<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ntpconfig: NTP Daemon (ntpd)</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ntpconfig
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('db/d0f/md__src_product-ref1_px-toolkit_etn_source_ntpconfig_NTP_and_NTP_OOB_Guide.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">NTP Daemon (ntpd) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>PX-Red uses a customized version of the NTP Daemon software for syncing the system clock to remote time servers. The PX-Red customizations to the NTP codebase allows the NTP Daemon to report status and clock change events to the NTP Out-of-Band (OOB) Objects. These NTP status and clock change events will in turn trigger the toolkit Configsubscriber proccess to perform the script actions detailed below.</p>
<h2>How NTP Adjusts the System Clock</h2>
<p>NTP uses two methods to adjust the system clock:</p>
<ul>
<li>Clockstep - If the system time is offset from the correct time by more than 1 second, NTP will step the system clock to within 1 second of the correct time. When a clockstep operation is performed, the Eaton custom code will update the <code>ClockAdjusted</code> OOB as well.</li>
<li>Slew - When the system time is within 1 second of being correct, NTP will incrementally slew the clock to the correct time. Because clock slewing is done in time critical functions, there is no custom code in these functions.</li>
</ul>
<h2>Configsubscriber Initialization and Action Scripts for NTP</h2>
<p>The <a href="../../../../rootfs/skeleton/etc/configsubscriber/configsubscriber.json">configsubscriber.json</a> initialization file sets up the following change event actions on Out-of-Band (OOB) object updates:</p>
<ol type="1">
<li>If the <code>DateTime</code> OOB is changed, then the <a href="../../../../rootfs/skeleton/sbin/datetimeset.sh">`datetimeset.sh`</a> and <a href="../.././rootfs/etc/configsubscriber/ntp_reboot">`ntp_reboot`</a> scripts are called.</li>
<li>If the <code>ClockAdjusted</code> OOB is written to, then the <a href="../../../../rootfs/skeleton/etc/configsubscriber/clockadjusted">`clockadjusted`</a> script is called.</li>
</ol>
<h2>NTP Out-of-Band (OOB) Object Initialization</h2>
<p>The following JSON files intitialize the default data for the OOBs defined below.</p>
<ul>
<li><a href="../../../../rootfs/skeleton/etc/cds/generic/97_datetime_defaults.json">Default initialization for the `DateTime` and `ClockAdjusted` OOBs</a>. <code>ClockAdjusted</code> OOB documentation is below. <a href="../../../../rootfs/documents/DateTime_OOB_Objects.md">DateTime OOB documentation</a></li>
<li><a href="../.././rootfs/etc/cds/generic/97_ntpd_defaults.json">Default initialization for the `NtpStatus` and `NtpConfig` OOBs</a>. <code>NtpStatus</code> and <code>NtpConfig</code> OOB documentation is below.</li>
</ul>
<h2>NTP Daemon Startup Process</h2>
<p>The <a href="../.././rootfs/etc/init.d/ntpd">NTP init script</a> will:</p>
<ol type="1">
<li>Read NTP configuration from the <b>DateTime</b> OOB.</li>
<li>Write the configured NTP servers and access restrictions to the <a href="../.././rootfs/etc/ntp.conf">NTP configuration file `ntp.conf`</a> using the <a href="../../ntpconfig.md">`ntpconfig` utility</a>. The default target filesystem location of the <code>ntp.conf</code> file is: The default NTP configuration file system location is: <blockquote class="doxtable">
<p>/etc/ntp.conf</p>
<p></p>
</blockquote>
</li>
<li>Start the <code>ntpd</code> daemon.</li>
</ol>
<h3>Best Practices for NTP Access Restrictions</h3>
<p>The access restriction settings written to the NTP configuration file are based on recommentations from the Network Time Foundation wiki <a href="http://support.ntp.org/bin/view/Support/AccessRestrictions">Access Restrictions</a>. See the <a href="../.././rootfs/etc/init.d/ntpd">NTP init script</a> for more access restriction details.</p>
<h1>NTP Daemon Configuration and Operation Out-of-Band (OOB) Objects</h1>
<p>The following NTP OOB objects support the configuration and operation of the NTP daemon <code>ntpd</code>:</p>
<ul>
<li><a href="../../../../documents/DateTime_OOB_Objects.md">DateTime</a> - NTP server configuration</li>
<li>ClockAdjusted - Trigger OOB for NTP clockstep.</li>
<li>NtpConfig - NTP operational mode configuration.</li>
<li>NtpStatus - NTP status.</li>
</ul>
<h2>ClockAdjusted OOB</h2>
<p>The NTP daemon writes "1" to this OOB on every clockstep. This OOB enables registering for system data/time changes with the Configsubscriber process.</p>
<ul>
<li><a href="../../../../rootfs/skeleton/etc/cds/generic/97_datetime_defaults.json">Default initialization for ClockAdjusted OOB</a>.</li>
<li><a href="../../../../rootfs/skeleton/etc/configsubscriber/configsubscriber.json">Default subscriptions for the Configsubscriber process</a>.</li>
<li><a href="../../../../rootfs/skeleton/etc/configsubscriber/clockadjusted">Default script the Configsubscriber runs when data/time changes occur</a>.</li>
</ul>
<h3>Fields</h3>
<h4>generic.StringData</h4>
<p>A generic value that triggers the Configsubscriber to run the <code>clockadjusted</code> script.</p>
<h3>Example</h3>
<p>```json { "toolkitStruct": { "generic": { "StringData":"1" }, "log_changes":false } } ```</p>
<h2>NtpConfig OOB</h2>
<h3>Fields</h3>
<h4>generic.StringData</h4>
<p>String - Defines the NTP operational mode. Used by <a href="../../../../rootfs/skeleton/sbin/datetimeset.sh">DateTime set script</a>. Possible mode values:</p>
<ul>
<li>"OFF"</li>
<li>"ON"</li>
<li>"STATIC_MANUAL"</li>
<li>"STATIC_AUTO"</li>
<li>"DHCP_MANUAL"</li>
<li>"DHCP_AUTO"</li>
</ul>
<h3>Example</h3>
<p>```json { "toolkitStruct": { "generic": { "StringData":"DHCP_MANUAL" } } } ```</p>
<h2>NtpStatus OOB</h2>
<h3>Fields</h3>
<h4>ntp_status</h4>
<p>String - Status of the NTP Daemon, synchronized NTP server, and NTP stratum level.</p>
<h5>state</h5>
<p>String - NTP daemon status. Possible status values:</p>
<ul>
<li>"Not running"</li>
<li>"Error, cannot find any NTP server!"</li>
<li>"Testing for valid NTP servers"</li>
<li>"Started, not synchronized"</li>
<li>"Synchronizing with NTP server"</li>
<li>"Synchronized"</li>
<li>"Stopped. Time correction exceeded sanity limit; set clock manually"</li>
<li>"Kernel time sync error!"</li>
<li>"Error, no NTP servers configured!"</li>
<li>"Clock Unsynchronized"</li>
<li>"Clock Error"</li>
</ul>
<h5>address</h5>
<p>String - Address of the synchronized NTP server.</p>
<h5>stratum</h5>
<p>Integer - Stratum level of the NTP synchronization.</p>
<h3>Example</h3>
<p>```json { "toolkitStruct": { "ntp_status": { "state":"SYNCHRONIZED", "address":"151.110.126.15", "stratum":3 }, "log_changes":false } } ``` </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 7 2021 20:25:50 for ntpconfig by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
