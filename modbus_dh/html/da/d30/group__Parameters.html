<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ModbusDeviceHandler: Channel and Internal Parameter details for the device_handler.</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ModbusDeviceHandler
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('da/d30/group__Parameters.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a>  </div>
  <div class="headertitle">
<div class="title">Channel and Internal Parameter details for the device_handler.</div>  </div>
</div><!--header-->
<div class="contents">

<p>The <a class="el" href="../../d4/dab/classCChannel.html" title="Channel class. ">CChannel</a> objects (measured/reported points found in the CDS and reported to PXI) and <a class="el" href="../../d9/d07/classCInternalParam.html" title="Internal &quot;parameter&quot; class. ">CInternalParam</a> objects (internal to the Device Handler, and not in the CDS, and therefore not visible to the outside) are derived from the <a class="el" href="../../df/d2c/classCParam.html" title="Base &quot;parameter&quot; class for Channels and Internal Parameters. ">CParam</a> class.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d4/dab/classCChannel.html">CChannel</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Channel class.  <a href="../../d4/dab/classCChannel.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d17/classCEqValueHandler.html">CEqValueHandler</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The Device Handler's implementation of "Translatable" object using CPxValue.  <a href="../../d3/d17/classCEqValueHandler.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d07/classCInternalParam.html">CInternalParam</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal "parameter" class.  <a href="../../d9/d07/classCInternalParam.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../df/d2c/classCParam.html">CParam</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base "parameter" class for Channels and Internal Parameters.  <a href="../../df/d2c/classCParam.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d1/ddc/classCCommand.html">CCommand</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Command class.  <a href="../../d1/ddc/classCCommand.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The <a class="el" href="../../d4/dab/classCChannel.html" title="Channel class. ">CChannel</a> objects (measured/reported points found in the CDS and reported to PXI) and <a class="el" href="../../d9/d07/classCInternalParam.html" title="Internal &quot;parameter&quot; class. ">CInternalParam</a> objects (internal to the Device Handler, and not in the CDS, and therefore not visible to the outside) are derived from the <a class="el" href="../../df/d2c/classCParam.html" title="Base &quot;parameter&quot; class for Channels and Internal Parameters. ">CParam</a> class. </p>
<p>Both types can have equations and both (along with <a class="el" href="../../de/d8a/classCDataBlock.html" title="Abstract &quot;Data Block&quot; class. ">CDataBlock</a>) can have conditional equation dependencies.</p>
<p>The IDs for Channels are assigned by the CDS; these IDs and the Channel Settings information will persist through reboots via the CDS after they have been profiled once by the Device Handler.</p>
<p>The (transient) IDs for Internal Parameters are assigned on instantiation by the Device Handler; the Internal Parameter information is not persisted and so must be created whenever a Device is profiled.</p>
<p>Before profiling a Device, the Data Blocks must be initialized and evaluated (though they have no data yet).</p>
<ol type="1">
<li>The Data Blocks may have conditional equations which must be evaluated.</li>
<li>The states for the Data Blocks all progress from Provisional (if there is a conditional dependency) to Pending_Update to Valid.</li>
</ol>
<p>The Internal Parameters are evaluated before the Channels. They follow a simpler set of states than the Channels, since they don't go to the CDS and can get transient IDs right away. This flow is implemented in <a class="el" href="../../d2/d76/classCDevice.html#a623f52fff7f402a7e9746e93e8996fc2" title="Create and initialize the Internal Parameters called for by the EDS. ">CDevice::initialize_internal_params()</a> and <a class="el" href="../../d9/d07/classCInternalParam.html#a41e8042ceef897236fbf50833c959cb9" title="Initialize this Internal Parameter from its EDS information. ">CInternalParam::initialize_param()</a></p>
<ol type="1">
<li>The EDS is parsed to get the Internal Parameter Settings, translation (perhaps equation), and perhaps a conditional dependency equation or static Value</li>
<li>The Internal Parameter gets a transient ID, and is added to the Device's map of Internal Parameters.</li>
<li>The translation is evaluated<ol type="a">
<li>If the mapping from device data is direct, the Internal Parameter state becomes Pending_Update. Its source and target IDs are added to the dependency graph.</li>
<li>If it has an equation, the equation is initialized and parsed; the Internal Parameter state becomes Provisional. The source IDs are not evaluated yet.</li>
<li>If the translation evaluation fails, the Internal Parameter is removed from the Device.</li>
</ol>
</li>
<li>If there is a conditional dependency equation, it is initialized and parsed; the Internal Parameter state becomes Provisional.</li>
</ol>
<p>When profiling a Device for the first time (ie, not yet in the CDS), each Channel is evaluated and created in this order: This flow is implemented in <a class="el" href="../../d2/d76/classCDevice.html#a86e0d795f0cc71ab61e023d4213c36ab" title="Create and initialize the Channels called for by the EDS. ">CDevice::initialize_channel_params()</a> and <a class="el" href="../../d4/dab/classCChannel.html#a11e5afc5fa8cb59a139eafdc942299c9" title="Initialize this Channel, and its ChannelSettings, from its EDS information. ">CChannel::initialize_param()</a></p>
<ol type="1">
<li>The EDS is parsed to get the Channel Settings, translation (perhaps equation), and perhaps a conditional dependency equation or static Value</li>
<li>The Channel is added to the CDS with its Settings, and gets an ID from the CDS, and is added to the Device's map of Channels.</li>
<li>The translation is evaluated<ol type="a">
<li>If the mapping from device data is direct, the Channel state becomes Pending_Update. Its source and target IDs are added to the dependency graph.</li>
<li>If it has an equation, the equation is initialized and parsed; the Channel state becomes Provisional. The source IDs are not evaluated yet.</li>
<li>If the translation evaluation fails, the Channel is removed from the CDS and Device.</li>
</ol>
</li>
<li>If there is a conditional dependency equation, it is initialized and parsed; the Channel state becomes Provisional.</li>
</ol>
<p>The process is simplified when we find the Channels in the CDS at startup; we assume that we don't have to reprove these Channels. These steps are followed: This flow is implemented in <a class="el" href="../../d2/d76/classCDevice.html#a86e0d795f0cc71ab61e023d4213c36ab" title="Create and initialize the Channels called for by the EDS. ">CDevice::initialize_channel_params()</a> and <a class="el" href="../../d4/dab/classCChannel.html#a3149c9e47836222d82b3f3d4675922c0" title="RE-Initialize this Channel, which is already in the CDS, from its EDS information. ">CChannel::reinitialize_channel()</a></p>
<ol type="1">
<li>The EDS is parsed to get the Channel Settings, translation (perhaps equation), and perhaps a conditional dependency equation or static Value</li>
<li>The Channel is added to the Device's map of Channels and given a state of Pending_Update.</li>
<li>The translation is evaluated<ol type="a">
<li>If the mapping from device data is direct, its source and target IDs are added to the dependency graph.</li>
<li>If it has an equation, the equation is initialized and parsed; The source IDs are looked up, since all are known at this point.</li>
<li>(Unlikely) If the translation evaluation fails, the Channel is removed from the CDS and Device.</li>
</ol>
</li>
<li>If there is a conditional dependency equation, it is initialized and parsed; the Channel state becomes Provisional in this case.</li>
</ol>
<p>After all the Internal Parameters and Channels have been initialized as above, then the Provisional ones are re-evaluated (with Internal Parameters processed before Channels): This flow is implemented in <a class="el" href="../../d2/d76/classCDevice.html#a5b95ae29dd0e5aa33b5cf7d165f8f151" title="Re-evaluate the Internal Parameters or Channels to fill out the dependencies. ">CDevice::reevaluate_params()</a> and <a class="el" href="../../df/d2c/classCParam.html#a63053de958301306b4062c7573d9e0de" title="Lookup the sources for the equation for this parameter, and add them to this parameter&#39;s list of sour...">CParam::lookup_eqn_variables()</a></p>
<ol type="1">
<li>The IDs of the equation and conditional equation Sources are all looked up.<ol type="a">
<li>If any fail to be found or are still Provisional, then the Parameter is removed from the CDS and Device.</li>
</ol>
</li>
<li>The source and target IDs are added to the dependency graph. If that fails (eg, due to a circular dependency), the Parameter is removed from the CDS and Device.</li>
<li>Now the Parameter state becomes Pending_Update. As a simple solution to resolving order-of-evaluation problems, we do a second pass through this code, and only do the actual removal of Params on this second pass.</li>
</ol>
<p>After all the Data Blocks, Internal Parameters, and Channels have been re-evaluated, then the polling of Data Blocks commences.</p>
<ol type="1">
<li>As each Data Block is received, its Targets are all evaluated and provided with Values<ol type="a">
<li>If the Parameter has an conditional equation, it attempts to evaluate that equation.<ol type="i">
<li>If any of the term(s) are not yet Valid, the Parameter Value is not evaluted yet.</li>
<li>If the equation evaluates to False, the Parameter is removed from the Device. If it is a Channel, it is removed from the CDS.</li>
<li>Once the conditional equation is evaluated, it is cleared from this Parameter, as it is no longer needed.</li>
</ol>
</li>
<li>If the Parameter has an equation, its Sources are all checked; if any are not yet Valid, then the Parameter is not updated yet.</li>
<li>When each Parameter gets a Value, its state is changed to Valid.</li>
</ol>
</li>
<li>Once all the Data Blocks have been polled and their Targets evaluated,<ol type="a">
<li>All of the Internal Parameters and Channels are rechecked to see if any are still Pending_Update; any of these are removed from the CDS and Device, and an error is logged.</li>
<li>Now the Device's flag for not_communicating is cleared and prioritized polling starts.</li>
</ol>
</li>
</ol>
<p>For the case of persisted Devices and Channels, it is possible (though unlikely) for the conditional equation to evaluate to False. Note that in this case, however, we won't detect Channels whose dependencies have become valid, so such Channels won't be restored. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 7 2021 20:25:20 for ModbusDeviceHandler by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
