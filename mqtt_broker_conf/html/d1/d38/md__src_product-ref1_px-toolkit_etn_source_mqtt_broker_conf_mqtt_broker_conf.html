<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>mqtt_broker_conf: MQTT Broker Config Program (mqtt_broker_conf)</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">mqtt_broker_conf
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d1/d38/md__src_product-ref1_px-toolkit_etn_source_mqtt_broker_conf_mqtt_broker_conf.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">MQTT Broker Config Program (mqtt_broker_conf) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <code>mqtt_broker_conf</code> program is Eaton code to transform the input from the MqttBrokerSettings OOB (Out Of Band) object into a mosquitto.conf file to control the operation of the Mosquitto MQTT Broker.</p>
<p>The purpose of the MqttBrokerSettings OOB is to define that input, allowing the UI to change the settings in that OOB. The mqtt_broker_conf program is run before starting the Mosquitto mqtt_broker (in <a href="../.././rootfs/etc/init.d/mqtt_broker">its initialization script</a>), and this program parses that OOB and uses the contents to generate the appropriate mosquitto.conf output.</p>
<p>Information about running the Mosquitto MQTT Broker can be found on the <a href="https://mosquitto.org/man/mosquitto-8.html">Mosquitto man page</a>.</p>
<h2>How to enable Mosquitto and MQTT Broker Config and in your product</h2>
<p>Follow steps 1 and 2 below to enable building and running the MQTT Broker and MQTT Device Handler services.</p>
<h3>Step 1: Enable building the Mosquitto MQTT Broker and MQTT Broker Config</h3>
<p>Edit your project root <code>config</code> file and add the following entries. Rebuild your project. </p>
<pre class="fragment">###############################
## Eaton Software
###############################

# Enable MQTT Broker, Library, and associated components
CONFIG_EATON_MQTT_BROKER?=y
export CONFIG_EATON_MQTT_BROKER
</pre><h3>Step 2: Enable MQTT Broker Config service</h3>
<h4>Edit the project rc.conf.product file</h4>
<p>Open the project <code>rootfs/etc/rc.conf.product</code> file and add the following lines to enable the MQTT Broker Config service. </p>
<pre class="fragment"># Enable the MQTT Broker
mqtt_broker_enable=y
</pre><h2>mqtt_broker_conf examples</h2>
<p>A few examples showing how <code>mqtt_broker_conf</code> can be used to set and unset OOB key label settings:</p>
<h3>Set</h3>
<p>``` Set default listener port: mqtt_broker_conf -s "port,1883" -u "bind_address,EMPTY" "extra_listener,EMPTY"</p>
<p>Set bind address for default listener port: mqtt_broker_conf -s "bind_address,127.0.0.1"</p>
<p>Set Extra Listener: mqtt_broker_conf -s "extra_listener,8883"</p>
<p>Enable TLS settings for the Extra Listener: </p>
<pre class="fragment">mqtt_broker_conf -s "extra_cafile,/flash/certificates/mqtt/test1_ca.crt"
mqtt_broker_conf -s "extra_certfile,/flash/certificates/mqtt/test1_server.crt"
mqtt_broker_conf -s "extra_keyfile,/flash/certificates/mqtt/test1_server.key"
mqtt_broker_conf -s "extra_require_certificate,true"
</pre><p>Or on a single line (note space between each key label/value pair ): </p>
<pre class="fragment">mqtt_broker_conf -s "extra_cafile,/flash/certificates/mqtt/test1_ca.crt" "extra_certfile,/flash/certificates/mqtt/test1_server.crt" "extra_keyfile,/flash/certificates/mqtt/test1_server.key" "extra_require_certificate,true"
</pre><p> ```</p>
<h3>Unset</h3>
<p>``` Remove default listener bind address: mqtt_broker_conf -u "bind_address,EMPTY"</p>
<p>Remove Extra Listener: mqtt_broker_conf -u "extra_listener,EMPTY"</p>
<p>Disable TLS settings for the Extra Listener: </p>
<pre class="fragment">mqtt_broker_conf -u "extra_cafile,EMPTY"
mqtt_broker_conf -u "extra_certfile,EMPTY"
mqtt_broker_conf -u "extra_keyfile,EMPTY"
mqtt_broker_conf -u "extra_require_certificate,EMPTY"
</pre><p>Or on a single line (note space between each key label/value pair ): </p>
<pre class="fragment">    mqtt_broker_conf -u "extra_cafile,EMPTY" "extra_certfile,EMPTY" "extra_keyfile,EMPTY" "extra_require_certificate,EMPTY"
</pre><p>```</p>
<h2>mqtt_broker_conf Usage</h2>
<p>The compact usage and command line arguments for mqtt_broker_conf are:</p>
<p>``` ~ # mqtt_broker_conf &ndash;help</p>
<p>Program to generate a mosquitto broker conf file from OOB data. Defaults will generate the primary conf file, but extension conf files can be created and placed in the folder specified by the primary's "include_dir" directive.</p>
<p>Usage: mqtt_broker_conf [-D &lt;verbosity&gt;] [-Ns] [-dbp &lt;dir&gt;] [&ndash;show-disabled] [&ndash;show-details] [-fn &lt;filename&gt;] [-h] [-hv] [-p &lt;dir&gt;] [&ndash;console-output] [-s &lt;key_label[,value]&gt; [key_label [,value]]...] [-t &lt;tag&gt;] [-u key_label[,value]] [-v]</p>
<p>-D : Set the application's debugging verbosity level -Ns : Don't direct MQTT log messages to syslogd -dbp : Directory path for the persistent MQTT Broker database files. -disd : Include 'disabled' items in the conf file output. -dtls : Print the full item details into the conf file output. -fn : Filename for the output conf file. -h : Print usage information to stderr and exit -hv : Print detailed/verbose usage information to stderr and exit -p : Directory path to which output conf file is to be written. -ptc : Print the conf output to the system console. -s : Enable, and optionally set key values. -t : Tag (name) of the OOB that is input for the output conf file. -u : Disable, and optionally unset key values. -v : Print version information to stderr and exit ```</p>
<p>The extended usage and command line arguments for mqtt_broker_conf are:</p>
<p>``` ~ # mqtt_broker_conf -hv</p>
<p>Program to generate a mosquitto broker conf file from OOB data. Defaults will generate the primary conf file, but extension conf files can be created and placed in the folder specified by the primary's "include_dir" directive.</p>
<p>Usage: mqtt_broker_conf [-D &lt;verbosity&gt;] [-Ns] [-dbp &lt;dir&gt;] [&ndash;show-disabled] [&ndash;show-details] [-fn &lt;filename&gt;] [-h] [-hv] [-p &lt;dir&gt;] [&ndash;console-output] [-s &lt;key_label[,value]&gt; [key_label [,value]]...] [-t &lt;tag&gt;] [-u key_label[,value]] [-v]</p>
<p>-D : &ndash;debug : Set the application's debugging verbosity level </p>
<pre class="fragment">      This option sets the debugging verbosity level of the application.
      Verbosity levels vary from 0, at which point only the most critical
      messages are displayed, to &gt;=5, beyond which every function call
      prints its entry &amp; exit point.  Output may be directed to stderr as
      well as to the Linux system log service.

      (default: 0)
</pre><p>-Ns : &ndash;no-syslogd : Don't direct MQTT log messages to syslogd </p>
<pre class="fragment">           By default the MQTT Broker prints messages to syslog(3).
           If you want to turn this off for debugging the MQTT Broker (run
           in non-daemonized mode), use this option.

           (default: false)
</pre><p>-dbp : &ndash;databasepath : Directory path for the persistent MQTT Broker database files. </p>
<pre class="fragment">             Sets the path for the 'persistent' conf file output from this
             program.
             Overwrites the persistence_location field in output conf file
             with this path.

             (default: /initlo/data/app/mqtt_broker/)
</pre><p>-disd : &ndash;show-disabled : Include 'disabled' items in the conf file output. </p>
<pre class="fragment">              Normally 'disabled' items are not included in the output;
              if enabled, they will be printed (with the '#' to comment
              them out).

              (default: false)
</pre><p>-dtls : &ndash;show-details : Print the full item details into the conf file output. </p>
<pre class="fragment">             Normally just the terse 'tool_tip' line is included in the
             output;
             if enabled, the Description line(s) will be printed instead.

             (default: false)
</pre><p>-fn : &ndash;filename : Filename for the output conf file. (default: mqtt_broker.conf)</p>
<p>-h : &ndash;help : Print usage information to stderr and exit </p>
<pre class="fragment">     This prints general usage information, including a program synopsis
     and general description for each option.
</pre><p>-hv : &ndash;usage : Print detailed/verbose usage information to stderr and exit </p>
<pre class="fragment">      This prints usage information similar to that shown for "--help";
      however, extra details are shown for this flag, including a more
      in-depth discussion of each option and displaying default values.
</pre><p>-p : &ndash;path : Directory path to which output conf file is to be written. </p>
<pre class="fragment">     Sets the path for the conf file output from this program.

     (default: /etc)
</pre><p>-ptc : &ndash;console-output : Print the conf output to the system console. </p>
<pre class="fragment">               Print the conf output to the system console.

               (default: false)
</pre><p>-s : &ndash;set : Enable, and optionally set key values. </p>
<pre class="fragment">    Enable, and optionally set key values. Use a value of "EMPTY" to clear
    string values
    Examples:
    Enable 'log_type' 'error': -s log_error
    Set 'cafile' : -s "cafile,/flash/certificates/mqtt/m2mqtt_ca.crt"
    Set 'capath' : -s "capath,/flash/certificates/mqtt"
    *** key_label {type [default]} ***
    cafile (TLS/PEM) {str []}
    capath (TLS/PEM) {str []}
    certfile (TLS/PEM) {str []}
    keyfile (TLS/PEM) {str []}
    tls_version (TLS) {str [tlsv1.2]}
    require_certificate (TLS) {bool [false]}
    use_identity_as_username (TLS/PSK) {bool [false]}
    crlfile (TLS/PEM) {str []}
    ciphers (TLS) {str [DEFAULT:!aNULL:!eNULL:!LOW:!EXPORT:!SSLv2:@STRENGTH]
    }
    psk_hint (TLS/PSK) {str []}
    psk_ciphers (TLS/PSK) {str []}
    psk_file (TLS/PSK) {str []}
    extra_listener {str []}
    extra_cafile (TLS/PEM) {str []}
    extra_capath (TLS/PEM) {str []}
    extra_certfile (TLS/PEM) {str []}
    extra_keyfile (TLS/PEM) {str []}
    extra_require_certificate (TLS) {bool [false]}
    extra_use_identity_as_username (TLS/PSK) {bool [false]}
    extra_crlfile (TLS/PEM) {str []}
    extra_psk_hint (TLS/PSK) {str []}
    extra_psk_ciphers (TLS/PSK) {str []}
    bridge_cafile (TLS/PEM) {str []}
    bridge_capath (TLS/PEM) {str []}
    bridge_insecure (TLS/PEM) {bool [false]}
    bridge_certfile (TLS/PEM) {str []}
    bridge_keyfile (TLS/PEM) {str []}
    bridge_psk (TLS/PSK) {str []}
    bridge_identity (TLS/PSK) {str []}
    -- See also the mosquitto-tls man page and the Certificate based
    SSL/TLS support section --
    listener {str []}
    log_timestamp {bool [true]}
    log_error
    log_warning
    log_notice
    log_information
    log_debug
    log_subscribe
    log_unsubscribe
    log_websockets
    log_all

    (default: )
</pre><p>-t : &ndash;oobtag : Tag (name) of the OOB that is input for the output conf file. (default: MqttBrokerSettings)</p>
<p>-u : &ndash;unset : Disable, and optionally unset key values. </p>
<pre class="fragment">      Disable, and optionally unset key values. Use a value of "EMPTY" to
      clear a string value.
      Examples:
      Disable 'log_type' 'error': -u log_error
      Disable 'cafile' : -u cafile
      Disable and unset 'capath' : -u "capath,EMPTY"
      *** key_label {type [default]} ***
      cafile (TLS/PEM) {str []}
      capath (TLS/PEM) {str []}
      certfile (TLS/PEM) {str []}
      keyfile (TLS/PEM) {str []}
      tls_version (TLS) {str [tlsv1.2]}
      require_certificate (TLS) {bool [false]}
      use_identity_as_username (TLS/PSK) {bool [false]}
      crlfile (TLS/PEM) {str []}
      ciphers (TLS) {str [DEFAULT:!aNULL:!eNULL:!LOW:!EXPORT:!SSLv2:@STRENGT
      H]}
      psk_hint (TLS/PSK) {str []}
      psk_ciphers (TLS/PSK) {str []}
      psk_file (TLS/PSK) {str []}
      extra_listener {str []}
      extra_cafile (TLS/PEM) {str []}
      extra_capath (TLS/PEM) {str []}
      extra_certfile (TLS/PEM) {str []}
      extra_keyfile (TLS/PEM) {str []}
      extra_require_certificate (TLS) {bool [false]}
      extra_use_identity_as_username (TLS/PSK) {bool [false]}
      extra_crlfile (TLS/PEM) {str []}
      extra_psk_hint (TLS/PSK) {str []}
      extra_psk_ciphers (TLS/PSK) {str []}
      bridge_cafile (TLS/PEM) {str []}
      bridge_capath (TLS/PEM) {str []}
      bridge_insecure (TLS/PEM) {bool [false]}
      bridge_certfile (TLS/PEM) {str []}
      bridge_keyfile (TLS/PEM) {str []}
      bridge_psk (TLS/PSK) {str []}
      bridge_identity (TLS/PSK) {str []}
      -- See also the mosquitto-tls man page and the Certificate based
      SSL/TLS support section --
      listener {str []}
      log_timestamp {bool [true]}
      log_error
      log_warning
      log_notice
      log_information
      log_debug
      log_subscribe
      log_unsubscribe
      log_websockets
      log_all

      (default: )
</pre><p>-v : &ndash;version : Print version information to stderr and exit </p>
<pre class="fragment">        This option prints usage and version information, including the
        Toolkit version, build date, and revision number.
</pre><p>```</p>
<p>The arguments used in a particular target can be found with the <code>showcfg</code> argument to the <code>/etc/init.d/mqtt_broker</code> script:</p>
<p>``` ~ $ sudo /etc/init.d/mqtt_broker showcfg Configured arguments for /etc/init.d/mqtt_broker start: mosquitto /bin/mqtt_broker_conf -p /etc -fn mosquitto.conf -dbp /flash/mosquitto -d -c /etc/mosquitto.conf </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 7 2021 20:26:15 for mqtt_broker_conf by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
