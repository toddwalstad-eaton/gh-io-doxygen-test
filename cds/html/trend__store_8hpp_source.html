<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>cds_ng: trend_store.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">cds_ng
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('trend__store_8hpp_source.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">trend_store.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#ifndef _TREND_STORE_HPP</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define _TREND_STORE_HPP</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;mutex&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;future&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;thread&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;chrono&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;deque&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;px/db/key_value_store.hpp&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;px/data/trend_stage_update.hpp&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;px/type/string.hpp&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;px/data/channel_selector.hpp&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;px/data/channel_trends.hpp&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;px/type/wall_time.hpp&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;trends_cache.hpp&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;px/db/adapter.hpp&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">class </span><a class="code" href="classCDataStore.html">CDataStore</a>;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#define TREND_INTERVAL_MINUTES 5</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define TREND_CLOSING_OFFSET_MINUTES 1</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="classCTrendStore.html">   36</a></span>&#160;<span class="keyword">class </span><a class="code" href="classCTrendStore.html">CTrendStore</a></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;{</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="keyword">public</span>:</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <a class="code" href="classCTrendStore.html#a80c34117d445d20b3693ae3912965f6a">CTrendStore</a>( <span class="keyword">const</span> px::string &amp;db_path, <a class="code" href="classCDataStore.html">CDataStore</a> *cds );</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        <a class="code" href="classCTrendStore.html#a6f9b1751fe0369d638abf337c9b1844f">~CTrendStore</a>();</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a41b47ef0bf30a13c7141c7a101d2154f">   62</a></span>&#160;        <span class="keyword">inline</span> <span class="keyword">static</span> uint32_t <a class="code" href="classCTrendStore.html#a41b47ef0bf30a13c7141c7a101d2154f">get_stage_db_index</a>( uint32_t time )</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                <span class="comment">// we need to return zero if invalid, so we know that the time is open ended.</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                <span class="keywordflow">if</span> ( unlikely( time == 0 ) )</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                        <span class="keywordflow">return</span> ( 0 );</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                <span class="keywordflow">return</span> ( ( time - 1 ) / ( 24 * 60 ) + 1 );</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="classCTrendStore.html#aac019b1e6569b8ede89d5c09589f8aec">   79</a></span>&#160;        <span class="keyword">inline</span> <span class="keyword">static</span> uint32_t <a class="code" href="classCTrendStore.html#aac019b1e6569b8ede89d5c09589f8aec">get_stage_db_index</a>( <span class="keyword">const</span> px::CWallTime &amp;time )</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                <span class="comment">// we need to return zero if invalid, so we know that the time is open ended.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                <span class="keywordflow">if</span> ( unlikely( !time.valid() ) )</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                        <span class="keywordflow">return</span> ( 0 );</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                }</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                uint32_t minutes = 0;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                <span class="keywordtype">bool</span> on_interval = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <span class="comment">// normalize the time to 5 minute.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                px::db::get_normalized_interval_timestamp( time, TREND_INTERVAL_MINUTES, minutes,</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                                                                                                   on_interval );</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                <span class="keywordflow">return</span> ( <a class="code" href="classCTrendStore.html#a41b47ef0bf30a13c7141c7a101d2154f">get_stage_db_index</a>( minutes ) );</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#a2c6ee12af0640fab076136d51a6994c6">get_stage_db_minutes_range</a>( uint32_t stage_index,</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                                                                                                   uint32_t &amp;from, uint32_t &amp;to );</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#ad1c7deb03bf9c342c8ca5e554f2f8cf2">store</a>( std::vector&lt;std::shared_ptr&lt;px::CTrendStageUpdate&gt; &gt; &amp;updates );</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        <span class="comment">// void MoveStageToBucketAsync(uint32_t active_stage_index);</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        std::vector&lt;px::CChannelTrends&gt; <a class="code" href="classCTrendStore.html#a59ae14f650ab7f058f8dd0c52bd15610">QueryTrends</a>( <span class="keyword">const</span> std::unordered_map&lt;uint32_t, px::datatype&gt; &amp;channels,</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                                                                                                 <span class="keyword">const</span> <span class="keywordtype">bool</span> complete_snapshots, <span class="keyword">const</span> px::CWallTime &amp;start_time,</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                                                                                                 <span class="keyword">const</span> px::CWallTime &amp;requested_end_time,</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                                                                                 <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> request_period, <span class="keyword">const</span> <span class="keywordtype">bool</span> include_avg,</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                                                                                                 <span class="keyword">const</span> <span class="keywordtype">bool</span> include_min, <span class="keyword">const</span> <span class="keywordtype">bool</span> include_max,</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                                                                                 <span class="keyword">const</span> <span class="keywordtype">bool</span> include_actual, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> row_limit,</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                                                                                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> absolute_count_limit,</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                                                                                 <span class="keywordtype">bool</span> &amp;more_data ) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#ad76f4c4b0dcfec8ec3c34af58aead9fc">DeleteTrends</a>( <span class="keyword">const</span> std::unordered_set&lt;uint32_t&gt; &amp;channel_ids,</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                                           <span class="keyword">const</span> px::CWallTime &amp;start_time,</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                                           <span class="keyword">const</span> px::CWallTime &amp;end_time );</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#ad76f4c4b0dcfec8ec3c34af58aead9fc">DeleteTrends</a>( <span class="keyword">const</span> px::CWallTime &amp;start_time,</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                                           <span class="keyword">const</span> px::CWallTime &amp;end_time );</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="comment">//      / @param clear_existing By default, all existing trend logs are cleared.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="comment">//      /                       If false, do not clear data (data for channels</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="comment">//      /                       and times in the file will still be overwritten)</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;<span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#a7adaa6fa7bd22a8800383313c072dd89">ImportTrends</a>( <span class="keyword">const</span> px::string &amp;file_path, <span class="keywordtype">int</span> &amp;row_count,</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                           <span class="keywordtype">int</span> &amp;value_count, <span class="keyword">const</span> <span class="keywordtype">bool</span> stage_only = <span class="keyword">false</span>,</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                           <span class="keyword">const</span> <span class="keywordtype">bool</span> bucket_only = <span class="keyword">false</span> );</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#ae5e4b974f877eb1a20e2793e55ded3fe">ExportTrends</a>( std::ofstream &amp;file,</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                           <span class="keyword">const</span> std::vector&lt;uint32_t&gt; &amp;channel_ids,</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                                           <span class="keyword">const</span> std::unordered_map&lt;uint32_t, px::datatype&gt; &amp;channels,</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                                           <span class="keyword">const</span> std::unordered_map&lt;uint32_t, std::bitset&lt;4&gt; &gt; &amp;channel_traits_map,</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                                           <span class="keyword">const</span> px::CWallTime &amp;start_time, <span class="keyword">const</span> px::CWallTime &amp;end_time,</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                           <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> request_period, <span class="keyword">const</span> <span class="keywordtype">bool</span> include_avg,</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                           <span class="keyword">const</span> <span class="keywordtype">bool</span> include_min, <span class="keyword">const</span> <span class="keywordtype">bool</span> include_min_time,</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                                           <span class="keyword">const</span> <span class="keywordtype">bool</span> include_max, <span class="keyword">const</span> <span class="keywordtype">bool</span> include_max_time,</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                                           <span class="keyword">const</span> <span class="keywordtype">bool</span> include_actual, <span class="keyword">const</span> <span class="keywordtype">bool</span> include_stage,</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                                           <span class="keyword">const</span> <span class="keywordtype">bool</span> include_bucket, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> row_limit,</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                                           <span class="keyword">const</span> <span class="keywordtype">bool</span> export_local_time,</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                                           <span class="keywordtype">bool</span> &amp;more_data, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;values_count,</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                                           <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;row_count );</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00230"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a7cb4834d713541e10da83599510d7d0a">  230</a></span>&#160;        <span class="keyword">inline</span> uint32_t <a class="code" href="classCTrendStore.html#a7cb4834d713541e10da83599510d7d0a">get_live_stage_index</a>()</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                std::lock_guard&lt;std::mutex&gt; lock { <a class="code" href="classCTrendStore.html#a44927ca732bb1f6d1d52cda6f27c3137">_mutex</a> };</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                <span class="keywordflow">return</span> ( <a class="code" href="classCTrendStore.html#a2d11f0b2effabc57610f3cb4cdf61be0">_live_stage_index</a> );</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        std::shared_ptr&lt;px::db::CKeyValueStore&gt; <a class="code" href="classCTrendStore.html#af183006bcd799d8d92565050a88b2840">get_stage_db</a>( uint32_t stage_index );</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="classCTrendStore.html#abe2f003c5a6584f6d082ea19a1a0bc46">  249</a></span>&#160;        <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#abe2f003c5a6584f6d082ea19a1a0bc46">update_live_interval</a>( <span class="keyword">const</span> px::CWallTime time )</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                uint32_t minutes = 0;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                <span class="keywordtype">bool</span> on_interval = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                px::db::get_normalized_interval_timestamp( time, TREND_INTERVAL_MINUTES, minutes,</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                                                                                   on_interval );</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                {       <span class="comment">// lock scope</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                        std::lock_guard&lt;std::mutex&gt; lock { <a class="code" href="classCTrendStore.html#a44927ca732bb1f6d1d52cda6f27c3137">_mutex</a> };</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                        <a class="code" href="classCTrendStore.html#a9d701b44bb5466effefa1d56bbd30817">_live_interval</a> = minutes;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                }</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        uint32_t <a class="code" href="classCTrendStore.html#a447cb6335f985ba76c8df57038e87707">get_migration_count</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#a96d9c92e871bdf011ddde3f905dad5a6">get_levelup_policy</a>( uint32_t &amp;min_free_space_mb,</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                                                         uint32_t &amp;time_threshold_5min,</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                                                         uint32_t &amp;time_threshold_15min,</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                                                         uint32_t &amp;time_threshold_60min,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                                         uint32_t &amp;step_days );</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a3e0a3801eca59a3883f8ae45e2cb7c04">  283</a></span>&#160;        <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classCTrendStore.html#a3e0a3801eca59a3883f8ae45e2cb7c04">signal_ready_to_levelup</a>()</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                std::lock_guard&lt;std::mutex&gt; lock { <a class="code" href="classCTrendStore.html#a44927ca732bb1f6d1d52cda6f27c3137">_mutex</a> };</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="classCTrendStore.html#ab6b7c953b384ace84b214be2fee0c7f7">_levelup_in_progress</a> )</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                {</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                        <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                <a class="code" href="classCTrendStore.html#ab6b7c953b384ace84b214be2fee0c7f7">_levelup_in_progress</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                <span class="keywordflow">return</span> ( <span class="keyword">true</span> );</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#ad2047a9303a805c0334733c49008f229">BucketCleanup</a>();</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment">// void levelup_shrink_bucket_async();</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        uint64_t <a class="code" href="classCTrendStore.html#a6e863b54d7952319a18dec47ed37e2d0">get_trend_bucket_disk_free_space</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        uint64_t <a class="code" href="classCTrendStore.html#abbed5e2aa6e0b8e93f2b0a65a343d0fe">get_trend_bucket_disk_usage</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#aaa334e0679e3d2c956286b49ae54385f">get_trended_channels</a>( std::unordered_set&lt;uint32_t&gt; &amp;trended_channels ) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        std::tuple&lt;bool, std::vector&lt;uint32_t&gt;, <span class="keywordtype">double</span>&gt; <a class="code" href="classCTrendStore.html#a85aecef759f13455e6ed202b75971eb1">move_stage_to_bucket</a>( uint32_t cutoff );</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="keyword">private</span>:</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        std::tuple&lt;bool, double&gt; <a class="code" href="classCTrendStore.html#a634f8304b324e61a428bb00193e5332a">levelup_bucket</a>( <span class="keyword">const</span> uint32_t time_threshold_5min,</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                                                                                         <span class="keyword">const</span> uint32_t time_threshold_15min,</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                                                                                         <span class="keyword">const</span> uint32_t time_threshold_60min,</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                                                                                         <span class="keyword">const</span> <span class="keywordtype">size_t</span> num_trended_channels );</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#abc8c75eccfec80c4db86f8d5eb0f5a28">load_stage_dbs</a>();</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#a8a35bb8b7a967d2dc7664282ffa0f717">initilize_todays_stage_db</a>();</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        px::string <a class="code" href="classCTrendStore.html#acb1baa80b5173ec9aa49dc6eae66acc7">get_stage_db_path</a>( uint32_t stage_index );</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        px::string <a class="code" href="classCTrendStore.html#a7e150ff2403542b0b5d70d6e669f09e3">get_obsolete_stage_db_path</a>( uint32_t stage_index );</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a4773db0924d8fb7f24e7ffa2bc8d5fdf">  389</a></span>&#160;        <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#a4773db0924d8fb7f24e7ffa2bc8d5fdf">reset_levelup_in_progress</a>()</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                std::lock_guard&lt;std::mutex&gt; lock { <a class="code" href="classCTrendStore.html#a44927ca732bb1f6d1d52cda6f27c3137">_mutex</a> };</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                <a class="code" href="classCTrendStore.html#ab6b7c953b384ace84b214be2fee0c7f7">_levelup_in_progress</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#a1ae59ffbcf7cd9859ca3020ef1b82f8c">simple_wait_timer</a>( <span class="keywordtype">int</span> delay_ms );</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#a3e9f7f12e9675a8cfe5f53231b94d459">move_obsolete_stage_dbs_to_bucket</a>();</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#a1ecb59e829d27ea473fd0e7088b687e3">poke_obsolete_move_task</a>();</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#af6254f613e306e2f2a56a0cfc0a44206">query_db</a>( std::shared_ptr&lt;px::db::CKeyValueStore&gt; db, <span class="keywordtype">bool</span> is_bucket,</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                                   px::CChannelTrends &amp;trends, <span class="keyword">const</span> px::CWallTime &amp;start_time,</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                                   <span class="keyword">const</span> px::CWallTime &amp;end_time, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> request_period,</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                                   <span class="keyword">const</span> <span class="keywordtype">bool</span> include_avg, <span class="keyword">const</span> <span class="keywordtype">bool</span> include_min,</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                                   <span class="keyword">const</span> <span class="keywordtype">bool</span> include_max, <span class="keyword">const</span> <span class="keywordtype">bool</span> include_actual,</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                                   <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> row_count_limit,</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                                   <span class="keywordtype">bool</span> &amp;more_data ) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classCTrendStore.html#aa8e893b14ce6ed5519bf821d0ff61ff8">merge_query_results</a>( px::CChannelTrends &amp;dst,</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                                                                          <span class="keyword">const</span> px::CChannelTrends &amp;src ) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classCTrendStore.html#a5298304047fcadedef46745e9f333bfc">is_snapshot_complete</a>( <span class="keyword">const</span> uint32_t time,</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                                                           px::CWallTime &amp;latest_complete_time ) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keyword">static</span> std::string <a class="code" href="classCTrendStore.html#af3ef25a164ceaf87e84b5255aaa95320">get_trend_trait_value</a>( <span class="keyword">const</span> px::datatype datatype,</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                                                                                          <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;value );</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#a2c94e65314866abaca128481843649bb">get_database_settings</a>( uint32_t &amp;min_free_space_mb,</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                                                uint32_t &amp;levelup_days_5min,</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                                                                uint32_t &amp;levelup_days_15min,</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                                                                uint32_t &amp;rolloff_days_60min,</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                                                                uint32_t &amp;step_days ) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="keywordtype">void</span> delete_untrended_channels_bucket_db( <span class="keyword">const</span> std::set&lt;px::id_t&gt; &amp;channels );</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classCTrendStore.html#a7e4d66d37243f7e9ea1b707adac67a0c">get_folder_size</a>( <span class="keyword">const</span> std::string &amp;path,</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                                                                 uint64_t &amp;file_size );</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div>
<div class="line"><a name="l00471"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a57b273270664f9dfebfba578c629f580">  471</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classCTrendStore.html#a57b273270664f9dfebfba578c629f580">_move_in_progress</a>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;</div>
<div class="line"><a name="l00476"></a><span class="lineno"><a class="line" href="classCTrendStore.html#ae4a95e32fc5878a5d825c2826d3f8ebb">  476</a></span>&#160;        uint32_t <a class="code" href="classCTrendStore.html#ae4a95e32fc5878a5d825c2826d3f8ebb">_previous_stage_index</a>;</div>
<div class="line"><a name="l00482"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a2d11f0b2effabc57610f3cb4cdf61be0">  482</a></span>&#160;        uint32_t <a class="code" href="classCTrendStore.html#a2d11f0b2effabc57610f3cb4cdf61be0">_live_stage_index</a>;</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;</div>
<div class="line"><a name="l00489"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a7957df3a545a23c5525bbbc6e5e4d7f8">  489</a></span>&#160;        std::future&lt;std::tuple&lt;bool, std::vector&lt;uint32_t&gt;, <span class="keywordtype">double</span>&gt; &gt; <a class="code" href="classCTrendStore.html#a7957df3a545a23c5525bbbc6e5e4d7f8">_move_task</a>;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00494"></a><span class="lineno"><a class="line" href="classCTrendStore.html#ab6b7c953b384ace84b214be2fee0c7f7">  494</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classCTrendStore.html#ab6b7c953b384ace84b214be2fee0c7f7">_levelup_in_progress</a>;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a67d189d1edaa263572eb87bd617d54d6">  500</a></span>&#160;        std::future&lt;std::tuple&lt;bool, double&gt; &gt; <a class="code" href="classCTrendStore.html#a67d189d1edaa263572eb87bd617d54d6">_levelup_task</a>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00507"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a6536ea9c3d21efd08c7eb441b5563a46">  507</a></span>&#160;        std::future&lt;void&gt; <a class="code" href="classCTrendStore.html#a6536ea9c3d21efd08c7eb441b5563a46">_obsolete_move_task</a>;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;</div>
<div class="line"><a name="l00515"></a><span class="lineno"><a class="line" href="classCTrendStore.html#ac7f0a0ba0ca0ac4871bd782ff48d4341">  515</a></span>&#160;        std::deque&lt;uint32_t&gt; <a class="code" href="classCTrendStore.html#ac7f0a0ba0ca0ac4871bd782ff48d4341">_obsolete_move_indices</a>;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;</div>
<div class="line"><a name="l00520"></a><span class="lineno"><a class="line" href="classCTrendStore.html#acd655929c4c75820deeb226b62ae0c6c">  520</a></span>&#160;        px::string <a class="code" href="classCTrendStore.html#acd655929c4c75820deeb226b62ae0c6c">_db_path</a>;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div>
<div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a45befea74c1869adca316c14c42fa2f1">  529</a></span>&#160;        std::map&lt;uint32_t, std::shared_ptr&lt;px::db::CKeyValueStore&gt; &gt; <a class="code" href="classCTrendStore.html#a45befea74c1869adca316c14c42fa2f1">_stage_dbs</a>;</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;</div>
<div class="line"><a name="l00534"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a7aa64b90216dac784c17663db20a6bf7">  534</a></span>&#160;        std::shared_ptr&lt;px::db::CKeyValueStore&gt; <a class="code" href="classCTrendStore.html#a7aa64b90216dac784c17663db20a6bf7">_bucket_db</a>;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;</div>
<div class="line"><a name="l00539"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a44927ca732bb1f6d1d52cda6f27c3137">  539</a></span>&#160;        <span class="keyword">mutable</span> std::mutex <a class="code" href="classCTrendStore.html#a44927ca732bb1f6d1d52cda6f27c3137">_mutex</a>;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;</div>
<div class="line"><a name="l00544"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a44f208740681e380a5190bac2f451466">  544</a></span>&#160;        <span class="keyword">const</span> <span class="keyword">static</span> px::string <a class="code" href="classCTrendStore.html#a44f208740681e380a5190bac2f451466">_bucket_db_name</a>;</div>
<div class="line"><a name="l00548"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a9d4200b9cb69903aa3fc3fc1c10e1b86">  548</a></span>&#160;        <span class="keyword">const</span> <span class="keyword">static</span> px::string <a class="code" href="classCTrendStore.html#a9d4200b9cb69903aa3fc3fc1c10e1b86">_stage_db_prefix</a>;</div>
<div class="line"><a name="l00552"></a><span class="lineno"><a class="line" href="classCTrendStore.html#aefe61238451214c05d8192da80d16c00">  552</a></span>&#160;        <span class="keyword">const</span> <span class="keyword">static</span> px::string <a class="code" href="classCTrendStore.html#aefe61238451214c05d8192da80d16c00">_obsolete_stage_db_prefix</a>;</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;</div>
<div class="line"><a name="l00558"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a47da0724e3b8bd77671ebb2a5bafdead">  558</a></span>&#160;        <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="classCTrendStore.html#a47da0724e3b8bd77671ebb2a5bafdead">_default_absolute_count_limit</a>;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;</div>
<div class="line"><a name="l00561"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a71c3a037795aed1c21e179e03a291bf0">  561</a></span>&#160;        <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classCTrendStore.html#a71c3a037795aed1c21e179e03a291bf0">_max_stage_dbs_atstart</a>;</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div>
<div class="line"><a name="l00564"></a><span class="lineno"><a class="line" href="classCTrendStore.html#afce95787ec63087a1de7066bc834446e">  564</a></span>&#160;        <span class="keyword">const</span> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="classCTrendStore.html#afce95787ec63087a1de7066bc834446e">_max_stage_dbs_ever</a>;</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;</div>
<div class="line"><a name="l00570"></a><span class="lineno"><a class="line" href="classCTrendStore.html#a9d701b44bb5466effefa1d56bbd30817">  570</a></span>&#160;        uint32_t <a class="code" href="classCTrendStore.html#a9d701b44bb5466effefa1d56bbd30817">_live_interval</a>;</div>
<div class="line"><a name="l00576"></a><span class="lineno"><a class="line" href="classCTrendStore.html#ad1f5504b93ee3ed1cf6b29e3da683588">  576</a></span>&#160;        <span class="keyword">mutable</span> std::shared_ptr&lt;CTrendsCache&gt; <a class="code" href="classCTrendStore.html#ad1f5504b93ee3ed1cf6b29e3da683588">_cache</a>;</div>
<div class="line"><a name="l00580"></a><span class="lineno"><a class="line" href="classCTrendStore.html#ae1ea363768a947ba481002060411a4b1">  580</a></span>&#160;        uint32_t <a class="code" href="classCTrendStore.html#ae1ea363768a947ba481002060411a4b1">_migration_count</a>;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keyword">const</span> px::string OOB_DATABASE_SETTINGS = <span class="stringliteral">&quot;DatabaseSettings&quot;</span>;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <a class="code" href="classCDataStore.html">CDataStore</a> *_cds;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;</div>
<div class="line"><a name="l00589"></a><span class="lineno"><a class="line" href="classCTrendStore.html#ad50271ab4bcf4b20a1a6b47b15984c16">  589</a></span>&#160;        <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classCTrendStoreTestHelper.html">CTrendStoreTestHelper</a>;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;};</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="ttc" id="classCTrendStore_html_aa8e893b14ce6ed5519bf821d0ff61ff8"><div class="ttname"><a href="classCTrendStore.html#aa8e893b14ce6ed5519bf821d0ff61ff8">CTrendStore::merge_query_results</a></div><div class="ttdeci">unsigned int merge_query_results(px::CChannelTrends &amp;dst, const px::CChannelTrends &amp;src) const </div><div class="ttdoc">Merge &amp;quot;src&amp;quot; query results into &amp;quot;dst&amp;quot;. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l01163">trend_store.cpp:1163</a></div></div>
<div class="ttc" id="classCTrendStore_html_a447cb6335f985ba76c8df57038e87707"><div class="ttname"><a href="classCTrendStore.html#a447cb6335f985ba76c8df57038e87707">CTrendStore::get_migration_count</a></div><div class="ttdeci">uint32_t get_migration_count() const </div><div class="ttdoc">Get the count of stage-&amp;gt;bucket DB migrations that have happened. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l02218">trend_store.cpp:2218</a></div></div>
<div class="ttc" id="classCTrendStore_html_a7adaa6fa7bd22a8800383313c072dd89"><div class="ttname"><a href="classCTrendStore.html#a7adaa6fa7bd22a8800383313c072dd89">CTrendStore::ImportTrends</a></div><div class="ttdeci">void ImportTrends(const px::string &amp;file_path, int &amp;row_count, int &amp;value_count, const bool stage_only=false, const bool bucket_only=false)</div><div class="ttdoc">Import from CSV. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l01782">trend_store.cpp:1782</a></div></div>
<div class="ttc" id="classCTrendStore_html_afce95787ec63087a1de7066bc834446e"><div class="ttname"><a href="classCTrendStore.html#afce95787ec63087a1de7066bc834446e">CTrendStore::_max_stage_dbs_ever</a></div><div class="ttdeci">static const int _max_stage_dbs_ever</div><div class="ttdoc">Max stage DBs to be open at one time during operation. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00564">trend_store.hpp:564</a></div></div>
<div class="ttc" id="classCTrendStore_html_ae4a95e32fc5878a5d825c2826d3f8ebb"><div class="ttname"><a href="classCTrendStore.html#ae4a95e32fc5878a5d825c2826d3f8ebb">CTrendStore::_previous_stage_index</a></div><div class="ttdeci">uint32_t _previous_stage_index</div><div class="ttdoc">Tracks the previously processed stage index, used to detect the stage index change. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00476">trend_store.hpp:476</a></div></div>
<div class="ttc" id="classCTrendStore_html_a59ae14f650ab7f058f8dd0c52bd15610"><div class="ttname"><a href="classCTrendStore.html#a59ae14f650ab7f058f8dd0c52bd15610">CTrendStore::QueryTrends</a></div><div class="ttdeci">std::vector&lt; px::CChannelTrends &gt; QueryTrends(const std::unordered_map&lt; uint32_t, px::datatype &gt; &amp;channels, const bool complete_snapshots, const px::CWallTime &amp;start_time, const px::CWallTime &amp;requested_end_time, const unsigned int request_period, const bool include_avg, const bool include_min, const bool include_max, const bool include_actual, unsigned int row_limit, unsigned int absolute_count_limit, bool &amp;more_data) const </div><div class="ttdoc">Query the databases. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l01284">trend_store.cpp:1284</a></div></div>
<div class="ttc" id="classCTrendStore_html_a1ae59ffbcf7cd9859ca3020ef1b82f8c"><div class="ttname"><a href="classCTrendStore.html#a1ae59ffbcf7cd9859ca3020ef1b82f8c">CTrendStore::simple_wait_timer</a></div><div class="ttdeci">void simple_wait_timer(int delay_ms)</div><div class="ttdoc">Helper method to sleep for testing. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00643">trend_store.cpp:643</a></div></div>
<div class="ttc" id="classCTrendStore_html_aaa334e0679e3d2c956286b49ae54385f"><div class="ttname"><a href="classCTrendStore.html#aaa334e0679e3d2c956286b49ae54385f">CTrendStore::get_trended_channels</a></div><div class="ttdeci">void get_trended_channels(std::unordered_set&lt; uint32_t &gt; &amp;trended_channels) const </div><div class="ttdoc">Get the trended channels. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00958">trend_store.cpp:958</a></div></div>
<div class="ttc" id="classCDataStore_html"><div class="ttname"><a href="classCDataStore.html">CDataStore</a></div><div class="ttdoc">Top-level class containing all internal data. </div><div class="ttdef"><b>Definition:</b> <a href="datastore_8hpp_source.html#l00060">datastore.hpp:60</a></div></div>
<div class="ttc" id="classCTrendStore_html_a3e9f7f12e9675a8cfe5f53231b94d459"><div class="ttname"><a href="classCTrendStore.html#a3e9f7f12e9675a8cfe5f53231b94d459">CTrendStore::move_obsolete_stage_dbs_to_bucket</a></div><div class="ttdeci">void move_obsolete_stage_dbs_to_bucket()</div><div class="ttdoc">Move the obsolete trend stage DBs listed in _obsolete_move_indices to the bucket DB. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l02225">trend_store.cpp:2225</a></div></div>
<div class="ttc" id="classCTrendStore_html_a71c3a037795aed1c21e179e03a291bf0"><div class="ttname"><a href="classCTrendStore.html#a71c3a037795aed1c21e179e03a291bf0">CTrendStore::_max_stage_dbs_atstart</a></div><div class="ttdeci">static const int _max_stage_dbs_atstart</div><div class="ttdoc">Max stage DBs to be opened at startup. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00561">trend_store.hpp:561</a></div></div>
<div class="ttc" id="classCTrendStore_html_acd655929c4c75820deeb226b62ae0c6c"><div class="ttname"><a href="classCTrendStore.html#acd655929c4c75820deeb226b62ae0c6c">CTrendStore::_db_path</a></div><div class="ttdeci">px::string _db_path</div><div class="ttdoc">Represents the parent folder of all the databases. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00520">trend_store.hpp:520</a></div></div>
<div class="ttc" id="classCTrendStore_html_abbed5e2aa6e0b8e93f2b0a65a343d0fe"><div class="ttname"><a href="classCTrendStore.html#abbed5e2aa6e0b8e93f2b0a65a343d0fe">CTrendStore::get_trend_bucket_disk_usage</a></div><div class="ttdeci">uint64_t get_trend_bucket_disk_usage() const </div><div class="ttdoc">Get the space, in bytes, being used by the trend bucket DB. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l02409">trend_store.cpp:2409</a></div></div>
<div class="ttc" id="classCTrendStore_html_a634f8304b324e61a428bb00193e5332a"><div class="ttname"><a href="classCTrendStore.html#a634f8304b324e61a428bb00193e5332a">CTrendStore::levelup_bucket</a></div><div class="ttdeci">std::tuple&lt; bool, double &gt; levelup_bucket(const uint32_t time_threshold_5min, const uint32_t time_threshold_15min, const uint32_t time_threshold_60min, const size_t num_trended_channels)</div><div class="ttdoc">Levelup bucket trends from 5 to 15, then to 60, then to deletion, based on the policy. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00892">trend_store.cpp:892</a></div></div>
<div class="ttc" id="classCTrendStore_html_a47da0724e3b8bd77671ebb2a5bafdead"><div class="ttname"><a href="classCTrendStore.html#a47da0724e3b8bd77671ebb2a5bafdead">CTrendStore::_default_absolute_count_limit</a></div><div class="ttdeci">static const unsigned int _default_absolute_count_limit</div><div class="ttdoc">Represents a hard coded query limit of the trends values count. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00558">trend_store.hpp:558</a></div></div>
<div class="ttc" id="classCTrendStore_html_a6536ea9c3d21efd08c7eb441b5563a46"><div class="ttname"><a href="classCTrendStore.html#a6536ea9c3d21efd08c7eb441b5563a46">CTrendStore::_obsolete_move_task</a></div><div class="ttdeci">std::future&lt; void &gt; _obsolete_move_task</div><div class="ttdoc">If there are too many stage DBs to keep open, this task moves the others into the bucket DB in the ba...</div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00507">trend_store.hpp:507</a></div></div>
<div class="ttc" id="classCTrendStore_html_a6e863b54d7952319a18dec47ed37e2d0"><div class="ttname"><a href="classCTrendStore.html#a6e863b54d7952319a18dec47ed37e2d0">CTrendStore::get_trend_bucket_disk_free_space</a></div><div class="ttdeci">uint64_t get_trend_bucket_disk_free_space() const </div><div class="ttdoc">Trigger the level up and then shrink trends buckets in the async mode. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l02395">trend_store.cpp:2395</a></div></div>
<div class="ttc" id="classCTrendStore_html"><div class="ttname"><a href="classCTrendStore.html">CTrendStore</a></div><div class="ttdoc">Class to manage the trend storage. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00036">trend_store.hpp:36</a></div></div>
<div class="ttc" id="classCTrendStore_html_a2c94e65314866abaca128481843649bb"><div class="ttname"><a href="classCTrendStore.html#a2c94e65314866abaca128481843649bb">CTrendStore::get_database_settings</a></div><div class="ttdeci">void get_database_settings(uint32_t &amp;min_free_space_mb, uint32_t &amp;levelup_days_5min, uint32_t &amp;levelup_days_15min, uint32_t &amp;rolloff_days_60min, uint32_t &amp;step_days) const </div><div class="ttdoc">Gets the database settings from the oob or default. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l02349">trend_store.cpp:2349</a></div></div>
<div class="ttc" id="classCTrendStore_html_ae5e4b974f877eb1a20e2793e55ded3fe"><div class="ttname"><a href="classCTrendStore.html#ae5e4b974f877eb1a20e2793e55ded3fe">CTrendStore::ExportTrends</a></div><div class="ttdeci">void ExportTrends(std::ofstream &amp;file, const std::vector&lt; uint32_t &gt; &amp;channel_ids, const std::unordered_map&lt; uint32_t, px::datatype &gt; &amp;channels, const std::unordered_map&lt; uint32_t, std::bitset&lt; 4 &gt; &gt; &amp;channel_traits_map, const px::CWallTime &amp;start_time, const px::CWallTime &amp;end_time, const unsigned int request_period, const bool include_avg, const bool include_min, const bool include_min_time, const bool include_max, const bool include_max_time, const bool include_actual, const bool include_stage, const bool include_bucket, const unsigned int row_limit, const bool export_local_time, bool &amp;more_data, unsigned int &amp;values_count, unsigned int &amp;row_count)</div><div class="ttdoc">Export to CSV. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l01795">trend_store.cpp:1795</a></div></div>
<div class="ttc" id="classCTrendStore_html_a7957df3a545a23c5525bbbc6e5e4d7f8"><div class="ttname"><a href="classCTrendStore.html#a7957df3a545a23c5525bbbc6e5e4d7f8">CTrendStore::_move_task</a></div><div class="ttdeci">std::future&lt; std::tuple&lt; bool, std::vector&lt; uint32_t &gt;, double &gt; &gt; _move_task</div><div class="ttdoc">Manages the task of moving trends from stage to bucket. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00489">trend_store.hpp:489</a></div></div>
<div class="ttc" id="classCTrendStore_html_aac019b1e6569b8ede89d5c09589f8aec"><div class="ttname"><a href="classCTrendStore.html#aac019b1e6569b8ede89d5c09589f8aec">CTrendStore::get_stage_db_index</a></div><div class="ttdeci">static uint32_t get_stage_db_index(const px::CWallTime &amp;time)</div><div class="ttdoc">Gets the stage db index (day index since 1970 UTC), based on the timestamp. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00079">trend_store.hpp:79</a></div></div>
<div class="ttc" id="classCTrendStore_html_a4773db0924d8fb7f24e7ffa2bc8d5fdf"><div class="ttname"><a href="classCTrendStore.html#a4773db0924d8fb7f24e7ffa2bc8d5fdf">CTrendStore::reset_levelup_in_progress</a></div><div class="ttdeci">void reset_levelup_in_progress()</div><div class="ttdoc">Reset the levelup in progress flag after the levelup is done. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00389">trend_store.hpp:389</a></div></div>
<div class="ttc" id="classCTrendStore_html_a2c6ee12af0640fab076136d51a6994c6"><div class="ttname"><a href="classCTrendStore.html#a2c6ee12af0640fab076136d51a6994c6">CTrendStore::get_stage_db_minutes_range</a></div><div class="ttdeci">static void get_stage_db_minutes_range(uint32_t stage_index, uint32_t &amp;from, uint32_t &amp;to)</div><div class="ttdoc">Gets the valid minutes time range (inclusive) from a stage db, based on its index. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00631">trend_store.cpp:631</a></div></div>
<div class="ttc" id="classCTrendStore_html_a96d9c92e871bdf011ddde3f905dad5a6"><div class="ttname"><a href="classCTrendStore.html#a96d9c92e871bdf011ddde3f905dad5a6">CTrendStore::get_levelup_policy</a></div><div class="ttdeci">void get_levelup_policy(uint32_t &amp;min_free_space_mb, uint32_t &amp;time_threshold_5min, uint32_t &amp;time_threshold_15min, uint32_t &amp;time_threshold_60min, uint32_t &amp;step_days)</div><div class="ttdoc">Get the currently-active levelup and rolloff policy (calculated from today based on OOB-stored thresh...</div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00847">trend_store.cpp:847</a></div></div>
<div class="ttc" id="classCTrendStore_html_a7e4d66d37243f7e9ea1b707adac67a0c"><div class="ttname"><a href="classCTrendStore.html#a7e4d66d37243f7e9ea1b707adac67a0c">CTrendStore::get_folder_size</a></div><div class="ttdeci">static void get_folder_size(const std::string &amp;path, uint64_t &amp;file_size)</div><div class="ttdoc">Get a folder&amp;#39;s total size in bytes. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l02316">trend_store.cpp:2316</a></div></div>
<div class="ttc" id="classCTrendStore_html_a7aa64b90216dac784c17663db20a6bf7"><div class="ttname"><a href="classCTrendStore.html#a7aa64b90216dac784c17663db20a6bf7">CTrendStore::_bucket_db</a></div><div class="ttdeci">std::shared_ptr&lt; px::db::CKeyValueStore &gt; _bucket_db</div><div class="ttdoc">A single bucket db stores all aggregated 5/15/60 minutes data for all times. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00534">trend_store.hpp:534</a></div></div>
<div class="ttc" id="classCTrendStore_html_a41b47ef0bf30a13c7141c7a101d2154f"><div class="ttname"><a href="classCTrendStore.html#a41b47ef0bf30a13c7141c7a101d2154f">CTrendStore::get_stage_db_index</a></div><div class="ttdeci">static uint32_t get_stage_db_index(uint32_t time)</div><div class="ttdoc">Gets the stage db index (day index since 1970 UTC), based on the timestamp already normalized to 5-mi...</div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00062">trend_store.hpp:62</a></div></div>
<div class="ttc" id="classCTrendStoreTestHelper_html"><div class="ttname"><a href="classCTrendStoreTestHelper.html">CTrendStoreTestHelper</a></div><div class="ttdoc">Class to access private members of CTrendStore. </div><div class="ttdef"><b>Definition:</b> <a href="test____trendstore_8cpp_source.html#l00037">test__trendstore.cpp:37</a></div></div>
<div class="ttc" id="classCTrendStore_html_af3ef25a164ceaf87e84b5255aaa95320"><div class="ttname"><a href="classCTrendStore.html#af3ef25a164ceaf87e84b5255aaa95320">CTrendStore::get_trend_trait_value</a></div><div class="ttdeci">static std::string get_trend_trait_value(const px::datatype datatype, const double &amp;value)</div><div class="ttdoc">Gets the trend trait value in user readable format, based on its data type. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l02170">trend_store.cpp:2170</a></div></div>
<div class="ttc" id="classCTrendStore_html_a6f9b1751fe0369d638abf337c9b1844f"><div class="ttname"><a href="classCTrendStore.html#a6f9b1751fe0369d638abf337c9b1844f">CTrendStore::~CTrendStore</a></div><div class="ttdeci">~CTrendStore()</div><div class="ttdoc">Destructor. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00114">trend_store.cpp:114</a></div></div>
<div class="ttc" id="classCTrendStore_html_abe2f003c5a6584f6d082ea19a1a0bc46"><div class="ttname"><a href="classCTrendStore.html#abe2f003c5a6584f6d082ea19a1a0bc46">CTrendStore::update_live_interval</a></div><div class="ttdeci">void update_live_interval(const px::CWallTime time)</div><div class="ttdoc">Update the current interval (normalized to 5 minutes) based on the current live channel value update&amp;#39;...</div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00249">trend_store.hpp:249</a></div></div>
<div class="ttc" id="classCTrendStore_html_abc8c75eccfec80c4db86f8d5eb0f5a28"><div class="ttname"><a href="classCTrendStore.html#abc8c75eccfec80c4db86f8d5eb0f5a28">CTrendStore::load_stage_dbs</a></div><div class="ttdeci">void load_stage_dbs()</div><div class="ttdoc">Initialize the object. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00436">trend_store.cpp:436</a></div></div>
<div class="ttc" id="classCTrendStore_html_a9d4200b9cb69903aa3fc3fc1c10e1b86"><div class="ttname"><a href="classCTrendStore.html#a9d4200b9cb69903aa3fc3fc1c10e1b86">CTrendStore::_stage_db_prefix</a></div><div class="ttdeci">static const px::string _stage_db_prefix</div><div class="ttdoc">Represents the stage db name&amp;#39;s prefix: trend_&amp;lt;index&amp;gt; </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00548">trend_store.hpp:548</a></div></div>
<div class="ttc" id="classCTrendStore_html_a67d189d1edaa263572eb87bd617d54d6"><div class="ttname"><a href="classCTrendStore.html#a67d189d1edaa263572eb87bd617d54d6">CTrendStore::_levelup_task</a></div><div class="ttdeci">std::future&lt; std::tuple&lt; bool, double &gt; &gt; _levelup_task</div><div class="ttdoc">Manages the task of level up trends in the bucket db based on the policy. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00500">trend_store.hpp:500</a></div></div>
<div class="ttc" id="classCTrendStore_html_a57b273270664f9dfebfba578c629f580"><div class="ttname"><a href="classCTrendStore.html#a57b273270664f9dfebfba578c629f580">CTrendStore::_move_in_progress</a></div><div class="ttdeci">bool _move_in_progress</div><div class="ttdoc">Indicates that a move task is currently in progress. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00471">trend_store.hpp:471</a></div></div>
<div class="ttc" id="classCTrendStore_html_a7cb4834d713541e10da83599510d7d0a"><div class="ttname"><a href="classCTrendStore.html#a7cb4834d713541e10da83599510d7d0a">CTrendStore::get_live_stage_index</a></div><div class="ttdeci">uint32_t get_live_stage_index()</div><div class="ttdoc">Gets the latest stage index. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00230">trend_store.hpp:230</a></div></div>
<div class="ttc" id="classCTrendStore_html_ad1f5504b93ee3ed1cf6b29e3da683588"><div class="ttname"><a href="classCTrendStore.html#ad1f5504b93ee3ed1cf6b29e3da683588">CTrendStore::_cache</a></div><div class="ttdeci">std::shared_ptr&lt; CTrendsCache &gt; _cache</div><div class="ttdoc">Cache the last interval snapshot, mostly designed to optimize the PXI integration. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00576">trend_store.hpp:576</a></div></div>
<div class="ttc" id="classCTrendStore_html_acb1baa80b5173ec9aa49dc6eae66acc7"><div class="ttname"><a href="classCTrendStore.html#acb1baa80b5173ec9aa49dc6eae66acc7">CTrendStore::get_stage_db_path</a></div><div class="ttdeci">px::string get_stage_db_path(uint32_t stage_index)</div><div class="ttdoc">Gets the stage db path based on the stage index (daily since 1970 UTC). </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00613">trend_store.cpp:613</a></div></div>
<div class="ttc" id="classCTrendStore_html_ac7f0a0ba0ca0ac4871bd782ff48d4341"><div class="ttname"><a href="classCTrendStore.html#ac7f0a0ba0ca0ac4871bd782ff48d4341">CTrendStore::_obsolete_move_indices</a></div><div class="ttdeci">std::deque&lt; uint32_t &gt; _obsolete_move_indices</div><div class="ttdoc">List of obsolete stage DB indices to move. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00515">trend_store.hpp:515</a></div></div>
<div class="ttc" id="classCTrendStore_html_af183006bcd799d8d92565050a88b2840"><div class="ttname"><a href="classCTrendStore.html#af183006bcd799d8d92565050a88b2840">CTrendStore::get_stage_db</a></div><div class="ttdeci">std::shared_ptr&lt; px::db::CKeyValueStore &gt; get_stage_db(uint32_t stage_index)</div><div class="ttdoc">Gets the stage db based on the stage index, create it if not existing. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00148">trend_store.cpp:148</a></div></div>
<div class="ttc" id="classCTrendStore_html_af6254f613e306e2f2a56a0cfc0a44206"><div class="ttname"><a href="classCTrendStore.html#af6254f613e306e2f2a56a0cfc0a44206">CTrendStore::query_db</a></div><div class="ttdeci">void query_db(std::shared_ptr&lt; px::db::CKeyValueStore &gt; db, bool is_bucket, px::CChannelTrends &amp;trends, const px::CWallTime &amp;start_time, const px::CWallTime &amp;end_time, const unsigned int request_period, const bool include_avg, const bool include_min, const bool include_max, const bool include_actual, const unsigned int row_count_limit, bool &amp;more_data) const </div><div class="ttdoc">Query trends from a stage DB or the bucket DB based on query criteria. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00966">trend_store.cpp:966</a></div></div>
<div class="ttc" id="classCTrendStore_html_ad2047a9303a805c0334733c49008f229"><div class="ttname"><a href="classCTrendStore.html#ad2047a9303a805c0334733c49008f229">CTrendStore::BucketCleanup</a></div><div class="ttdeci">void BucketCleanup()</div><div class="ttdoc">Trend bucket database periodic maintenance: level-up, roll-off, and clean-up. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l02418">trend_store.cpp:2418</a></div></div>
<div class="ttc" id="classCTrendStore_html_a8a35bb8b7a967d2dc7664282ffa0f717"><div class="ttname"><a href="classCTrendStore.html#a8a35bb8b7a967d2dc7664282ffa0f717">CTrendStore::initilize_todays_stage_db</a></div><div class="ttdeci">void initilize_todays_stage_db()</div><div class="ttdoc">Create today&amp;#39;s stage db if not existing, during the startup. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00597">trend_store.cpp:597</a></div></div>
<div class="ttc" id="classCTrendStore_html_ae1ea363768a947ba481002060411a4b1"><div class="ttname"><a href="classCTrendStore.html#ae1ea363768a947ba481002060411a4b1">CTrendStore::_migration_count</a></div><div class="ttdeci">uint32_t _migration_count</div><div class="ttdoc">Count of migrations from stage to bucket, to determine if the move happened during the query...</div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00580">trend_store.hpp:580</a></div></div>
<div class="ttc" id="classCTrendStore_html_a80c34117d445d20b3693ae3912965f6a"><div class="ttname"><a href="classCTrendStore.html#a80c34117d445d20b3693ae3912965f6a">CTrendStore::CTrendStore</a></div><div class="ttdeci">CTrendStore(const px::string &amp;db_path, CDataStore *cds)</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00074">trend_store.cpp:74</a></div></div>
<div class="ttc" id="classCTrendStore_html_a2d11f0b2effabc57610f3cb4cdf61be0"><div class="ttname"><a href="classCTrendStore.html#a2d11f0b2effabc57610f3cb4cdf61be0">CTrendStore::_live_stage_index</a></div><div class="ttdeci">uint32_t _live_stage_index</div><div class="ttdoc">Tracks the latest live update&amp;#39;s stage index, so that we know that this stage index is not mature to b...</div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00482">trend_store.hpp:482</a></div></div>
<div class="ttc" id="classCTrendStore_html_a5298304047fcadedef46745e9f333bfc"><div class="ttname"><a href="classCTrendStore.html#a5298304047fcadedef46745e9f333bfc">CTrendStore::is_snapshot_complete</a></div><div class="ttdeci">bool is_snapshot_complete(const uint32_t time, px::CWallTime &amp;latest_complete_time) const </div><div class="ttdoc">Check the live interval time to determine if the interval snapshot is complete This is required to su...</div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l01272">trend_store.cpp:1272</a></div></div>
<div class="ttc" id="classCTrendStore_html_ab6b7c953b384ace84b214be2fee0c7f7"><div class="ttname"><a href="classCTrendStore.html#ab6b7c953b384ace84b214be2fee0c7f7">CTrendStore::_levelup_in_progress</a></div><div class="ttdeci">bool _levelup_in_progress</div><div class="ttdoc">Indicates that a bucket level up task is currently in progress. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00494">trend_store.hpp:494</a></div></div>
<div class="ttc" id="classCTrendStore_html_a45befea74c1869adca316c14c42fa2f1"><div class="ttname"><a href="classCTrendStore.html#a45befea74c1869adca316c14c42fa2f1">CTrendStore::_stage_dbs</a></div><div class="ttdeci">std::map&lt; uint32_t, std::shared_ptr&lt; px::db::CKeyValueStore &gt; &gt; _stage_dbs</div><div class="ttdoc">A list of daily stage dbs ordered by the day index (since 1970 epoch UTC). </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00529">trend_store.hpp:529</a></div></div>
<div class="ttc" id="classCTrendStore_html_a44927ca732bb1f6d1d52cda6f27c3137"><div class="ttname"><a href="classCTrendStore.html#a44927ca732bb1f6d1d52cda6f27c3137">CTrendStore::_mutex</a></div><div class="ttdeci">std::mutex _mutex</div><div class="ttdoc">Mutex to make the members thread safe. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00539">trend_store.hpp:539</a></div></div>
<div class="ttc" id="classCTrendStore_html_a85aecef759f13455e6ed202b75971eb1"><div class="ttname"><a href="classCTrendStore.html#a85aecef759f13455e6ed202b75971eb1">CTrendStore::move_stage_to_bucket</a></div><div class="ttdeci">std::tuple&lt; bool, std::vector&lt; uint32_t &gt;, double &gt; move_stage_to_bucket(uint32_t cutoff)</div><div class="ttdoc">Move trends from the stage dbs (whose index is smaller than the cutoff) to the bucket, then delete the moved stage dbs. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00652">trend_store.cpp:652</a></div></div>
<div class="ttc" id="classCTrendStore_html_a3e0a3801eca59a3883f8ae45e2cb7c04"><div class="ttname"><a href="classCTrendStore.html#a3e0a3801eca59a3883f8ae45e2cb7c04">CTrendStore::signal_ready_to_levelup</a></div><div class="ttdeci">bool signal_ready_to_levelup()</div><div class="ttdoc">Return true if a new levelup task should be launched; or zero if a levelup operation is in progress...</div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00283">trend_store.hpp:283</a></div></div>
<div class="ttc" id="classCTrendStore_html_a9d701b44bb5466effefa1d56bbd30817"><div class="ttname"><a href="classCTrendStore.html#a9d701b44bb5466effefa1d56bbd30817">CTrendStore::_live_interval</a></div><div class="ttdeci">uint32_t _live_interval</div><div class="ttdoc">Tracks the latest live interval (normalized to 5-minute) that is current accumulating data...</div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00570">trend_store.hpp:570</a></div></div>
<div class="ttc" id="classCTrendStore_html_a7e150ff2403542b0b5d70d6e669f09e3"><div class="ttname"><a href="classCTrendStore.html#a7e150ff2403542b0b5d70d6e669f09e3">CTrendStore::get_obsolete_stage_db_path</a></div><div class="ttdeci">px::string get_obsolete_stage_db_path(uint32_t stage_index)</div><div class="ttdoc">Gets the obsolete stage db path based on the stage index (daily since 1970 UTC). </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00622">trend_store.cpp:622</a></div></div>
<div class="ttc" id="classCTrendStore_html_a44f208740681e380a5190bac2f451466"><div class="ttname"><a href="classCTrendStore.html#a44f208740681e380a5190bac2f451466">CTrendStore::_bucket_db_name</a></div><div class="ttdeci">static const px::string _bucket_db_name</div><div class="ttdoc">Represents the bucket db name: trends. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00544">trend_store.hpp:544</a></div></div>
<div class="ttc" id="classCTrendStore_html_a1ecb59e829d27ea473fd0e7088b687e3"><div class="ttname"><a href="classCTrendStore.html#a1ecb59e829d27ea473fd0e7088b687e3">CTrendStore::poke_obsolete_move_task</a></div><div class="ttdeci">void poke_obsolete_move_task()</div><div class="ttdoc">Kick off the thread to do the above obsolete move, if needed. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00577">trend_store.cpp:577</a></div></div>
<div class="ttc" id="classCTrendStore_html_ad76f4c4b0dcfec8ec3c34af58aead9fc"><div class="ttname"><a href="classCTrendStore.html#ad76f4c4b0dcfec8ec3c34af58aead9fc">CTrendStore::DeleteTrends</a></div><div class="ttdeci">void DeleteTrends(const std::unordered_set&lt; uint32_t &gt; &amp;channel_ids, const px::CWallTime &amp;start_time, const px::CWallTime &amp;end_time)</div><div class="ttdoc">Delete entries from the trend databases. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l01731">trend_store.cpp:1731</a></div></div>
<div class="ttc" id="classCTrendStore_html_aefe61238451214c05d8192da80d16c00"><div class="ttname"><a href="classCTrendStore.html#aefe61238451214c05d8192da80d16c00">CTrendStore::_obsolete_stage_db_prefix</a></div><div class="ttdeci">static const px::string _obsolete_stage_db_prefix</div><div class="ttdoc">Represents the obsolete stage db name&amp;#39;s prefix: old_trend_&amp;lt;index&amp;gt; </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8hpp_source.html#l00552">trend_store.hpp:552</a></div></div>
<div class="ttc" id="classCTrendStore_html_ad1c7deb03bf9c342c8ca5e554f2f8cf2"><div class="ttname"><a href="classCTrendStore.html#ad1c7deb03bf9c342c8ca5e554f2f8cf2">CTrendStore::store</a></div><div class="ttdeci">void store(std::vector&lt; std::shared_ptr&lt; px::CTrendStageUpdate &gt; &gt; &amp;updates)</div><div class="ttdoc">Stores trends update from the accumulators to the stage db. </div><div class="ttdef"><b>Definition:</b> <a href="trend__store_8cpp_source.html#l00280">trend_store.cpp:280</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_bd52eb7ac821349adc834157bbaf2648.html">data</a></li><li class="navelem"><b>trend_store.hpp</b></li>
    <li class="footer">Generated on Fri May 7 2021 20:24:00 for cds_ng by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
