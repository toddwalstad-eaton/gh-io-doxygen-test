<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>cds_ng: CTrendStore Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">cds_ng
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classCTrendStore.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-static-methods">Static Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="#pri-static-attribs">Static Private Attributes</a> &#124;
<a href="classCTrendStore-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">CTrendStore Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class to manage the trend storage.  
 <a href="classCTrendStore.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for CTrendStore:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore__coll__graph.png" border="0" usemap="#CTrendStore_coll__map" alt="Collaboration graph"/></div>
<map name="CTrendStore_coll__map" id="CTrendStore_coll__map">
<area shape="rect" id="node4" href="classCDataStore.html" title="Top&#45;level class containing all internal data. " alt="" coords="1405,1007,1501,1033"/><area shape="rect" id="node5" href="classCOpenAlarmsStore.html" title="For open alarms, we need to maintain a few parallel data structures, so to make sure they stay in syn..." alt="" coords="922,399,1067,425"/><area shape="rect" id="node9" title="STL class. " alt="" coords="6,509,141,536"/><area shape="rect" id="node15" title="STL class. " alt="" coords="443,1020,600,1047"/><area shape="rect" id="node47" title="STL class. " alt="" coords="931,1904,1059,1931"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a80c34117d445d20b3693ae3912965f6a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a80c34117d445d20b3693ae3912965f6a">CTrendStore</a> (const px::string &amp;db_path, <a class="el" href="classCDataStore.html">CDataStore</a> *cds)</td></tr>
<tr class="memdesc:a80c34117d445d20b3693ae3912965f6a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#a80c34117d445d20b3693ae3912965f6a">More...</a><br/></td></tr>
<tr class="separator:a80c34117d445d20b3693ae3912965f6a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f9b1751fe0369d638abf337c9b1844f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6f9b1751fe0369d638abf337c9b1844f"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a6f9b1751fe0369d638abf337c9b1844f">~CTrendStore</a> ()</td></tr>
<tr class="memdesc:a6f9b1751fe0369d638abf337c9b1844f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor. <br/></td></tr>
<tr class="separator:a6f9b1751fe0369d638abf337c9b1844f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1c7deb03bf9c342c8ca5e554f2f8cf2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#ad1c7deb03bf9c342c8ca5e554f2f8cf2">store</a> (std::vector&lt; std::shared_ptr&lt; px::CTrendStageUpdate &gt; &gt; &amp;updates)</td></tr>
<tr class="memdesc:ad1c7deb03bf9c342c8ca5e554f2f8cf2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores trends update from the accumulators to the stage db.  <a href="#ad1c7deb03bf9c342c8ca5e554f2f8cf2">More...</a><br/></td></tr>
<tr class="separator:ad1c7deb03bf9c342c8ca5e554f2f8cf2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59ae14f650ab7f058f8dd0c52bd15610"><td class="memItemLeft" align="right" valign="top">std::vector&lt; px::CChannelTrends &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a59ae14f650ab7f058f8dd0c52bd15610">QueryTrends</a> (const std::unordered_map&lt; uint32_t, px::datatype &gt; &amp;channels, const bool complete_snapshots, const px::CWallTime &amp;start_time, const px::CWallTime &amp;requested_end_time, const unsigned int request_period, const bool include_avg, const bool include_min, const bool include_max, const bool include_actual, unsigned int row_limit, unsigned int absolute_count_limit, bool &amp;more_data) const </td></tr>
<tr class="memdesc:a59ae14f650ab7f058f8dd0c52bd15610"><td class="mdescLeft">&#160;</td><td class="mdescRight">Query the databases.  <a href="#a59ae14f650ab7f058f8dd0c52bd15610">More...</a><br/></td></tr>
<tr class="separator:a59ae14f650ab7f058f8dd0c52bd15610"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad76f4c4b0dcfec8ec3c34af58aead9fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#ad76f4c4b0dcfec8ec3c34af58aead9fc">DeleteTrends</a> (const std::unordered_set&lt; uint32_t &gt; &amp;channel_ids, const px::CWallTime &amp;start_time, const px::CWallTime &amp;end_time)</td></tr>
<tr class="memdesc:ad76f4c4b0dcfec8ec3c34af58aead9fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete entries from the trend databases.  <a href="#ad76f4c4b0dcfec8ec3c34af58aead9fc">More...</a><br/></td></tr>
<tr class="separator:ad76f4c4b0dcfec8ec3c34af58aead9fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab7e4cba287d2a38f399a1c4313e27560"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#ab7e4cba287d2a38f399a1c4313e27560">DeleteTrends</a> (const px::CWallTime &amp;start_time, const px::CWallTime &amp;end_time)</td></tr>
<tr class="memdesc:ab7e4cba287d2a38f399a1c4313e27560"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delete entries from the trend databases by date (all channels).  <a href="#ab7e4cba287d2a38f399a1c4313e27560">More...</a><br/></td></tr>
<tr class="separator:ab7e4cba287d2a38f399a1c4313e27560"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7adaa6fa7bd22a8800383313c072dd89"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a7adaa6fa7bd22a8800383313c072dd89">ImportTrends</a> (const px::string &amp;file_path, int &amp;row_count, int &amp;value_count, const bool stage_only=false, const bool bucket_only=false)</td></tr>
<tr class="memdesc:a7adaa6fa7bd22a8800383313c072dd89"><td class="mdescLeft">&#160;</td><td class="mdescRight">Import from CSV.  <a href="#a7adaa6fa7bd22a8800383313c072dd89">More...</a><br/></td></tr>
<tr class="separator:a7adaa6fa7bd22a8800383313c072dd89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae5e4b974f877eb1a20e2793e55ded3fe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#ae5e4b974f877eb1a20e2793e55ded3fe">ExportTrends</a> (std::ofstream &amp;file, const std::vector&lt; uint32_t &gt; &amp;channel_ids, const std::unordered_map&lt; uint32_t, px::datatype &gt; &amp;channels, const std::unordered_map&lt; uint32_t, std::bitset&lt; 4 &gt; &gt; &amp;channel_traits_map, const px::CWallTime &amp;start_time, const px::CWallTime &amp;end_time, const unsigned int request_period, const bool include_avg, const bool include_min, const bool include_min_time, const bool include_max, const bool include_max_time, const bool include_actual, const bool include_stage, const bool include_bucket, const unsigned int row_limit, const bool export_local_time, bool &amp;more_data, unsigned int &amp;values_count, unsigned int &amp;row_count)</td></tr>
<tr class="memdesc:ae5e4b974f877eb1a20e2793e55ded3fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Export to CSV.  <a href="#ae5e4b974f877eb1a20e2793e55ded3fe">More...</a><br/></td></tr>
<tr class="separator:ae5e4b974f877eb1a20e2793e55ded3fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cb4834d713541e10da83599510d7d0a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7cb4834d713541e10da83599510d7d0a"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a7cb4834d713541e10da83599510d7d0a">get_live_stage_index</a> ()</td></tr>
<tr class="memdesc:a7cb4834d713541e10da83599510d7d0a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the latest stage index. <br/></td></tr>
<tr class="separator:a7cb4834d713541e10da83599510d7d0a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af183006bcd799d8d92565050a88b2840"><td class="memItemLeft" align="right" valign="top">std::shared_ptr<br class="typebreak"/>
&lt; px::db::CKeyValueStore &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#af183006bcd799d8d92565050a88b2840">get_stage_db</a> (uint32_t stage_index)</td></tr>
<tr class="memdesc:af183006bcd799d8d92565050a88b2840"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the stage db based on the stage index, create it if not existing.  <a href="#af183006bcd799d8d92565050a88b2840">More...</a><br/></td></tr>
<tr class="separator:af183006bcd799d8d92565050a88b2840"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe2f003c5a6584f6d082ea19a1a0bc46"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abe2f003c5a6584f6d082ea19a1a0bc46"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#abe2f003c5a6584f6d082ea19a1a0bc46">update_live_interval</a> (const px::CWallTime time)</td></tr>
<tr class="memdesc:abe2f003c5a6584f6d082ea19a1a0bc46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update the current interval (normalized to 5 minutes) based on the current live channel value update's timestamp. <br/></td></tr>
<tr class="separator:abe2f003c5a6584f6d082ea19a1a0bc46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a447cb6335f985ba76c8df57038e87707"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a447cb6335f985ba76c8df57038e87707">get_migration_count</a> () const </td></tr>
<tr class="memdesc:a447cb6335f985ba76c8df57038e87707"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the count of stage-&gt;bucket DB migrations that have happened.  <a href="#a447cb6335f985ba76c8df57038e87707">More...</a><br/></td></tr>
<tr class="separator:a447cb6335f985ba76c8df57038e87707"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a96d9c92e871bdf011ddde3f905dad5a6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a96d9c92e871bdf011ddde3f905dad5a6">get_levelup_policy</a> (uint32_t &amp;min_free_space_mb, uint32_t &amp;time_threshold_5min, uint32_t &amp;time_threshold_15min, uint32_t &amp;time_threshold_60min, uint32_t &amp;step_days)</td></tr>
<tr class="memdesc:a96d9c92e871bdf011ddde3f905dad5a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the currently-active levelup and rolloff policy (calculated from today based on OOB-stored thresholds)  <a href="#a96d9c92e871bdf011ddde3f905dad5a6">More...</a><br/></td></tr>
<tr class="separator:a96d9c92e871bdf011ddde3f905dad5a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e0a3801eca59a3883f8ae45e2cb7c04"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3e0a3801eca59a3883f8ae45e2cb7c04"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a3e0a3801eca59a3883f8ae45e2cb7c04">signal_ready_to_levelup</a> ()</td></tr>
<tr class="memdesc:a3e0a3801eca59a3883f8ae45e2cb7c04"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return true if a new levelup task should be launched; or zero if a levelup operation is in progress. <br/></td></tr>
<tr class="separator:a3e0a3801eca59a3883f8ae45e2cb7c04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad2047a9303a805c0334733c49008f229"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#ad2047a9303a805c0334733c49008f229">BucketCleanup</a> ()</td></tr>
<tr class="memdesc:ad2047a9303a805c0334733c49008f229"><td class="mdescLeft">&#160;</td><td class="mdescRight">Trend bucket database periodic maintenance: level-up, roll-off, and clean-up.  <a href="#ad2047a9303a805c0334733c49008f229">More...</a><br/></td></tr>
<tr class="separator:ad2047a9303a805c0334733c49008f229"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e863b54d7952319a18dec47ed37e2d0"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a6e863b54d7952319a18dec47ed37e2d0">get_trend_bucket_disk_free_space</a> () const </td></tr>
<tr class="memdesc:a6e863b54d7952319a18dec47ed37e2d0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Trigger the level up and then shrink trends buckets in the async mode.  <a href="#a6e863b54d7952319a18dec47ed37e2d0">More...</a><br/></td></tr>
<tr class="separator:a6e863b54d7952319a18dec47ed37e2d0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abbed5e2aa6e0b8e93f2b0a65a343d0fe"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abbed5e2aa6e0b8e93f2b0a65a343d0fe"></a>
uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#abbed5e2aa6e0b8e93f2b0a65a343d0fe">get_trend_bucket_disk_usage</a> () const </td></tr>
<tr class="memdesc:abbed5e2aa6e0b8e93f2b0a65a343d0fe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the space, in bytes, being used by the trend bucket DB. <br/></td></tr>
<tr class="separator:abbed5e2aa6e0b8e93f2b0a65a343d0fe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa334e0679e3d2c956286b49ae54385f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaa334e0679e3d2c956286b49ae54385f"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#aaa334e0679e3d2c956286b49ae54385f">get_trended_channels</a> (std::unordered_set&lt; uint32_t &gt; &amp;trended_channels) const </td></tr>
<tr class="memdesc:aaa334e0679e3d2c956286b49ae54385f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the trended channels. <br/></td></tr>
<tr class="separator:aaa334e0679e3d2c956286b49ae54385f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a85aecef759f13455e6ed202b75971eb1"><td class="memItemLeft" align="right" valign="top">std::tuple&lt; bool, std::vector<br class="typebreak"/>
&lt; uint32_t &gt;, double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a85aecef759f13455e6ed202b75971eb1">move_stage_to_bucket</a> (uint32_t cutoff)</td></tr>
<tr class="memdesc:a85aecef759f13455e6ed202b75971eb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move trends from the stage dbs (whose index is smaller than the cutoff) to the bucket, then delete the moved stage dbs.  <a href="#a85aecef759f13455e6ed202b75971eb1">More...</a><br/></td></tr>
<tr class="separator:a85aecef759f13455e6ed202b75971eb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a41b47ef0bf30a13c7141c7a101d2154f"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a41b47ef0bf30a13c7141c7a101d2154f">get_stage_db_index</a> (uint32_t time)</td></tr>
<tr class="memdesc:a41b47ef0bf30a13c7141c7a101d2154f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the stage db index (day index since 1970 UTC), based on the timestamp already normalized to 5-minute interval (end of interval).  <a href="#a41b47ef0bf30a13c7141c7a101d2154f">More...</a><br/></td></tr>
<tr class="separator:a41b47ef0bf30a13c7141c7a101d2154f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac019b1e6569b8ede89d5c09589f8aec"><td class="memItemLeft" align="right" valign="top">static uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#aac019b1e6569b8ede89d5c09589f8aec">get_stage_db_index</a> (const px::CWallTime &amp;time)</td></tr>
<tr class="memdesc:aac019b1e6569b8ede89d5c09589f8aec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the stage db index (day index since 1970 UTC), based on the timestamp.  <a href="#aac019b1e6569b8ede89d5c09589f8aec">More...</a><br/></td></tr>
<tr class="separator:aac019b1e6569b8ede89d5c09589f8aec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c6ee12af0640fab076136d51a6994c6"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a2c6ee12af0640fab076136d51a6994c6">get_stage_db_minutes_range</a> (uint32_t stage_index, uint32_t &amp;from, uint32_t &amp;to)</td></tr>
<tr class="memdesc:a2c6ee12af0640fab076136d51a6994c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the valid minutes time range (inclusive) from a stage db, based on its index.  <a href="#a2c6ee12af0640fab076136d51a6994c6">More...</a><br/></td></tr>
<tr class="separator:a2c6ee12af0640fab076136d51a6994c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a634f8304b324e61a428bb00193e5332a"><td class="memItemLeft" align="right" valign="top">std::tuple&lt; bool, double &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a634f8304b324e61a428bb00193e5332a">levelup_bucket</a> (const uint32_t time_threshold_5min, const uint32_t time_threshold_15min, const uint32_t time_threshold_60min, const size_t num_trended_channels)</td></tr>
<tr class="memdesc:a634f8304b324e61a428bb00193e5332a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Levelup bucket trends from 5 to 15, then to 60, then to deletion, based on the policy.  <a href="#a634f8304b324e61a428bb00193e5332a">More...</a><br/></td></tr>
<tr class="separator:a634f8304b324e61a428bb00193e5332a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abc8c75eccfec80c4db86f8d5eb0f5a28"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#abc8c75eccfec80c4db86f8d5eb0f5a28">load_stage_dbs</a> ()</td></tr>
<tr class="memdesc:abc8c75eccfec80c4db86f8d5eb0f5a28"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the object.  <a href="#abc8c75eccfec80c4db86f8d5eb0f5a28">More...</a><br/></td></tr>
<tr class="separator:abc8c75eccfec80c4db86f8d5eb0f5a28"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a35bb8b7a967d2dc7664282ffa0f717"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8a35bb8b7a967d2dc7664282ffa0f717"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a8a35bb8b7a967d2dc7664282ffa0f717">initilize_todays_stage_db</a> ()</td></tr>
<tr class="memdesc:a8a35bb8b7a967d2dc7664282ffa0f717"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create today's stage db if not existing, during the startup. <br/></td></tr>
<tr class="separator:a8a35bb8b7a967d2dc7664282ffa0f717"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb1baa80b5173ec9aa49dc6eae66acc7"><td class="memItemLeft" align="right" valign="top">px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#acb1baa80b5173ec9aa49dc6eae66acc7">get_stage_db_path</a> (uint32_t stage_index)</td></tr>
<tr class="memdesc:acb1baa80b5173ec9aa49dc6eae66acc7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the stage db path based on the stage index (daily since 1970 UTC).  <a href="#acb1baa80b5173ec9aa49dc6eae66acc7">More...</a><br/></td></tr>
<tr class="separator:acb1baa80b5173ec9aa49dc6eae66acc7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e150ff2403542b0b5d70d6e669f09e3"><td class="memItemLeft" align="right" valign="top">px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a7e150ff2403542b0b5d70d6e669f09e3">get_obsolete_stage_db_path</a> (uint32_t stage_index)</td></tr>
<tr class="memdesc:a7e150ff2403542b0b5d70d6e669f09e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the obsolete stage db path based on the stage index (daily since 1970 UTC).  <a href="#a7e150ff2403542b0b5d70d6e669f09e3">More...</a><br/></td></tr>
<tr class="separator:a7e150ff2403542b0b5d70d6e669f09e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4773db0924d8fb7f24e7ffa2bc8d5fdf"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4773db0924d8fb7f24e7ffa2bc8d5fdf"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a4773db0924d8fb7f24e7ffa2bc8d5fdf">reset_levelup_in_progress</a> ()</td></tr>
<tr class="memdesc:a4773db0924d8fb7f24e7ffa2bc8d5fdf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the levelup in progress flag after the levelup is done. <br/></td></tr>
<tr class="separator:a4773db0924d8fb7f24e7ffa2bc8d5fdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ae59ffbcf7cd9859ca3020ef1b82f8c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1ae59ffbcf7cd9859ca3020ef1b82f8c"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a1ae59ffbcf7cd9859ca3020ef1b82f8c">simple_wait_timer</a> (int delay_ms)</td></tr>
<tr class="memdesc:a1ae59ffbcf7cd9859ca3020ef1b82f8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper method to sleep for testing. <br/></td></tr>
<tr class="separator:a1ae59ffbcf7cd9859ca3020ef1b82f8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e9f7f12e9675a8cfe5f53231b94d459"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a3e9f7f12e9675a8cfe5f53231b94d459">move_obsolete_stage_dbs_to_bucket</a> ()</td></tr>
<tr class="memdesc:a3e9f7f12e9675a8cfe5f53231b94d459"><td class="mdescLeft">&#160;</td><td class="mdescRight">Move the obsolete trend stage DBs listed in _obsolete_move_indices to the bucket DB.  <a href="#a3e9f7f12e9675a8cfe5f53231b94d459">More...</a><br/></td></tr>
<tr class="separator:a3e9f7f12e9675a8cfe5f53231b94d459"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ecb59e829d27ea473fd0e7088b687e3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a1ecb59e829d27ea473fd0e7088b687e3">poke_obsolete_move_task</a> ()</td></tr>
<tr class="memdesc:a1ecb59e829d27ea473fd0e7088b687e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Kick off the thread to do the above obsolete move, if needed.  <a href="#a1ecb59e829d27ea473fd0e7088b687e3">More...</a><br/></td></tr>
<tr class="separator:a1ecb59e829d27ea473fd0e7088b687e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6254f613e306e2f2a56a0cfc0a44206"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#af6254f613e306e2f2a56a0cfc0a44206">query_db</a> (std::shared_ptr&lt; px::db::CKeyValueStore &gt; db, bool is_bucket, px::CChannelTrends &amp;trends, const px::CWallTime &amp;start_time, const px::CWallTime &amp;end_time, const unsigned int request_period, const bool include_avg, const bool include_min, const bool include_max, const bool include_actual, const unsigned int row_count_limit, bool &amp;more_data) const </td></tr>
<tr class="memdesc:af6254f613e306e2f2a56a0cfc0a44206"><td class="mdescLeft">&#160;</td><td class="mdescRight">Query trends from a stage DB or the bucket DB based on query criteria.  <a href="#af6254f613e306e2f2a56a0cfc0a44206">More...</a><br/></td></tr>
<tr class="separator:af6254f613e306e2f2a56a0cfc0a44206"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8e893b14ce6ed5519bf821d0ff61ff8"><td class="memItemLeft" align="right" valign="top">unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#aa8e893b14ce6ed5519bf821d0ff61ff8">merge_query_results</a> (px::CChannelTrends &amp;dst, const px::CChannelTrends &amp;src) const </td></tr>
<tr class="memdesc:aa8e893b14ce6ed5519bf821d0ff61ff8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Merge "src" query results into "dst".  <a href="#aa8e893b14ce6ed5519bf821d0ff61ff8">More...</a><br/></td></tr>
<tr class="separator:aa8e893b14ce6ed5519bf821d0ff61ff8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5298304047fcadedef46745e9f333bfc"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5298304047fcadedef46745e9f333bfc"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a5298304047fcadedef46745e9f333bfc">is_snapshot_complete</a> (const uint32_t time, px::CWallTime &amp;latest_complete_time) const </td></tr>
<tr class="memdesc:a5298304047fcadedef46745e9f333bfc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the live interval time to determine if the interval snapshot is complete This is required to support the GetTrendSnapshots when only called by PXI. <br/></td></tr>
<tr class="separator:a5298304047fcadedef46745e9f333bfc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c94e65314866abaca128481843649bb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2c94e65314866abaca128481843649bb"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a2c94e65314866abaca128481843649bb">get_database_settings</a> (uint32_t &amp;min_free_space_mb, uint32_t &amp;levelup_days_5min, uint32_t &amp;levelup_days_15min, uint32_t &amp;rolloff_days_60min, uint32_t &amp;step_days) const </td></tr>
<tr class="memdesc:a2c94e65314866abaca128481843649bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the database settings from the oob or default. <br/></td></tr>
<tr class="separator:a2c94e65314866abaca128481843649bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-methods"></a>
Static Private Member Functions</h2></td></tr>
<tr class="memitem:af3ef25a164ceaf87e84b5255aaa95320"><td class="memItemLeft" align="right" valign="top">static std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#af3ef25a164ceaf87e84b5255aaa95320">get_trend_trait_value</a> (const px::datatype datatype, const double &amp;value)</td></tr>
<tr class="memdesc:af3ef25a164ceaf87e84b5255aaa95320"><td class="mdescLeft">&#160;</td><td class="mdescRight">Gets the trend trait value in user readable format, based on its data type.  <a href="#af3ef25a164ceaf87e84b5255aaa95320">More...</a><br/></td></tr>
<tr class="separator:af3ef25a164ceaf87e84b5255aaa95320"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e4d66d37243f7e9ea1b707adac67a0c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7e4d66d37243f7e9ea1b707adac67a0c"></a>
static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a7e4d66d37243f7e9ea1b707adac67a0c">get_folder_size</a> (const std::string &amp;path, uint64_t &amp;file_size)</td></tr>
<tr class="memdesc:a7e4d66d37243f7e9ea1b707adac67a0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a folder's total size in bytes. <br/></td></tr>
<tr class="separator:a7e4d66d37243f7e9ea1b707adac67a0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a57b273270664f9dfebfba578c629f580"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a57b273270664f9dfebfba578c629f580"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a57b273270664f9dfebfba578c629f580">_move_in_progress</a></td></tr>
<tr class="memdesc:a57b273270664f9dfebfba578c629f580"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates that a move task is currently in progress. <br/></td></tr>
<tr class="separator:a57b273270664f9dfebfba578c629f580"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae4a95e32fc5878a5d825c2826d3f8ebb"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae4a95e32fc5878a5d825c2826d3f8ebb"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#ae4a95e32fc5878a5d825c2826d3f8ebb">_previous_stage_index</a></td></tr>
<tr class="memdesc:ae4a95e32fc5878a5d825c2826d3f8ebb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tracks the previously processed stage index, used to detect the stage index change. <br/></td></tr>
<tr class="separator:ae4a95e32fc5878a5d825c2826d3f8ebb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d11f0b2effabc57610f3cb4cdf61be0"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a2d11f0b2effabc57610f3cb4cdf61be0">_live_stage_index</a></td></tr>
<tr class="memdesc:a2d11f0b2effabc57610f3cb4cdf61be0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tracks the latest live update's stage index, so that we know that this stage index is not mature to be moved to the bucket.  <a href="#a2d11f0b2effabc57610f3cb4cdf61be0">More...</a><br/></td></tr>
<tr class="separator:a2d11f0b2effabc57610f3cb4cdf61be0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7957df3a545a23c5525bbbc6e5e4d7f8"><td class="memItemLeft" align="right" valign="top">std::future&lt; std::tuple&lt; bool, <br class="typebreak"/>
std::vector&lt; uint32_t &gt;<br class="typebreak"/>
, double &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a7957df3a545a23c5525bbbc6e5e4d7f8">_move_task</a></td></tr>
<tr class="memdesc:a7957df3a545a23c5525bbbc6e5e4d7f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manages the task of moving trends from stage to bucket.  <a href="#a7957df3a545a23c5525bbbc6e5e4d7f8">More...</a><br/></td></tr>
<tr class="separator:a7957df3a545a23c5525bbbc6e5e4d7f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6b7c953b384ace84b214be2fee0c7f7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab6b7c953b384ace84b214be2fee0c7f7"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#ab6b7c953b384ace84b214be2fee0c7f7">_levelup_in_progress</a></td></tr>
<tr class="memdesc:ab6b7c953b384ace84b214be2fee0c7f7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates that a bucket level up task is currently in progress. <br/></td></tr>
<tr class="separator:ab6b7c953b384ace84b214be2fee0c7f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67d189d1edaa263572eb87bd617d54d6"><td class="memItemLeft" align="right" valign="top">std::future&lt; std::tuple&lt; bool, <br class="typebreak"/>
double &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a67d189d1edaa263572eb87bd617d54d6">_levelup_task</a></td></tr>
<tr class="memdesc:a67d189d1edaa263572eb87bd617d54d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Manages the task of level up trends in the bucket db based on the policy.  <a href="#a67d189d1edaa263572eb87bd617d54d6">More...</a><br/></td></tr>
<tr class="separator:a67d189d1edaa263572eb87bd617d54d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6536ea9c3d21efd08c7eb441b5563a46"><td class="memItemLeft" align="right" valign="top">std::future&lt; void &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a6536ea9c3d21efd08c7eb441b5563a46">_obsolete_move_task</a></td></tr>
<tr class="memdesc:a6536ea9c3d21efd08c7eb441b5563a46"><td class="mdescLeft">&#160;</td><td class="mdescRight">If there are too many stage DBs to keep open, this task moves the others into the bucket DB in the background.  <a href="#a6536ea9c3d21efd08c7eb441b5563a46">More...</a><br/></td></tr>
<tr class="separator:a6536ea9c3d21efd08c7eb441b5563a46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7f0a0ba0ca0ac4871bd782ff48d4341"><td class="memItemLeft" align="right" valign="top">std::deque&lt; uint32_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#ac7f0a0ba0ca0ac4871bd782ff48d4341">_obsolete_move_indices</a></td></tr>
<tr class="memdesc:ac7f0a0ba0ca0ac4871bd782ff48d4341"><td class="mdescLeft">&#160;</td><td class="mdescRight">List of obsolete stage DB indices to move.  <a href="#ac7f0a0ba0ca0ac4871bd782ff48d4341">More...</a><br/></td></tr>
<tr class="separator:ac7f0a0ba0ca0ac4871bd782ff48d4341"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd655929c4c75820deeb226b62ae0c6c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acd655929c4c75820deeb226b62ae0c6c"></a>
px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#acd655929c4c75820deeb226b62ae0c6c">_db_path</a></td></tr>
<tr class="memdesc:acd655929c4c75820deeb226b62ae0c6c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents the parent folder of all the databases. <br/></td></tr>
<tr class="separator:acd655929c4c75820deeb226b62ae0c6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45befea74c1869adca316c14c42fa2f1"><td class="memItemLeft" align="right" valign="top">std::map&lt; uint32_t, <br class="typebreak"/>
std::shared_ptr<br class="typebreak"/>
&lt; px::db::CKeyValueStore &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a45befea74c1869adca316c14c42fa2f1">_stage_dbs</a></td></tr>
<tr class="memdesc:a45befea74c1869adca316c14c42fa2f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">A list of daily stage dbs ordered by the day index (since 1970 epoch UTC).  <a href="#a45befea74c1869adca316c14c42fa2f1">More...</a><br/></td></tr>
<tr class="separator:a45befea74c1869adca316c14c42fa2f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7aa64b90216dac784c17663db20a6bf7"><td class="memItemLeft" align="right" valign="top">std::shared_ptr<br class="typebreak"/>
&lt; px::db::CKeyValueStore &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a7aa64b90216dac784c17663db20a6bf7">_bucket_db</a></td></tr>
<tr class="memdesc:a7aa64b90216dac784c17663db20a6bf7"><td class="mdescLeft">&#160;</td><td class="mdescRight">A single bucket db stores all aggregated 5/15/60 minutes data for all times.  <a href="#a7aa64b90216dac784c17663db20a6bf7">More...</a><br/></td></tr>
<tr class="separator:a7aa64b90216dac784c17663db20a6bf7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44927ca732bb1f6d1d52cda6f27c3137"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a44927ca732bb1f6d1d52cda6f27c3137"></a>
std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a44927ca732bb1f6d1d52cda6f27c3137">_mutex</a></td></tr>
<tr class="memdesc:a44927ca732bb1f6d1d52cda6f27c3137"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex to make the members thread safe. <br/></td></tr>
<tr class="separator:a44927ca732bb1f6d1d52cda6f27c3137"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d701b44bb5466effefa1d56bbd30817"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a9d701b44bb5466effefa1d56bbd30817">_live_interval</a></td></tr>
<tr class="memdesc:a9d701b44bb5466effefa1d56bbd30817"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tracks the latest live interval (normalized to 5-minute) that is current accumulating data.  <a href="#a9d701b44bb5466effefa1d56bbd30817">More...</a><br/></td></tr>
<tr class="separator:a9d701b44bb5466effefa1d56bbd30817"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1f5504b93ee3ed1cf6b29e3da683588"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="classCTrendsCache.html">CTrendsCache</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#ad1f5504b93ee3ed1cf6b29e3da683588">_cache</a></td></tr>
<tr class="memdesc:ad1f5504b93ee3ed1cf6b29e3da683588"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cache the last interval snapshot, mostly designed to optimize the PXI integration.  <a href="#ad1f5504b93ee3ed1cf6b29e3da683588">More...</a><br/></td></tr>
<tr class="separator:ad1f5504b93ee3ed1cf6b29e3da683588"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae1ea363768a947ba481002060411a4b1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae1ea363768a947ba481002060411a4b1"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#ae1ea363768a947ba481002060411a4b1">_migration_count</a></td></tr>
<tr class="memdesc:ae1ea363768a947ba481002060411a4b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Count of migrations from stage to bucket, to determine if the move happened during the query. <br/></td></tr>
<tr class="separator:ae1ea363768a947ba481002060411a4b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-static-attribs"></a>
Static Private Attributes</h2></td></tr>
<tr class="memitem:a44f208740681e380a5190bac2f451466"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a44f208740681e380a5190bac2f451466"></a>
static const px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a44f208740681e380a5190bac2f451466">_bucket_db_name</a> = &quot;trends&quot;</td></tr>
<tr class="memdesc:a44f208740681e380a5190bac2f451466"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents the bucket db name: trends. <br/></td></tr>
<tr class="separator:a44f208740681e380a5190bac2f451466"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9d4200b9cb69903aa3fc3fc1c10e1b86"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9d4200b9cb69903aa3fc3fc1c10e1b86"></a>
static const px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a9d4200b9cb69903aa3fc3fc1c10e1b86">_stage_db_prefix</a> = &quot;trend_&quot;</td></tr>
<tr class="memdesc:a9d4200b9cb69903aa3fc3fc1c10e1b86"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents the stage db name's prefix: trend_&lt;index&gt; <br/></td></tr>
<tr class="separator:a9d4200b9cb69903aa3fc3fc1c10e1b86"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aefe61238451214c05d8192da80d16c00"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aefe61238451214c05d8192da80d16c00"></a>
static const px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#aefe61238451214c05d8192da80d16c00">_obsolete_stage_db_prefix</a> = &quot;old_trend_&quot;</td></tr>
<tr class="memdesc:aefe61238451214c05d8192da80d16c00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents the obsolete stage db name's prefix: old_trend_&lt;index&gt; <br/></td></tr>
<tr class="separator:aefe61238451214c05d8192da80d16c00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a47da0724e3b8bd77671ebb2a5bafdead"><td class="memItemLeft" align="right" valign="top">static const unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a47da0724e3b8bd77671ebb2a5bafdead">_default_absolute_count_limit</a> = 1000000</td></tr>
<tr class="memdesc:a47da0724e3b8bd77671ebb2a5bafdead"><td class="mdescLeft">&#160;</td><td class="mdescRight">Represents a hard coded query limit of the trends values count.  <a href="#a47da0724e3b8bd77671ebb2a5bafdead">More...</a><br/></td></tr>
<tr class="separator:a47da0724e3b8bd77671ebb2a5bafdead"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71c3a037795aed1c21e179e03a291bf0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a71c3a037795aed1c21e179e03a291bf0"></a>
static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#a71c3a037795aed1c21e179e03a291bf0">_max_stage_dbs_atstart</a> = 5</td></tr>
<tr class="memdesc:a71c3a037795aed1c21e179e03a291bf0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Max stage DBs to be opened at startup. <br/></td></tr>
<tr class="separator:a71c3a037795aed1c21e179e03a291bf0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afce95787ec63087a1de7066bc834446e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afce95787ec63087a1de7066bc834446e"></a>
static const int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCTrendStore.html#afce95787ec63087a1de7066bc834446e">_max_stage_dbs_ever</a> = 10</td></tr>
<tr class="memdesc:afce95787ec63087a1de7066bc834446e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Max stage DBs to be open at one time during operation. <br/></td></tr>
<tr class="separator:afce95787ec63087a1de7066bc834446e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class to manage the trend storage. </p>
<p>Manages the bucket database (long-term storage), and one or more staging databases (where recent data is stored for about a day).</p>
<p>Methods are safe to call in multiple threads concurrently, except where noted otherwise. </p>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00036">36</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a80c34117d445d20b3693ae3912965f6a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CTrendStore::CTrendStore </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>db_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCDataStore.html">CDataStore</a> *&#160;</td>
          <td class="paramname"><em>cds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_path</td><td>Specifies the absolute folder path for all the databases. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00074">74</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a41b47ef0bf30a13c7141c7a101d2154f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t CTrendStore::get_stage_db_index </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>time</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the stage db index (day index since 1970 UTC), based on the timestamp already normalized to 5-minute interval (end of interval). </p>
<p>The ceiling of minutes divided by 1 day. The valid index always starts from 1.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">time</td><td>The minutes (normalized to 5-min interval) since 1970 UTC. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00062">62</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_a41b47ef0bf30a13c7141c7a101d2154f_icgraph.png" border="0" usemap="#classCTrendStore_a41b47ef0bf30a13c7141c7a101d2154f_icgraph" alt=""/></div>
<map name="classCTrendStore_a41b47ef0bf30a13c7141c7a101d2154f_icgraph" id="classCTrendStore_a41b47ef0bf30a13c7141c7a101d2154f_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#ad1c7deb03bf9c342c8ca5e554f2f8cf2" title="Stores trends update from the accumulators to the stage db. " alt="" coords="251,5,392,32"/><area shape="rect" id="node4" href="classCTrendStore.html#a8a35bb8b7a967d2dc7664282ffa0f717" title="Create today&#39;s stage db if not existing, during the startup. " alt="" coords="243,57,399,98"/><area shape="rect" id="node5" href="classCTrendStore.html#a59ae14f650ab7f058f8dd0c52bd15610" title="Query the databases. " alt="" coords="227,123,416,149"/><area shape="rect" id="node6" href="classCTrendStore.html#ae5e4b974f877eb1a20e2793e55ded3fe" title="Export to CSV. " alt="" coords="465,148,657,175"/><area shape="rect" id="node7" href="classCTrendStore.html#aac019b1e6569b8ede89d5c09589f8aec" title="Gets the stage db index (day index since 1970 UTC), based on the timestamp. " alt="" coords="235,225,407,266"/><area shape="rect" id="node3" href="classCTrendStore.html#a7adaa6fa7bd22a8800383313c072dd89" title="Import from CSV. " alt="" coords="465,5,658,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aac019b1e6569b8ede89d5c09589f8aec"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static uint32_t CTrendStore::get_stage_db_index </td>
          <td>(</td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>time</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the stage db index (day index since 1970 UTC), based on the timestamp. </p>
<p>The valid index always starts from 1.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">time</td><td>The CWallTime. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00079">79</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2c6ee12af0640fab076136d51a6994c6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::get_stage_db_minutes_range </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>stage_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t &amp;&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t &amp;&#160;</td>
          <td class="paramname"><em>to</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the valid minutes time range (inclusive) from a stage db, based on its index. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stage_index</td><td>The stage db's index (days since 1970 UTC). The valid index always starts from 1. </td></tr>
    <tr><td class="paramname">from</td><td>The returned from minutes (should be YYYY-MM-DD 00:00:05) </td></tr>
    <tr><td class="paramname">to</td><td>The returned to minutes (should be YYYY-MM-DD+1 00:00:00) In this case, the stage's index is YYYY-MM-DD+1 </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00631">631</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_a2c6ee12af0640fab076136d51a6994c6_icgraph.png" border="0" usemap="#classCTrendStore_a2c6ee12af0640fab076136d51a6994c6_icgraph" alt=""/></div>
<map name="classCTrendStore_a2c6ee12af0640fab076136d51a6994c6_icgraph" id="classCTrendStore_a2c6ee12af0640fab076136d51a6994c6_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#a85aecef759f13455e6ed202b75971eb1" title="Move trends from the stage dbs (whose index is smaller than the cutoff) to the bucket, then delete the moved stage dbs. " alt="" coords="237,5,425,46"/><area shape="rect" id="node3" href="classCTrendStore.html#a3e9f7f12e9675a8cfe5f53231b94d459" title="Move the obsolete trend stage DBs listed in _obsolete_move_indices to the bucket DB. " alt="" coords="227,70,435,111"/><area shape="rect" id="node4" href="classCTrendStore.html#a1ecb59e829d27ea473fd0e7088b687e3" title="Kick off the thread to do the above obsolete move, if needed. " alt="" coords="483,70,685,111"/><area shape="rect" id="node5" href="classCTrendStore.html#af183006bcd799d8d92565050a88b2840" title="Gets the stage db based on the stage index, create it if not existing. " alt="" coords="741,52,936,79"/><area shape="rect" id="node9" href="classCTrendStore.html#abc8c75eccfec80c4db86f8d5eb0f5a28" title="Initialize the object. " alt="" coords="734,103,943,129"/><area shape="rect" id="node6" href="classCTrendStore.html#ad1c7deb03bf9c342c8ca5e554f2f8cf2" title="Stores trends update from the accumulators to the stage db. " alt="" coords="1000,23,1141,49"/><area shape="rect" id="node8" href="classCTrendStore.html#a8a35bb8b7a967d2dc7664282ffa0f717" title="Create today&#39;s stage db if not existing, during the startup. " alt="" coords="993,74,1149,115"/><area shape="rect" id="node7" href="classCTrendStore.html#a7adaa6fa7bd22a8800383313c072dd89" title="Import from CSV. " alt="" coords="1198,23,1391,49"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad1c7deb03bf9c342c8ca5e554f2f8cf2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::store </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; std::shared_ptr&lt; px::CTrendStageUpdate &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>updates</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stores trends update from the accumulators to the stage db. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">updates</td><td>Updates from the accumulators, whether they are in a batch depends on how the value updates are pushed from the DH, or replay. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00280">280</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_ad1c7deb03bf9c342c8ca5e554f2f8cf2_icgraph.png" border="0" usemap="#classCTrendStore_ad1c7deb03bf9c342c8ca5e554f2f8cf2_icgraph" alt=""/></div>
<map name="classCTrendStore_ad1c7deb03bf9c342c8ca5e554f2f8cf2_icgraph" id="classCTrendStore_ad1c7deb03bf9c342c8ca5e554f2f8cf2_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#a7adaa6fa7bd22a8800383313c072dd89" title="Import from CSV. " alt="" coords="195,5,389,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a59ae14f650ab7f058f8dd0c52bd15610"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt; px::CChannelTrends &gt; CTrendStore::QueryTrends </td>
          <td>(</td>
          <td class="paramtype">const std::unordered_map&lt; uint32_t, px::datatype &gt; &amp;&#160;</td>
          <td class="paramname"><em>channels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>complete_snapshots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>start_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>requested_end_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>request_period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_avg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_actual</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>row_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>absolute_count_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>more_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Query the databases. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channels</td><td>A list of channel ids (that are trended). </td></tr>
    <tr><td class="paramname">complete_snapshots</td><td>Only include trends that are completed for a given interval. This feature is required by the Mercury GetTrendSnapshots API. </td></tr>
    <tr><td class="paramname">start_time</td><td>Do not return results from before this time. Returns from beginning of databases if invalid. </td></tr>
    <tr><td class="paramname">requested_end_time</td><td>Do not return results after this time. Returns results to end of databases if invalid. </td></tr>
    <tr><td class="paramname">request_period</td><td>Interval desired, in minutes, must be 5, 15, 60, or 1440. the aggregated data can be returned if Data returned will be this interval, or longer. </td></tr>
    <tr><td class="paramname">include_avg</td><td>Include the 'average' trait (when present) </td></tr>
    <tr><td class="paramname">include_min</td><td>Include the 'min' trait (when present) </td></tr>
    <tr><td class="paramname">include_max</td><td>Include the 'max' trait (when present) </td></tr>
    <tr><td class="paramname">include_actual</td><td>Include the 'actual' trait (when present) </td></tr>
    <tr><td class="paramname">row_limit</td><td>The limit for each trends row retruned. 0 = unlimited </td></tr>
    <tr><td class="paramname">absolute_count_limit</td><td>The limit for each trend value. </td></tr>
    <tr><td class="paramname">more_data</td><td>Set to true if limit hit and there would otherwise be more data to return. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l01284">1284</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_a59ae14f650ab7f058f8dd0c52bd15610_icgraph.png" border="0" usemap="#classCTrendStore_a59ae14f650ab7f058f8dd0c52bd15610_icgraph" alt=""/></div>
<map name="classCTrendStore_a59ae14f650ab7f058f8dd0c52bd15610_icgraph" id="classCTrendStore_a59ae14f650ab7f058f8dd0c52bd15610_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#ae5e4b974f877eb1a20e2793e55ded3fe" title="Export to CSV. " alt="" coords="243,5,435,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad76f4c4b0dcfec8ec3c34af58aead9fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::DeleteTrends </td>
          <td>(</td>
          <td class="paramtype">const std::unordered_set&lt; uint32_t &gt; &amp;&#160;</td>
          <td class="paramname"><em>channel_ids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>start_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>end_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete entries from the trend databases. </p>
<p>Compacts them immediately.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channel_ids</td><td>Delete only trends from channels covered by this set. </td></tr>
    <tr><td class="paramname">start_time</td><td>Do not delete trend entries from before this time. Ignored if invalid. </td></tr>
    <tr><td class="paramname">end_time</td><td>Do not delete trend entries from after this time. Ignored if invalid. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l01731">1731</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ab7e4cba287d2a38f399a1c4313e27560"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::DeleteTrends </td>
          <td>(</td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>start_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>end_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Delete entries from the trend databases by date (all channels). </p>
<p>Compacts them immediately.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">start_time</td><td>Do not delete trend entries from before this time. Open ended if invalid. </td></tr>
    <tr><td class="paramname">end_time</td><td>Do not delete trend entries from after this time. Open ended if invalid. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l01757">1757</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a7adaa6fa7bd22a8800383313c072dd89"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::ImportTrends </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>file_path</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>row_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &amp;&#160;</td>
          <td class="paramname"><em>value_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>stage_only</em> = <code>false</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>bucket_only</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Import from CSV. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file_path</td><td>Absolute path to file. </td></tr>
    <tr><td class="paramname">row_count</td><td>Number of rows read and successfully imported. </td></tr>
    <tr><td class="paramname">value_count</td><td>Number of total traits read and successfully imported. </td></tr>
    <tr><td class="paramname">stage_only</td><td>If true, import directly to current stage DB </td></tr>
    <tr><td class="paramname">bucket_only</td><td>If true, import directly to bucket DB </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l01782">1782</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae5e4b974f877eb1a20e2793e55ded3fe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::ExportTrends </td>
          <td>(</td>
          <td class="paramtype">std::ofstream &amp;&#160;</td>
          <td class="paramname"><em>file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; uint32_t &gt; &amp;&#160;</td>
          <td class="paramname"><em>channel_ids</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::unordered_map&lt; uint32_t, px::datatype &gt; &amp;&#160;</td>
          <td class="paramname"><em>channels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::unordered_map&lt; uint32_t, std::bitset&lt; 4 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>channel_traits_map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>start_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>end_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>request_period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_avg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_min_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_max_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_actual</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_stage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_bucket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>row_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>export_local_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>more_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>values_count</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int &amp;&#160;</td>
          <td class="paramname"><em>row_count</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Export to CSV. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">file</td><td>The output file stream that is already opened. </td></tr>
    <tr><td class="paramname">channels</td><td>A list of channel ids (that are trended). </td></tr>
    <tr><td class="paramname">channel_traits_map</td><td>Lookup from channel id to the traits flags. </td></tr>
    <tr><td class="paramname">start_time</td><td>Do not return results from before this time. Returns from beginning of databases if invalid. </td></tr>
    <tr><td class="paramname">end_time</td><td>Do not return results after this time. Returns results to end of databases if invalid.</td></tr>
    <tr><td class="paramname">request_period</td><td>Interval desired, in minutes. Data returned will be this interval, or longer.</td></tr>
    <tr><td class="paramname">include_avg</td><td>Include the 'average' trait (when present) </td></tr>
    <tr><td class="paramname">include_min</td><td>Include the 'min' trait (when present) </td></tr>
    <tr><td class="paramname">include_max</td><td>Include the 'max' trait (when present) </td></tr>
    <tr><td class="paramname">include_actual</td><td>Include the 'actual' trait (when present) </td></tr>
    <tr><td class="paramname">include_stage</td><td>If true, data will be exported from the stages. </td></tr>
    <tr><td class="paramname">bucket_only</td><td>If true, data will be exported from the buckets. </td></tr>
    <tr><td class="paramname">row_limit</td><td>Export at most this many rows. 0 = unlimited </td></tr>
    <tr><td class="paramname">export_local_time</td><td>If true, export local timestamps, otherwise UTC. </td></tr>
    <tr><td class="paramname">more_data</td><td>Set to true if limit hit and there would otherwise be more data to include. </td></tr>
    <tr><td class="paramname">values_count</td><td>Set to the number of total traits exported. </td></tr>
    <tr><td class="paramname">row_count</td><td>Set to the number of rows exported. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l01795">1795</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="af183006bcd799d8d92565050a88b2840"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt; px::db::CKeyValueStore &gt; CTrendStore::get_stage_db </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>stage_index</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Gets the stage db based on the stage index, create it if not existing. </p>
<p>Returns empty ptr if failed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stage_index</td><td>Represents a stage db's index. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00148">148</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_af183006bcd799d8d92565050a88b2840_icgraph.png" border="0" usemap="#classCTrendStore_af183006bcd799d8d92565050a88b2840_icgraph" alt=""/></div>
<map name="classCTrendStore_af183006bcd799d8d92565050a88b2840_icgraph" id="classCTrendStore_af183006bcd799d8d92565050a88b2840_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#ad1c7deb03bf9c342c8ca5e554f2f8cf2" title="Stores trends update from the accumulators to the stage db. " alt="" coords="256,5,397,32"/><area shape="rect" id="node4" href="classCTrendStore.html#a8a35bb8b7a967d2dc7664282ffa0f717" title="Create today&#39;s stage db if not existing, during the startup. " alt="" coords="249,57,405,98"/><area shape="rect" id="node3" href="classCTrendStore.html#a7adaa6fa7bd22a8800383313c072dd89" title="Import from CSV. " alt="" coords="454,5,647,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a447cb6335f985ba76c8df57038e87707"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t CTrendStore::get_migration_count </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the count of stage-&gt;bucket DB migrations that have happened. </p>
<p>If this differs from the last value, a migration has started in the interim between calls. </p>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l02218">2218</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_a447cb6335f985ba76c8df57038e87707_icgraph.png" border="0" usemap="#classCTrendStore_a447cb6335f985ba76c8df57038e87707_icgraph" alt=""/></div>
<map name="classCTrendStore_a447cb6335f985ba76c8df57038e87707_icgraph" id="classCTrendStore_a447cb6335f985ba76c8df57038e87707_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#a59ae14f650ab7f058f8dd0c52bd15610" title="Query the databases. " alt="" coords="253,12,443,39"/><area shape="rect" id="node3" href="classCTrendStore.html#ae5e4b974f877eb1a20e2793e55ded3fe" title="Export to CSV. " alt="" coords="491,12,683,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a96d9c92e871bdf011ddde3f905dad5a6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::get_levelup_policy </td>
          <td>(</td>
          <td class="paramtype">uint32_t &amp;&#160;</td>
          <td class="paramname"><em>min_free_space_mb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t &amp;&#160;</td>
          <td class="paramname"><em>time_threshold_5min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t &amp;&#160;</td>
          <td class="paramname"><em>time_threshold_15min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t &amp;&#160;</td>
          <td class="paramname"><em>time_threshold_60min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t &amp;&#160;</td>
          <td class="paramname"><em>step_days</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the currently-active levelup and rolloff policy (calculated from today based on OOB-stored thresholds) </p>
<p>Gets the currently-active levelup settings. </p>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00847">847</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_a96d9c92e871bdf011ddde3f905dad5a6_icgraph.png" border="0" usemap="#classCTrendStore_a96d9c92e871bdf011ddde3f905dad5a6_icgraph" alt=""/></div>
<map name="classCTrendStore_a96d9c92e871bdf011ddde3f905dad5a6_icgraph" id="classCTrendStore_a96d9c92e871bdf011ddde3f905dad5a6_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#ad2047a9303a805c0334733c49008f229" title="Trend bucket database periodic maintenance: level&#45;up, roll&#45;off, and clean&#45;up. " alt="" coords="238,12,445,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad2047a9303a805c0334733c49008f229"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::BucketCleanup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Trend bucket database periodic maintenance: level-up, roll-off, and clean-up. </p>
<p>Works like this: 1) Per DatabaseSettings, level-up old 5-minute buckets to 15-minute intervals, 15 to 60, 60 to deletion. 2) Delete any entries for non-existent or non-trended channels. 3) Check the free space of the filesystem containing the bucket DB. If less than the minimum in DatabaseSettings, levelup and rolloff entries with progressively tighter thresholds until there is 101% of the minimum amount free, or there are no bucket entries. </p>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l02418">2418</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6e863b54d7952319a18dec47ed37e2d0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t CTrendStore::get_trend_bucket_disk_free_space </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Trigger the level up and then shrink trends buckets in the async mode. </p>
<p>The condition should be checked before calling this method. Get the free space, in bytes, for the filesystem the bucket database is stored on. </p>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l02395">2395</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_a6e863b54d7952319a18dec47ed37e2d0_icgraph.png" border="0" usemap="#classCTrendStore_a6e863b54d7952319a18dec47ed37e2d0_icgraph" alt=""/></div>
<map name="classCTrendStore_a6e863b54d7952319a18dec47ed37e2d0_icgraph" id="classCTrendStore_a6e863b54d7952319a18dec47ed37e2d0_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#ad2047a9303a805c0334733c49008f229" title="Trend bucket database periodic maintenance: level&#45;up, roll&#45;off, and clean&#45;up. " alt="" coords="241,12,447,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a85aecef759f13455e6ed202b75971eb1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::tuple&lt; bool, std::vector&lt; uint32_t &gt;, double &gt; CTrendStore::move_stage_to_bucket </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>cutoff</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Move trends from the stage dbs (whose index is smaller than the cutoff) to the bucket, then delete the moved stage dbs. </p>
<p>Returns a tuple of result, including: bool: Indicates if successful, vector: a list of stages moved, double: duration in seconds Ran on trend_bucket_thread.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">live_stage_index</td><td>Indicates the live stage db that is active. All previous stage dbs are mature to move. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00652">652</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a634f8304b324e61a428bb00193e5332a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::tuple&lt; bool, double &gt; CTrendStore::levelup_bucket </td>
          <td>(</td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>time_threshold_5min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>time_threshold_15min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>time_threshold_60min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>num_trended_channels</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Levelup bucket trends from 5 to 15, then to 60, then to deletion, based on the policy. </p>
<p>num_trended_channels is a hint for the database size. Returns a tuple of result, including: bool: Indicates if successful, double: duration in seconds </p>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00892">892</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_a634f8304b324e61a428bb00193e5332a_icgraph.png" border="0" usemap="#classCTrendStore_a634f8304b324e61a428bb00193e5332a_icgraph" alt=""/></div>
<map name="classCTrendStore_a634f8304b324e61a428bb00193e5332a_icgraph" id="classCTrendStore_a634f8304b324e61a428bb00193e5332a_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#ad2047a9303a805c0334733c49008f229" title="Trend bucket database periodic maintenance: level&#45;up, roll&#45;off, and clean&#45;up. " alt="" coords="211,12,418,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="abc8c75eccfec80c4db86f8d5eb0f5a28"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::load_stage_dbs </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize the object. </p>
<p>Open the databases, creating as necessary. Throws generic_err if something goes wrong. </p>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00436">436</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="acb1baa80b5173ec9aa49dc6eae66acc7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">px::string CTrendStore::get_stage_db_path </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>stage_index</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the stage db path based on the stage index (daily since 1970 UTC). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stage_index</td><td>Represents a stage db's index. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00613">613</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_acb1baa80b5173ec9aa49dc6eae66acc7_icgraph.png" border="0" usemap="#classCTrendStore_acb1baa80b5173ec9aa49dc6eae66acc7_icgraph" alt=""/></div>
<map name="classCTrendStore_acb1baa80b5173ec9aa49dc6eae66acc7_icgraph" id="classCTrendStore_acb1baa80b5173ec9aa49dc6eae66acc7_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#af183006bcd799d8d92565050a88b2840" title="Gets the stage db based on the stage index, create it if not existing. " alt="" coords="235,35,429,61"/><area shape="rect" id="node6" href="classCTrendStore.html#abc8c75eccfec80c4db86f8d5eb0f5a28" title="Initialize the object. " alt="" coords="227,85,437,112"/><area shape="rect" id="node7" href="classCTrendStore.html#a85aecef759f13455e6ed202b75971eb1" title="Move trends from the stage dbs (whose index is smaller than the cutoff) to the bucket, then delete the moved stage dbs. " alt="" coords="238,137,426,178"/><area shape="rect" id="node3" href="classCTrendStore.html#ad1c7deb03bf9c342c8ca5e554f2f8cf2" title="Stores trends update from the accumulators to the stage db. " alt="" coords="493,5,635,32"/><area shape="rect" id="node5" href="classCTrendStore.html#a8a35bb8b7a967d2dc7664282ffa0f717" title="Create today&#39;s stage db if not existing, during the startup. " alt="" coords="486,57,642,98"/><area shape="rect" id="node4" href="classCTrendStore.html#a7adaa6fa7bd22a8800383313c072dd89" title="Import from CSV. " alt="" coords="691,5,885,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7e150ff2403542b0b5d70d6e669f09e3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">px::string CTrendStore::get_obsolete_stage_db_path </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>stage_index</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the obsolete stage db path based on the stage index (daily since 1970 UTC). </p>
<p>These paths are used to store stage DBs that we are just consuming in the background rather than querying. Under normal conditions, none exist.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">stage_index</td><td>Represents a stage db's index. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00622">622</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_a7e150ff2403542b0b5d70d6e669f09e3_icgraph.png" border="0" usemap="#classCTrendStore_a7e150ff2403542b0b5d70d6e669f09e3_icgraph" alt=""/></div>
<map name="classCTrendStore_a7e150ff2403542b0b5d70d6e669f09e3_icgraph" id="classCTrendStore_a7e150ff2403542b0b5d70d6e669f09e3_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#af183006bcd799d8d92565050a88b2840" title="Gets the stage db based on the stage index, create it if not existing. " alt="" coords="760,35,955,61"/><area shape="rect" id="node6" href="classCTrendStore.html#abc8c75eccfec80c4db86f8d5eb0f5a28" title="Initialize the object. " alt="" coords="753,89,962,116"/><area shape="rect" id="node7" href="classCTrendStore.html#a3e9f7f12e9675a8cfe5f53231b94d459" title="Move the obsolete trend stage DBs listed in _obsolete_move_indices to the bucket DB. " alt="" coords="245,54,453,95"/><area shape="rect" id="node3" href="classCTrendStore.html#ad1c7deb03bf9c342c8ca5e554f2f8cf2" title="Stores trends update from the accumulators to the stage db. " alt="" coords="1019,5,1160,32"/><area shape="rect" id="node5" href="classCTrendStore.html#a8a35bb8b7a967d2dc7664282ffa0f717" title="Create today&#39;s stage db if not existing, during the startup. " alt="" coords="1011,57,1167,98"/><area shape="rect" id="node4" href="classCTrendStore.html#a7adaa6fa7bd22a8800383313c072dd89" title="Import from CSV. " alt="" coords="1217,5,1410,32"/><area shape="rect" id="node8" href="classCTrendStore.html#a1ecb59e829d27ea473fd0e7088b687e3" title="Kick off the thread to do the above obsolete move, if needed. " alt="" coords="501,54,704,95"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a3e9f7f12e9675a8cfe5f53231b94d459"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::move_obsolete_stage_dbs_to_bucket </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Move the obsolete trend stage DBs listed in _obsolete_move_indices to the bucket DB. </p>
<p>Meant to be the top function of a background thread. </p>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l02225">2225</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_a3e9f7f12e9675a8cfe5f53231b94d459_icgraph.png" border="0" usemap="#classCTrendStore_a3e9f7f12e9675a8cfe5f53231b94d459_icgraph" alt=""/></div>
<map name="classCTrendStore_a3e9f7f12e9675a8cfe5f53231b94d459_icgraph" id="classCTrendStore_a3e9f7f12e9675a8cfe5f53231b94d459_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#a1ecb59e829d27ea473fd0e7088b687e3" title="Kick off the thread to do the above obsolete move, if needed. " alt="" coords="261,53,464,94"/><area shape="rect" id="node3" href="classCTrendStore.html#af183006bcd799d8d92565050a88b2840" title="Gets the stage db based on the stage index, create it if not existing. " alt="" coords="520,35,715,61"/><area shape="rect" id="node7" href="classCTrendStore.html#abc8c75eccfec80c4db86f8d5eb0f5a28" title="Initialize the object. " alt="" coords="513,85,722,112"/><area shape="rect" id="node4" href="classCTrendStore.html#ad1c7deb03bf9c342c8ca5e554f2f8cf2" title="Stores trends update from the accumulators to the stage db. " alt="" coords="779,5,920,32"/><area shape="rect" id="node6" href="classCTrendStore.html#a8a35bb8b7a967d2dc7664282ffa0f717" title="Create today&#39;s stage db if not existing, during the startup. " alt="" coords="771,57,927,98"/><area shape="rect" id="node5" href="classCTrendStore.html#a7adaa6fa7bd22a8800383313c072dd89" title="Import from CSV. " alt="" coords="977,5,1170,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a1ecb59e829d27ea473fd0e7088b687e3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::poke_obsolete_move_task </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Kick off the thread to do the above obsolete move, if needed. </p>
<p>Call under _obsolete_move_lock. </p>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00577">577</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_a1ecb59e829d27ea473fd0e7088b687e3_icgraph.png" border="0" usemap="#classCTrendStore_a1ecb59e829d27ea473fd0e7088b687e3_icgraph" alt=""/></div>
<map name="classCTrendStore_a1ecb59e829d27ea473fd0e7088b687e3_icgraph" id="classCTrendStore_a1ecb59e829d27ea473fd0e7088b687e3_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#af183006bcd799d8d92565050a88b2840" title="Gets the stage db based on the stage index, create it if not existing. " alt="" coords="264,35,459,61"/><area shape="rect" id="node6" href="classCTrendStore.html#abc8c75eccfec80c4db86f8d5eb0f5a28" title="Initialize the object. " alt="" coords="257,85,466,112"/><area shape="rect" id="node3" href="classCTrendStore.html#ad1c7deb03bf9c342c8ca5e554f2f8cf2" title="Stores trends update from the accumulators to the stage db. " alt="" coords="523,5,664,32"/><area shape="rect" id="node5" href="classCTrendStore.html#a8a35bb8b7a967d2dc7664282ffa0f717" title="Create today&#39;s stage db if not existing, during the startup. " alt="" coords="515,57,671,98"/><area shape="rect" id="node4" href="classCTrendStore.html#a7adaa6fa7bd22a8800383313c072dd89" title="Import from CSV. " alt="" coords="721,5,914,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af6254f613e306e2f2a56a0cfc0a44206"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CTrendStore::query_db </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; px::db::CKeyValueStore &gt;&#160;</td>
          <td class="paramname"><em>db</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>is_bucket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">px::CChannelTrends &amp;&#160;</td>
          <td class="paramname"><em>trends</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>start_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>end_time</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>request_period</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_avg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_min</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_max</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const bool&#160;</td>
          <td class="paramname"><em>include_actual</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>row_count_limit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &amp;&#160;</td>
          <td class="paramname"><em>more_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Query trends from a stage DB or the bucket DB based on query criteria. </p>
<p>The result is always sorted in the time ascending order. The limit should be applied to the time ascending order as well. (Truncate the newer data when the limit has been reached.) </p>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l00966">966</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_af6254f613e306e2f2a56a0cfc0a44206_icgraph.png" border="0" usemap="#classCTrendStore_af6254f613e306e2f2a56a0cfc0a44206_icgraph" alt=""/></div>
<map name="classCTrendStore_af6254f613e306e2f2a56a0cfc0a44206_icgraph" id="classCTrendStore_af6254f613e306e2f2a56a0cfc0a44206_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#a59ae14f650ab7f058f8dd0c52bd15610" title="Query the databases. " alt="" coords="221,5,411,32"/><area shape="rect" id="node3" href="classCTrendStore.html#ae5e4b974f877eb1a20e2793e55ded3fe" title="Export to CSV. " alt="" coords="459,5,651,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aa8e893b14ce6ed5519bf821d0ff61ff8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned int CTrendStore::merge_query_results </td>
          <td>(</td>
          <td class="paramtype">px::CChannelTrends &amp;&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CChannelTrends &amp;&#160;</td>
          <td class="paramname"><em>src</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Merge "src" query results into "dst". </p>
<p>Assumes trends within each are time-sorted in the same direction. Most efficient if src set is smaller and times are at the end of dst, but will work otherwise. Returns number of redundant trends removed. </p>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l01163">1163</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_aa8e893b14ce6ed5519bf821d0ff61ff8_icgraph.png" border="0" usemap="#classCTrendStore_aa8e893b14ce6ed5519bf821d0ff61ff8_icgraph" alt=""/></div>
<map name="classCTrendStore_aa8e893b14ce6ed5519bf821d0ff61ff8_icgraph" id="classCTrendStore_aa8e893b14ce6ed5519bf821d0ff61ff8_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#a59ae14f650ab7f058f8dd0c52bd15610" title="Query the databases. " alt="" coords="205,12,395,39"/><area shape="rect" id="node3" href="classCTrendStore.html#ae5e4b974f877eb1a20e2793e55ded3fe" title="Export to CSV. " alt="" coords="443,12,635,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="af3ef25a164ceaf87e84b5255aaa95320"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::string CTrendStore::get_trend_trait_value </td>
          <td>(</td>
          <td class="paramtype">const px::datatype&#160;</td>
          <td class="paramname"><em>datatype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const double &amp;&#160;</td>
          <td class="paramname"><em>value</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Gets the trend trait value in user readable format, based on its data type. </p>
<p>Returns empty string if not supported or invalid. </p>

<p>Definition at line <a class="el" href="trend__store_8cpp_source.html#l02170">2170</a> of file <a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCTrendStore_af3ef25a164ceaf87e84b5255aaa95320_icgraph.png" border="0" usemap="#classCTrendStore_af3ef25a164ceaf87e84b5255aaa95320_icgraph" alt=""/></div>
<map name="classCTrendStore_af3ef25a164ceaf87e84b5255aaa95320_icgraph" id="classCTrendStore_af3ef25a164ceaf87e84b5255aaa95320_icgraph">
<area shape="rect" id="node2" href="classCTrendStore.html#ae5e4b974f877eb1a20e2793e55ded3fe" title="Export to CSV. " alt="" coords="224,12,416,39"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a2d11f0b2effabc57610f3cb4cdf61be0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t CTrendStore::_live_stage_index</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Tracks the latest live update's stage index, so that we know that this stage index is not mature to be moved to the bucket. </p>
<p>Any stages earlier(smaller) than this index should be mature to move. </p>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00482">482</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a7957df3a545a23c5525bbbc6e5e4d7f8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::future&lt;std::tuple&lt;bool, std::vector&lt;uint32_t&gt;, double&gt; &gt; CTrendStore::_move_task</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Manages the task of moving trends from stage to bucket. </p>
<p>The result tuple contains a successful flag, the moved stage db's indexes, and the execution duration in seconds. </p>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00489">489</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a67d189d1edaa263572eb87bd617d54d6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::future&lt;std::tuple&lt;bool, double&gt; &gt; CTrendStore::_levelup_task</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Manages the task of level up trends in the bucket db based on the policy. </p>
<p>The result tuple contains a successful flag, and the execution duration in seconds, </p>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00500">500</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a6536ea9c3d21efd08c7eb441b5563a46"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::future&lt;void&gt; CTrendStore::_obsolete_move_task</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If there are too many stage DBs to keep open, this task moves the others into the bucket DB in the background. </p>
<p>Spawn and check for finishing under the _obsolete_move_lock. </p>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00507">507</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ac7f0a0ba0ca0ac4871bd782ff48d4341"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::deque&lt;uint32_t&gt; CTrendStore::_obsolete_move_indices</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>List of obsolete stage DB indices to move. </p>
<p>Background thread pops from back, other threads push to front. Pushes and pops must be done holding the _mutex, so if empty the thread can end. </p>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00515">515</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a45befea74c1869adca316c14c42fa2f1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;uint32_t, std::shared_ptr&lt;px::db::CKeyValueStore&gt; &gt; CTrendStore::_stage_dbs</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A list of daily stage dbs ordered by the day index (since 1970 epoch UTC). </p>
<p>The schema is optimized for write. Data are partitioned daily. The index is the days since 1970 UTC, starting from 1. It is the end (inclusive) time of the day. For example, trend_1 contains data between 1970-1-1 0:0:01 (not-included) and 1970-1-2 0:00 (included). </p>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00529">529</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a7aa64b90216dac784c17663db20a6bf7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;px::db::CKeyValueStore&gt; CTrendStore::_bucket_db</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A single bucket db stores all aggregated 5/15/60 minutes data for all times. </p>
<p>The schema is optimized for compact size and read speed. </p>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00534">534</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a47da0724e3b8bd77671ebb2a5bafdead"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const unsigned int CTrendStore::_default_absolute_count_limit = 1000000</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Represents a hard coded query limit of the trends values count. </p>
<p>All queries should not exceed this limit, otherwise too much data should be returned. </p>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00558">558</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a9d701b44bb5466effefa1d56bbd30817"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t CTrendStore::_live_interval</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Tracks the latest live interval (normalized to 5-minute) that is current accumulating data. </p>
<p>Any interval prior (and not including this one) is mature for snapshot fetch. </p>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00570">570</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ad1f5504b93ee3ed1cf6b29e3da683588"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="classCTrendsCache.html">CTrendsCache</a>&gt; CTrendStore::_cache</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Cache the last interval snapshot, mostly designed to optimize the PXI integration. </p>
<p>PXI pulls trends at least once every 2 minutes. The cache will allow the get_trend_snapshots to hit the memory and avoid disk/IO. </p>

<p>Definition at line <a class="el" href="trend__store_8hpp_source.html#l00576">576</a> of file <a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="trend__store_8hpp_source.html">trend_store.hpp</a></li>
<li><a class="el" href="trend__store_8cpp_source.html">trend_store.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classCTrendStore.html">CTrendStore</a></li>
    <li class="footer">Generated on Fri May 7 2021 20:24:01 for cds_ng by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
