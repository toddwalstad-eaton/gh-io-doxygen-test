<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>cds_ng: CSessManager Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">cds_ng
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classCSessManager.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classCSessManager-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">CSessManager Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class to manage user session operations.  
 <a href="classCSessManager.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="sess__manager_8hpp_source.html">sess_manager.hpp</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for CSessManager:</div>
<div class="dyncontent">
<div class="center"><img src="classCSessManager__coll__graph.png" border="0" usemap="#CSessManager_coll__map" alt="Collaboration graph"/></div>
<map name="CSessManager_coll__map" id="CSessManager_coll__map">
<area shape="rect" id="node3" title="STL class. " alt="" coords="21,245,173,286"/><area shape="rect" id="node5" href="classCDataStore.html" title="Top&#45;level class containing all internal data. " alt="" coords="1389,1048,1485,1075"/><area shape="rect" id="node6" href="classCOpenAlarmsStore.html" title="For open alarms, we need to maintain a few parallel data structures, so to make sure they stay in syn..." alt="" coords="970,927,1115,953"/><area shape="rect" id="node9" title="STL class. " alt="" coords="6,783,189,809"/><area shape="rect" id="node11" title="STL class. " alt="" coords="30,1036,165,1063"/><area shape="rect" id="node17" title="STL class. " alt="" coords="491,1701,648,1728"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac8560d944a9e7c994f38177ed587dac5"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac8560d944a9e7c994f38177ed587dac5"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#ac8560d944a9e7c994f38177ed587dac5">CSessManager</a> (std::shared_ptr&lt; <a class="el" href="classCAuthManager.html">CAuthManager</a> &gt; auth_mgr, <a class="el" href="classCDataStore.html">CDataStore</a> &amp;cds)</td></tr>
<tr class="memdesc:ac8560d944a9e7c994f38177ed587dac5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor. <br/></td></tr>
<tr class="separator:ac8560d944a9e7c994f38177ed587dac5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa0d54dac46be0846d1d5c94ca0b8a38a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa0d54dac46be0846d1d5c94ca0b8a38a"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#aa0d54dac46be0846d1d5c94ca0b8a38a">~CSessManager</a> ()</td></tr>
<tr class="memdesc:aa0d54dac46be0846d1d5c94ca0b8a38a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor. <br/></td></tr>
<tr class="separator:aa0d54dac46be0846d1d5c94ca0b8a38a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a79eaa86ffad3a9c37ee66766f06b2d74"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a79eaa86ffad3a9c37ee66766f06b2d74">GetUserInfo</a> (const px::string &amp;session_token, px::CUser &amp;info) const </td></tr>
<tr class="memdesc:a79eaa86ffad3a9c37ee66766f06b2d74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the CUser object for a session token.  <a href="#a79eaa86ffad3a9c37ee66766f06b2d74">More...</a><br/></td></tr>
<tr class="separator:a79eaa86ffad3a9c37ee66766f06b2d74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab67682d2fa7c60a72aa8b685754b92b7"><td class="memItemLeft" align="right" valign="top">px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#ab67682d2fa7c60a72aa8b685754b92b7">GetUserName</a> (const px::string &amp;session_token) const </td></tr>
<tr class="memdesc:ab67682d2fa7c60a72aa8b685754b92b7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the username for a session token.  <a href="#ab67682d2fa7c60a72aa8b685754b92b7">More...</a><br/></td></tr>
<tr class="separator:ab67682d2fa7c60a72aa8b685754b92b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31344054a1936b8c4138682543989ad5"><td class="memItemLeft" align="right" valign="top">px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a31344054a1936b8c4138682543989ad5">GetUserIP</a> (const px::string &amp;session_token) const </td></tr>
<tr class="memdesc:a31344054a1936b8c4138682543989ad5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the IP for a session token.  <a href="#a31344054a1936b8c4138682543989ad5">More...</a><br/></td></tr>
<tr class="separator:a31344054a1936b8c4138682543989ad5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5850dda8e1a636da90ce4ad6181f2139"><td class="memItemLeft" align="right" valign="top">px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a5850dda8e1a636da90ce4ad6181f2139">Login</a> (const px::string &amp;username, const px::string &amp;service, const px::string &amp;password, px::cds::ClientID client, px::string ip=&quot;&quot;)</td></tr>
<tr class="memdesc:a5850dda8e1a636da90ce4ad6181f2139"><td class="mdescLeft">&#160;</td><td class="mdescRight">Login a user.  <a href="#a5850dda8e1a636da90ce4ad6181f2139">More...</a><br/></td></tr>
<tr class="separator:a5850dda8e1a636da90ce4ad6181f2139"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3c5ae70631386047ff4c970e54cc09c"><td class="memItemLeft" align="right" valign="top">px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#ab3c5ae70631386047ff4c970e54cc09c">SubsessionLogin</a> (const px::string &amp;parent_token, const px::CBitset&lt; px::permissions &gt; &amp;perms_mask=px::CBitset&lt; px::permissions &gt;(), uint32_t timeout=0, uint32_t hard_timeout=0)</td></tr>
<tr class="memdesc:ab3c5ae70631386047ff4c970e54cc09c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Login as a subsession of an existing parent session.  <a href="#ab3c5ae70631386047ff4c970e54cc09c">More...</a><br/></td></tr>
<tr class="separator:ab3c5ae70631386047ff4c970e54cc09c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a341fd3a3b7155a863500bf20e36f5241"><td class="memItemLeft" align="right" valign="top">px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a341fd3a3b7155a863500bf20e36f5241">CdsClientLogin</a> (px::cds::ClientID client, const px::string &amp;service, uint32_t timeout=0, uint32_t hard_timeout=0)</td></tr>
<tr class="memdesc:a341fd3a3b7155a863500bf20e36f5241"><td class="mdescLeft">&#160;</td><td class="mdescRight">Login with the credentials assigned to this process, identified via its CDS ClientID.  <a href="#a341fd3a3b7155a863500bf20e36f5241">More...</a><br/></td></tr>
<tr class="separator:a341fd3a3b7155a863500bf20e36f5241"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2108026d25fa021b4bfa3ae8c94482b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a2108026d25fa021b4bfa3ae8c94482b4">Logout</a> (const px::string &amp;session_token, px::sub::subscription_type reason=px::sub::subscription_type::logout)</td></tr>
<tr class="memdesc:a2108026d25fa021b4bfa3ae8c94482b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Logout a user by session token.  <a href="#a2108026d25fa021b4bfa3ae8c94482b4">More...</a><br/></td></tr>
<tr class="separator:a2108026d25fa021b4bfa3ae8c94482b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43ca761076bf4c643414015c650a6539"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a43ca761076bf4c643414015c650a6539">CheckSession</a> (const px::string &amp;session_token)</td></tr>
<tr class="memdesc:a43ca761076bf4c643414015c650a6539"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check session token for authentication.  <a href="#a43ca761076bf4c643414015c650a6539">More...</a><br/></td></tr>
<tr class="separator:a43ca761076bf4c643414015c650a6539"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c3a1a3b6a3614d0a94b0d2494963651"><td class="memItemLeft" align="right" valign="top">std::unordered_set&lt; px::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a7c3a1a3b6a3614d0a94b0d2494963651">lookup_sessions</a> (const px::string &amp;userid)</td></tr>
<tr class="memdesc:a7c3a1a3b6a3614d0a94b0d2494963651"><td class="mdescLeft">&#160;</td><td class="mdescRight">Looking for all sessions by user.  <a href="#a7c3a1a3b6a3614d0a94b0d2494963651">More...</a><br/></td></tr>
<tr class="separator:a7c3a1a3b6a3614d0a94b0d2494963651"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a764ff11726af1df3bb99fef3cbac4923"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a764ff11726af1df3bb99fef3cbac4923">CheckSessionPermission</a> (const px::string &amp;session_token, const px::permissions perm)</td></tr>
<tr class="memdesc:a764ff11726af1df3bb99fef3cbac4923"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check that the given token is for a valid session, and that the permission given is allowed for that session.  <a href="#a764ff11726af1df3bb99fef3cbac4923">More...</a><br/></td></tr>
<tr class="separator:a764ff11726af1df3bb99fef3cbac4923"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0685c58858071840977cefbe6d7982a3"><td class="memItemLeft" align="right" valign="top">px::CBitset&lt; px::permissions &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a0685c58858071840977cefbe6d7982a3">GetSessionPerms</a> (const px::string &amp;session_token)</td></tr>
<tr class="memdesc:a0685c58858071840977cefbe6d7982a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return all the permissions allowed for the given token.  <a href="#a0685c58858071840977cefbe6d7982a3">More...</a><br/></td></tr>
<tr class="separator:a0685c58858071840977cefbe6d7982a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab4a8674290e1fa40d9962b9e3abeccb5"><td class="memItemLeft" align="right" valign="top">px::cds::ClientID&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#ab4a8674290e1fa40d9962b9e3abeccb5">GetSessionClientId</a> (const px::string &amp;session_token)</td></tr>
<tr class="memdesc:ab4a8674290e1fa40d9962b9e3abeccb5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the client_id.  <a href="#ab4a8674290e1fa40d9962b9e3abeccb5">More...</a><br/></td></tr>
<tr class="separator:ab4a8674290e1fa40d9962b9e3abeccb5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac7efa165ae3fdff72c6e65581b553e68"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac7efa165ae3fdff72c6e65581b553e68"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#ac7efa165ae3fdff72c6e65581b553e68">CheckClientPermission</a> (const px::cds::ClientID client, const px::permissions perm)</td></tr>
<tr class="memdesc:ac7efa165ae3fdff72c6e65581b553e68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if a CDS client is allowed a particular permission by virtue of the Linux user ID of its process. <br/></td></tr>
<tr class="separator:ac7efa165ae3fdff72c6e65581b553e68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaac99a561d345bcf29181315edfe8c0b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaac99a561d345bcf29181315edfe8c0b"></a>
px::CBitset&lt; px::permissions &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#aaac99a561d345bcf29181315edfe8c0b">GetClientPerms</a> (const px::cds::ClientID client)</td></tr>
<tr class="memdesc:aaac99a561d345bcf29181315edfe8c0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the permissions allowed for the CDS client by virtue of the Linux user ID of its process. <br/></td></tr>
<tr class="separator:aaac99a561d345bcf29181315edfe8c0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4966039723747c87472ef70566824c60"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a4966039723747c87472ef70566824c60">CheckRequestPermission</a> (const px::cds::CRequestResponse &amp;req, const px::permissions perm)</td></tr>
<tr class="memdesc:a4966039723747c87472ef70566824c60"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check that the given permission is allowed for the given request.  <a href="#a4966039723747c87472ef70566824c60">More...</a><br/></td></tr>
<tr class="separator:a4966039723747c87472ef70566824c60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4f708e4c842c9a1cf98f4ad860290753"><td class="memItemLeft" align="right" valign="top">px::CBitset&lt; px::permissions &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a4f708e4c842c9a1cf98f4ad860290753">GetRequestPerms</a> (const px::cds::CRequestResponse &amp;req)</td></tr>
<tr class="memdesc:a4f708e4c842c9a1cf98f4ad860290753"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the permissions allowed for the given request.  <a href="#a4f708e4c842c9a1cf98f4ad860290753">More...</a><br/></td></tr>
<tr class="separator:a4f708e4c842c9a1cf98f4ad860290753"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e7f37407e73ea09f425273c4542d6f2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9e7f37407e73ea09f425273c4542d6f2"></a>
std::unordered_map&lt; uint32_t, <br class="typebreak"/>
<a class="el" href="classCSession.html">CSession</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a9e7f37407e73ea09f425273c4542d6f2">ListSessions</a> () const </td></tr>
<tr class="memdesc:a9e7f37407e73ea09f425273c4542d6f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">List all current, valid sessions. <br/></td></tr>
<tr class="separator:a9e7f37407e73ea09f425273c4542d6f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adcd6d53d565a6e3a0f55d0857549adb8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adcd6d53d565a6e3a0f55d0857549adb8"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#adcd6d53d565a6e3a0f55d0857549adb8">TerminateSessions</a> (const std::unordered_set&lt; uint32_t &gt; &amp;handles)</td></tr>
<tr class="memdesc:adcd6d53d565a6e3a0f55d0857549adb8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Terminate sessions with given handles. <br/></td></tr>
<tr class="separator:adcd6d53d565a6e3a0f55d0857549adb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a708968016bc47e1d3911af166748a43d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a708968016bc47e1d3911af166748a43d"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a708968016bc47e1d3911af166748a43d">PruneSessions</a> ()</td></tr>
<tr class="memdesc:a708968016bc47e1d3911af166748a43d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Terminate all sessions that have expired or whose CDS clients are no longer connected. <br/></td></tr>
<tr class="separator:a708968016bc47e1d3911af166748a43d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac963f2d6f4ec616824072941ec9d38e1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#ac963f2d6f4ec616824072941ec9d38e1">GetSession</a> (const px::string &amp;token, <a class="el" href="classCSession.html">CSession</a> &amp;session) const </td></tr>
<tr class="memdesc:ac963f2d6f4ec616824072941ec9d38e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a copy of the <a class="el" href="classCSession.html" title="Class to manage user session operations. ">CSession</a> object for the given session.  <a href="#ac963f2d6f4ec616824072941ec9d38e1">More...</a><br/></td></tr>
<tr class="separator:ac963f2d6f4ec616824072941ec9d38e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae72ac7b8b32dd5741f2a92d9d2d9ca1c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#ae72ac7b8b32dd5741f2a92d9d2d9ca1c">GetLastLog</a> (const px::string &amp;username, <a class="el" href="classCLastLog.html">CLastLog</a> &amp;info) const </td></tr>
<tr class="memdesc:ae72ac7b8b32dd5741f2a92d9d2d9ca1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the last-login information for a user.  <a href="#ae72ac7b8b32dd5741f2a92d9d2d9ca1c">More...</a><br/></td></tr>
<tr class="separator:ae72ac7b8b32dd5741f2a92d9d2d9ca1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78b2e095efc87dd085b9912f5e59770d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a78b2e095efc87dd085b9912f5e59770d">GetPolicy</a> (uint32_t &amp;concurrent_session_limit)</td></tr>
<tr class="memdesc:a78b2e095efc87dd085b9912f5e59770d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get global policy parameters.  <a href="#a78b2e095efc87dd085b9912f5e59770d">More...</a><br/></td></tr>
<tr class="separator:a78b2e095efc87dd085b9912f5e59770d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ed1eb7234cf231d833eac8e540434fc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a8ed1eb7234cf231d833eac8e540434fc">SetPolicy</a> (uint32_t concurrent_session_limit)</td></tr>
<tr class="memdesc:a8ed1eb7234cf231d833eac8e540434fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set global policy parameters.  <a href="#a8ed1eb7234cf231d833eac8e540434fc">More...</a><br/></td></tr>
<tr class="separator:a8ed1eb7234cf231d833eac8e540434fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a46a7d769599d36558cb686f68ed4b782"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a46a7d769599d36558cb686f68ed4b782"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a46a7d769599d36558cb686f68ed4b782">LoadLastLog</a> (const px::string &amp;db_path)</td></tr>
<tr class="memdesc:a46a7d769599d36558cb686f68ed4b782"><td class="mdescLeft">&#160;</td><td class="mdescRight">Load last-log from database. <br/></td></tr>
<tr class="separator:a46a7d769599d36558cb686f68ed4b782"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:af0bfa2a9c3bdd8d5ce1140a26dc81cc4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af0bfa2a9c3bdd8d5ce1140a26dc81cc4"></a>
typedef std::unordered_map<br class="typebreak"/>
&lt; px::string, <a class="el" href="classCSession.html">CSession</a> &gt;<br class="typebreak"/>
::iterator&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#af0bfa2a9c3bdd8d5ce1140a26dc81cc4">sess_map_iter</a></td></tr>
<tr class="memdesc:af0bfa2a9c3bdd8d5ce1140a26dc81cc4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Define a typedef for the iterator for our map (non-const type) <br/></td></tr>
<tr class="separator:af0bfa2a9c3bdd8d5ce1140a26dc81cc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a3bf83745eae71ac2cd46e1d4c627ad4e"><td class="memItemLeft" align="right" valign="top">px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a3bf83745eae71ac2cd46e1d4c627ad4e">session_token_rand</a> ()</td></tr>
<tr class="memdesc:a3bf83745eae71ac2cd46e1d4c627ad4e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Use OpenSSL RAND_bytes to get a session token.  <a href="#a3bf83745eae71ac2cd46e1d4c627ad4e">More...</a><br/></td></tr>
<tr class="separator:a3bf83745eae71ac2cd46e1d4c627ad4e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a303400a209c81d424d3153649747342a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a303400a209c81d424d3153649747342a">remove_session</a> (<a class="el" href="classCSessManager.html#af0bfa2a9c3bdd8d5ce1140a26dc81cc4">sess_map_iter</a> &amp;map_pair, const px::string &amp;session_token, px::sub::subscription_type reason)</td></tr>
<tr class="memdesc:a303400a209c81d424d3153649747342a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Remove this session from our session and handle maps, and (recursively) remove any subsessions.  <a href="#a303400a209c81d424d3153649747342a">More...</a><br/></td></tr>
<tr class="separator:a303400a209c81d424d3153649747342a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a406339c3b2bdac9637234815bcef6439"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a406339c3b2bdac9637234815bcef6439">update_lastlog</a> (const px::string &amp;username, bool failed, const px::string &amp;ip)</td></tr>
<tr class="memdesc:a406339c3b2bdac9637234815bcef6439"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update last-log.  <a href="#a406339c3b2bdac9637234815bcef6439">More...</a><br/></td></tr>
<tr class="separator:a406339c3b2bdac9637234815bcef6439"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a2e87f0c0ce4d20b04930502b9be263a8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2e87f0c0ce4d20b04930502b9be263a8"></a>
std::shared_ptr&lt; <a class="el" href="classCAuthManager.html">CAuthManager</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a2e87f0c0ce4d20b04930502b9be263a8">_auth_mgr</a></td></tr>
<tr class="memdesc:a2e87f0c0ce4d20b04930502b9be263a8"><td class="mdescLeft">&#160;</td><td class="mdescRight">System's auth manager. <br/></td></tr>
<tr class="separator:a2e87f0c0ce4d20b04930502b9be263a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a32371c183b2423b27ea4ad4bfda99d2c"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a32371c183b2423b27ea4ad4bfda99d2c"></a>
<a class="el" href="classCDataStore.html">CDataStore</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a32371c183b2423b27ea4ad4bfda99d2c">_cds</a></td></tr>
<tr class="memdesc:a32371c183b2423b27ea4ad4bfda99d2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">System's <a class="el" href="classCDataStore.html" title="Top-level class containing all internal data. ">CDataStore</a>, for sending notifications. <br/></td></tr>
<tr class="separator:a32371c183b2423b27ea4ad4bfda99d2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f43e6dcae090a7befa4e92056beeeca"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1f43e6dcae090a7befa4e92056beeeca"></a>
std::unordered_map&lt; px::string, <br class="typebreak"/>
<a class="el" href="classCSession.html">CSession</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a1f43e6dcae090a7befa4e92056beeeca">_sessions</a></td></tr>
<tr class="memdesc:a1f43e6dcae090a7befa4e92056beeeca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map of sessions, keyed by token for each session. <br/></td></tr>
<tr class="separator:a1f43e6dcae090a7befa4e92056beeeca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2181a8c7e24d372ee39cff393f052c71"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2181a8c7e24d372ee39cff393f052c71"></a>
std::unordered_map&lt; px::string, <br class="typebreak"/>
uint32_t &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a2181a8c7e24d372ee39cff393f052c71">_handles</a></td></tr>
<tr class="memdesc:a2181a8c7e24d372ee39cff393f052c71"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handle (for list, terminate operations) for each session. <br/></td></tr>
<tr class="separator:a2181a8c7e24d372ee39cff393f052c71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a999de66ad6812db772cce8fcbcbf6125"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a999de66ad6812db772cce8fcbcbf6125"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a999de66ad6812db772cce8fcbcbf6125">_next_handle</a></td></tr>
<tr class="memdesc:a999de66ad6812db772cce8fcbcbf6125"><td class="mdescLeft">&#160;</td><td class="mdescRight">Next handle to be given to a new session. <br/></td></tr>
<tr class="separator:a999de66ad6812db772cce8fcbcbf6125"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a130f7be78294a3bb5316cdc7576d0a91"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a130f7be78294a3bb5316cdc7576d0a91"></a>
std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a130f7be78294a3bb5316cdc7576d0a91">_mutex</a></td></tr>
<tr class="memdesc:a130f7be78294a3bb5316cdc7576d0a91"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex to serialize access to _sessions, _handles, _next_handle. <br/></td></tr>
<tr class="separator:a130f7be78294a3bb5316cdc7576d0a91"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c8f7dfd940318dde578dc0017fa839d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4c8f7dfd940318dde578dc0017fa839d"></a>
std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a4c8f7dfd940318dde578dc0017fa839d">_lastlog_mutex</a></td></tr>
<tr class="memdesc:a4c8f7dfd940318dde578dc0017fa839d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex to protect last_login information. <br/></td></tr>
<tr class="separator:a4c8f7dfd940318dde578dc0017fa839d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fa29ffc809567fb5560d4bc1b7afd9b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8fa29ffc809567fb5560d4bc1b7afd9b"></a>
std::unordered_map&lt; px::string, <br class="typebreak"/>
<a class="el" href="classCLastLog.html">CLastLog</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a8fa29ffc809567fb5560d4bc1b7afd9b">_lastlog</a></td></tr>
<tr class="memdesc:a8fa29ffc809567fb5560d4bc1b7afd9b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Last-login information. <br/></td></tr>
<tr class="separator:a8fa29ffc809567fb5560d4bc1b7afd9b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a13d80cc6a39a1304551530c4e6cb7d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4a13d80cc6a39a1304551530c4e6cb7d"></a>
uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#a4a13d80cc6a39a1304551530c4e6cb7d">_concurrent_session_limit</a></td></tr>
<tr class="memdesc:a4a13d80cc6a39a1304551530c4e6cb7d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Limit on concurrent sessions, for users that don't have such a limit configured. <br/></td></tr>
<tr class="separator:a4a13d80cc6a39a1304551530c4e6cb7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aecb0eedbe5f28b307a9f13c3a58b8707"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aecb0eedbe5f28b307a9f13c3a58b8707"></a>
px::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classCSessManager.html#aecb0eedbe5f28b307a9f13c3a58b8707">_db_path</a></td></tr>
<tr class="memdesc:aecb0eedbe5f28b307a9f13c3a58b8707"><td class="mdescLeft">&#160;</td><td class="mdescRight">Path to last-log database. <br/></td></tr>
<tr class="separator:aecb0eedbe5f28b307a9f13c3a58b8707"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class to manage user session operations. </p>
<p>Methods are safe to call in multiple threads concurrently, except where noted otherwise. </p>

<p>Definition at line <a class="el" href="sess__manager_8hpp_source.html#l00033">33</a> of file <a class="el" href="sess__manager_8hpp_source.html">sess_manager.hpp</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a79eaa86ffad3a9c37ee66766f06b2d74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CSessManager::GetUserInfo </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>session_token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">px::CUser &amp;&#160;</td>
          <td class="paramname"><em>info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the CUser object for a session token. </p>
<p>Returns true if the session is valid, false if not. </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00036">36</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ab67682d2fa7c60a72aa8b685754b92b7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">px::string CSessManager::GetUserName </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>session_token</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the username for a session token. </p>
<p>Returns "NoSession" if no session found </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00067">67</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a31344054a1936b8c4138682543989ad5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">px::string CSessManager::GetUserIP </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>session_token</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the IP for a session token. </p>
<p>Returns "0.0.0.0" if no session found </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00083">83</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a5850dda8e1a636da90ce4ad6181f2139"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">px::string CSessManager::Login </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>service</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>password</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">px::cds::ClientID&#160;</td>
          <td class="paramname"><em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">px::string&#160;</td>
          <td class="paramname"><em>ip</em> = <code>&quot;&quot;</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Login a user. </p>
<p>Returns a session token on success, empty string on failure (bad username/password/service combo). </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00113">113</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ab3c5ae70631386047ff4c970e54cc09c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">px::string CSessManager::SubsessionLogin </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>parent_token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CBitset&lt; px::permissions &gt; &amp;&#160;</td>
          <td class="paramname"><em>perms_mask</em> = <code>px::CBitset&lt;px::permissions&gt;(&#160;)</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>timeout</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>hard_timeout</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Login as a subsession of an existing parent session. </p>
<p>The subsession will be created and added to its parent's list of subsessions. The parent is identified by its parent_token. This subsession gets its permissions as those of the parent session less any set in the perms_mask. The timeouts are set to the lesser of the requested or the parent's timeouts.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">parent_token</td><td>The session token of the parent session. </td></tr>
    <tr><td class="paramname">perms_mask</td><td>Mask, with bits sets for the permissions that this subsession does NOT want. This mask defaults to an empty set (so will get all of the parent's permissions). </td></tr>
    <tr><td class="paramname">timeout</td><td>Idle timeout for this session (default/0: no timeout) </td></tr>
    <tr><td class="paramname">hard_timeout</td><td>Hard timeout (not refreshable) for this session (default/0: no timeout)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A session token for the subsession on success, empty string on failure (could not resolve the parent session). </dd></dl>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00207">207</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a341fd3a3b7155a863500bf20e36f5241"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">px::string CSessManager::CdsClientLogin </td>
          <td>(</td>
          <td class="paramtype">px::cds::ClientID&#160;</td>
          <td class="paramname"><em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>service</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>timeout</em> = <code>0</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>hard_timeout</em> = <code>0</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Login with the credentials assigned to this process, identified via its CDS ClientID. </p>
<p>Look up the process UID given its CDS ClientID, and then look up the permissions preset for that process. This is useful for internal processes for which there is no user name or password. These processes will normally set both timeouts to 0 for no timeout.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">client</td><td>The CDS ClientID (assigned when the process' CDS Client first connects to the CDS). </td></tr>
    <tr><td class="paramname">service</td><td>The service that this client is logging in for. (Eg, CDS_SERVICE_MERCURY = "mercury"). </td></tr>
    <tr><td class="paramname">timeout</td><td>Idle timeout for this session (default/0: no timeout) </td></tr>
    <tr><td class="paramname">hard_timeout</td><td>Hard timeout (not refreshable) for this session (default/0: no timeout)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A session token for the session on success, empty string on failure (could not resolve the process permissions). </dd></dl>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00257">257</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a2108026d25fa021b4bfa3ae8c94482b4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSessManager::Logout </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>session_token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">px::sub::subscription_type&#160;</td>
          <td class="paramname"><em>reason</em> = <code>px::sub::subscription_type::logout</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Logout a user by session token. </p>
<p>If it has subsessions, will log them out too. </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00303">303</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCSessManager_a2108026d25fa021b4bfa3ae8c94482b4_icgraph.png" border="0" usemap="#classCSessManager_a2108026d25fa021b4bfa3ae8c94482b4_icgraph" alt=""/></div>
<map name="classCSessManager_a2108026d25fa021b4bfa3ae8c94482b4_icgraph" id="classCSessManager_a2108026d25fa021b4bfa3ae8c94482b4_icgraph">
<area shape="rect" id="node2" href="classCSessManager.html#adcd6d53d565a6e3a0f55d0857549adb8" title="Terminate sessions with given handles. " alt="" coords="225,5,471,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a43ca761076bf4c643414015c650a6539"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CSessManager::CheckSession </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>session_token</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check session token for authentication. </p>
<p>Returns true if authenticated, false if not. Side effects: updates timeout, deletes session if timed out or if CDS client no longer connected </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00323">323</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCSessManager_a43ca761076bf4c643414015c650a6539_icgraph.png" border="0" usemap="#classCSessManager_a43ca761076bf4c643414015c650a6539_icgraph" alt=""/></div>
<map name="classCSessManager_a43ca761076bf4c643414015c650a6539_icgraph" id="classCSessManager_a43ca761076bf4c643414015c650a6539_icgraph">
<area shape="rect" id="node2" href="classCSessManager.html#a0685c58858071840977cefbe6d7982a3" title="Return all the permissions allowed for the given token. " alt="" coords="270,37,469,78"/><area shape="rect" id="node6" href="classCSessManager.html#ab4a8674290e1fa40d9962b9e3abeccb5" title="Return the client_id. " alt="" coords="270,102,469,143"/><area shape="rect" id="node3" href="classCSessManager.html#a764ff11726af1df3bb99fef3cbac4923" title="Check that the given token is for a valid session, and that the permission given is allowed for that ..." alt="" coords="518,5,733,46"/><area shape="rect" id="node4" href="classCSessManager.html#a4f708e4c842c9a1cf98f4ad860290753" title="Return the permissions allowed for the given request. " alt="" coords="525,70,725,111"/><area shape="rect" id="node5" href="classCSessManager.html#a4966039723747c87472ef70566824c60" title="Check that the given permission is allowed for the given request. " alt="" coords="782,70,999,111"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a7c3a1a3b6a3614d0a94b0d2494963651"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_set&lt; px::string &gt; CSessManager::lookup_sessions </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>userid</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Looking for all sessions by user. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">userid</td><td>the owner of the sessions</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A unordered set of all sessions owned by the user </dd></dl>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00341">341</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a764ff11726af1df3bb99fef3cbac4923"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CSessManager::CheckSessionPermission </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>session_token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::permissions&#160;</td>
          <td class="paramname"><em>perm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check that the given token is for a valid session, and that the permission given is allowed for that session. </p>
<p>Side effect: updates timeout </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00434">434</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a0685c58858071840977cefbe6d7982a3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">px::CBitset&lt; px::permissions &gt; CSessManager::GetSessionPerms </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>session_token</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return all the permissions allowed for the given token. </p>
<p>May be empty, especially if the token is invalid. Side effect: updates timeout </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00397">397</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCSessManager_a0685c58858071840977cefbe6d7982a3_icgraph.png" border="0" usemap="#classCSessManager_a0685c58858071840977cefbe6d7982a3_icgraph" alt=""/></div>
<map name="classCSessManager_a0685c58858071840977cefbe6d7982a3_icgraph" id="classCSessManager_a0685c58858071840977cefbe6d7982a3_icgraph">
<area shape="rect" id="node2" href="classCSessManager.html#a764ff11726af1df3bb99fef3cbac4923" title="Check that the given token is for a valid session, and that the permission given is allowed for that ..." alt="" coords="254,5,469,46"/><area shape="rect" id="node3" href="classCSessManager.html#a4f708e4c842c9a1cf98f4ad860290753" title="Return the permissions allowed for the given request. " alt="" coords="261,70,461,111"/><area shape="rect" id="node4" href="classCSessManager.html#a4966039723747c87472ef70566824c60" title="Check that the given permission is allowed for the given request. " alt="" coords="518,70,735,111"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ab4a8674290e1fa40d9962b9e3abeccb5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">px::cds::ClientID CSessManager::GetSessionClientId </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>session_token</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the client_id. </p>
<p>May be 0, especially if the token is invalid. Side effect: updates timeout </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00416">416</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a4966039723747c87472ef70566824c60"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CSessManager::CheckRequestPermission </td>
          <td>(</td>
          <td class="paramtype">const px::cds::CRequestResponse &amp;&#160;</td>
          <td class="paramname"><em>req</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::permissions&#160;</td>
          <td class="paramname"><em>perm</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check that the given permission is allowed for the given request. </p>
<p>Checks the session token if the request provides one, checks the Linux user ID otherwise. </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00557">557</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a4f708e4c842c9a1cf98f4ad860290753"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">px::CBitset&lt; px::permissions &gt; CSessManager::GetRequestPerms </td>
          <td>(</td>
          <td class="paramtype">const px::cds::CRequestResponse &amp;&#160;</td>
          <td class="paramname"><em>req</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the permissions allowed for the given request. </p>
<p>Checks the session token if the request provides one, checks the Linux user ID otherwise. </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00583">583</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCSessManager_a4f708e4c842c9a1cf98f4ad860290753_icgraph.png" border="0" usemap="#classCSessManager_a4f708e4c842c9a1cf98f4ad860290753_icgraph" alt=""/></div>
<map name="classCSessManager_a4f708e4c842c9a1cf98f4ad860290753_icgraph" id="classCSessManager_a4f708e4c842c9a1cf98f4ad860290753_icgraph">
<area shape="rect" id="node2" href="classCSessManager.html#a4966039723747c87472ef70566824c60" title="Check that the given permission is allowed for the given request. " alt="" coords="254,5,471,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac963f2d6f4ec616824072941ec9d38e1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CSessManager::GetSession </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCSession.html">CSession</a> &amp;&#160;</td>
          <td class="paramname"><em>session</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a copy of the <a class="el" href="classCSession.html" title="Class to manage user session operations. ">CSession</a> object for the given session. </p>
<p>Returns true if valid, false if not. </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00099">99</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae72ac7b8b32dd5741f2a92d9d2d9ca1c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool CSessManager::GetLastLog </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCLastLog.html">CLastLog</a> &amp;&#160;</td>
          <td class="paramname"><em>info</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the last-login information for a user. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">username</td><td>(input) User name to get last-login information for </td></tr>
    <tr><td class="paramname">info</td><td>(output) Last-login information, if known </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if information known, false if not </dd></dl>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00681">681</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a78b2e095efc87dd085b9912f5e59770d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSessManager::GetPolicy </td>
          <td>(</td>
          <td class="paramtype">uint32_t &amp;&#160;</td>
          <td class="paramname"><em>concurrent_session_limit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get global policy parameters. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">concurrent_session_limit</td><td>(output) Limit on the number of concurrent session a user may have. 0 = unlimited. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00695">695</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a8ed1eb7234cf231d833eac8e540434fc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void CSessManager::SetPolicy </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>concurrent_session_limit</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set global policy parameters. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">concurrent_session_limit</td><td>Limit on the number of concurrent sessions a user may have. 0 = unlimited. No attempt is made to close existing sessions if this limit is reduced. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00702">702</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a3bf83745eae71ac2cd46e1d4c627ad4e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">px::string CSessManager::session_token_rand </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Use OpenSSL RAND_bytes to get a session token. </p>
<p>Returns array of bytes. </p>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00482">482</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCSessManager_a3bf83745eae71ac2cd46e1d4c627ad4e_icgraph.png" border="0" usemap="#classCSessManager_a3bf83745eae71ac2cd46e1d4c627ad4e_icgraph" alt=""/></div>
<map name="classCSessManager_a3bf83745eae71ac2cd46e1d4c627ad4e_icgraph" id="classCSessManager_a3bf83745eae71ac2cd46e1d4c627ad4e_icgraph">
<area shape="rect" id="node2" href="classCSessManager.html#a5850dda8e1a636da90ce4ad6181f2139" title="Login a user. " alt="" coords="261,5,421,32"/><area shape="rect" id="node3" href="classCSessManager.html#ab3c5ae70631386047ff4c970e54cc09c" title="Login as a subsession of an existing parent session. " alt="" coords="242,57,441,98"/><area shape="rect" id="node4" href="classCSessManager.html#a341fd3a3b7155a863500bf20e36f5241" title="Login with the credentials assigned to this process, identified via its CDS ClientID. " alt="" coords="230,123,453,149"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a303400a209c81d424d3153649747342a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CSessManager::remove_session </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classCSessManager.html#af0bfa2a9c3bdd8d5ce1140a26dc81cc4">sess_map_iter</a> &amp;&#160;</td>
          <td class="paramname"><em>map_pair</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>session_token</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">px::sub::subscription_type&#160;</td>
          <td class="paramname"><em>reason</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Remove this session from our session and handle maps, and (recursively) remove any subsessions. </p>
<p>Relies on the mutex locking of the calling function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">map_pair</td><td>The (valid) map entry for the session to be removed. This entry will be invalid (removed) on return. </td></tr>
    <tr><td class="paramname">session_token</td><td>The session's ID (token) string. </td></tr>
    <tr><td class="paramname">reason</td><td>Reason this session is to be removed </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00621">621</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCSessManager_a303400a209c81d424d3153649747342a_icgraph.png" border="0" usemap="#classCSessManager_a303400a209c81d424d3153649747342a_icgraph" alt=""/></div>
<map name="classCSessManager_a303400a209c81d424d3153649747342a_icgraph" id="classCSessManager_a303400a209c81d424d3153649747342a_icgraph">
<area shape="rect" id="node2" href="classCSessManager.html#a2108026d25fa021b4bfa3ae8c94482b4" title="Logout a user by session token. " alt="" coords="230,12,399,39"/><area shape="rect" id="node3" href="classCSessManager.html#adcd6d53d565a6e3a0f55d0857549adb8" title="Terminate sessions with given handles. " alt="" coords="449,12,695,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a406339c3b2bdac9637234815bcef6439"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void CSessManager::update_lastlog </td>
          <td>(</td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>username</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>failed</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::string &amp;&#160;</td>
          <td class="paramname"><em>ip</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Update last-log. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">username</td><td>User name (needed for success or failure) </td></tr>
    <tr><td class="paramname">failed</td><td>True if login failed, false if succeeded </td></tr>
    <tr><td class="paramname">source</td><td>IP passed to Login </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="sess__manager_8cpp_source.html#l00713">713</a> of file <a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classCSessManager_a406339c3b2bdac9637234815bcef6439_icgraph.png" border="0" usemap="#classCSessManager_a406339c3b2bdac9637234815bcef6439_icgraph" alt=""/></div>
<map name="classCSessManager_a406339c3b2bdac9637234815bcef6439_icgraph" id="classCSessManager_a406339c3b2bdac9637234815bcef6439_icgraph">
<area shape="rect" id="node2" href="classCSessManager.html#a5850dda8e1a636da90ce4ad6181f2139" title="Login a user. " alt="" coords="224,12,384,39"/></map>
</div>
</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="sess__manager_8hpp_source.html">sess_manager.hpp</a></li>
<li><a class="el" href="sess__manager_8cpp_source.html">sess_manager.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="classCSessManager.html">CSessManager</a></li>
    <li class="footer">Generated on Fri May 7 2021 20:24:00 for cds_ng by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
