<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>mqtt_device_handler: MQTT Device Handler</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">mqtt_device_handler
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d3/da2/md__src_product-ref1_px-toolkit_etn_source_mqtt_device_handler_mqtt_device_handler.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">MQTT Device Handler </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the root project folder for the MQTT Device Handler and related components. Note: The MQTT Device Handler is not a standalone service, and requires Adopter Project MQTT Device EDS file(s) in order to function properly.</p>
<h2>MQTT Device Handler components</h2>
<p>A brief description of the MQTT Device Handler components.</p>
<table class="doxtable">
<tr>
<th>Folder </th><th>Description  </th></tr>
<tr>
<td><code>device_handler</code> </td><td>Source code for the <code>mqtt_device_handler</code> service. </td></tr>
<tr>
<td></td><td>Can also be used to check MQTT Device EDS files for correctness. </td></tr>
<tr>
<td><code>eds</code> </td><td>Protobuf definition for the MQTT Product and Device EDSs format. </td></tr>
<tr>
<td></td><td>Example test product and device EDSs as well. </td></tr>
<tr>
<td><code>libmqtteds</code> </td><td>Compiled MQTT protobuf library. </td></tr>
<tr>
<td><code>publisher_test</code> </td><td>Source code for the <code>mqtt_pub_test</code> utility. Reads an MQTT </td></tr>
<tr>
<td></td><td>Device EDS file and publishes channel data to the MQTT broker. </td></tr>
</table>
<h2>How to enable the MQTT Device Handler in your product</h2>
<p>Follow steps 1 and 2 below to enable building and running the MQTT Broker and MQTT Device Handler applications.</p>
<h3>Step 1: Enable building Mosquitto MQTT Broker, MQTT Broker Config, and MQTT Device Handler</h3>
<p>Edit your project root <code>config</code> file and add the following entries. Rebuild your project. </p>
<pre class="fragment">###############################
## Eaton Software
###############################

# Enable MQTT Broker, Library, and associated components
CONFIG_EATON_MQTT_BROKER?=y
export CONFIG_EATON_MQTT_BROKER

# Enable MQTT Library, Device Handler, and associated components
CONFIG_EATON_MQTT_DEV_HANDLER?=y
export CONFIG_EATON_MQTT_DEV_HANDLER
</pre><h3>Step 2: Enable MQTT Broker Config service</h3>
<h4>Edit the project rc.conf.product file</h4>
<p>Open the project <code>rootfs/etc/rc.conf.product</code> file and add the following lines to enable the MQTT Broker Config service. </p>
<pre class="fragment"># Enable the MQTT Broker
mqtt_broker_enable=y
</pre><h4>Edit the project rc.platform.product file</h4>
<p>Open the project <code>rootfs/etc/rc.platform.product</code> file and add system configuration references to the product specific MQTT Product EDS file, and the location of the product specific MQTT Device EDS file(s). Examples below:</p>
<p><b>Example PX-Red-BBB (product-ref1):</b> </p>
<pre class="fragment"># Location of MQTT Device EDS files to be used by the MQTT Device Handler
CFG_MQTT_DEVICE_EDS_DIR="/eds/protocol/mqtt"
</pre><h3>Step 3: Add MQTT Device EDS File(s) to your Project</h3>
<p>See the product-ref1 Adopter project as an example of adding MQTT Device EDS files to the build. <a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/product-ref1/eds/mqtt">Add MQTT Device EDS files to your project</a> <a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/product-ref1/eds/mqtt/Makefile">Makefile to copy EDS files to build output diretcory</a> <a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/product-ref1/Makefile">Add 'eds' and 'eds_source' targets to project Makefile</a></p>
<h2>MQTT Pub Test Command Line Examples</h2>
<p>The <code>mqtt_pub_test</code> utility reads an MQTT Device EDS file and publishes channel test data to the MQTT broker. Only channels with a <code>test</code> object will have data published to the broker.</p>
<ul>
<li>Run <code>mqtt_pub_test</code> once with debug level 5, unique Device Id <code>56781234</code>, and MQTT test device file <code>/eds/protocol/mqtt/test/device/EDS_MQTT-Test.json</code>. ``` ~ # mqtt_pub_test &ndash;loop-count 1 -d -D 5 -I 56781234 -f /eds/protocol/mqtt/test/device/EDS_MQTT-Test.json ```</li>
<li>Run <code>mqtt_pub_test</code> once with unique Device Id <code>56781234</code>, and MQTT test device file <code>/eds/protocol/mqtt/test/device/EDS_MQTT-Test.json</code>. ``` ~ # mqtt_pub_test &ndash;loop-count 1 -I 56781234 -f /eds/protocol/mqtt/test/device/EDS_MQTT-Test.json ```</li>
<li>Loop <code>mqtt_pub_test</code> continuously with a loop wait period of 1000ms, QoS level of 2, retain messages, unique Device Id <code>56781234</code>, and MQTT test device file <code>/eds/protocol/mqtt/test/device/EDS_MQTT-Test.json</code>. Use CTRL-C to stop the program. ``` ~ # mqtt_pub_test &ndash;loop-delay 1000 -q 2 -r -I 56781234 -f /eds/protocol/mqtt/test/device/EDS_MQTT-Test.json ```</li>
<li><b>Pro Gateway Project only</b>: Loop <code>mqtt_pub_test</code> continuously with a loop wait period of 1000ms, QoS level of 2, retain messages, Device serial # <code>12345678</code>, and MQTT device file <code>/eds/protocol/mqtt/device/EDS_GameOn400.json</code>. Use CTRL-C to stop the program. ``` ~ # mqtt_pub_test &ndash;loop-delay 1000 -q 2 -r -I 12345678 -f /eds/protocol/mqtt/device/EDS_GameOn400.json ```</li>
</ul>
<h2>Using MQTT Device Handler to check MQTT EDS files for validty</h2>
<p><code>mqtt_device_handler</code> can be used to check MQTT Device EDS files for correctness.</p>
<ul>
<li>Check MQTT Device EDS in a directory. ``` ~ # /bin/mqtt_device_handler -gve /eds/protocol/mqtt -pv ~ # /bin/mqtt_device_handler -gve /eds/protocol/mqtt/test/px-red/eds -pv ``` </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 7 2021 20:26:16 for mqtt_device_handler by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
