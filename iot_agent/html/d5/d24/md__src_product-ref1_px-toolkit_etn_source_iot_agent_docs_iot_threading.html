<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>IoT Agent: Threading in the IoT Agent</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../Eaton_Red_Toolbox_Logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">IoT Agent
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d5/d24/md__src_product-ref1_px-toolkit_etn_source_iot_agent_docs_iot_threading.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Threading in the IoT Agent </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Main program thread</h2>
<ul>
<li>After initialization and daemonization, Boost ASIO manages the pseudo-multi-tasking of the various Actors.</li>
<li>Everything here is event-driven; the main "event" the process Timer going off.</li>
<li>Based on Boost::ASIO library (see the LibPX cumentation)</li>
<li>After initialization, IOT code should <em>never</em> call blockable or synchronous functions (except in ASIO)</li>
</ul>
<h2>CDS Background thread</h2>
<ul>
<li>From the libpx CDS Client</li>
<li>Launched when the program initializes its CDS connection</li>
<li>While IoT Agent code could interface directly with CDS Client methods, instead we are relying on the CdsHandler class to be our interface the CDS.</li>
<li>The background thread will call our registered callback functions when something of subscribed interest happens (eg, device or Channel change or update)</li>
</ul>
<h2>Azure thread</h2>
<ul>
<li>Not too sure of the details of this thread, but be aware that there is one.</li>
<li>This thread is allowed to run whenever the DoWork() function is called.</li>
<li>The Azure code relies on the IoT Agent implementation for some thread utilities, such as ThreadAPI_Sleep().</li>
<li>The rest are provided by the pthread library, which is linked to the Azure code.</li>
</ul>
<h2>Net Diagnostics thread</h2>
<p>When the attempt to connect fails and the IoT Agent needs to diagnose the reasons why, it launches a thread to run the Net Diagnostics task in the <a class="el" href="../../da/d95/classCNetDiag.html" title="The class to diagnose and report on connection issues. ">CNetDiag</a> class.</p>
<ul>
<li>The C++11 std::async() and std::future are used to launch the thread and get the results of the task.</li>
<li>The task is a run-to-completion task, which can involve a number of steps and take a few minutes to complete.</li>
</ul>
<h2>Trend Catchup thread</h2>
<p>If, after connecting, the IoT Agent determines that there are old trend intervals which need to be published to PX White, it launches a thread to slowly query and publish those missing trend intervals.</p>
<ul>
<li>This is found in the <a class="el" href="../../db/db5/classTrendManager.html" title="Class to manage the Trend publishing and other trend-related services. ">TrendManager</a> class.</li>
<li>The C++11 std::async() and std::future are used to launch the thread and get the results of the task.</li>
<li>The task is a run-to-completion task, which could run for some time before all the trends have been published.</li>
<li>It paces itself both by using a 10s sleep between actions, and by ensuring that the published messages are all acknowledged before considering an interval "caught up" and moving on to the next one.</li>
</ul>
<h2>IOT Blob Upload Thread</h2>
<ul>
<li>This thread is found in <a class="el" href="../../d4/dd8/classBlobUploadManager.html" title="Class to manage Blob uploads, handling the requests and response through OOB/. ">BlobUploadManager</a> Class.</li>
<li>The C++11 std::async() and std::future are used to launch this thread and get results of the thread.</li>
<li>Every 5 secs(configurable by variable in IoT Agent device client), the pending list (map) will be checked and if pending uploads found, launch this thread to take care of the pending uploads.</li>
<li>There will be a separate thread for each fle upload which will run to completition.</li>
<li>The thread will lock the pending list, copy the contents into a local list, clear the pending list and release the lock.</li>
<li>The thread will be completed after all OOBs in the local list are processed.</li>
<li>In the blob upload, there is another thread for the blob upload catch up task. In case the blob uploads are interrupted due to system or network issues, they will be re-attempted when IoT Agent re-connects. This thread is also launched using C++11 std::async() and std::future.</li>
</ul>
<p><a class="el" href="../../d3/dbd/group__iot__threading.html">Module for IoT Threading</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 7 2021 20:26:03 for IoT Agent by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
