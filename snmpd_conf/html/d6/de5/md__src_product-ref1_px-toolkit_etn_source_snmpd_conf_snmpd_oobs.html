<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>snmpd_conf: Out-of-Band (OOB) Objects for SNMP Configuration and Operation</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">snmpd_conf
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d6/de5/md__src_product-ref1_px-toolkit_etn_source_snmpd_conf_snmpd_oobs.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Out-of-Band (OOB) Objects for SNMP Configuration and Operation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There are a variety of OOB objects that support the configuration and operation of the Net-SNMP daemon (snmpd):</p>
<ul>
<li>SnmpDataSettings</li>
<li>SnmpUserSettings</li>
<li>SnmpV3NewPassphrases/[username]</li>
<li>SnmpV3UsmUser/[username]</li>
<li>SnmpMibs</li>
<li>ACCESS_CTRL/SNMP</li>
</ul>
<p>These OOBs are each described in the sections below. All but the SNMP_MIBS and Access Control OOBs are processed by the snmpd_conf program, where they serve as input to the snmpd.conf file that the program generates; see its description for more details on operation of this program.</p>
<p>The reason for having a variety of OOBs rather than just one as input to snmpd_conf is due to the various origins of the data for each; some are product-specific, and others are user-specified.</p>
<h2>SnmpDataSettings OOB</h2>
<p>The SnmpDataSettings OOB is a fixed entry OOB provided by the product build, and provides product-specific input to the snmpd.conf file.</p>
<p>Each product should provide a file to override the <a href="../../../snmp_mibs/rootfs/etc/cds/generic/52_snmp_data_defaults.json">default initialization for SnmpDataSettings</a>.</p>
<p>The protobuf definition for the SnmpDataSettings OOB is found in <a href="../../../libpx/tk_proto/hg/SnmpDataSettings.proto">SnmpDataSettings.proto</a>.</p>
<p>The sections below describe how the SnmpDataSettings fields are used to support configuration of the snmpd.conf file.</p>
<h3>Fields for the SnmpDataSettings OOB</h3>
<p>Only one relevant field is used in this OOB.</p>
<h4>sys_object_id</h4>
<p>The sysObjectId OID for this product. This should be a unique-to-this-product OID (as a text string), assigned in EATON-OIDS.txt. Required.</p>
<h4>submodules</h4>
<p>Not used. (Replaced by the SnmpMibs OOB.)</p>
<h3>Example of SnmpDataSettings OOB</h3>
<p>The following shows some representative entries in this OOB; this example is from the defaults for this OOB.</p>
<p>```json { "toolkitStruct": { "snmp_data": { "sys_object_id":"1.3.6.1.4.1.534.2.12", "submodules": [ "entityMIB" ] }, "description":"SNMP Data settings for the Test product; OID = eatonPowerChainDevice.", "label":"SNMP Data Settings" } } ```</p>
<p>The corresponding entry in the snmpd.conf file looks like:</p>
<p>``` sysobjectid 1.3.6.1.4.1.534.2.12 ```</p>
<h2>SnmpUserSettings OOB</h2>
<p>The SnmpUserSettings OOB is an OOB whose fields are set by the user (usually through the UI), and it provides Security and User configuration (v1 and/or v3) input to the snmpd.conf file. It also holds the trapsink and trap session information, which must be configured to be useful.</p>
<p>This OOB is accessible by the UI but human access is restricted to Security Admin (for r/w) and Security Viewer (for read-only).</p>
<p>The <a href="../../../snmp_mibs/rootfs/etc/cds/generic/53_snmp_user_defaults.json">default initialization for SnmpUserSettings</a> disables both v1 and v3 access, but also provides the well-known v1 community strings of 'public' and 'private'. Of course, no trapsinks are configured by default.</p>
<p>The protobuf definition for the SnmpUserSettings OOB is found in <a href="../../../libpx/tk_proto/hg/SnmpUserSettings.proto">SnmpUserSettings.proto</a>.</p>
<p>The sections below describe how the SnmpUserSettings fields are used to support configuration of the snmpd.conf file. Note that unless either enable_v1 or enable_v3 is set, there will be effectively no SNMP access.</p>
<h3>v1 User Fields for the SnmpUserSettings OOB</h3>
<h4>enable_v1</h4>
<p>The enable flag for SNMP version 1. If enabled, the rocommunity and rwcommunity strings should be set.</p>
<h4>ro_community</h4>
<p>Community string for v1 read-only access. Defaults to the universally known value of "public". Only a single community string entry will be provided for, since the v1 support is effectively deprecated by security concerns.</p>
<h4>rw_community</h4>
<p>Community string for v1 read-write access. Defaults to the universally known value of "private".</p>
<p>Expect that this will contain just the community name, but the contents of this string will be provided to snmpd.conf without interpretation, so it is possible to give it the fuller view restriction following the format of: <code>community [default|hostname|network/bits [oid|-V view [context]]]</code></p>
<p>Only a single community string entry will be provided for, since the v1 support is effectively deprecated by security concerns.</p>
<h3>v1 Trap Fields for the SnmpUserSettings OOB</h3>
<h4>trap_community</h4>
<p>Community string to be sent with trap messages. Defaults to "public". Can be used on the receiving end to filter trap messages.</p>
<h4>auth_trap_enable</h4>
<p>Enables the sending of authFail traps when an SNMP request is received with invalid credentials. Defaults to false (disabled).</p>
<h4>trap_sinks</h4>
<p>An array of trapsinks - hosts to whom traps are to be sent. Normally just a network host address or hostname is provided, but the full form is supported: <code>host [community] [port]</code></p>
<h3>v3 User Fields for the SnmpUserSettings OOB</h3>
<h4>enable_v3</h4>
<p>The enable flag for SNMP version 3. If enabled, the v3 user information should be configured.</p>
<h4>Array of v3_users</h4>
<p>An array of SNMPv3 configured users and their access levels. Each entry consists of the following fields:</p>
<h5>v3_users::username</h5>
<p>Name of the user. The choice of name is arbitrary to snmpd. Required.</p>
<h5>v3_users::use_auth</h5>
<p>Whether authentication is required to accept queries using this username. Default/null = true, which is also the highly recommended choice. Optional but highly recommended.</p>
<h5>v3_users::use_priv</h5>
<p>Whether privacy (message encryption) is required to accept queries using this username. Default/null = false. Ignored if use_auth is false. Optional.</p>
<h5>v3_users::allow_write</h5>
<p>Whether to allow this user to do SETs. GETs and GETNEXTs are always allowed. Default/null = false. Optional.</p>
<h5>v3_users::has_auth_passphrase</h5>
<p>Whether an authentication passphrase has been set for this user. Set by the system when a passphrase is set. Default/null = false. Optional.</p>
<h5>v3_users::has_priv_passphrase</h5>
<p>Whether a privacy passphrase has been set for this user. Set by the system when a passphrase is set. Default/null = false. Optional.</p>
<h3>v3 Trap Field for the SnmpUserSettings OOB</h3>
<h4>trap_sess (trap sessions)</h4>
<p>An array of trapsess - hosts to whom traps are to be sent. The trapsess directive in snmpd_conf configures the v3 trap type that trapsink does not support. The full form for entries that is supported are:</p>
<ul>
<li><code>-v 1 [-c community] host[:port]</code></li>
<li><code>-v 3 -u v3user host[:port]</code></li>
</ul>
<h3>Example of SnmpUserSettings OOB</h3>
<p>The following example shows a fully configured OOB, with v1 and v3 enabled, two v3 users configured (one for read/write access), and both a trapsink and trap session configured.</p>
<p>```json { "toolkitStruct": { "snmp_user": { "enable_v1":true, "enable_v3":true, "ro_community":"public", "rw_community":"private", "trap_community":"public", "auth_trap_enable":false, "trap_sinks": [ "10.222.42.78" ], "v3_users": [ { "username":"myRoUser", "use_auth":true, "use_priv":false, "has_auth_passphrase":false, "has_priv_passphrase":false }, { "username":"myRwUser", "use_auth":true, "use_priv":false, "allow_write":true, "has_auth_passphrase":false, "has_priv_passphrase":false } ], "trap_sess": [ "-v 3 -u myRoUser -l authNoPriv 10.222.42.78" ] } } } ```</p>
<p>The corresponding entries in the snmpd.conf file, with their helpful comments removed for brevity's sake, look like:</p>
<p>``` rouser 'myRoUser' auth rwuser 'myRwUser' auth</p>
<p>rocommunity 'public' rwcommunity 'private'</p>
<p>trapcommunity public</p>
<p>trapsink 10.222.42.78</p>
<p>trapsess -v 3 -u myRoUser -l authNoPriv 10.222.42.78</p>
<p>authtrapenable 2 ```</p>
<h2>SnmpV3NewPassphrases OOB</h2>
<p>Each SnmpV3NewPassphrases/[username] OOB is a transient OOB which is created by the user (usually through the UI) when a new v3 user is added, and it holds the passphrase(s) for v3 authentication and encryption. It is read by, and then deleted by, the snmpd_conf program, to reduce any chance of passphrases leaking; snmpd_conf will subsequently create a SnmpV3UsmUser/[username] OOB to store the hashed versions of these passphrase(s).</p>
<p>This OOB is written by the UI but only by someone with the role of Security Admin.</p>
<p>The protobuf definition for the SnmpV3NewPassphrases OOB is found in <a href="../../../libpx/tk_proto/hg/SnmpV3UserPassphrases.proto">SnmpV3UserPassphrases.proto</a>.</p>
<p>The sections below describe how the SnmpV3NewPassphrases fields.</p>
<h3>Fields for the SnmpV3NewPassphrases OOB</h3>
<p>The data in the fields here are unencrypted and intended to exist only transiently, to reduce any chance of passphrases leaking.</p>
<h4>username</h4>
<p>The username for the SNMPv3 user.</p>
<h4>authentication_passphrase</h4>
<p>The authentication passphrase for the SNMPv3 user.</p>
<h4>encryption_passphrase</h4>
<p>The encryption ("privacy") passphrase for the SNMPv3 user. If left blank, the authentication_passphrase is used as the encryption_passphrase.</p>
<h3>Example of SnmpV3NewPassphrases OOB</h3>
<p>The following example shows an OOB for new user "myRwUser", with passphrases configured for authentication and encryption. (I think this is correct; couldn't capture a real example!)</p>
<p>```json { "toolkitStruct": { "snmp_v3_userpass": { "username":"myRwUser", "authentication_passphrase":"BadPassword", "username":"Worse Password" } } } ```</p>
<h2>SnmpV3UsmUser OOB</h2>
<p>Each SnmpV3UsmUser/[username] OOB is an OOB that stores the hashed passphrase(s) for one user from/for the the semi-hidden /flash/app/snmpd.conf file. The snmpd_conf creates each of these OOBs when a new v3 user is added, after snmpd has been run once; snmpd_conf will delete the corresponding SnmpV3NewPassphrases/[username] OOB and read this user's entry from the /flash/app/snmpd.conf file and store it in this OOB.</p>
<p>On subsequent restarts of snmpd_conf and snmpd, snmpd_conf reads the contents of this OOB and can restore them to /flash/app/snmpd.conf if not already present there; this is especially helpful when backing up the system's configuration for all OOBs.</p>
<p>This OOB would accessible by the UI (though there is little reason to do so), but human access is restricted to Security Admin (for r/w) and Security Viewer (for read-only).</p>
<p>The SnmpV3UsmUser OOB simply uses a single "GenericSettings" string field for its data, as defined in <a href="../../../libpx/proto/ToolkitConfiguration.proto">ToolkitConfiguration.proto</a>, but then adds the read/write permissions to tightly restrict access.</p>
<p>The sections below describe how the SnmpV3UsmUser fields are used to support configuration of the snmpd.conf file.</p>
<h3>Fields for the SnmpV3UsmUser OOB</h3>
<h4>generic::StringData</h4>
<p>The contents of this user's entry in /flash/app/snmpd.conf, given as one string of text. Interested readers can dig through the Net-SNMP documentation for the breakdown of the fields here.</p>
<h4>read_permission_required</h4>
<p>Declares the roles necessary for users (or programs) to be able to read this OOB.</p>
<h4>write_permission_required</h4>
<p>Declares the more limited roles necessary for users (or programs) to be able to write to this OOB.</p>
<h4>delete_or_permission_permission_required</h4>
<p>Declares the roles necessary for users (or programs) to be able to delete this OOB. Note that this can include the UI for advanced users.</p>
<h3>Example of SnmpV3UsmUser OOB</h3>
<p>The following example shows a fully configured OOB, with v1 and v3 enabled, two v3 users configured (one for read/write access), and both a trapsink and trap session configured.</p>
<p>```json { "toolkitStruct": { "generic": { "StringData":"usmUser 1 3 0x80001f88804e1c3a024c0cde59 \"myRwUser" "myRwUser" NULL .1.3.6.1.6.3.10.1.1.3 0x325332f1fd9e8cabe35a0bbc32c8d698ca1c1609 .1.3.6.1.6.3.10.1.2.4 0x325332f1fd9e8cabe35a0bbc32c8d698 0x" }, "read_permission_required": [ "SECURITY_READ", "INTERNAL_APP", "SECURITY_ADMIN" ], "write_permission_required": [ "SECURITY_ADMIN", "INTERNAL_APP" ], "delete_or_permission_permission_required": [ "CONFIG_WRITE", "INTERNAL_APP", "SECURITY_ADMIN" ] } } ```</p>
<p>The corresponding entries for two example users in the semi-hidden /flash/app/snmpd.conf file, with the comments removed for brevity's sake, look like:</p>
<p>``` usmUser 1 3 0x80001f88804e1c3a024c0cde59 "myRoUser" "myRoUser" NULL .1.3.6.1.6.3.10.1.1.3 0x67eba69f84b2db1a1e0cc33fdb66e6a6df7b8524 .1.3.6.1.6.3.10.1.2.4 0x67eba69f84b2db1a1e0cc33fdb66e6a6 0x usmUser 1 3 0x80001f88804e1c3a024c0cde59 "myRwUser" "myRwUser" NULL .1.3.6.1.6.3.10.1.1.3 0x325332f1fd9e8cabe35a0bbc32c8d698ca1c1609 .1.3.6.1.6.3.10.1.2.4 0x325332f1fd9e8cabe35a0bbc32c8d698 0x ```</p>
<h2>SnmpMibs OOB</h2>
<p>The SnmpMibs OOB is a fixed entry OOB generated by snmpd_conf, and it provides a list of the supported MIBs (both standard and Eaton-specific) for the UI. When snmpd_conf is run, it populates the table of entries based on the MIB extensions that it finds in /lib/snmp; it interrogates these DLLs and from that produces the list of MIB entries.</p>
<p>The SnmpMibs OOB uses repeated GenericTableEntry entries, as defined in <a href="../../../libpx/tk_proto/hg/GenericTableEntry.proto">GenericTableEntry.proto</a>.</p>
<p>The sections below describe how the GenericTableEntry fields are used for the SnmpMibs OOB.</p>
<h3>Fields for the SnmpMibs OOB</h3>
<p>The fields described here define one MIB file entry for the UI.</p>
<h4>label</h4>
<p>The name of the MIB. This is a short unique label that can be used to identify the table entry.</p>
<h4>description</h4>
<p>A short description of the MIB file (to aid the user).</p>
<h4>value</h4>
<p>The CGI download script and MIB file name that can be used to access the MIB file.</p>
<h3>Example of SnmpMibs OOB</h3>
<p>The following shows some representative entries in this OOB; this example is from the Beagle-Bone Black Bacon Cape device.</p>
<p>```json { "toolkitStruct": { "generic_table": [ { "label":"EATON-OIDS", "description":"Eaton OID assignments", "value": { "str_val":"/mibs/download.cgi?EATON-OIDS.txt" } }, { "label":"ENTITY-MIB", "description":"RFC 4133 Entity MIB", "value": { "str_val":"/mibs/download.cgi?ENTITY-MIB.txt" } }, { "label":"ENTITY-STATE-MIB", "description":"RFC 4268 Entity State MIB", "value": { "str_val":"/mibs/download.cgi?ENTITY-STATE-MIB.txt" } }, { "label":"ENTITY-STATE-TC-MIB", "description":"RFC 4268 Entity State MIB Part 2", "value": { "str_val":"/mibs/download.cgi?ENTITY-STATE-TC-MIB.txt" } }, { "label":"EATON-PCD-MIB", "description":"Eaton Power Device MIB", "value": { "str_val":"/mibs/download.cgi?EATON-PCD-MIB.txt" } }, { "label":"EATON-PWR-MTR-MIB", "description":"Eaton Power Meter MIB", "value": { "str_val":"/mibs/download.cgi?EATON-PWR-MTR-MIB.txt" } }, { "label":"EATON-PXG-MIB", "description":"Eaton Alarms+Traps MIB", "value": { "str_val":"/mibs/download.cgi?EATON-PXG-MIB.txt" } } ], "description":"List of supported SNMP MIBs", "label":"SNMP MIBs", "log_changes":false } } ```</p>
<p>The corresponding entries generated into the snmpd.conf file look like:</p>
<p>``` </p>
<h6></h6>
<h1>SECTION: Dynamically Loadable MIB Extension Modules</h1>
<p># </p>
<h1>This section This section adds the submodules for our system.</h1>
<p>dlmod etn_mibs_base /lib/snmp/etn_mibs_base.so dlmod pcd_mib /lib/snmp/pcd_mib.so dlmod pwr_mtr_mib /lib/snmp/pwr_mtr_mib.so dlmod pxg_mib /lib/snmp/pxg_mib.so ```</p>
<p>Here the "etn_mibs_base" covers the standard IETF MIBs for Entity and Entity State.</p>
<h2>ACCESS_CTRL/SNMP OOB</h2>
<p>For the OOB that controls the firewall settings for SNMP access, see <a href="../../../../documents/Network_OOB_Objects.md">the writeup for all ACCESS_CTRL OOBs</a></p>
<p>By default, the SNMP daemon is disabled, and the default port assignment is standard SNMP port 161.</p>
<h3>Example 'ACCESS_CTRL/SNMP', when enabled</h3>
<p>```json { "toolkitStruct": { "access_ctrl": { "restricted":false, "disabled":false, "port":161, "is_udp":true, "block_broadcasts":true }, "description":"Maps your cached device data to SNMP MIB data.", "label":"SNMP" } } ``` </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 7 2021 20:26:13 for snmpd_conf by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
