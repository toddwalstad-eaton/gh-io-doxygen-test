<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>libpx: cds_handler.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">libpx
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('db/db1/cds__handler_8cpp_source.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">cds_handler.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../db/db1/cds__handler_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="../../db/db1/cds__handler_8cpp.html#a15e74dc945b6abf9c8ce62fcba2e517a">    1</a></span>&#160;<span class="preprocessor">#define LIBPX_LOG_SUBSYSTEM LIBPX_LOG_CDS_HANDLE</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../df/d9c/cds__handler_8hpp.html">px/asio/cds/cds_handler.hpp</a>&quot;</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d86/cds__connection__callback_8hpp.html">px/asio/cds/cds_connection_callback.hpp</a>&quot;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d2/dfe/client_8hpp.html">px/cds/client.hpp</a>&quot;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d0/d4e/signal__pipe_8hpp.html">px/cds/signal_pipe.hpp</a>&quot;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d64/clear__watchdog_8hpp.html">px/cds/clear_watchdog.hpp</a>&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d8b/ping__watchdog_8hpp.html">px/cds/ping_watchdog.hpp</a>&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/d07/register__watchdog_8hpp.html">px/cds/register_watchdog.hpp</a>&quot;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/d43/create__channel_8hpp.html">px/cds/create_channel.hpp</a>&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d4b/get__channel_8hpp.html">px/cds/get_channel.hpp</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d6c/get__channel__settings_8hpp.html">px/cds/get_channel_settings.hpp</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d89/get__channel__value_8hpp.html">px/cds/get_channel_value.hpp</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d4b/update__channel__value_8hpp.html">px/cds/update_channel_value.hpp</a>&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/db0/create__device_8hpp.html">px/cds/create_device.hpp</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/db7/delete__device_8hpp.html">px/cds/delete_device.hpp</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dc/dc8/get__device_8hpp.html">px/cds/get_device.hpp</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d5/d15/manage__subscriber__ids_8hpp.html">px/cds/manage_subscriber_ids.hpp</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d9/dbb/subscribe_8hpp.html">px/cds/subscribe.hpp</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d8/df9/subscriber__notify_8hpp.html">px/cds/subscriber_notify.hpp</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../df/d45/get__alarms_8hpp.html">px/cds/get_alarms.hpp</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/d6e/login_8hpp.html">px/cds/login.hpp</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../db/d8b/permission_8hpp.html">px/enum/permission.hpp</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d3/df0/query__trends_8hpp.html">px/cds/query_trends.hpp</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d7/d22/channel__trends_8hpp.html">px/data/channel_trends.hpp</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;sys/epoll.h&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../d4/d3d/log_8hpp.html">log.hpp</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="keyword">namespace </span>px {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">namespace </span>asio {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">// See cds_handler.hpp for description</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00036"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a9dbf29b0506a7fecd3970d72cc16115f">   36</a></span>&#160;<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a9dbf29b0506a7fecd3970d72cc16115f">CCdsHandler::CCdsHandler</a>( <span class="keyword">const</span> <a class="code" href="../../de/dcb/namespacepx.html#a7acb13796ae56fe8e773fe781eedd790">px::string</a> &amp;app_name, uint32_t wait_secs,</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                                                  uint32_t request_queue_size, uint32_t response_queue_size,</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;                                                  <span class="keyword">const</span> <span class="keywordtype">bool</span> enable_data_validation )</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        : <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html">CCdsSyncIO</a>( enable_data_validation ),</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        handle( <a class="code" href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a> ), _is_mock( false ), _want_reflexive( false ),</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        _change_signature_sub_id( 0 ), _add_dev_sub_id( 0 ), _dev_state_sub_id( 0 ),</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        _ch_values_sub_id( 0 ), _alarm_sub_id( 0 ),</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        _doing_initial_discovery( false ),</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        _internal_callback_handle( <a class="code" href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a> ), _in_callback_guard( false ),</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        _last_transaction_id( 0 ), _want_channels( false ),</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        _override_pacing( 0 ), _submit_wait_count( 0 )</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;{</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="comment">// This may throw, but will return on success:</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad31b9bf04739997bef426658f039d506">connect_to_cds</a>( app_name, wait_secs, request_queue_size, response_queue_size );</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">// Non-normal Constructor, only useful for non-CDS test.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">// This is only for tests, where we don&#39;t want/need a CDS connection.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8702027327c66c41e0a034c3230fa7d1">   56</a></span>&#160;<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a9dbf29b0506a7fecd3970d72cc16115f">CCdsHandler::CCdsHandler</a>( <span class="keywordtype">bool</span> is_mock )</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;        : <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html">CCdsSyncIO</a>(),</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        handle( <a class="code" href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a> ), _is_mock( is_mock ), _want_reflexive( false ),</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        _change_signature_sub_id( 0 ), _add_dev_sub_id( 0 ), _dev_state_sub_id( 0 ),</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        _ch_values_sub_id( 0 ), _alarm_sub_id( 0 ),</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        _doing_initial_discovery( false ),</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        _internal_callback_handle( <a class="code" href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a> ), _in_callback_guard( false ),</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        _last_transaction_id( 0 ), _want_channels( false ),</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        _override_pacing( 0 ), _submit_wait_count( 0 )</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;{</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;        <span class="keywordflow">if</span> ( !is_mock )</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#ab1ccbce6dc90278ccab5c9081dce6e17">LIBPX_FERR</a>( 1, <span class="stringliteral">&quot;Only use this constructor in test code.&quot;</span> );</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                <span class="comment">// assert rather than throw</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                assert( !is_mock );</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="comment">// Else, just returns with no CDS checking</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#aca06af91b95ad5e55953f4488f2c95e1">LIBPX_FINFO</a>( 1, <span class="stringliteral">&quot;The CDS Connection was not checked&quot;</span> );</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        }</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;}</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">// See cds_handler.hpp for description</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae99a652e32b681d13ef351dbea4a2ad1">   82</a></span>&#160;<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae99a652e32b681d13ef351dbea4a2ad1">CCdsHandler::~CCdsHandler</a>()</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;{</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="comment">// If we haven&#39;t already called closeout_device_map(), do so</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.empty() )</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0c2473fb91cf4b2786888535da71e51b">closeout_device_map</a>();</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="comment">// Do a graceful disconnect, closing out subscriptions, etc</span></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#a5aa42d307a74fdd3117745f85a587e34">disconnect</a>();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;}</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">// See cds_handler.hpp for description</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad31b9bf04739997bef426658f039d506">   97</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad31b9bf04739997bef426658f039d506">CCdsHandler::connect_to_cds</a>( <span class="keyword">const</span> <a class="code" href="../../de/dcb/namespacepx.html#a7acb13796ae56fe8e773fe781eedd790">px::string</a> &amp;app_name, uint32_t wait_secs,</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                                                                  uint32_t request_queue_size, uint32_t response_queue_size )</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;{</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        assert( request_queue_size &gt;= 4096 );</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        assert( response_queue_size &gt;= 4096 );</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <a class="code" href="../../d7/d2b/classpx_1_1cds_1_1CSignalPipe.html">px::cds::CSignalPipe</a> sigpipe;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordtype">int</span> epoll_fd = epoll_create( 1 );</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordtype">int</span> sigfd = sigpipe.<a class="code" href="../../d7/d2b/classpx_1_1cds_1_1CSignalPipe.html#a10a7ac470fc31363514f20e1ae650dc1">fd</a>();</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        std::vector&lt;epoll_event&gt; eventvec( 1 );</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="comment">//register with sighandler</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        epoll_event ev;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        memset( &amp;ev, 0, <span class="keyword">sizeof</span>( ev ) );</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;        ev.events = EPOLLIN | EPOLLERR | EPOLLHUP;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        ev.data.fd = sigfd;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">if</span> ( ::epoll_ctl( epoll_fd, EPOLL_CTL_ADD, sigfd, &amp;ev ) )</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a001b58f6595b2ecf816ea11fbb58b201">LIBPX_ERR</a>( 1, <span class="stringliteral">&quot;Can&#39;t add FD from epoll(): %s&quot;</span>, strerror( errno ) );</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a>( <span class="stringliteral">&quot;Can&#39;t add FD from epoll()&quot;</span> );</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="../../d4/d3d/log_8hpp.html#aedf82e390ea25288cf698a9d9eb470ef">LIBPX_INFO</a>( 1, <span class="stringliteral">&quot;Connecting to CDS... &quot;</span> );</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        <span class="comment">//Sighandler that attempts to connect with the CDS every 5 seconds until it succeeds</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        uint32_t log_spam = 13;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        uint32_t timeout = 0;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment">// Normally we want to pace the attempts to connect to the CDS, so we</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <span class="comment">// call connect() with cds_wait set to false.</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        <span class="comment">// Otherwise, we offer the CDS infinite time to connect().</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="keywordtype">bool</span> cds_wait = ( wait_secs == 0 );</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="keywordflow">while</span> ( !( <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;connect( cds_wait, app_name, request_queue_size, response_queue_size ) ) )</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                <span class="keywordtype">int</span> retval;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                <span class="keywordtype">int</span> errval = 0;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                <span class="keywordflow">do</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                        <span class="comment">//We don&#39;t want to spam the log. log once every 15 seconds</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                        <span class="keywordflow">if</span> ( ( log_spam++ ) &gt; 2 )</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                        {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 1, <span class="stringliteral">&quot;Unable to connect with CDS: Retrying...&quot;</span> );</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                                log_spam = 0;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                        }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                        <span class="comment">// We assume(?) that a failed connection attempt took about 5s</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                        timeout += 5;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                        <span class="keywordflow">if</span> ( timeout &gt; wait_secs )</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                        {</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                                <span class="keywordflow">throw</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a>( <span class="stringliteral">&quot;connection timeout&quot;</span> );</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                        }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                        retval = ::epoll_wait( epoll_fd, &amp;( eventvec.front() ),</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                                                                   eventvec.size(), 5000 );</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                        errval = errno;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                <span class="keywordflow">while</span> ( ( retval &lt; 0 ) &amp;&amp;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                                ( errval == EINTR ) &amp;&amp;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                                !( <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#a4dcbd4ee30cff72e47da46e92b9fc9c2">connect</a>( cds_wait, app_name ) ) );</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                <span class="comment">//shouldn&#39;t be more then 1 event but just in case lets handle them all</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; retval; i++ )</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                        <span class="keywordtype">int</span> fd = eventvec[i].data.fd;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                        assert( fd &gt;= 0 );</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                        <span class="comment">// First, check for incoming signals</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                        <span class="keywordflow">if</span> ( fd == sigpipe.<a class="code" href="../../d7/d2b/classpx_1_1cds_1_1CSignalPipe.html#a10a7ac470fc31363514f20e1ae650dc1">fd</a>() )</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                        {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                                sigpipe.<a class="code" href="../../d7/d2b/classpx_1_1cds_1_1CSignalPipe.html#acd94e725edcf8d7b6c2cf4b55b2d430c">clear</a>();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                        }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                        {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                                <span class="keywordflow">throw</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a>( <span class="stringliteral">&quot;Unknown signal caught&quot;</span> );</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                        }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">if</span> ( !( <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;connect( cds_wait, app_name, request_queue_size, response_queue_size ) ) )</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a001b58f6595b2ecf816ea11fbb58b201">LIBPX_ERR</a>( 0, <span class="stringliteral">&quot;Failed to connect to CDS.&quot;</span> );</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a>( <span class="stringliteral">&quot;Failed to connect to CDS.&quot;</span> );</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#aedf82e390ea25288cf698a9d9eb470ef">LIBPX_INFO</a>( 1, <span class="stringliteral">&quot;connected with CDS!: start app logic&quot;</span> );</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;}</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">// See cds_handler.hpp for description</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">  194</a></span>&#160;std::shared_ptr&lt;px::cds::CRequestResponse&gt; <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">CCdsHandler::submit_wait</a>( <a class="code" href="../../d3/dbb/classpx_1_1cds_1_1CRequestResponse.html">px::cds::CRequestResponse</a> &amp;req )<span class="keyword"> const</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">// Whether succeeds or not, count this call. Have to make it mutable within this const function.</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        <span class="keyword">const_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> &amp;<span class="keyword">&gt;</span>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1490c8cfafb707940563675d474c1752">_submit_wait_count</a> )++;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// Check the callback guard, but only if we are the background thread,</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">// which is what we are guarding against getting hung up.</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#acc483b564f12d9173bf7369ef89ae42b">_in_callback_guard</a> &amp;&amp; <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#acb54300760c627bee88063465442bd74">px::cds::CClient::am_i_background_thread</a>() )</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a521456704214b9bd0a4dd62c8095ec13">LIBPX_NOTICE</a>( 1, <span class="stringliteral">&quot;Calling submit_wait() within a callback; would hang!&quot;</span> );</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                assert( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#acc483b564f12d9173bf7369ef89ae42b">_in_callback_guard</a> );          <span class="comment">// Get their attention</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                <span class="comment">// Clear the flag, just in case it was inadvertently stuck on (guard against the guard)</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                <span class="comment">// This member is mutable.</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#acc483b564f12d9173bf7369ef89ae42b">_in_callback_guard</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                <span class="comment">// For release code, return empty (status(INCOMPLETE)) result</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="keywordflow">return</span> ( std::shared_ptr&lt;px::cds::CRequestResponse&gt;( <span class="keyword">new</span> <a class="code" href="../../d3/dbb/classpx_1_1cds_1_1CRequestResponse.html">px::cds::CRequestResponse</a>() ) );</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordflow">return</span> ( <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">submit_wait</a>( req ) );</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="comment">// See cds_handler.hpp for description</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#af206864b870bb26b37f9fc6cd563a88e">  219</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#af206864b870bb26b37f9fc6cd563a88e">CCdsHandler::submit_forget</a>( <a class="code" href="../../d3/dbb/classpx_1_1cds_1_1CRequestResponse.html">px::cds::CRequestResponse</a> &amp;req,</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                                                                 <span class="keywordtype">bool</span> sleep_on_full )</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;{</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <a class="code" href="../../d5/dd5/namespacepx_1_1cds.html#af5c5d93bab566bfc0b74fbab046f8246">px::cds::CallbackHandle</a> hndl = <a class="code" href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#a907410082d34b93630b2f0b0abe44186">submit</a>( req, hndl, sleep_on_full );</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;}</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">// See cds_handler.hpp for description</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a6a303fcab722a10d70bdca3133b072cd">  232</a></span>&#160;uint32_t <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a6a303fcab722a10d70bdca3133b072cd">CCdsHandler::submit</a>( <a class="code" href="../../d3/dbb/classpx_1_1cds_1_1CRequestResponse.html">px::cds::CRequestResponse</a> &amp;req, <span class="keywordtype">bool</span> sleep_on_full )</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;{</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7adb2b1f00702d8aa9ae706962b78d3e">handle</a> == <a class="code" href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a> )</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#ab1ccbce6dc90278ccab5c9081dce6e17">LIBPX_FERR</a>( 1, <span class="stringliteral">&quot;ASIO manager not started yet&quot;</span> );</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                <span class="comment">// Since this library is intended to feature convenience, will not throw() here.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <span class="comment">// Assert or return 0.</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                assert( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7adb2b1f00702d8aa9ae706962b78d3e">handle</a> == <a class="code" href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a> );</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                <span class="keywordflow">return</span> ( 0 );</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        }</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="keywordflow">return</span> ( <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a6a303fcab722a10d70bdca3133b072cd">submit</a>( req, <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7adb2b1f00702d8aa9ae706962b78d3e">handle</a>, sleep_on_full ) );</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;}</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">// See cds_handler.hpp for description</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae2d8ae3b3bd79f213a473f0bc3488d30">  251</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae2d8ae3b3bd79f213a473f0bc3488d30">CCdsHandler::ping_watchdog</a>()</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;{</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <a class="code" href="../../d9/d9c/classpx_1_1cds_1_1CPingWatchdog.html">px::cds::CPingWatchdog</a> ping_msg;                <span class="comment">// no arguments for this simple message</span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="comment">// Fire n forget</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#a907410082d34b93630b2f0b0abe44186">submit</a>( ping_msg );</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <a class="code" href="../../d4/d3d/log_8hpp.html#aedf82e390ea25288cf698a9d9eb470ef">LIBPX_INFO</a>( 5, <span class="stringliteral">&quot;Pinging Watchdog directly.&quot;</span> );</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="comment">// Insert a check for any async timeouts here, and check the queue if timed out</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0b6d96ca49da4118186dc686a98622d8">check_awaiting_timeouts</a>() )</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a4184f2136532243984b5ceb61d0d76c0">check_request_queue</a>();</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        }</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;}</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="comment">// See cds_handler.hpp for description</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a81c6a883af06f5e82ea5b8d465579884">  271</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a81c6a883af06f5e82ea5b8d465579884">CCdsHandler::set_oob</a>( <span class="keyword">const</span> <a class="code" href="../../de/dcb/namespacepx.html#a7acb13796ae56fe8e773fe781eedd790">px::string</a> &amp;tag, <span class="keyword">const</span> px::proto::toolkitStruct &amp;data, <span class="keywordtype">bool</span> persist )</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;{</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        assert( !tag.empty() );</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <a class="code" href="../../d4/d55/classpx_1_1cds_1_1CSetOOBData.html">px::cds::CSetOOBData</a> cds_req;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        cds_req.<a class="code" href="../../d4/d55/classpx_1_1cds_1_1CSetOOBData.html#a86c87efc4c9a5194b13059406cdf6888">data</a>.push_back( <a class="code" href="../../d6/d60/classpx_1_1cds_1_1CSetOOBDataUnit.html">px::cds::CSetOOBDataUnit</a>( tag, data, ( persist ? <a class="code" href="../../d5/dd5/namespacepx_1_1cds.html#afb592c0e9297414bf72bd442764b079aa4e4104ab10b7592af99a7bbc6023d93f">px::cds::persistence::save_always</a> : <a class="code" href="../../d5/dd5/namespacepx_1_1cds.html#afb592c0e9297414bf72bd442764b079aac8c45f79829ea04ab6d397525bf35b94">px::cds::persistence::do_not_save</a> ) ) );</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keywordflow">try</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                <span class="comment">// Check the callback guard, but only if we are the background thread,</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                <span class="comment">// which is what we are guarding against getting hung up.</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#acc483b564f12d9173bf7369ef89ae42b">_in_callback_guard</a> &amp;&amp; <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#acb54300760c627bee88063465442bd74">px::cds::CClient::am_i_background_thread</a>() )</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                        <span class="comment">// Inside a callback, we can&#39;t wait on the result.</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                        this-&gt;<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#af206864b870bb26b37f9fc6cd563a88e">submit_forget</a>( cds_req );</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                        <span class="comment">// Small advantage to waiting for the result, for error checking.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                        <span class="keyword">auto</span> resp = this-&gt;<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">submit_wait</a>( cds_req );</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                        <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a5f8a8b6012a3798213d38f323d330867">check_cds_result</a>( resp, <span class="stringliteral">&quot;set_oob&quot;</span> );</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#aedf82e390ea25288cf698a9d9eb470ef">LIBPX_INFO</a>( 5, <span class="stringliteral">&quot;Updated %s OOB data.&quot;</span>, tag.c_str() );</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        }</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="comment">// ToDo: can it really throw this exception?  CDS itself throws px:: exceptions</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">catch</span> ( <span class="keyword">const</span> std::exception &amp;ex )</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        {</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a001b58f6595b2ecf816ea11fbb58b201">LIBPX_ERR</a>( 0, <span class="stringliteral">&quot;When updating %s OOB data : %s&quot;</span>, tag.c_str(), ex.what() );</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;}</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">// See cds_handler.hpp for description</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00308"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8e7f7da549a3fd4bebeff1deb9646d12">  308</a></span>&#160;<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html">px::CDevice</a> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8e7f7da549a3fd4bebeff1deb9646d12">CCdsHandler::get_device</a>( <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> dev_id )</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;{</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        assert( dev_id );</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment">// See if we have it in our map already</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.empty() )</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        {</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                <a class="code" href="../../d6/dbb/namespacepx_1_1asio.html#a755f93f6e581023c79c1b07e313ac802">cds_device_map_citer_t</a> map_pos;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7b760a8420b8a6ef12d60c3f9c00eaff">get_map_device</a>( dev_id, map_pos ) )</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                        <span class="keywordflow">return</span> ( map_pos-&gt;second._px_device );</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                <span class="comment">// Else, if not in our map, probably doesn&#39;t exist</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a>( <span class="stringliteral">&quot;Failed lookup of requested device&quot;</span> );</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="comment">// Else, ask the CDS for it</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <a class="code" href="../../dc/d8a/classpx_1_1cds_1_1CGetDevice.html">px::cds::CGetDevice</a> dev_req;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="comment">// Leave the request set to no recursion (level 0)</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        dev_req.<a class="code" href="../../dc/d8a/classpx_1_1cds_1_1CGetDevice.html#ae6beff875f8f7d70853848c58b870a43">requested_ids</a>.push_back( dev_id );</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;Requesting Device %&quot;</span> PRIu64 <span class="stringliteral">&quot; info from the CDS&quot;</span>, dev_id );</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        std::shared_ptr&lt;px::cds::CGetDevice&gt; dev_resp =</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                std::dynamic_pointer_cast&lt;<a class="code" href="../../dc/d8a/classpx_1_1cds_1_1CGetDevice.html">px::cds::CGetDevice</a>&gt;( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">submit_wait</a>( dev_req ) );</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a5f8a8b6012a3798213d38f323d330867">check_cds_result</a>( dev_resp, <span class="stringliteral">&quot;CGetDevice&quot;</span> );</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordflow">if</span> ( dev_resp-&gt;devices.size() != 1 )</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a>( <span class="stringliteral">&quot;Failed to retrieve requested device&quot;</span> );</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;        <span class="keywordflow">return</span> ( dev_resp-&gt;devices[0] );</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;}</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">// Function to initialize the local map of Device data from the CDS.</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">// The application provides its callback functions which will be invoked</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">// when a device is added to, updated in, or deleted from the map.</span></div>
<div class="line"><a name="l00346"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a410ac02c6d8fb33b91deff414db7e061">  346</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a410ac02c6d8fb33b91deff414db7e061">CCdsHandler::init_device_map</a>( <span class="keyword">const</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a55081ea603905bb29e8a1cc0a0ef1069">cds_device_callback_t</a> &amp;add_device_callback,</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                                                                   <span class="keyword">const</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a55081ea603905bb29e8a1cc0a0ef1069">cds_device_callback_t</a> &amp;update_device_callback,</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                                                                   <span class="keyword">const</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a517c085c90f0643a22ad476324ae3e99">device_delete_callback_t</a> &amp;delete_device_callback,</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                                                   <span class="keyword">const</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a55081ea603905bb29e8a1cc0a0ef1069">cds_device_callback_t</a> &amp;device_state_callback, <span class="keywordtype">bool</span> want_channels,</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                                                   <span class="keyword">const</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a52fdbf559cb4e634a650ef82657588b7">cds_ch_settings_callback_t</a> &amp;channel_settings_callback )</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;{</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="comment">// Save the callbacks:</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8c213d7dd5c7e101e8beabd4ce832248">_add_device_callback</a> = add_device_callback;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a97d7549acfc26ffd2dc51dc7bcbdeb07">_update_device_callback</a> = update_device_callback;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0e35161a3e9f1c5a204a396efff80ecb">_delete_device_callback</a> = delete_device_callback;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0326c84fc1ea91666cd775c6db751382">_device_state_callback</a> = device_state_callback;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> = want_channels;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ada543e79f572842d093be4a33ee058a7">_channel_settings_callback</a> = channel_settings_callback;         <span class="comment">// may be empty</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="comment">// Create the response callback</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3ab982d098d8801301333226379a315">_internal_callback</a>.reset( <span class="keyword">new</span> <a class="code" href="../../da/d72/classpx_1_1asio_1_1CCdsHandlerCallback.html">CCdsHandlerCallback</a>( *<span class="keyword">this</span> ) );</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="comment">// and register this handler for internal CDS submit() calls - coming up in do_static_discovery()</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a96568e9452f15dcc9ef7d1b7412443ab">_internal_callback_handle</a> = <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#a63512b3fd6a96fb8adf392c2242d9f54">register_callback</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3ab982d098d8801301333226379a315">_internal_callback</a> );</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="comment">// Get our 3 subscription IDs here, while we can still make synchronous calls</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keywordtype">size_t</span> num_subs = 3;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> )   <span class="comment">// one more in this case</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                num_subs++;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        }</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="comment">// Make these reflexive = True because we want to see</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="comment">// notifications even for our own changes, eg if we set sysContact (Device 1&#39;s Contact field)</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        std::vector&lt;uint64_t&gt; new_ids = <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a9476cf54a2363a1a646f3769c5fcd3dc">get_subscriber_ids</a>( num_subs, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        <span class="comment">// Now save the 3 IDs</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a911700a9b460e8f4dd41a4eb82f7355a">_change_signature_sub_id</a> = new_ids[0];</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a624f000e659948bbee10971f0fc9cdee">_add_dev_sub_id</a> = new_ids[1];</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa45851ad0ebfa7541cab7a1f739b4e18">_dev_state_sub_id</a> = new_ids[2];</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> )   <span class="comment">// one more in this case</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        {</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3fb9eb8b97a409c3d27c370afcdf993">_ch_values_sub_id</a> = new_ids[3];</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="comment">// Mark that we have entered our initial scan of static Discovery mode</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abf75a5dfc2411c8d4aca956f6a5afb14">_doing_initial_discovery</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="comment">// Start with the root device&#39;s data, and kick off the first round of static discovery</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="comment">// Will process in hierarchy order: root first, then ports, then first level serial devices, etc</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5556ac1e9278da66bfa7f6a50c2c718f">do_static_discovery</a>( <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a> );</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="comment">// That call won&#39;t return until all existing devices have been discovered</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="comment">// Now clear the flag for initial Discovery mode</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abf75a5dfc2411c8d4aca956f6a5afb14">_doing_initial_discovery</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">// Perform a static discovery of all device data starting at the given ID.</span></div>
<div class="line"><a name="l00399"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5556ac1e9278da66bfa7f6a50c2c718f">  399</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5556ac1e9278da66bfa7f6a50c2c718f">CCdsHandler::do_static_discovery</a>( <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> starting_dev_id )</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;{</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        assert( starting_dev_id );</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a7e5b30fcce4d8299841858a089502ed3">RQST_GET_DEVICE</a>, starting_dev_id );</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> )</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                <span class="comment">/* Don&#39;t request Channel Settings or Values until we know we have a &quot;valid&quot; device:</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;<span class="comment">                 * add_msg_to_rqst_queue( RQST_GET_CHANNEL_SETTINGS, starting_dev_id );</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;<span class="comment">                 * add_msg_to_rqst_queue( RQST_GET_CHANNEL_VALUES, starting_dev_id );</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                <span class="comment">// No subscriptions should be entered during the first pass</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abf75a5dfc2411c8d4aca956f6a5afb14">_doing_initial_discovery</a> )</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                        <span class="comment">// Since the devices may not have updated change_signatures,</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                        <span class="comment">// we might not drill down through all of the already known devices</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                        <span class="comment">// But we need, at this point, to subscribe to the value_updates</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                        <span class="comment">// So just do that now for all known devices</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                        <span class="keywordflow">for</span> ( <span class="keyword">auto</span> entry : <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a> )</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                        {</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                                <span class="keywordflow">if</span> ( !entry.second._px_device.channels.empty() &amp;&amp; entry.second.is_valid_device() &amp;&amp;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                                         !entry.second._channel_values_subscribed )</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                                {</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a8ccf655de8fa023eb6ce0f6e243e2089">RQST_SUBSCRIBE_CHANNEL_VALUES</a>, entry.first );</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                                        entry.second._channel_values_subscribed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                                }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                        }</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;        }</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;        <span class="comment">// Now iterate through the dynamic queue for starting_dev_id and discovered child devices</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;        <span class="comment">// Requesting one device at a time.</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;        <span class="keywordflow">while</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a4184f2136532243984b5ceb61d0d76c0">check_request_queue</a>() )</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;        {</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a52ae66ba371f37cbcb7a33d0cdec38cc">ok_to_proceed</a>() )</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                {</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                        <span class="comment">// Cancel subscriptions and clear the maps and request queue</span></div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0c2473fb91cf4b2786888535da71e51b">closeout_device_map</a>();</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                }</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                <span class="comment">// Nothing to do here that check_request_queue() hasn&#39;t already done</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                <span class="keyword">struct </span><a class="code" href="../../da/d9d/classtimespec.html">timespec</a> req;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                <span class="comment">// If the pacing is overridden, use that value here.  Else default as commented</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                <span class="comment">// below.</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a4566a160ea6d8b1659725e11a770e5d8">_override_pacing</a> )</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                {</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                        req.tv_sec = 0;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                        req.tv_nsec = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a4566a160ea6d8b1659725e11a770e5d8">_override_pacing</a>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                }</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                {</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> )</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                        {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                                <span class="comment">// Slow this down to give the rest of the system a chance to breath (1s)</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                                req.tv_sec = 1;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                                req.tv_nsec = 0L;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                        }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                        {</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                                <span class="comment">// Just devices; sleep a little (100ms) and then check again</span></div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                                req.tv_sec = 0;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                                req.tv_nsec = 100000000L;       <span class="comment">// 100,000,000 ns = 100 ms</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                        }</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                }</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                nanosleep( &amp;req, ( <span class="keyword">struct</span> <a class="code" href="../../da/d9d/classtimespec.html">timespec</a> * )NULL );</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;        }</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;}</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;<span class="comment">// Enter CDS subscriptions for Device CrUD events to maintain the device map.</span></div>
<div class="line"><a name="l00471"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aefac77b191971c7b5373489a6ae5733c">  471</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aefac77b191971c7b5373489a6ae5733c">CCdsHandler::subscribe_device_callbacks</a>()</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;{</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        <span class="comment">// First, create the response callback (if not already)</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="comment">// and register it if the ASIO CCdsConnection hasn&#39;t already</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        <span class="comment">// registered an unsolicited callback. We want the shared pointer in either case, as</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="comment">// a sign that we are interested in having internal_handle_response() called.</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3ab982d098d8801301333226379a315">_internal_callback</a> || ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3ab982d098d8801301333226379a315">_internal_callback</a> == <a class="code" href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a> ) )</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3ab982d098d8801301333226379a315">_internal_callback</a>.reset( <span class="keyword">new</span> <a class="code" href="../../da/d72/classpx_1_1asio_1_1CCdsHandlerCallback.html">CCdsHandlerCallback</a>( *<span class="keyword">this</span> ) );</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                <span class="comment">// Since newly created, register this handler for internal CDS submit() calls.</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a96568e9452f15dcc9ef7d1b7412443ab">_internal_callback_handle</a> = <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#a63512b3fd6a96fb8adf392c2242d9f54">register_callback</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3ab982d098d8801301333226379a315">_internal_callback</a> );</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7adb2b1f00702d8aa9ae706962b78d3e">handle</a> == <a class="code" href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a> )</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;        {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#abe5d6aa630878410324758c8b501bab4">register_unsolicited_callback</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3ab982d098d8801301333226379a315">_internal_callback</a> );</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="comment">// Enter the subscriptions (except Channel Value Updates - that will come later)</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html">px::cds::CSubscribe</a> sub_req;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordtype">bool</span> is_id_recursive = <span class="keyword">true</span>;            <span class="comment">// recursive from the root device (1)</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        assert( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a911700a9b460e8f4dd41a4eb82f7355a">_change_signature_sub_id</a> );             <span class="comment">// should be initialized</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="comment">// This bunch is all placed at recursively at the Publisher (dev_id == 1) level</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a911700a9b460e8f4dd41a4eb82f7355a">_change_signature_sub_id</a>,</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                                                                                                                                   <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841aed9c52e870141df9c25b8e97263a19d0">px::sub::subscription_type::change_signature</a>,</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                                                                                                                                   <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a>, is_id_recursive ) );</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a624f000e659948bbee10971f0fc9cdee">_add_dev_sub_id</a>,</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                                                                                                                                   <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841ab6abbfb7c6c6e9ca809dea2537ee2c90">px::sub::subscription_type::device_create_recursive</a>,</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                                                                                                                                   <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a>, is_id_recursive ) );</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;        sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a624f000e659948bbee10971f0fc9cdee">_add_dev_sub_id</a>,</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                                                                                                                                   <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a6173fabae619ef4770b698d998e2ea6f">px::sub::subscription_type::device_delete_recursive</a>,</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                                                                                                                                   <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a>, is_id_recursive ) );</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="comment">// We can re-use the Add Device subscription ID for changes in Device Settings,</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="comment">// since they use the same response structure</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a624f000e659948bbee10971f0fc9cdee">_add_dev_sub_id</a>,</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                                                                                                                                   <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a139ee1f327cb1d7e4748baced02f8e60">px::sub::subscription_type::device_settings</a>,</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                                                                                                                                   <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a>, is_id_recursive ) );</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa45851ad0ebfa7541cab7a1f739b4e18">_dev_state_sub_id</a>,</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                                                                                                                                   <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a29b57489abff7736fc2f1860190a1efd">px::sub::subscription_type::device_state_recursive</a>,</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                                                                                                                                   <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a>, is_id_recursive ) );</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        std::shared_ptr&lt;px::cds::CRequestResponse&gt; sub_resp = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">submit_wait</a>( sub_req );</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a5f8a8b6012a3798213d38f323d330867">check_cds_result</a>( sub_resp, <span class="stringliteral">&quot;CSubscribe&quot;</span> );</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;}</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="comment">// Function to initialize the optional callback for channel value updates.</span></div>
<div class="line"><a name="l00517"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a965b685fdc21e5892cb63d817c33fa33">  517</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a965b685fdc21e5892cb63d817c33fa33">CCdsHandler::init_channel_values_callback</a>( <span class="keyword">const</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a9982fd5461711099639ce9923c9b21e5">cds_ch_values_callback_t</a> &amp;update_channel_values_callback )</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;{</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="comment">// One validity test: are we monitoring channels?</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> )</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        {</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7909cedb98efe9b26b6205ac3b7d48e1">_channel_values_callback</a> = update_channel_values_callback;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <span class="keywordflow">return</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> );</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;}</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">// Undo the features that we enabled to populate the device map: unsubscribe callbacks, clear the map.</span></div>
<div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0c2473fb91cf4b2786888535da71e51b">  529</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0c2473fb91cf4b2786888535da71e51b">CCdsHandler::closeout_device_map</a>()</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;{</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 3, <span class="stringliteral">&quot;Closing out the CdsHandler device map and closing subscriptions.&quot;</span> );</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;        <span class="comment">// First unregister any already registered unsolicited handler</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="comment">// Somewhat misnamed, since this callback handles subscribed updates as well</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#a28b00111c32ca2391045e23966fb7210">unregister_unsolicited_callback</a>();</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a96568e9452f15dcc9ef7d1b7412443ab">_internal_callback_handle</a> != <a class="code" href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a> )</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#a04806b8577ecbb198bc2f7c8cf9939ff">unregister_callback</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a96568e9452f15dcc9ef7d1b7412443ab">_internal_callback_handle</a> );</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a96568e9452f15dcc9ef7d1b7412443ab">_internal_callback_handle</a> = <a class="code" href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a>;</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="comment">// For the sake of completeness (?), unsubscribe our callbacks as well</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        <a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html">px::cds::CSubscribe</a> sub_req;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        <span class="comment">// This bunch is all placed at recursively at the Publisher (dev_id == 1) level</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a911700a9b460e8f4dd41a4eb82f7355a">_change_signature_sub_id</a>,</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                                                                                                                                   <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a86e7be1e80840bad6d3471e250ff1c2e">px::sub::subscription_type::max_subscription_type</a>,</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                                                                                                                                   <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a>, <span class="keyword">true</span>, <span class="keyword">true</span> ) );</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a624f000e659948bbee10971f0fc9cdee">_add_dev_sub_id</a>,</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                                                                                                                                   <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a86e7be1e80840bad6d3471e250ff1c2e">px::sub::subscription_type::max_subscription_type</a>,</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                                                                                                                                   <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a>, <span class="keyword">true</span>, <span class="keyword">true</span> ) );</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="comment">// We can re-use the Add Device subscription ID for changes in Device Settings,</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;        <span class="comment">// since they use the same response structure</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;        sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa45851ad0ebfa7541cab7a1f739b4e18">_dev_state_sub_id</a>,</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                                                                                                                                   <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a86e7be1e80840bad6d3471e250ff1c2e">px::sub::subscription_type::max_subscription_type</a>,</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                                                                                                                                   <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a>, <span class="keyword">true</span>, <span class="keyword">true</span> ) );</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> )</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;        {</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;                sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3fb9eb8b97a409c3d27c370afcdf993">_ch_values_sub_id</a>,</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                                                                                                                                           <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a86e7be1e80840bad6d3471e250ff1c2e">px::sub::subscription_type::max_subscription_type</a>,</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                                                                                                                                           <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a>, <span class="keyword">true</span>, <span class="keyword">true</span> ) );</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a16553da663bf5d4e9d51882bc98fc581">_alarm_sub_id</a> != 0 )</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;        {</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a16553da663bf5d4e9d51882bc98fc581">_alarm_sub_id</a>,</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                                                                                                                                           <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a86e7be1e80840bad6d3471e250ff1c2e">px::sub::subscription_type::max_subscription_type</a>,</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                                                                                                                                           <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a>, <span class="keyword">true</span>, <span class="keyword">true</span> ) );</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a16553da663bf5d4e9d51882bc98fc581">_alarm_sub_id</a> = 0;</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        }</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="comment">// We can&#39;t get a response back at this point, so fire-n-forget</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#af206864b870bb26b37f9fc6cd563a88e">submit_forget</a>( sub_req );</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="comment">// Finally, clear our maps of devices and channels, and the request queue</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8f13df8167b9a9bbaf5b8f6d96490ae5">_device_map_mutex</a> );</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.clear();</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;        }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;        {</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2cc65de2bb61ce9231deb98fb0676845">_channel_map_mutex</a> );</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.clear();</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        }</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                <span class="comment">// In case we are still in the static_discovery phase, clear this to short-circuit the discovery loop</span></div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                std::unique_lock&lt;std::recursive_mutex&gt; ulock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5fa6628b70d41ed6fe65199fbaa2092d">_reqst_queue_mutex</a> );</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3d74e802843cf6efac6b7ac6cc9d7263">_reqst_queue</a>.clear();</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        }</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;}</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="comment">// The recursive function to check this device&#39;s data and</span></div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="comment">// see if we need to add or update the Device data, or its channels,</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="comment">// or (recursively) its child devices.</span></div>
<div class="line"><a name="l00591"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2006f4f4d69f866827c8585cb3d7d09b">  591</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2006f4f4d69f866827c8585cb3d7d09b">CCdsHandler::process_device_data</a>( <span class="keyword">const</span> <a class="code" href="../../d6/d5b/classpx_1_1CDevice.html">px::CDevice</a> &amp;px_device )</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;{</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keywordtype">bool</span> is_changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8f13df8167b9a9bbaf5b8f6d96490ae5">_device_map_mutex</a> );</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="comment">// See if it is already in our map</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keyword">auto</span> pos = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.find( px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        <span class="keywordflow">if</span> ( pos != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.end() )</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                <a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html">px::asio::CCdsDevice</a> &amp;container = pos-&gt;second;</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                <span class="keywordflow">if</span> ( px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#a41eb528e122765272fe2d317daf428b0">change_signature</a> == container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#aad9dd7ebc8ea00d8b047239e4e0730e2">_px_device</a>.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#a41eb528e122765272fe2d317daf428b0">change_signature</a> )</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                        lock.unlock();          <span class="comment">// Don&#39;t continue to lock the mutex now</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                        <span class="comment">/* We had this one, and no change observed.</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="comment">                         * No need to check the child devices, either,</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="comment">                         * since the change_signature is recursive. */</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 3, <span class="stringliteral">&quot;No change in change_signature, so not rechecking children of Device %&quot;</span> PRIu64 <span class="stringliteral">&quot;.&quot;</span>,</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                                                 px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                        <span class="comment">// Else, update the Device data</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                        container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#aad9dd7ebc8ea00d8b047239e4e0730e2">_px_device</a> = px_device;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                        lock.unlock();          <span class="comment">// Don&#39;t continue to lock the mutex now</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                        <span class="comment">// Notify our application</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a97d7549acfc26ffd2dc51dc7bcbdeb07">_update_device_callback</a> )</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                        {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a97d7549acfc26ffd2dc51dc7bcbdeb07">_update_device_callback</a>( container );</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                        }</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                        is_changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> &amp;&amp; container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#af01372623d442be1a7edde160653cb4e">is_valid_device</a>() )</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                {</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                        <span class="keywordflow">if</span> ( !container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#a53b9ab7fb8db713c0269fb13525bd767">_channel_values_received</a> )</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                        {</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                                <span class="comment">// Request the Channel Settings and Values</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Requesting initial Channel data for Device %&quot;</span> PRIu64 <span class="stringliteral">&quot;.&quot;</span>,</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                                                         px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ae8a24b31c9e5c8ac99f0f14055c5308d">RQST_GET_CHANNEL_SETTINGS</a>, px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ab7dddeda449a68096c6427841bffcf58">RQST_GET_CHANNEL_VALUES</a>, px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                        }</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#a074c5f9be4f7d9513374eba7054725ee">_channel_settings_count</a> != container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#aad9dd7ebc8ea00d8b047239e4e0730e2">_px_device</a>.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#a648d75d3577fd8f08a863d70ca378703">channels</a>.size() )</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                        {</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 3, <span class="stringliteral">&quot;Re-requesting Channel data for Device %&quot;</span> PRIu64 <span class="stringliteral">&quot; for updated Channel count %zu (was %zu)&quot;</span>,</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                                                         px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>(), container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#a074c5f9be4f7d9513374eba7054725ee">_channel_settings_count</a>,</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                                                         container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#aad9dd7ebc8ea00d8b047239e4e0730e2">_px_device</a>.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#a648d75d3577fd8f08a863d70ca378703">channels</a>.size() );</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ae8a24b31c9e5c8ac99f0f14055c5308d">RQST_GET_CHANNEL_SETTINGS</a>, px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ab7dddeda449a68096c6427841bffcf58">RQST_GET_CHANNEL_VALUES</a>, px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                        }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                        <span class="comment">// No subscriptions should be entered during the first pass</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abf75a5dfc2411c8d4aca956f6a5afb14">_doing_initial_discovery</a> )</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                        {</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a8ccf655de8fa023eb6ce0f6e243e2089">RQST_SUBSCRIBE_CHANNEL_VALUES</a>, px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                                container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#ab022cc05f8830462e4f2022d4314a682">_channel_values_subscribed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                        }</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                }</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        }</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() == <a class="code" href="../../db/db3/id_8hpp.html#a461a9279b34d33ce9f3daeb054c18b7b">PX_ID_UNSET</a> )</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;        {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                <span class="comment">// This device data isn&#39;t fully baked yet; don&#39;t invoke any callback</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;        {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                <span class="comment">// This is a new entry</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                <span class="keyword">auto</span> result = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.emplace( std::make_pair( px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>(), <a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html">CCdsDevice</a>( px_device ) ) );</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                lock.unlock();          <span class="comment">// Don&#39;t continue to lock the mutex now</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;                <span class="keywordflow">if</span> ( !result.second )</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;                {</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;                        <span class="comment">// In this very unlikely event, log a Notice and return</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a521456704214b9bd0a4dd62c8095ec13">LIBPX_NOTICE</a>( 1, <span class="stringliteral">&quot;Failed to add new device (%u) to _cds_device_map&quot;</span>, ( uint32_t ) px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                        <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                is_changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                <span class="comment">// Get a reference to the container in the new map entry</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                <span class="comment">// (should be no copying or construction here)</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                <a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html">px::asio::CCdsDevice</a> &amp;container = result.first-&gt;second; <span class="comment">// That&#39;s a tongue twister</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> &amp;&amp; container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#af01372623d442be1a7edde160653cb4e">is_valid_device</a>() )</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                        <span class="comment">// Request its Channel Settings and Values now (if enabled and communicating)</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ae8a24b31c9e5c8ac99f0f14055c5308d">RQST_GET_CHANNEL_SETTINGS</a>, px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ab7dddeda449a68096c6427841bffcf58">RQST_GET_CHANNEL_VALUES</a>, px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                        <span class="comment">// No subscriptions should be entered during the first pass</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abf75a5dfc2411c8d4aca956f6a5afb14">_doing_initial_discovery</a> )</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                        {</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a8ccf655de8fa023eb6ce0f6e243e2089">RQST_SUBSCRIBE_CHANNEL_VALUES</a>, px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">id</a>() );</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                                container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#ab022cc05f8830462e4f2022d4314a682">_channel_values_subscribed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                        }</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                <span class="comment">// Notify our application</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8c213d7dd5c7e101e8beabd4ce832248">_add_device_callback</a> )</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8c213d7dd5c7e101e8beabd4ce832248">_add_device_callback</a>( container );</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        }</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="comment">// Now, deal with the children.</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        <span class="comment">// We will push them onto the request dequeue</span></div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">if</span> ( is_changed &amp;&amp; !px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#a4ade246292d8b52df1b4395087231ad5">sub_devices</a>.empty() )</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 6, <span class="stringliteral">&quot;Queing up %zu child devices&quot;</span>,  px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#a4ade246292d8b52df1b4395087231ad5">sub_devices</a>.size() );</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                <span class="keywordflow">for</span> ( <span class="keyword">auto</span> dev_id : px_device.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#a4ade246292d8b52df1b4395087231ad5">sub_devices</a> )</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                {</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a7e5b30fcce4d8299841858a089502ed3">RQST_GET_DEVICE</a>, dev_id );</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        <span class="keywordflow">return</span> ( is_changed );</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;}</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;<span class="comment">// Given the Value for a Channel (from GetValue request or subscription update),</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;<span class="comment">// save it to our map of channel values.</span></div>
<div class="line"><a name="l00704"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a488561bc6f2b2db3baaf66f5422aba3d">  704</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a488561bc6f2b2db3baaf66f5422aba3d">CCdsHandler::process_channel_value</a>( <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> ch_id, <span class="keyword">const</span> <a class="code" href="../../db/dd9/classpx_1_1CValue.html">px::CValue</a> &amp;value, <span class="keyword">const</span> <a class="code" href="../../d9/d7d/classpx_1_1CWallTime.html">CWallTime</a> &amp;timestamp )</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;{</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        assert( ch_id );</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;        <a class="code" href="../../dc/d33/structpx_1_1asio_1_1CCdsHandler_1_1ch__val__s.html">channel_value_t</a> new_entry;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        new_entry.<a class="code" href="../../dc/d33/structpx_1_1asio_1_1CCdsHandler_1_1ch__val__s.html#a8a3c8ae37d30a089f4c8763724e61cdb">value</a> = value;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        new_entry.<a class="code" href="../../dc/d33/structpx_1_1asio_1_1CCdsHandler_1_1ch__val__s.html#ad869ebb5e167a2dc070346249dcaee34">when</a> = timestamp;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2cc65de2bb61ce9231deb98fb0676845">_channel_map_mutex</a> );</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="keyword">auto</span> pos = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.find( ch_id );</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <span class="keywordflow">if</span> ( pos != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.end() )</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                <a class="code" href="../../db/dd9/classpx_1_1CValue.html">px::CValue</a> old_value( pos-&gt;second.value );</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                pos-&gt;second = new_entry;</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                <span class="keywordflow">return</span> ( old_value != value );</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <span class="comment">// Else, make a new entry and always return True</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>[ch_id] = new_entry;</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="keywordflow">return</span> ( <span class="keyword">true</span> );</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;}</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="comment">// Getter for a CCdsDevice instance in our map, looked up by its Device ID.</span></div>
<div class="line"><a name="l00727"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7b760a8420b8a6ef12d60c3f9c00eaff">  727</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7b760a8420b8a6ef12d60c3f9c00eaff">CCdsHandler::get_map_device</a>( <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> dev_id, <a class="code" href="../../d6/dbb/namespacepx_1_1asio.html#a755f93f6e581023c79c1b07e313ac802">cds_device_map_citer_t</a> &amp;map_pos )<span class="keyword"> const</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        assert( dev_id );</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        <span class="comment">// Call the non-const variety, with a const_cast to &quot;this&quot;</span></div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        <a class="code" href="../../d6/dbb/namespacepx_1_1asio.html#acd6bf8b26abffde39f6859fe50bb37af">cds_device_map_iter_t</a> mutable_map_pos;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="keywordtype">bool</span> bOK = <span class="keyword">const_cast&lt;</span><a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html">CCdsHandler</a> *<span class="keyword">&gt;</span>( this )-&gt;<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a37228ed2d170ccea24335355b09402b0">lookup_map_device</a>( dev_id, mutable_map_pos );</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        <span class="keywordflow">if</span> ( bOK )</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        {</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                map_pos = mutable_map_pos;              <span class="comment">// safely pass to the const iterator</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        }</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        <span class="keywordflow">return</span> ( bOK );</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;}</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;<span class="comment">// Getter for a non-const CCdsDevice instance in our map, looked up by its Device ID.</span></div>
<div class="line"><a name="l00744"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a37228ed2d170ccea24335355b09402b0">  744</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a37228ed2d170ccea24335355b09402b0">CCdsHandler::lookup_map_device</a>( <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> dev_id, <a class="code" href="../../d6/dbb/namespacepx_1_1asio.html#acd6bf8b26abffde39f6859fe50bb37af">cds_device_map_iter_t</a> &amp;map_pos )</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;{</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        assert( dev_id );</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="comment">// Create a unique_lock, but don&#39;t lock the mutex yet</span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        std::unique_lock&lt;std::recursive_mutex&gt; ulock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8f13df8167b9a9bbaf5b8f6d96490ae5">_device_map_mutex</a>, std::defer_lock );</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <span class="keywordflow">if</span> ( ulock.try_lock() )</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                map_pos = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.find( dev_id );</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                <span class="keywordflow">if</span> ( map_pos != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.end() )</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                {</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                        <span class="comment">// LIBPX_DEBUG(8, &quot;Lookup found device in our map: %s&quot;, map_pos-&gt;second._px_device.str().c_str() );</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                        <span class="keywordflow">return</span> ( <span class="keyword">true</span> );</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 2, <span class="stringliteral">&quot;Lookup did not find Device %&quot;</span> PRIu64 <span class="stringliteral">&quot; in our map.&quot;</span>, dev_id );</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                        <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                }</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        }</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 2, <span class="stringliteral">&quot;Could not lock access to device map (was searching for Device %&quot;</span> PRIu64 <span class="stringliteral">&quot;).&quot;</span>, dev_id );</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        }</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;}</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">// Checks if we have the requested Device instance in our map, and if its state is &quot;valid&quot;</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">// (ie, enabled and communicating).</span></div>
<div class="line"><a name="l00775"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0e54ae24cd6e4b943ea7171e97701456">  775</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0e54ae24cd6e4b943ea7171e97701456">CCdsHandler::is_communicating_device</a>( <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> dev_id )<span class="keyword"> const</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        assert( dev_id );</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        <a class="code" href="../../d6/dbb/namespacepx_1_1asio.html#a755f93f6e581023c79c1b07e313ac802">cds_device_map_citer_t</a> map_pos;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7b760a8420b8a6ef12d60c3f9c00eaff">get_map_device</a>( dev_id, map_pos ) )</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                <span class="keywordflow">return</span> ( map_pos-&gt;second.is_valid_device() );</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;        }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="comment">// Else, no such device, at least in our map</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;}</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;<span class="comment">// Function to initialize the Alarm update callbacks.</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;<span class="comment">// The application provides its callback functions which will be invoked</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;<span class="comment">// when an alarm is updated.</span></div>
<div class="line"><a name="l00793"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3447051088e42e33b96e066fb1381f48">  793</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3447051088e42e33b96e066fb1381f48">CCdsHandler::init_alarm_callback</a>( <span class="keyword">const</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a4aec87f0faac56ad5be4175eb454d43a">cds_alarm_callback_t</a> &amp;update_alarm_callback )</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;{</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="comment">// Save the callback</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8dd0c6c7d23ea679678326cefa3464a6">_update_alarm_callback</a> = update_alarm_callback;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;}</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;<span class="comment">// Perform a static discovery of all alarm updates starting at the given global count.</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;<span class="comment">// If alarm update callback has been provided it will call that.</span></div>
<div class="line"><a name="l00803"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad38c9597f35205f25c50107f2d5564d8">  803</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad38c9597f35205f25c50107f2d5564d8">CCdsHandler::do_alarm_discovery</a>( uint64_t starting_global_count )</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;{</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <a class="code" href="../../d1/dc0/classpx_1_1cds_1_1CGetAlarms.html">px::cds::CGetAlarms</a> cds_req;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        cds_req.<a class="code" href="../../d1/dc0/classpx_1_1cds_1_1CGetAlarms.html#aeb2e15718008971cf7dcf119d79807d9">recursive</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        cds_req.<a class="code" href="../../d1/dc0/classpx_1_1cds_1_1CGetAlarms.html#acb61b42d91b8165c368d0720ee0d55f0">start_global_count</a> = starting_global_count;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        cds_req.<a class="code" href="../../d1/dc0/classpx_1_1cds_1_1CGetAlarms.html#adeb35c7c6b484781ff5d685c0a47bb2c">max_result_size</a> = 0;<span class="comment">// unlimited</span></div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        cds_req.<a class="code" href="../../d1/dc0/classpx_1_1cds_1_1CGetAlarms.html#aa838ec7aff2a4ef94834b2d5357e2f8e">populate_str_val</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        std::shared_ptr&lt;px::cds::CGetAlarms&gt; cds_resp = std::dynamic_pointer_cast&lt;<a class="code" href="../../d1/dc0/classpx_1_1cds_1_1CGetAlarms.html">px::cds::CGetAlarms</a>&gt;( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">submit_wait</a>( cds_req ) );</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a5f8a8b6012a3798213d38f323d330867">check_cds_result</a>( cds_resp, <span class="stringliteral">&quot;Alarm Discovery&quot;</span> );</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="comment">// Call callback for each alarm update</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8dd0c6c7d23ea679678326cefa3464a6">_update_alarm_callback</a> != <span class="keyword">nullptr</span> )</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        {</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;                <span class="keywordflow">for</span> ( <span class="keyword">auto</span> &amp;alarm: cds_resp-&gt;alarms )</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8dd0c6c7d23ea679678326cefa3464a6">_update_alarm_callback</a>( alarm );</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;                }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;}</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;</div>
<div class="line"><a name="l00827"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7572741e89c58700cb91b699865c0fa9">  827</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7572741e89c58700cb91b699865c0fa9">CCdsHandler::subscribe_alarm_callback</a>()</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;{</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        <span class="comment">// Get our subscription ID.</span></div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;        <span class="comment">// Make it reflexive to see even alarm changes that we make into the CDS</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <span class="comment">// (ToDo: is reflexive = True right / meaningful ?)</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        std::vector&lt;uint64_t&gt; new_ids = <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a9476cf54a2363a1a646f3769c5fcd3dc">get_subscriber_ids</a>( 1, <span class="keyword">true</span> );</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="comment">// Now save the ID</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a16553da663bf5d4e9d51882bc98fc581">_alarm_sub_id</a> = new_ids[0];</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Alarm subscription ID %&quot;</span> PRIu64, <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a16553da663bf5d4e9d51882bc98fc581">_alarm_sub_id</a> );</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="comment">// Enter the subscriptions</span></div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html">px::cds::CSubscribe</a> sub_req;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="keywordtype">bool</span> is_id_recursive = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a16553da663bf5d4e9d51882bc98fc581">_alarm_sub_id</a>,</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                                                                                                                                   <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841ac75944ab6b9f0d0b27f3765664f88bbe">px::sub::subscription_type::alarm_recursive</a>,</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;                                                                                                                                   <a class="code" href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a>, is_id_recursive ) );</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;        std::shared_ptr&lt;px::cds::CRequestResponse&gt; sub_resp = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">submit_wait</a>( sub_req );</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a5f8a8b6012a3798213d38f323d330867">check_cds_result</a>( sub_resp, <span class="stringliteral">&quot;CSubscribe Alarms&quot;</span> );</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;}</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">// Called by the CDS when one or more unsolicited or solicited responses are ready</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">// for the internal handling by this class, eg, for maintaining the device map.</span></div>
<div class="line"><a name="l00853"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a959ebec907e436ed208793395f8e4cf6">  853</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a959ebec907e436ed208793395f8e4cf6">CCdsHandler::internal_handle_response</a>( std::shared_ptr&lt;px::cds::CRequestResponse&gt; resp )</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;{</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        assert( resp );</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="comment">// Set on entry, clear on exit</span></div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#acc483b564f12d9173bf7369ef89ae42b">_in_callback_guard</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a04a2b0f57c4dee19c0c178f71b7fc146">_last_transaction_id</a> = resp-&gt;transaction_id;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="keywordflow">if</span> ( resp-&gt;is_unsolicited() )</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        {</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 6, <span class="stringliteral">&quot;Unsolicited CDS response - ignored for internal_handle_response().&quot;</span> );</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;        }</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="comment">// If NOT unsolicited, not subscribed - ie, WAS Requested by somebody</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !resp-&gt;is_subscription() )</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;        {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 6, <span class="stringliteral">&quot;In Internal CDS response handler, TransID = %u&quot;</span>, resp-&gt;transaction_id );</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                <span class="keywordflow">if</span> ( resp-&gt;callback_handle == <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a96568e9452f15dcc9ef7d1b7412443ab">_internal_callback_handle</a> )</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                        std::unique_lock&lt;std::recursive_mutex&gt; ulock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aef4cca6cba616dc0dcce8f914f792b83">_awaiting_resps_mutex</a> );</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                        <span class="keyword">auto</span> wt_entry = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.find( resp-&gt;transaction_id );</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                        <span class="keywordflow">if</span> ( wt_entry == <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.end() )</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                        {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                                ulock.unlock();                 <span class="comment">// release the mutex lock now</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                                <span class="comment">// This may be normal, if the CDS fired a response almost instantaneously with our submit()</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                                <span class="comment">// (Previously tried to wait a bit, but since we&#39;re in a callback here, no foreground progress occurs)</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#aedf82e390ea25288cf698a9d9eb470ef">LIBPX_INFO</a>( 3, <span class="stringliteral">&quot;Got a response we weren&#39;t (yet) waiting for: TransID %u&quot;</span>, resp-&gt;transaction_id );</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                                <span class="comment">// Well, alright, let&#39;s give it the old college try anyway.</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                                <span class="comment">// So check and see if this was one of our types (and handle, if found)</span></div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                                <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8a5010e9de4014a5c2ee6ae37b008230">process_response_type</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a7e5b30fcce4d8299841858a089502ed3">RQST_GET_DEVICE</a>, resp ) )</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                                {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                                        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8a5010e9de4014a5c2ee6ae37b008230">process_response_type</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ab7dddeda449a68096c6427841bffcf58">RQST_GET_CHANNEL_VALUES</a>, resp ) )</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                                        {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8a5010e9de4014a5c2ee6ae37b008230">process_response_type</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ae8a24b31c9e5c8ac99f0f14055c5308d">RQST_GET_CHANNEL_SETTINGS</a>, resp );</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                                                <span class="comment">// If that didn&#39;t work, we are out of options</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                                        }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                                }</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                                <span class="comment">// Try to cleanup again; maybe the entry finally showed up?</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                                ulock.lock();</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                                wt_entry = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.find( resp-&gt;transaction_id );</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                                <span class="keywordflow">if</span> ( wt_entry != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.end() )</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                                {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.erase( wt_entry );</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                                }</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                        }</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( resp-&gt;status != <a class="code" href="../../d5/dd5/namespacepx_1_1cds.html#a24c4c8fb05021548bccecd5fa3f2e5feababe2b4a31ed96d73bd4c7d9556e583a">px::cds::RequestStatus::SUCCEEDED</a> )</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                        {</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 2, <span class="stringliteral">&quot;Bad CDS response %s for TransID %u (req_type %u, Device %&quot;</span> PRIu64 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                                                        resp-&gt;get_status_text(), resp-&gt;transaction_id,</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                                                        wt_entry-&gt;second.req_type, wt_entry-&gt;second.dev_id );</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                                <span class="comment">// What else can we do but remove this one; no point in re-requesting</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.erase( wt_entry );</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                        }</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;                        {</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                                <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> dev_id = wt_entry-&gt;second.dev_id;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0">queued_req_type</a> req_type = wt_entry-&gt;second.req_type;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                                <span class="comment">// Safe to remove the map entry now</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.erase( wt_entry );</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                <span class="keywordtype">size_t</span> still_waiting_count = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.size();</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                                ulock.unlock();                 <span class="comment">// release the mutex lock now</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;Handling CDS response TransID %u (req_type %u, Device %&quot;</span> PRIu64 <span class="stringliteral">&quot;)&quot;</span>,</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                                                         resp-&gt;transaction_id, req_type, dev_id );</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8a5010e9de4014a5c2ee6ae37b008230">process_response_type</a>( req_type, resp );</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                <span class="keywordflow">if</span> ( still_waiting_count &gt; 0 )</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                                {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;Still waiting on %zu CDS responses&quot;</span>, still_waiting_count );</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                                }</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                        }</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                        <span class="comment">// Not for us</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 6, <span class="stringliteral">&quot;Ignore CDS response (%u:%u) to request from %s&quot;</span>,</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                                                 resp-&gt;callback_handle, resp-&gt;transaction_id, resp-&gt;session_token.c_str() );</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        <span class="comment">// This is published data for our subscriptions</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        {</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;Internal Handle CDS subscribed response begin&quot;</span> );</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                std::shared_ptr&lt;px::cds::CSubscriberNotify&gt; update =</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                        std::dynamic_pointer_cast&lt;<a class="code" href="../../d7/d07/classpx_1_1cds_1_1CSubscriberNotify.html">px::cds::CSubscriberNotify</a>&gt;( resp );</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                <span class="keywordflow">if</span> ( !update.get() )</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                {</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                        <span class="comment">//the world is not as we know it.</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 3, <span class="stringliteral">&quot;Ignoring invalid subscribed response from CDS&quot;</span> );</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#acc483b564f12d9173bf7369ef89ae42b">_in_callback_guard</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                }</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;Checking CSubscriberNotify type=%u, subscriber=%&quot;</span> PRIu64 <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                                         ( uint8_t ) update-&gt;event, update-&gt;subscriber_id );</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                <span class="comment">// Check against our internal subscriptions</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                <span class="keywordflow">if</span> ( ( update-&gt;subscriber_id == <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a911700a9b460e8f4dd41a4eb82f7355a">_change_signature_sub_id</a> ) ||</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                         ( update-&gt;subscriber_id == <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a624f000e659948bbee10971f0fc9cdee">_add_dev_sub_id</a> ) ||</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                         ( update-&gt;subscriber_id == <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa45851ad0ebfa7541cab7a1f739b4e18">_dev_state_sub_id</a> ) ||</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                         ( update-&gt;subscriber_id == <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3fb9eb8b97a409c3d27c370afcdf993">_ch_values_sub_id</a> ) ||</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                         ( update-&gt;subscriber_id == <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a16553da663bf5d4e9d51882bc98fc581">_alarm_sub_id</a> ) )</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                        <span class="comment">// This function might queue up more device IDs</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a27bb935ae2e5a5a0dbcefdc69e9ae947">process_subscription_update</a>( update );</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                {</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                        <span class="comment">// Since we see any subscription updates, this one might have been intended for</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                        <span class="comment">// the application&#39;s handle_response() and not us</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 9, <span class="stringliteral">&quot;No internal (CdsHandler) subscribers matching %&quot;</span> PRIu64 <span class="stringliteral">&quot;.&quot;</span>,</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                                                 update-&gt;subscriber_id );</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                }</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;        }</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        <span class="comment">// See if we have more to process, submitting requests for their data</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;        <span class="comment">// ToDo: give each client a timeout actor (like iot_agent has) that can be used to make this call</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="comment">//       more reliably than here in this callback.</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a4184f2136532243984b5ceb61d0d76c0">check_request_queue</a>();  <span class="comment">// ToDo: prefer not to call this within this callback</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        <span class="comment">// Now clear our guard flag</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#acc483b564f12d9173bf7369ef89ae42b">_in_callback_guard</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;}</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">// (Attempt to) Process a CDS response of the given request type.</span></div>
<div class="line"><a name="l00980"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8a5010e9de4014a5c2ee6ae37b008230">  980</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8a5010e9de4014a5c2ee6ae37b008230">CCdsHandler::process_response_type</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0">queued_req_type</a> exp_req_type, std::shared_ptr&lt;px::cds::CRequestResponse&gt; resp )</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;{</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        assert( resp );</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;        <span class="keywordtype">bool</span> is_handled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        <span class="comment">// First, a quick check to make sure we should proceed</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a52ae66ba371f37cbcb7a33d0cdec38cc">ok_to_proceed</a>() )</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                <span class="keywordflow">return</span> ( is_handled );</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        }</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        <span class="keywordflow">switch</span> ( exp_req_type )</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        {</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a7e5b30fcce4d8299841858a089502ed3">RQST_GET_DEVICE</a>:</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                        {</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                                <span class="comment">// See if we got back Device data</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                                std::shared_ptr&lt;px::cds::CGetDevice&gt; dev_resp =</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                                        std::dynamic_pointer_cast&lt;<a class="code" href="../../dc/d8a/classpx_1_1cds_1_1CGetDevice.html">px::cds::CGetDevice</a>&gt;( resp );</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                                <span class="keywordflow">if</span> ( dev_resp.get() )</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                                {</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                                        <span class="comment">// Probably only one device, but process as a loop anyway</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                                        <span class="keywordflow">for</span> ( <span class="keyword">const</span> <a class="code" href="../../d6/d5b/classpx_1_1CDevice.html">px::CDevice</a> &amp;device : dev_resp-&gt;devices )</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                                        {</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;                                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2006f4f4d69f866827c8585cb3d7d09b">process_device_data</a>( device );</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                                        }</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                                        is_handled = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;                                }</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;                        }</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ab7dddeda449a68096c6427841bffcf58">RQST_GET_CHANNEL_VALUES</a>:</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;                        {</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                                <span class="comment">// See if we got back Channel Value data</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                                std::shared_ptr&lt;px::cds::CGetChannelValue&gt; chv_resp =</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                                        std::dynamic_pointer_cast&lt;<a class="code" href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html">px::cds::CGetChannelValue</a>&gt;( resp );</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                                <span class="keywordflow">if</span> ( chv_resp.get() )</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                                {</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                                        <span class="keywordflow">for</span> ( <span class="keyword">const</span> <a class="code" href="../../d6/da7/classpx_1_1cds_1_1CGetSingleChannelValue.html">px::cds::CGetSingleChannelValue</a> &amp;ch_value : chv_resp-&gt;values )</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                                        {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a488561bc6f2b2db3baaf66f5422aba3d">process_channel_value</a>( ch_value.<a class="code" href="../../d6/da7/classpx_1_1cds_1_1CGetSingleChannelValue.html#a9da03c004f44d0a9d614e6774e3deaeb">id</a>, ch_value.<a class="code" href="../../d6/da7/classpx_1_1cds_1_1CGetSingleChannelValue.html#a61e877b4df6690a39d7ac9673b6dbf0e">value</a>, ch_value.<a class="code" href="../../d6/da7/classpx_1_1cds_1_1CGetSingleChannelValue.html#a3c8207a636f7571a426849c1b4d1d6ed">when</a> );</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                                        }</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                                        <span class="comment">// We&#39;ll make the simple assumption that this request was made with the Device ID</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                                        <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> dev_id = chv_resp-&gt;ids[0];</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;Processed %zu Channel Values for (Device) %&quot;</span> PRIu64 <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                                                                 chv_resp-&gt;values.size(), dev_id );</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                                        is_handled = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                                        <span class="comment">// Mark the channel data as received for this Device&#39;s container</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                                        <a class="code" href="../../d6/dbb/namespacepx_1_1asio.html#acd6bf8b26abffde39f6859fe50bb37af">cds_device_map_iter_t</a> mutable_map_pos;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                                        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a37228ed2d170ccea24335355b09402b0">lookup_map_device</a>( dev_id, mutable_map_pos ) )</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                                        {</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                                                mutable_map_pos-&gt;second._channel_values_received = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                                        }</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                                }</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                        }</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ae8a24b31c9e5c8ac99f0f14055c5308d">RQST_GET_CHANNEL_SETTINGS</a>:</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                        {</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                                <span class="comment">// See if we got back Channel Settings data and have a callback to handle it</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                                std::shared_ptr&lt;px::cds::CGetChannelSettings&gt; chs_resp =</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                                        std::dynamic_pointer_cast&lt;<a class="code" href="../../de/dab/classpx_1_1cds_1_1CGetChannelSettings.html">px::cds::CGetChannelSettings</a>&gt;( resp );</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                                <span class="keywordflow">if</span> ( chs_resp.get() &amp;&amp; <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ada543e79f572842d093be4a33ee058a7">_channel_settings_callback</a> )</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                                {</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                                        <span class="comment">// We&#39;ll make the simple assumption that this request was made with the Device ID</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                                        <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> dev_id = chs_resp-&gt;<a class="code" href="../../de/dab/classpx_1_1cds_1_1CGetChannelSettings.html#a9f57e428683c3eb02eb104d36adbfa32">ids</a>[0];</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 1, <span class="stringliteral">&quot;Processing %zu Channel Settings for (Device) %&quot;</span> PRIu64 <span class="stringliteral">&quot;, first of %zu IDs&quot;</span>,</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                                                                 chs_resp-&gt;channels.size(), dev_id, chs_resp-&gt;ids.size() );</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                                        <span class="comment">// Note the count of channel settings received for this Device&#39;s container</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                                        <a class="code" href="../../d6/dbb/namespacepx_1_1asio.html#acd6bf8b26abffde39f6859fe50bb37af">cds_device_map_iter_t</a> mutable_map_pos;</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                                        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a37228ed2d170ccea24335355b09402b0">lookup_map_device</a>( dev_id, mutable_map_pos ) )</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                                        {</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                                                mutable_map_pos-&gt;second._channel_settings_count = chs_resp-&gt;channels.size();</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                                                <span class="comment">// Now give the callback both the container for this device and its ChannelSettings data</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ada543e79f572842d093be4a33ee058a7">_channel_settings_callback</a>( mutable_map_pos-&gt;second, chs_resp-&gt;channels );</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                                        }</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                                }</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                                is_handled = chs_resp.get();<span class="comment">// return True even if no callback to handle (?)</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                        }</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 1, <span class="stringliteral">&quot;No handler for CDS request type %u (TransID %u)&quot;</span>,</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                                                exp_req_type, resp-&gt;transaction_id );</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        }</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <span class="keywordflow">return</span> ( is_handled );</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;}</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">// Given a subscribed update event, process its contents.</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a27bb935ae2e5a5a0dbcefdc69e9ae947"> 1073</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a27bb935ae2e5a5a0dbcefdc69e9ae947">CCdsHandler::process_subscription_update</a>( std::shared_ptr&lt;px::cds::CSubscriberNotify&gt; update )</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;{</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        assert( update );</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="keywordflow">switch</span> ( update-&gt;event )</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        {</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841aed9c52e870141df9c25b8e97263a19d0">px::sub::subscription_type::change_signature</a>:</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Processing %zu change signature updates&quot;</span>, update-&gt;change_sigs.size() );</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                        <span class="keywordflow">for</span> ( <span class="keyword">auto</span> &amp;change_pair : update-&gt;change_sigs )</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                        {</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                                <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> changed_dev_id = change_pair.first;</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a7e5b30fcce4d8299841858a089502ed3">RQST_GET_DEVICE</a>, changed_dev_id );</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                                <span class="comment">// Seems best to re-request the channel data as well, though it may not have changed</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ab7dddeda449a68096c6427841bffcf58">RQST_GET_CHANNEL_VALUES</a>, changed_dev_id );</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ae8a24b31c9e5c8ac99f0f14055c5308d">RQST_GET_CHANNEL_SETTINGS</a>, changed_dev_id );</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                                <span class="comment">// But not the subscription to channel Value updates, as that should still be good</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Updated change_signature for Device %&quot;</span> PRIu64 <span class="stringliteral">&quot; = %&quot;</span> PRIu64 <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                                                         changed_dev_id, change_pair.second );</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                        }</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841ab6abbfb7c6c6e9ca809dea2537ee2c90">px::sub::subscription_type::device_create_recursive</a>:</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Processing %zu added devices&quot;</span>, update-&gt;device_settings.size() );</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                        <span class="keywordflow">for</span> ( <span class="keyword">auto</span> &amp;new_pair : update-&gt;device_settings )</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                        {</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                                <span class="comment">// px::id_t dev_id = new_pair.first;</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2006f4f4d69f866827c8585cb3d7d09b">process_device_data</a>( new_pair.second );         <span class="comment">// This will take care of adding it</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                                <span class="comment">//LIBPX_DEBUG(8, &quot;Dump of Added Device: %s&quot;, new_pair.second.str().c_str() );</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                        }</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a6173fabae619ef4770b698d998e2ea6f">px::sub::subscription_type::device_delete_recursive</a>:</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                        {</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Processing %zu deleted devices&quot;</span>, update-&gt;deleted_devices.size() );</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                                <span class="keywordflow">for</span> ( <span class="keyword">auto</span> dev_id : update-&gt;deleted_devices )</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                                {</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                                        <span class="comment">// Notify our application first, then remove from our map</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                                        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0e35161a3e9f1c5a204a396efff80ecb">_delete_device_callback</a> )</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                                        {</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0e35161a3e9f1c5a204a396efff80ecb">_delete_device_callback</a>( dev_id );</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                                        }</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                                        <span class="comment">// Delete our copy of the Channel data</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                                        <a class="code" href="../../d6/dbb/namespacepx_1_1asio.html#a755f93f6e581023c79c1b07e313ac802">cds_device_map_citer_t</a> map_pos;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                                        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> &amp;&amp; <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7b760a8420b8a6ef12d60c3f9c00eaff">get_map_device</a>( dev_id, map_pos ) )</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                                        {</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                                                std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2cc65de2bb61ce9231deb98fb0676845">_channel_map_mutex</a> );</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                                                <span class="keywordflow">for</span> ( <span class="keyword">const</span> <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> &amp;ch_id : map_pos-&gt;second._px_device.channels )</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                                                {</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                                                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.erase( ch_id );</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                                                }</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                                        }</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                                        {</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                                                std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8f13df8167b9a9bbaf5b8f6d96490ae5">_device_map_mutex</a> );</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.erase( dev_id );</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                                        }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                                }</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                        }</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a139ee1f327cb1d7e4748baced02f8e60">px::sub::subscription_type::device_settings</a>:</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Processing %zu updated devices&quot;</span>, update-&gt;device_settings.size() );</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                        <span class="keywordflow">for</span> ( <span class="keyword">auto</span> &amp;dev_pair : update-&gt;device_settings )</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                        {</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                                <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> dev_id = dev_pair.first;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                                <span class="comment">// See if it is already in our map (should be!)</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                                std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8f13df8167b9a9bbaf5b8f6d96490ae5">_device_map_mutex</a> );</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                                <span class="keyword">auto</span> pos = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.find( dev_id );</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                                <span class="keywordflow">if</span> ( <a class="code" href="../../dd/d3a/common_8hpp.html#a217a0bd562b98ae8c2ffce44935351e1">likely</a>( pos != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.end() ) )</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                                {</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                                        <a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html">px::asio::CCdsDevice</a> &amp;container = pos-&gt;second;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                                        <span class="comment">// Update the Device data (copying the class instance data)</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                                        container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#aad9dd7ebc8ea00d8b047239e4e0730e2">_px_device</a> = dev_pair.second;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                                        <span class="comment">//LIBPX_DEBUG(8, &quot;Dump of Updated Device: %s&quot;, container._px_device.str().c_str() );</span></div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                                        lock.unlock();          <span class="comment">// Don&#39;t continue to hold the lock</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                                        <span class="comment">// Notify our application</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                                        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a97d7549acfc26ffd2dc51dc7bcbdeb07">_update_device_callback</a> )</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                                        {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a97d7549acfc26ffd2dc51dc7bcbdeb07">_update_device_callback</a>( container );</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                                        }</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                                }</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                                {</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                                        <span class="comment">// The event says its updated, but not in our map.</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                                        <span class="comment">// Hmmm. Let&#39;s queue it up to be checked later.</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a7e5b30fcce4d8299841858a089502ed3">RQST_GET_DEVICE</a>, dev_id );</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                                }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                        }</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a68aae5477ac1dcccc5bcb6ac4e5b7e7e">px::sub::subscription_type::device_state</a>:</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a29b57489abff7736fc2f1860190a1efd">px::sub::subscription_type::device_state_recursive</a>:</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Processing %zu device state changes&quot;</span>, update-&gt;realtime_states.size() );</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                        <span class="keywordflow">for</span> ( <span class="keyword">auto</span> &amp;state_pair : update-&gt;realtime_states )</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;                        {</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                                <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> dev_id = state_pair.first;</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                                std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8f13df8167b9a9bbaf5b8f6d96490ae5">_device_map_mutex</a> );</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;                                <span class="comment">// See if it is already in our map (should be!)</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                                <span class="keyword">auto</span> pos = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.find( dev_id );</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                                <span class="keywordflow">if</span> ( <a class="code" href="../../dd/d3a/common_8hpp.html#a217a0bd562b98ae8c2ffce44935351e1">likely</a>( pos != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">_cds_device_map</a>.end() ) )</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;                                {</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                                        <a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html">px::asio::CCdsDevice</a> &amp;container = pos-&gt;second;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                                        <span class="comment">// Get the Device&#39;s state data before this update</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                                        <a class="code" href="../../dd/d57/classpx_1_1CBitset.html">px::CBitset&lt;px::realtime_state&gt;</a> prior_states = container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#aad9dd7ebc8ea00d8b047239e4e0730e2">_px_device</a>.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#abfc55a39e8c96431ef6588a56869ea71">get_state</a>();</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                                        <span class="comment">// Update our copy.  Inherited state is factored into the &quot;own&quot; state</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                                        <span class="comment">// in this update, so clear the inherited state.</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                                        <a class="code" href="../../dd/d57/classpx_1_1CBitset.html">px::CBitset&lt;px::realtime_state&gt;</a> inherited_state;<span class="comment">// cleared state</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                                        container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#aad9dd7ebc8ea00d8b047239e4e0730e2">_px_device</a>.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#af415b4387c92c27e7c05585954a754a7">set_inherited_state</a>( inherited_state );</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                                        container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#aad9dd7ebc8ea00d8b047239e4e0730e2">_px_device</a>.<a class="code" href="../../d6/d5b/classpx_1_1CDevice.html#a806bd549a06559074ccae14be9afd925">set_state</a>( state_pair.second );</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                                        lock.unlock();          <span class="comment">// Don&#39;t continue to hold the lock</span></div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                                        <span class="comment">// Notify our application</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                                        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0326c84fc1ea91666cd775c6db751382">_device_state_callback</a> )</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;                                        {</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0326c84fc1ea91666cd775c6db751382">_device_state_callback</a>( container );</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                                        }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                                        <span class="comment">// Now, if we just changed to enabled and communicating:</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                                        <span class="keywordflow">if</span> ( !state_pair.second.get( <a class="code" href="../../de/dcb/namespacepx.html#a60cb4a870ad1ada57e20d9e76de5578ca075ae3d2fc31640504f814f60e5ef713">px::realtime_state::disabled</a> ) &amp;&amp;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                                                 !state_pair.second.get( <a class="code" href="../../de/dcb/namespacepx.html#a60cb4a870ad1ada57e20d9e76de5578ca0c161174c6857de22a3653e43574df78">px::realtime_state::not_communicating</a> ) )</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                                        {</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Device %&quot;</span> PRIu64 <span class="stringliteral">&quot; state is enabled and communicating&quot;</span>, dev_id );</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                                                <span class="keywordflow">if</span> ( ( prior_states.<a class="code" href="../../dd/d57/classpx_1_1CBitset.html#a990ea0e6f3eb03b789d1cd58c74b38f2">get</a>( <a class="code" href="../../de/dcb/namespacepx.html#a60cb4a870ad1ada57e20d9e76de5578ca075ae3d2fc31640504f814f60e5ef713">px::realtime_state::disabled</a> ) ||</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                                                           prior_states.<a class="code" href="../../dd/d57/classpx_1_1CBitset.html#a990ea0e6f3eb03b789d1cd58c74b38f2">get</a>( <a class="code" href="../../de/dcb/namespacepx.html#a60cb4a870ad1ada57e20d9e76de5578ca0c161174c6857de22a3653e43574df78">px::realtime_state::not_communicating</a> ) ) &amp;&amp; <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> )</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                                                {</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                                                        <span class="comment">// Then request the Channel data so we can be sure to have</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                                                        <span class="comment">// the channel objects under this now available device</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                                                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ae8a24b31c9e5c8ac99f0f14055c5308d">RQST_GET_CHANNEL_SETTINGS</a>, dev_id );</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                                                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ab7dddeda449a68096c6427841bffcf58">RQST_GET_CHANNEL_VALUES</a>, dev_id );</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;                                                        <span class="comment">// No subscriptions should be entered during the first pass</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;                                                        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abf75a5dfc2411c8d4aca956f6a5afb14">_doing_initial_discovery</a> &amp;&amp; !container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#ab022cc05f8830462e4f2022d4314a682">_channel_values_subscribed</a> )</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;                                                        {</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                                                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a8ccf655de8fa023eb6ce0f6e243e2089">RQST_SUBSCRIBE_CHANNEL_VALUES</a>, dev_id );</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                                                                container.<a class="code" href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#ab022cc05f8830462e4f2022d4314a682">_channel_values_subscribed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                                                        }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                                                }</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                                        }</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                                        <span class="comment">// Not valid, but is this a recent change from enabled AND communicating?</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ( !prior_states.<a class="code" href="../../dd/d57/classpx_1_1CBitset.html#a990ea0e6f3eb03b789d1cd58c74b38f2">get</a>( <a class="code" href="../../de/dcb/namespacepx.html#a60cb4a870ad1ada57e20d9e76de5578ca075ae3d2fc31640504f814f60e5ef713">px::realtime_state::disabled</a> ) &amp;&amp;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                                                                !prior_states.<a class="code" href="../../dd/d57/classpx_1_1CBitset.html#a990ea0e6f3eb03b789d1cd58c74b38f2">get</a>( <a class="code" href="../../de/dcb/namespacepx.html#a60cb4a870ad1ada57e20d9e76de5578ca0c161174c6857de22a3653e43574df78">px::realtime_state::not_communicating</a> ) ) &amp;&amp; <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> )</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                                        {</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                                                <span class="comment">// Delete our copy of the Channel data since it is presumed not valid now</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                                                <a class="code" href="../../d6/dbb/namespacepx_1_1asio.html#a755f93f6e581023c79c1b07e313ac802">cds_device_map_citer_t</a> map_pos;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                                                <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7b760a8420b8a6ef12d60c3f9c00eaff">get_map_device</a>( dev_id, map_pos ) )</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;                                                {</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                                                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 6, <span class="stringliteral">&quot;Removing %zu of %zu Channel entries from map&quot;</span>,</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                                                                                 map_pos-&gt;second._px_device.channels.size(), <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.size() );</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                                                        std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2cc65de2bb61ce9231deb98fb0676845">_channel_map_mutex</a> );</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                                                        <span class="keywordflow">for</span> ( <span class="keyword">const</span> <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> &amp;ch_id : map_pos-&gt;second._px_device.channels )</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                                                        {</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                                                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.erase( ch_id );</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                                                        }</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                                                }</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                                        }</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;                                }</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                                {</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;                                        <span class="comment">// The event says its updated, but not in our map.</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                                        <span class="comment">// Hmmm. Let&#39;s queue it up to be checked later.</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a7e5b30fcce4d8299841858a089502ed3">RQST_GET_DEVICE</a>, dev_id );</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                                }</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                        }</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841ac657323e6efcc419624555fab7ee5ec3">px::sub::subscription_type::value_update</a>:</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                        {</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;Processing %zu value updates&quot;</span>, update-&gt;channel_values.size() );</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                                std::map&lt;px::id_t, px::CValue&gt; updated_values;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                                <span class="keywordflow">for</span> ( <span class="keyword">auto</span> &amp;ch_value: update-&gt;channel_values )</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                                {</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                                        <span class="keywordtype">bool</span> is_diff = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a488561bc6f2b2db3baaf66f5422aba3d">process_channel_value</a>( ch_value.first, ch_value.second, update-&gt;timestamp );</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                                        <span class="keywordflow">if</span> ( is_diff &amp;&amp; <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7909cedb98efe9b26b6205ac3b7d48e1">_channel_values_callback</a> )</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                                        {</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;                                                <span class="comment">// The application wants to get these updated channel values</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;                                                updated_values.insert( ch_value );</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;                                        }</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                                }</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                                <span class="comment">// When done, if we queued up any updates, send them</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                                <span class="keywordflow">if</span> ( !updated_values.empty() )</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                                {</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7909cedb98efe9b26b6205ac3b7d48e1">_channel_values_callback</a>( updated_values, update-&gt;timestamp );</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                                }</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                        }</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a6486b4e98228b83d4b13d54febe5f170">px::sub::subscription_type::alarm</a>:</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                <span class="keywordflow">case</span> <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841ac75944ab6b9f0d0b27f3765664f88bbe">px::sub::subscription_type::alarm_recursive</a>:</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8dd0c6c7d23ea679678326cefa3464a6">_update_alarm_callback</a> )</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                        {</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Processing %zu alarm updates&quot;</span>, update-&gt;alarms.size() );</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                                <span class="keywordflow">for</span> ( <span class="keyword">auto</span> &amp;alarm: update-&gt;alarms )</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                                {</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                                        <span class="comment">// update local alarms (we don&#39;t keep local yet)</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8dd0c6c7d23ea679678326cefa3464a6">_update_alarm_callback</a>( alarm );</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                                }</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                        }</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;                        {</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;                                <span class="comment">// Maybe CDS was restarted and the alarm subscription lost?</span></div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 2, <span class="stringliteral">&quot;There are %zu alarm updates but no handler for them&quot;</span>, update-&gt;alarms.size() );</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                        }</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;                <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 2, <span class="stringliteral">&quot;Unhandled Subscription Update event, type=%u&quot;</span>, ( uint8_t ) update-&gt;event );</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;        }</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;}</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="comment">/* Add the given message type and Device ID to our queue of messages to be processed,</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="comment"> * unless it is already in that queue. */</span></div>
<div class="line"><a name="l01283"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93"> 1283</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">CCdsHandler::add_msg_to_rqst_queue</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0">queued_req_type</a> msg_type, <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> dev_id )</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;{</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        assert( dev_id );</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;        <span class="comment">// First, a screen: don&#39;t add ChannelSettings requests unless we have the callback</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        <span class="comment">// and don&#39;t add any Channel-type requests unless we want channels</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <span class="keywordflow">if</span> ( ( msg_type != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a7e5b30fcce4d8299841858a089502ed3">RQST_GET_DEVICE</a> ) &amp;&amp; !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> )</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        {</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;No requests for Channel data (type %u) desired.&quot;</span>, msg_type );</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        }</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        <span class="keywordflow">if</span> ( ( msg_type == <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ae8a24b31c9e5c8ac99f0f14055c5308d">RQST_GET_CHANNEL_SETTINGS</a> ) &amp;&amp; !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ada543e79f572842d093be4a33ee058a7">_channel_settings_callback</a> )</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        {</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;No callback to receive ChannelSettings&quot;</span> );</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        }</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        std::unique_lock&lt;std::recursive_mutex&gt; ulock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5fa6628b70d41ed6fe65199fbaa2092d">_reqst_queue_mutex</a> );</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        <span class="keyword">auto</span> pentry = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3d74e802843cf6efac6b7ac6cc9d7263">_reqst_queue</a>.begin();</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;        <span class="keywordflow">while</span> ( pentry != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3d74e802843cf6efac6b7ac6cc9d7263">_reqst_queue</a>.end() )</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        {</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;                <span class="keywordflow">if</span> ( ( pentry-&gt;dev_id == dev_id ) &amp;&amp; ( pentry-&gt;req_type == msg_type ) )</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;                {</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 2, <span class="stringliteral">&quot;Already had a queued up request for msg_type %d for device %&quot;</span> PRIu64 <span class="stringliteral">&quot;&quot;</span>, msg_type, dev_id );</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 2, <span class="stringliteral">&quot;Reporting %zu requests, this one for msg_type %d for device %&quot;</span> PRIu64 <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;                                                 <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3d74e802843cf6efac6b7ac6cc9d7263">_reqst_queue</a>.size(), pentry-&gt;req_type, pentry-&gt;dev_id );</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;                }</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;                ++pentry;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        }</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;        <span class="comment">// If this message was not already queued up:</span></div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;        <span class="keywordflow">if</span> ( pentry == <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3d74e802843cf6efac6b7ac6cc9d7263">_reqst_queue</a>.end() )</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        {</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;                <a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html">queued_req_t</a> entry;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;                entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#abfa749fe99c164d725c66c94bfbe35ab">dev_id</a> = dev_id;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;                entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#a55fa5a32af82f5d7f0b4895a3e075e81">req_type</a> = msg_type;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;                entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#a8195950e2532284fc8b784b221ffb886">awaiting_timeout</a> = 0;                     <span class="comment">// this field is not used in _reqst_queue</span></div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3d74e802843cf6efac6b7ac6cc9d7263">_reqst_queue</a>.push_back( entry );</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;                <span class="keywordflow">return</span> ( <span class="keyword">true</span> );</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        }</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;        {</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        }</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;}</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;<span class="comment">// See if there is an entry available in our queue of message requests,</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;<span class="comment">// and, if so, send the request for its CDS data.</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a4184f2136532243984b5ceb61d0d76c0"> 1334</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a4184f2136532243984b5ceb61d0d76c0">CCdsHandler::check_request_queue</a>()</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;{</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.empty() )</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;        {</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;                <span class="comment">/* We choose not to make another request yet while a previous one is pending.</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">                 * This state might arise if we get an unsolicited callback while</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">                 * waiting for a CDS response.</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">                 * But check first to see if any have timed out.*/</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;                <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0b6d96ca49da4118186dc686a98622d8">check_awaiting_timeouts</a>() )</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;                {</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                        <span class="keywordflow">return</span> ( <span class="keyword">true</span> );</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                }</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;        }</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        <span class="comment">// Keep processing until we are either done or have made the requests that we want</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <span class="comment">// Since all these requests can be made from just the Device ID, we</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;        <span class="comment">// don&#39;t have to wait for the GetDevice response to be able to form the other requests</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="comment">// Will take a break after sending 4 requests, since that is</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <span class="comment">// normally how many requests that we make for a new device, with Channels</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        <span class="keywordtype">size_t</span> remaining = 4;</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> )          <span class="comment">// But only once if no channel requests</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        {</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;                remaining = 1;</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        }</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <span class="keywordflow">while</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3d74e802843cf6efac6b7ac6cc9d7263">_reqst_queue</a>.empty() &amp;&amp; ( remaining &gt; 0 ) )</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        {</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                std::unique_lock&lt;std::recursive_mutex&gt; ulock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5fa6628b70d41ed6fe65199fbaa2092d">_reqst_queue_mutex</a> );</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;                <span class="comment">// Copy the front entry before popping it off the deque and freeing the mutex</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;                <a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html">queued_req_t</a> rqst_entry = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3d74e802843cf6efac6b7ac6cc9d7263">_reqst_queue</a>.front();</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3d74e802843cf6efac6b7ac6cc9d7263">_reqst_queue</a>.pop_front();               <span class="comment">// now clear this one</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;                ulock.unlock();</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#a8195950e2532284fc8b784b221ffb886">awaiting_timeout</a> = <a class="code" href="../../d5/d4c/classpx_1_1CMonoTime.html#a2272cac8e659fb3fb3260c776369f1e2">px::CMonoTime::now</a>() + <a class="code" href="../../d5/d4c/classpx_1_1CMonoTime.html">px::CMonoTime</a>( 5 );        <span class="comment">// 5s from now is plenty long enough</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                uint32_t trans_id = 0;</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;                <span class="keywordflow">switch</span> ( rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#a55fa5a32af82f5d7f0b4895a3e075e81">req_type</a> )</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                {</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a7e5b30fcce4d8299841858a089502ed3">RQST_GET_DEVICE</a>:</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;                                {</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;                                        <a class="code" href="../../dc/d8a/classpx_1_1cds_1_1CGetDevice.html">px::cds::CGetDevice</a> get_dev;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                                        get_dev.<a class="code" href="../../dc/d8a/classpx_1_1cds_1_1CGetDevice.html#ae6beff875f8f7d70853848c58b870a43">requested_ids</a>.clear();</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;                                        get_dev.<a class="code" href="../../dc/d8a/classpx_1_1cds_1_1CGetDevice.html#ae6beff875f8f7d70853848c58b870a43">requested_ids</a>.push_back( rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#abfa749fe99c164d725c66c94bfbe35ab">dev_id</a> );</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;                                        <span class="comment">// Call the CDS API&#39;s submit() directly and provide the internal callback handle</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;                                        <span class="comment">// so the response comes back to internal_handle_response() instead of handle_response()</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;                                        trans_id = <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#a907410082d34b93630b2f0b0abe44186">submit</a>( get_dev, <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a96568e9452f15dcc9ef7d1b7412443ab">_internal_callback_handle</a> );</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;                                }</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ab7dddeda449a68096c6427841bffcf58">RQST_GET_CHANNEL_VALUES</a>:</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;                                {</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;                                        <a class="code" href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html">px::cds::CGetChannelValue</a> get_ch_vals;</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;                                        get_ch_vals.<a class="code" href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html#ad405a9803aeb3af1240344a2c4b1bd44">ids</a>.clear();</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;                                        <span class="comment">// Instead of the individual channels, just request all using the device ID</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;                                        get_ch_vals.<a class="code" href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html#ad405a9803aeb3af1240344a2c4b1bd44">ids</a>.push_back( rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#abfa749fe99c164d725c66c94bfbe35ab">dev_id</a> );</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;                                        trans_id = <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#a907410082d34b93630b2f0b0abe44186">submit</a>( get_ch_vals, <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a96568e9452f15dcc9ef7d1b7412443ab">_internal_callback_handle</a> );</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;                                }</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ae8a24b31c9e5c8ac99f0f14055c5308d">RQST_GET_CHANNEL_SETTINGS</a>:</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;                                {</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;                                        <a class="code" href="../../de/dab/classpx_1_1cds_1_1CGetChannelSettings.html">px::cds::CGetChannelSettings</a> get_ch_settings;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;                                        get_ch_settings.<a class="code" href="../../de/dab/classpx_1_1cds_1_1CGetChannelSettings.html#a9f57e428683c3eb02eb104d36adbfa32">ids</a>.clear();</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;                                        <span class="comment">// Instead of the individual channels, just request all using the device ID</span></div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;                                        get_ch_settings.<a class="code" href="../../de/dab/classpx_1_1cds_1_1CGetChannelSettings.html#a9f57e428683c3eb02eb104d36adbfa32">ids</a>.push_back( rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#abfa749fe99c164d725c66c94bfbe35ab">dev_id</a> );</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;                                        trans_id = <a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a>()-&gt;<a class="code" href="../../db/db8/classpx_1_1cds_1_1CClient.html#a907410082d34b93630b2f0b0abe44186">submit</a>( get_ch_settings, <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a96568e9452f15dcc9ef7d1b7412443ab">_internal_callback_handle</a> );</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;                                }</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;                        <span class="keywordflow">case</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a8ccf655de8fa023eb6ce0f6e243e2089">RQST_SUBSCRIBE_CHANNEL_VALUES</a>:</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;                                {</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;                                        <a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html">px::cds::CSubscribe</a> sub_req;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                                        <span class="keywordtype">bool</span> is_id_recursive = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;                                        <span class="comment">// Instead of the individual channels, just request all using the device ID</span></div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;                                        sub_req.<a class="code" href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">subscriptions</a>.emplace_back( <a class="code" href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a>( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3fb9eb8b97a409c3d27c370afcdf993">_ch_values_sub_id</a>,</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;                                                                                                                                                                   <a class="code" href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841ac657323e6efcc419624555fab7ee5ec3">px::sub::subscription_type::value_update</a>,</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;                                                                                                                                                                   rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#abfa749fe99c164d725c66c94bfbe35ab">dev_id</a>, is_id_recursive ) );</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;                                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#af206864b870bb26b37f9fc6cd563a88e">submit_forget</a>( sub_req );</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;Made CDS req_type %u for Device %&quot;</span> PRIu64 <span class="stringliteral">&quot;, but no response expected&quot;</span>,</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                                                                 rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#a55fa5a32af82f5d7f0b4895a3e075e81">req_type</a>, rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#abfa749fe99c164d725c66c94bfbe35ab">dev_id</a> );</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;                                }</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a31b08ca1c16e897657509ea114043aba">LIBPX_FWARN</a>( 1, <span class="stringliteral">&quot;Unexpected case %u; dropping.&quot;</span>, rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#a55fa5a32af82f5d7f0b4895a3e075e81">req_type</a> );</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                }</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;                <span class="keywordflow">if</span> ( trans_id != 0 )</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;                {</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;                        <span class="keywordflow">if</span> ( trans_id == <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a04a2b0f57c4dee19c0c178f71b7fc146">_last_transaction_id</a> )</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;                        {</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;                                <span class="comment">// This means that the CDS responded immediately on submit, so nothing now to await.</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 6, <span class="stringliteral">&quot;Already received TransID %u response for Device %&quot;</span> PRIu64, trans_id, rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#abfa749fe99c164d725c66c94bfbe35ab">dev_id</a> );</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;                        }</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;                        {</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;                                <span class="comment">// Save to the map of responses we are waiting for</span></div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                                std::unique_lock&lt;std::recursive_mutex&gt; ulock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aef4cca6cba616dc0dcce8f914f792b83">_awaiting_resps_mutex</a> );</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>[trans_id] = rqst_entry;</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;Made CDS req_type %u for Device %&quot;</span> PRIu64 <span class="stringliteral">&quot;, TransID %u&quot;</span>,</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                                                         rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#a55fa5a32af82f5d7f0b4895a3e075e81">req_type</a>, rqst_entry.<a class="code" href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#abfa749fe99c164d725c66c94bfbe35ab">dev_id</a>, trans_id );</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                        }</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;                }</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;                remaining--;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        }</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        <span class="keywordflow">return</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3d74e802843cf6efac6b7ac6cc9d7263">_reqst_queue</a>.empty() || !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.empty() );</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;}</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;<span class="comment">/* Check the expected responses to see if we are past the time when an async response</span></div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;<span class="comment"> * can be expected to arrive for any; in that case, clear that entry but move it back</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="comment"> * to the end of the request queue. */</span></div>
<div class="line"><a name="l01447"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0b6d96ca49da4118186dc686a98622d8"> 1447</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0b6d96ca49da4118186dc686a98622d8">CCdsHandler::check_awaiting_timeouts</a>()</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;{</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        std::unique_lock&lt;std::recursive_mutex&gt; ulock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aef4cca6cba616dc0dcce8f914f792b83">_awaiting_resps_mutex</a> );</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        <a class="code" href="../../d5/d4c/classpx_1_1CMonoTime.html">px::CMonoTime</a> tnow = <a class="code" href="../../d5/d4c/classpx_1_1CMonoTime.html#a2272cac8e659fb3fb3260c776369f1e2">px::CMonoTime::now</a>();</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <span class="keywordflow">for</span> ( <span class="keyword">auto</span> pentry = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.begin(); pentry != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.end();)</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        {</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;                <span class="keywordflow">if</span> ( tnow &gt; pentry-&gt;second.awaiting_timeout )</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;                {</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 2, <span class="stringliteral">&quot;Timed out request (TransID = %u) for msg_type %d for device %&quot;</span> PRIu64 <span class="stringliteral">&quot;; removing and re-requesting&quot;</span>,</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                                                 pentry-&gt;first, pentry-&gt;second.req_type, pentry-&gt;second.dev_id );</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">add_msg_to_rqst_queue</a>( pentry-&gt;second.req_type, pentry-&gt;second.dev_id );</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                        pentry = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.erase( pentry );</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                }</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;                {</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;                        ++pentry;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;                }</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        }</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;        <span class="keywordflow">return</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">_awaiting_resps</a>.empty() );</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;}</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;<span class="comment">// See cds_handler.hpp for description</span></div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a23956be018c9fba64a7ff3d3d9952208"> 1474</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a23956be018c9fba64a7ff3d3d9952208">CCdsHandler::cds_login</a>()</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;{</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        <a class="code" href="../../dc/d26/classpx_1_1cds_1_1CCdsClientLogin.html">px::cds::CCdsClientLogin</a> cds_req;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        cds_req.<a class="code" href="../../dc/d26/classpx_1_1cds_1_1CCdsClientLogin.html#a00af3c2448a31ece1c0036c4a4ae9c4b">service</a> = <span class="stringliteral">&quot;cdscmd&quot;</span>;             <span class="comment">// a poor default</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        <span class="comment">// Set for no timeouts</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;        cds_req.<a class="code" href="../../dc/d26/classpx_1_1cds_1_1CCdsClientLogin.html#a53937ef73561f7e3fbedd780a162dc48">idle_timeout</a> = cds_req.<a class="code" href="../../dc/d26/classpx_1_1cds_1_1CCdsClientLogin.html#a5b8a5bf99d23d11123ea3ae3ce7ba277">hard_timeout</a> = 0;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        std::shared_ptr&lt;px::cds::CCdsClientLogin&gt; cds_resp =</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;                std::dynamic_pointer_cast&lt;<a class="code" href="../../dc/d26/classpx_1_1cds_1_1CCdsClientLogin.html">px::cds::CCdsClientLogin</a>&gt;( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">submit_wait</a>( cds_req ) );</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        <span class="keywordflow">if</span> ( !cds_resp )</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        {</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a>( <span class="stringliteral">&quot;CCdsClientLogin submit_wait fail&quot;</span> );</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        }</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        <span class="keywordflow">if</span> ( cds_resp-&gt;status != <a class="code" href="../../d5/dd5/namespacepx_1_1cds.html#a24c4c8fb05021548bccecd5fa3f2e5feababe2b4a31ed96d73bd4c7d9556e583a">px::cds::RequestStatus::SUCCEEDED</a> )</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 1, <span class="stringliteral">&quot;CCdsClientLogin(%s) result: %s&quot;</span>, cds_req.<a class="code" href="../../dc/d26/classpx_1_1cds_1_1CCdsClientLogin.html#a00af3c2448a31ece1c0036c4a4ae9c4b">service</a>.c_str(), cds_resp-&gt;get_status_text() );</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                <span class="keywordflow">if</span> ( cds_resp-&gt;status == <a class="code" href="../../d5/dd5/namespacepx_1_1cds.html#a24c4c8fb05021548bccecd5fa3f2e5fea8d4bce8bce5516e3866bd7d15cf71055">px::cds::RequestStatus::FAILED</a> )</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                {</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                        <span class="keywordflow">throw</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a>( <span class="stringliteral">&quot;failure to login to CDS&quot;</span> );</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                }</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;        }</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( !cds_resp-&gt;session_token.empty() &amp;&amp; !cds_resp-&gt;permissions.empty() )</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;        {</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 2, <span class="stringliteral">&quot;CCdsClientLogin returned token %s for perms %s&quot;</span>,</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                                         cds_resp-&gt;session_token.c_str(), <a class="code" href="../../da/dda/namespacepx_1_1permission.html#a7449a16cbcc654759961b6640de7ce33">px::permission::perms_to_short_str</a>( cds_resp-&gt;permissions ).c_str() );</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0a7867d1f3a2a55f28f1356ec071ff5c">_session_token</a> = cds_resp-&gt;session_token;</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aaaa16e727fba39f242dbe12de10ad926">_my_perms</a> = cds_resp-&gt;permissions;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        }</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;        {</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                <span class="comment">// Otherwise:</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 1, <span class="stringliteral">&quot;CCdsClientLogin(%s) failed to get token or permissions&quot;</span>, cds_req.<a class="code" href="../../dc/d26/classpx_1_1cds_1_1CCdsClientLogin.html#a00af3c2448a31ece1c0036c4a4ae9c4b">service</a>.c_str() );</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;        }</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;}</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="comment">// See cds_handler.hpp for description</span></div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abf5e000e20af5dc4b1e7f49299f4c48d"> 1518</a></span>&#160;<span class="keyword">const</span> <a class="code" href="../../de/dcb/namespacepx.html#a7acb13796ae56fe8e773fe781eedd790">px::string</a> &amp;<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abf5e000e20af5dc4b1e7f49299f4c48d">CCdsHandler::get_session_token</a>()</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;{</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0a7867d1f3a2a55f28f1356ec071ff5c">_session_token</a>.empty() )</div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        {</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a23956be018c9fba64a7ff3d3d9952208">cds_login</a>();</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        }</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="keywordflow">return</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0a7867d1f3a2a55f28f1356ec071ff5c">_session_token</a> );</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;}</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment">// Test to see if we have a given permission (privilege), checking</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment">// against the privileges for this CDS client.</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad39ad831e5b51973c5960726b72764bb"> 1529</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad39ad831e5b51973c5960726b72764bb">CCdsHandler::check_permission</a>( <a class="code" href="../../de/dcb/namespacepx.html#aeb85f37e2b5332475a0da66224536220">px::permissions</a> test_perm )</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;{</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aaaa16e727fba39f242dbe12de10ad926">_my_perms</a>.<a class="code" href="../../dd/d57/classpx_1_1CBitset.html#abce11bc695cf4b1dd4bf9cb31e62d919">empty</a>() )</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        {</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                <span class="keywordflow">try</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                {</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a23956be018c9fba64a7ff3d3d9952208">cds_login</a>();</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                }</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;                <span class="keywordflow">catch</span> ( <span class="keyword">const</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a> &amp;x )</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                {</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a001b58f6595b2ecf816ea11fbb58b201">LIBPX_ERR</a>( 0, <span class="stringliteral">&quot;Couldn&#39;t login to CDS: %s; will deny permission.&quot;</span>, x.<a class="code" href="../../d1/d2c/structpx_1_1generic__err.html#ab55d991a1469e98c5d79a27d1b93b4d6">what</a>() );</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                        <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;                }</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;        }</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;        <span class="keywordflow">return</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aaaa16e727fba39f242dbe12de10ad926">_my_perms</a>.<a class="code" href="../../dd/d57/classpx_1_1CBitset.html#a990ea0e6f3eb03b789d1cd58c74b38f2">get</a>( test_perm ) );</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;}</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment">// Retrieve a map of MCL Channel canonical names to their Channel settings.</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a872d5cd1f604695221f38d516530844c"> 1549</a></span>&#160;std::map&lt;px::string, px::CChannelSettings&gt; <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a872d5cd1f604695221f38d516530844c">CCdsHandler::list_channel_settings</a>( <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> dev_id )</div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;{</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        assert( dev_id );</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        std::shared_ptr&lt;px::cds::CGetChannelSettings&gt; ch_resp = <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a360b5622da14b7bef31147de28db63a4">CCdsSyncIO::get_channel_settings</a>( dev_id );</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <span class="keywordflow">if</span> ( !ch_resp.get() )</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        {</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a>( <span class="stringliteral">&quot;CDS error: Failed to get a response for CGetChannelSettings&quot;</span> );</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;        }</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        <span class="keywordflow">if</span> ( ch_resp-&gt;channels.empty() )</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        {</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;                <span class="keywordflow">throw</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a>( <span class="stringliteral">&quot;Failed to retrieve channel settings from CDS.&quot;</span> );</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;        }</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;        std::map&lt;px::string, px::CChannelSettings&gt; retvals;</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        <span class="keywordflow">for</span> ( <span class="keyword">auto</span> &amp;channel : ch_resp-&gt;channels )</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;        {</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;                retvals.emplace( channel.canonical_name, channel );</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;        }</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;        <span class="keywordflow">return</span> ( retvals );</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;}</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;<span class="comment">/* Utility function to get the current Value of a Channel from the CDS.</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment"> * Now using cached data when available to improve performance. */</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a6ef9a92f4828d60f311f463828d88998"> 1577</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a6ef9a92f4828d60f311f463828d88998">CCdsHandler::get_channel_value</a>( <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> channel_id, <a class="code" href="../../db/dd9/classpx_1_1CValue.html">px::CValue</a> &amp;value )</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;{</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        assert( channel_id );</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        <span class="keywordflow">if</span> ( channel_id == 0 )          <span class="comment">// no such Channel; we can exit now</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        {</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;        }</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.empty() )</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        {</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;                std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2cc65de2bb61ce9231deb98fb0676845">_channel_map_mutex</a> );</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;                <span class="keyword">auto</span> ch_pos = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.find( channel_id );</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;                <span class="keywordflow">if</span> ( ch_pos != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.end() )</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;                {</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;                        value = ch_pos-&gt;second.value;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;                        lock.unlock();</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;                        <span class="comment">// One more check: the CDS might have &quot;succeeded&quot; but returned an invalid value</span></div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                        <span class="keywordflow">if</span> ( value.<a class="code" href="../../db/dd9/classpx_1_1CValue.html#a2a46ef72ad52efd0c5b9d88b4cafc21a">type</a>() == <a class="code" href="../../de/dcb/namespacepx.html#acf6770f6d835c0c868d8be96d1771e3fafedb2d84cafe20862cb4399751a8a7e3">px::datatype::invalid</a> )</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;                        {</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 4, <span class="stringliteral">&quot;channel_id (%&quot;</span> PRIu64 <span class="stringliteral">&quot;) has an invalid datatype&quot;</span>, channel_id );</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;                                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;                        }</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;                        {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;get_channel_value(%&quot;</span> PRIu64 <span class="stringliteral">&quot;) returning cached value = %s&quot;</span>, channel_id, value.<a class="code" href="../../db/dd9/classpx_1_1CValue.html#a746a26c3a4970db4ea4f27f30c5d4d9a">as_string</a>().c_str() );</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;                                <span class="keywordflow">return</span> ( <span class="keyword">true</span> );</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;                        }</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;                }</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                <span class="comment">// Else, will proceed with the CDS request</span></div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                <span class="comment">// A warning: a disabled Device still appears to have CDS data, and the CDS request below</span></div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;                <span class="comment">// will succeed when it shouldn&#39;t. Check for device validity before calling this function.</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        }</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        <a class="code" href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html">px::cds::CGetChannelValue</a> gcv_msg;</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        gcv_msg.<a class="code" href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html#ad405a9803aeb3af1240344a2c4b1bd44">ids</a>.push_back( channel_id );</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        std::shared_ptr&lt;px::cds::CGetChannelValue&gt; cds_resp =</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                std::dynamic_pointer_cast&lt;<a class="code" href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html">px::cds::CGetChannelValue</a>&gt;( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">submit_wait</a>( gcv_msg ) );</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a5f8a8b6012a3798213d38f323d330867">check_cds_result</a>( cds_resp, <span class="stringliteral">&quot;CGetChannelValue&quot;</span> );</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        <span class="keywordflow">if</span> ( !cds_resp-&gt;values.empty() &amp;&amp; ( cds_resp-&gt;values[0].id == channel_id ) )</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;        {</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;                <span class="comment">// (If more than one Value returned, you aren&#39;t going to know...)</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                <span class="comment">// Copy the result to be returned.</span></div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                value = cds_resp-&gt;values[0].value;</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                <span class="comment">// One more check: the CDS might have &quot;succeeded&quot; but returned an invalid value</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                <span class="keywordflow">if</span> ( value.<a class="code" href="../../db/dd9/classpx_1_1CValue.html#a2a46ef72ad52efd0c5b9d88b4cafc21a">type</a>() == <a class="code" href="../../de/dcb/namespacepx.html#acf6770f6d835c0c868d8be96d1771e3fafedb2d84cafe20862cb4399751a8a7e3">px::datatype::invalid</a> )</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;                {</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 4, <span class="stringliteral">&quot;CDS GetChannelValue(%&quot;</span> PRIu64 <span class="stringliteral">&quot;) returned Invalid value&quot;</span>, channel_id );</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;                        <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                }</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                {</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;CDS GetChannelValue(%&quot;</span> PRIu64 <span class="stringliteral">&quot;) returning value = %s&quot;</span>, channel_id, value.<a class="code" href="../../db/dd9/classpx_1_1CValue.html#a746a26c3a4970db4ea4f27f30c5d4d9a">as_string</a>().c_str() );</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;                        <span class="keywordflow">return</span> ( <span class="keyword">true</span> );</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                }</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;        }</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        <span class="comment">// Otherwise:</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;}</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;<span class="comment">/* Utility function to get the current Value of a Channel from the CDS.</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;<span class="comment"> * Now using cached data when available to improve performance.</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;<span class="comment"> * Update: also returning the value&#39;s timestamp. */</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a893689858371716bc568cbd2fc9281de"> 1644</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a6ef9a92f4828d60f311f463828d88998">CCdsHandler::get_channel_value</a>( <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> channel_id, <a class="code" href="../../db/dd9/classpx_1_1CValue.html">px::CValue</a> &amp;value, <a class="code" href="../../d9/d7d/classpx_1_1CWallTime.html">CWallTime</a> &amp;timestamp )</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;{</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;        assert( channel_id );</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;        <span class="keywordflow">if</span> ( channel_id == 0 )          <span class="comment">// no such Channel; we can exit now</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        {</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;        }</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;        <span class="keywordflow">if</span> ( !<a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.empty() )</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        {</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2cc65de2bb61ce9231deb98fb0676845">_channel_map_mutex</a> );</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;                <span class="keyword">auto</span> ch_pos = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.find( channel_id );</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                <span class="keywordflow">if</span> ( ch_pos != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.end() )</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                {</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                        value = ch_pos-&gt;second.value;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                        <span class="keywordflow">if</span> ( ch_pos-&gt;second.when &lt; timestamp )</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                        {</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;channel_id (%&quot;</span> PRIu64 <span class="stringliteral">&quot;) has older timestamp&quot;</span>, channel_id );</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;                                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;                        }</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( value.<a class="code" href="../../db/dd9/classpx_1_1CValue.html#a2a46ef72ad52efd0c5b9d88b4cafc21a">type</a>() == <a class="code" href="../../de/dcb/namespacepx.html#acf6770f6d835c0c868d8be96d1771e3fafedb2d84cafe20862cb4399751a8a7e3">px::datatype::invalid</a> )</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;                        {</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                                <span class="comment">// The CDS might have &quot;succeeded&quot; but returned an invalid value</span></div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 4, <span class="stringliteral">&quot;channel_id (%&quot;</span> PRIu64 <span class="stringliteral">&quot;) has an invalid datatype&quot;</span>, channel_id );</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;                                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;                        }</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                        {</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                                timestamp = ch_pos-&gt;second.when;</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 8, <span class="stringliteral">&quot;channel_id (%&quot;</span> PRIu64 <span class="stringliteral">&quot;) has newer timestamp&quot;</span>, channel_id );</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;                                <span class="keywordflow">return</span> ( <span class="keyword">true</span> );</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;                        }</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;                }</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;                <span class="comment">// Else, will proceed with the CDS request</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;                <span class="comment">// A warning: a disabled Device still appears to have CDS data, and the CDS request below</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;                <span class="comment">// will succeed when it shouldn&#39;t. Check for device validity before calling this function.</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        }</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;        <a class="code" href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html">px::cds::CGetChannelValue</a> gcv_msg;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        gcv_msg.<a class="code" href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html#ad405a9803aeb3af1240344a2c4b1bd44">ids</a>.push_back( channel_id );</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;        <span class="keywordflow">try</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;        {</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;                std::shared_ptr&lt;px::cds::CGetChannelValue&gt; cds_resp =</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                        std::dynamic_pointer_cast&lt;<a class="code" href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html">px::cds::CGetChannelValue</a>&gt;( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">submit_wait</a>( gcv_msg ) );</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;                <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a5f8a8b6012a3798213d38f323d330867">check_cds_result</a>( cds_resp, <span class="stringliteral">&quot;CGetChannelValue&quot;</span> );</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;                <span class="keywordflow">if</span> ( !cds_resp-&gt;values.empty() &amp;&amp; ( cds_resp-&gt;values[0].id == channel_id ) )</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;                {</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                        <span class="comment">// (If more than one Value returned, you aren&#39;t going to know...)</span></div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;                        <span class="comment">// Copy the result to be returned.</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;                        value = cds_resp-&gt;values[0].value;</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;                        <span class="keywordflow">if</span> ( cds_resp-&gt;values[0].when &lt; timestamp )</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;                        {</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;channel_id (%&quot;</span> PRIu64 <span class="stringliteral">&quot;) has older timestamp&quot;</span>, channel_id );</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;                                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;                        }</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( value.<a class="code" href="../../db/dd9/classpx_1_1CValue.html#a2a46ef72ad52efd0c5b9d88b4cafc21a">type</a>() == <a class="code" href="../../de/dcb/namespacepx.html#acf6770f6d835c0c868d8be96d1771e3fafedb2d84cafe20862cb4399751a8a7e3">px::datatype::invalid</a> )</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                        {</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                                <span class="comment">// The CDS might have &quot;succeeded&quot; but returned an invalid value</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a>( 4, <span class="stringliteral">&quot;CDS GetChannelValue(%&quot;</span> PRIu64 <span class="stringliteral">&quot;) returned Invalid value&quot;</span>, channel_id );</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                                <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                        }</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;                        {</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                                timestamp = cds_resp-&gt;values[0].when;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                                <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;channel_id (%&quot;</span> PRIu64 <span class="stringliteral">&quot;) has newer timestamp&quot;</span>, channel_id );</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                                <span class="keywordflow">return</span> ( <span class="keyword">true</span> );</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                        }</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                }</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;        }</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <span class="keywordflow">catch</span> ( <span class="keyword">const</span> <a class="code" href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a> &amp; )</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        {</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                <span class="comment">// Message already logged in check_cds_result()</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        }</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <span class="comment">// Otherwise:</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        <span class="keywordflow">return</span> ( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;}</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;<span class="comment">// Utility function to set the current Value of a Channel into the CDS.</span></div>
<div class="line"><a name="l01728"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abed337d829238a87c3495edc8ead96f4"> 1728</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abed337d829238a87c3495edc8ead96f4">CCdsHandler::set_channel_value</a>( <a class="code" href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a> channel_id, <span class="keyword">const</span> <a class="code" href="../../db/dd9/classpx_1_1CValue.html">px::CValue</a> &amp;value )</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;{</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        PUSH_FUNC;</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        assert( channel_id );</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        <span class="comment">// Update the internal map, if enabled</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="keywordflow">if</span> ( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">_want_channels</a> )</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        {</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                <span class="keyword">auto</span> pos = <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.find( channel_id );</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                <span class="keywordflow">if</span> ( pos != <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>.end() )</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;                {</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Caching Channel %&quot;</span> PRIu64 <span class="stringliteral">&quot; value as %s.&quot;</span>, channel_id, value.<a class="code" href="../../db/dd9/classpx_1_1CValue.html#a746a26c3a4970db4ea4f27f30c5d4d9a">as_string</a>().c_str() );</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;                        std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2cc65de2bb61ce9231deb98fb0676845">_channel_map_mutex</a> );</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;                        pos-&gt;second.value = value;</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;                        pos-&gt;second.when = <a class="code" href="../../d9/d7d/classpx_1_1CWallTime.html#a4452bc7e8e4fbb8c976f5763269593e7">px::CWallTime::now</a>();</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                }</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;                {</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                        <span class="comment">// This one hasn&#39;t gotten an entry yet (maybe a write-only channel?)</span></div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;                        <a class="code" href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a>( 5, <span class="stringliteral">&quot;Storing initial Channel %&quot;</span> PRIu64 <span class="stringliteral">&quot; value as %s.&quot;</span>, channel_id, value.<a class="code" href="../../db/dd9/classpx_1_1CValue.html#a746a26c3a4970db4ea4f27f30c5d4d9a">as_string</a>().c_str() );</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;                        <a class="code" href="../../dc/d33/structpx_1_1asio_1_1CCdsHandler_1_1ch__val__s.html">channel_value_t</a> update;</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;                        update.<a class="code" href="../../dc/d33/structpx_1_1asio_1_1CCdsHandler_1_1ch__val__s.html#a8a3c8ae37d30a089f4c8763724e61cdb">value</a> = value;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;                        update.when = <a class="code" href="../../d9/d7d/classpx_1_1CWallTime.html#a4452bc7e8e4fbb8c976f5763269593e7">px::CWallTime::now</a>();</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                        std::unique_lock&lt;std::recursive_mutex&gt; lock( <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2cc65de2bb61ce9231deb98fb0676845">_channel_map_mutex</a> );</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;                        <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">_channel_values</a>[channel_id] = update;</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                }</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        }</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;        <a class="code" href="../../db/df2/classpx_1_1cds_1_1CUpdateChannelValue.html">px::cds::CUpdateChannelValue</a> cds_req;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;        cds_req.<a class="code" href="../../db/df2/classpx_1_1cds_1_1CUpdateChannelValue.html#a574a585ede62fb7e7c36b8daa6d567ac">bypass_validation</a> = <a class="code" href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#af8d5efcbedf3f138017689799ec31c29">_bypass_validation</a>;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;        cds_req.<a class="code" href="../../db/df2/classpx_1_1cds_1_1CUpdateChannelValue.html#aa0f5f0710d5595d207dff8c05e0ad227">updates</a>.emplace_back( <a class="code" href="../../d2/dfb/classpx_1_1cds_1_1CUpdateSingleChannelValue.html">px::cds::CUpdateSingleChannelValue</a>( channel_id, value ) );</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;        cds_req.<a class="code" href="../../db/df2/classpx_1_1cds_1_1CUpdateChannelValue.html#a9b664c078f4f54522c625e0be0b128f2">when</a> = <a class="code" href="../../d9/d7d/classpx_1_1CWallTime.html#a4452bc7e8e4fbb8c976f5763269593e7">px::CWallTime::now</a>();</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;        <span class="keywordflow">try</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        {</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#af206864b870bb26b37f9fc6cd563a88e">submit_forget</a>( cds_req );</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#aedf82e390ea25288cf698a9d9eb470ef">LIBPX_INFO</a>( 4, <span class="stringliteral">&quot;Updated Channel %&quot;</span> PRIu64 <span class="stringliteral">&quot; value to %s.&quot;</span>, channel_id, value.<a class="code" href="../../db/dd9/classpx_1_1CValue.html#a746a26c3a4970db4ea4f27f30c5d4d9a">as_string</a>().c_str() );</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        }</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;        <span class="keywordflow">catch</span> ( <span class="keyword">const</span> std::exception &amp;ex )</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;        {</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;                <span class="comment">// Pretty unlikely failures</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;                <a class="code" href="../../d4/d3d/log_8hpp.html#a001b58f6595b2ecf816ea11fbb58b201">LIBPX_ERR</a>( 1, <span class="stringliteral">&quot;When updating Channel %&quot;</span> PRIu64 <span class="stringliteral">&quot; value to %s: %s&quot;</span>, channel_id, value.<a class="code" href="../../db/dd9/classpx_1_1CValue.html#a746a26c3a4970db4ea4f27f30c5d4d9a">as_string</a>().c_str(), ex.what() );</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;        }</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;}</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="comment">// Default implementation; override to provide functionality.</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"><a class="line" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a52ae66ba371f37cbcb7a33d0cdec38cc"> 1775</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a52ae66ba371f37cbcb7a33d0cdec38cc">CCdsHandler::ok_to_proceed</a>()</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;{</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        <span class="keywordflow">return</span> ( <span class="keyword">true</span> );</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;}</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;}       <span class="comment">// asio</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;}       <span class="comment">// px</span></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a81c6a883af06f5e82ea5b8d465579884"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a81c6a883af06f5e82ea5b8d465579884">px::asio::CCdsHandler::set_oob</a></div><div class="ttdeci">PUBLIC void set_oob(const px::string &amp;tag, const px::proto::toolkitStruct &amp;data, bool persist=false)</div><div class="ttdoc">OOB Related Member Functions. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00271">cds_handler.cpp:271</a></div></div>
<div class="ttc" id="classpx_1_1CMonoTime_html"><div class="ttname"><a href="../../d5/d4c/classpx_1_1CMonoTime.html">px::CMonoTime</a></div><div class="ttdoc">Monotonic time. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da6/mono__time_8hpp_source.html#l00021">mono_time.hpp:21</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_af206864b870bb26b37f9fc6cd563a88e"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#af206864b870bb26b37f9fc6cd563a88e">px::asio::CCdsHandler::submit_forget</a></div><div class="ttdeci">virtual PUBLIC void submit_forget(px::cds::CRequestResponse &amp;req, bool sleep_on_full=false)</div><div class="ttdoc">Submit a request for CDS processing fire and forget style. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00219">cds_handler.cpp:219</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CClient_html_abe5d6aa630878410324758c8b501bab4"><div class="ttname"><a href="../../db/db8/classpx_1_1cds_1_1CClient.html#abe5d6aa630878410324758c8b501bab4">px::cds::CClient::register_unsolicited_callback</a></div><div class="ttdeci">PUBLIC void register_unsolicited_callback(std::shared_ptr&lt; CCallback &gt; callback)</div><div class="ttdoc">Register the callback function to receive unsolicited messages from the CDS. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/client_8cpp_source.html#l00496">client.cpp:496</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CUpdateChannelValue_html_a574a585ede62fb7e7c36b8daa6d567ac"><div class="ttname"><a href="../../db/df2/classpx_1_1cds_1_1CUpdateChannelValue.html#a574a585ede62fb7e7c36b8daa6d567ac">px::cds::CUpdateChannelValue::bypass_validation</a></div><div class="ttdeci">bool bypass_validation</div><div class="ttdoc">Bypass data validation. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4b/update__channel__value_8hpp_source.html#l00128">update_channel_value.hpp:128</a></div></div>
<div class="ttc" id="namespacepx_1_1cds_html_af5c5d93bab566bfc0b74fbab046f8246"><div class="ttname"><a href="../../d5/dd5/namespacepx_1_1cds.html#af5c5d93bab566bfc0b74fbab046f8246">px::cds::CallbackHandle</a></div><div class="ttdeci">uint16_t CallbackHandle</div><div class="ttdoc">Assigned by CDS when callbacks are registered, this identifies where to send responses. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d7c/request__response_8hpp_source.html#l00045">request_response.hpp:45</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a2cc65de2bb61ce9231deb98fb0676845"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2cc65de2bb61ce9231deb98fb0676845">px::asio::CCdsHandler::_channel_map_mutex</a></div><div class="ttdeci">std::recursive_mutex _channel_map_mutex</div><div class="ttdoc">A mutex to protect iterative access or updating of the map of Channel Values. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00919">cds_handler.hpp:919</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CClient_html_ad3a241ca4570471536d3436ee23b3d65"><div class="ttname"><a href="../../db/db8/classpx_1_1cds_1_1CClient.html#ad3a241ca4570471536d3436ee23b3d65">px::cds::CClient::get</a></div><div class="ttdeci">static PUBLIC CClient * get()</div><div class="ttdoc">Static Factory function: constructs if necessary, returns existing instance of CClient otherwise...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/client_8cpp_source.html#l00051">client.cpp:51</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CClient_html_acb54300760c627bee88063465442bd74"><div class="ttname"><a href="../../db/db8/classpx_1_1cds_1_1CClient.html#acb54300760c627bee88063465442bd74">px::cds::CClient::am_i_background_thread</a></div><div class="ttdeci">static PUBLIC bool am_i_background_thread()</div><div class="ttdoc">Static function that checks whether &amp;quot;this&amp;quot; thread is the CDS Client background thread. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/client_8cpp_source.html#l01087">client.cpp:1087</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsSyncIO_html_af8d5efcbedf3f138017689799ec31c29"><div class="ttname"><a href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#af8d5efcbedf3f138017689799ec31c29">px::asio::CCdsSyncIO::_bypass_validation</a></div><div class="ttdeci">bool _bypass_validation</div><div class="ttdoc">If true, bypass CDS data validation when setting channel values. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc6/cds__sync__io_8hpp_source.html#l00715">cds_sync_io.hpp:715</a></div></div>
<div class="ttc" id="classpx_1_1CDevice_html_abfc55a39e8c96431ef6588a56869ea71"><div class="ttname"><a href="../../d6/d5b/classpx_1_1CDevice.html#abfc55a39e8c96431ef6588a56869ea71">px::CDevice::get_state</a></div><div class="ttdeci">PUBLIC px::CBitset&lt; px::realtime_state &gt; get_state() const </div><div class="ttdoc">Return the device&amp;#39;s state, the union of bits set by inherited_state and own_state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dd4/device_8cpp_source.html#l00955">device.cpp:955</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CUpdateChannelValue_html_a9b664c078f4f54522c625e0be0b128f2"><div class="ttname"><a href="../../db/df2/classpx_1_1cds_1_1CUpdateChannelValue.html#a9b664c078f4f54522c625e0be0b128f2">px::cds::CUpdateChannelValue::when</a></div><div class="ttdeci">px::CWallTime when</div><div class="ttdoc">Timestamp of the update, to be returned by px::cds::CGetChannelValue and put into subscription update...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4b/update__channel__value_8hpp_source.html#l00123">update_channel_value.hpp:123</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsSyncIO_html_a5f8a8b6012a3798213d38f323d330867"><div class="ttname"><a href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a5f8a8b6012a3798213d38f323d330867">px::asio::CCdsSyncIO::check_cds_result</a></div><div class="ttdeci">PUBLIC void check_cds_result(const std::shared_ptr&lt; px::cds::CRequestResponse &gt; cds_resp, const char *req_name) const </div><div class="ttdoc">Utility function to check if we got a response, and that the returned CDS Results status is Success...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/cds__sync__io_8cpp_source.html#l00072">cds_sync_io.cpp:72</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetAlarms_html_aeb2e15718008971cf7dcf119d79807d9"><div class="ttname"><a href="../../d1/dc0/classpx_1_1cds_1_1CGetAlarms.html#aeb2e15718008971cf7dcf119d79807d9">px::cds::CGetAlarms::recursive</a></div><div class="ttdeci">bool recursive</div><div class="ttdoc">For devices listed in &amp;quot;ids&amp;quot;, include their children and further descendants? Default = false...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d45/get__alarms_8hpp_source.html#l00133">get_alarms.hpp:133</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetSingleChannelValue_html_a61e877b4df6690a39d7ac9673b6dbf0e"><div class="ttname"><a href="../../d6/da7/classpx_1_1cds_1_1CGetSingleChannelValue.html#a61e877b4df6690a39d7ac9673b6dbf0e">px::cds::CGetSingleChannelValue::value</a></div><div class="ttdeci">CValue value</div><div class="ttdoc">Current value of the channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d89/get__channel__value_8hpp_source.html#l00059">get_channel_value.hpp:59</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CSubscribe_html"><div class="ttname"><a href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html">px::cds::CSubscribe</a></div><div class="ttdoc">Manage subscriptions, to get notified when CDS data objects change. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbb/subscribe_8hpp_source.html#l00137">subscribe.hpp:137</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a8dd0c6c7d23ea679678326cefa3464a6"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8dd0c6c7d23ea679678326cefa3464a6">px::asio::CCdsHandler::_update_alarm_callback</a></div><div class="ttdeci">cds_alarm_callback_t _update_alarm_callback</div><div class="ttdoc">uniquely maps an alarm ID to a px::CAlarmUpdate object </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00913">cds_handler.hpp:913</a></div></div>
<div class="ttc" id="namespacepx_1_1asio_html_a755f93f6e581023c79c1b07e313ac802"><div class="ttname"><a href="../../d6/dbb/namespacepx_1_1asio.html#a755f93f6e581023c79c1b07e313ac802">px::asio::cds_device_map_citer_t</a></div><div class="ttdeci">std::map&lt; px::id_t, CCdsDevice &gt;::const_iterator cds_device_map_citer_t</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00046">cds_handler.hpp:46</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetAlarms_html"><div class="ttname"><a href="../../d1/dc0/classpx_1_1cds_1_1CGetAlarms.html">px::cds::CGetAlarms</a></div><div class="ttdoc">Returns alarms updates in the system (active or both active and historical) according to the ANDing o...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d45/get__alarms_8hpp_source.html#l00023">get_alarms.hpp:23</a></div></div>
<div class="ttc" id="structpx_1_1generic__err_html_ab55d991a1469e98c5d79a27d1b93b4d6"><div class="ttname"><a href="../../d1/d2c/structpx_1_1generic__err.html#ab55d991a1469e98c5d79a27d1b93b4d6">px::generic_err::what</a></div><div class="ttdeci">virtual const char * what() const noexcept</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1e/exception_8hpp_source.html#l00064">exception.hpp:64</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CSetOOBDataUnit_html"><div class="ttname"><a href="../../d6/d60/classpx_1_1cds_1_1CSetOOBDataUnit.html">px::cds::CSetOOBDataUnit</a></div><div class="ttdoc">Encapsulates a unit of OOB data: tag, data, whether data should be persisted to disk or not The API o...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5f/set__oob__data_8hpp_source.html#l00038">set_oob_data.hpp:38</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CClient_html_a4dcbd4ee30cff72e47da46e92b9fc9c2"><div class="ttname"><a href="../../db/db8/classpx_1_1cds_1_1CClient.html#a4dcbd4ee30cff72e47da46e92b9fc9c2">px::cds::CClient::connect</a></div><div class="ttdeci">PUBLIC bool connect(bool wait=false, px::string source_name=px::string(&quot;unknown&quot;), uint32_t request_queue_size=4194304, uint32_t response_queue_size=4194304)</div><div class="ttdoc">Establish a connection to the CDS. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/client_8cpp_source.html#l00065">client.cpp:65</a></div></div>
<div class="ttc" id="log_8hpp_html_a87e1fdf1ba293b942ef6f9a1d51e6f3f"><div class="ttname"><a href="../../d4/d3d/log_8hpp.html#a87e1fdf1ba293b942ef6f9a1d51e6f3f">LIBPX_WARN</a></div><div class="ttdeci">#define LIBPX_WARN(__VLVL__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3d/log_8hpp_source.html#l00184">log.hpp:184</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_ada543e79f572842d093be4a33ee058a7"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ada543e79f572842d093be4a33ee058a7">px::asio::CCdsHandler::_channel_settings_callback</a></div><div class="ttdeci">cds_ch_settings_callback_t _channel_settings_callback</div><div class="ttdoc">The callback function to the application to let it handle the response to a CGetChannelSettings reque...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00825">cds_handler.hpp:825</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a872d5cd1f604695221f38d516530844c"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a872d5cd1f604695221f38d516530844c">px::asio::CCdsHandler::list_channel_settings</a></div><div class="ttdeci">PUBLIC std::map&lt; px::string, px::CChannelSettings &gt; list_channel_settings(px::id_t dev_id)</div><div class="ttdoc">Retrieve a map of MCL Channel canonical names to their Channel settings. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l01549">cds_handler.cpp:1549</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a5e678922f96c39b1076791cf66354c93"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5e678922f96c39b1076791cf66354c93">px::asio::CCdsHandler::add_msg_to_rqst_queue</a></div><div class="ttdeci">bool add_msg_to_rqst_queue(queued_req_type msg_type, px::id_t dev_id)</div><div class="ttdoc">Add the given message type and Device ID to our queue of messages to be processed, unless it is already in that queue. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l01283">cds_handler.cpp:1283</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_ad38c9597f35205f25c50107f2d5564d8"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad38c9597f35205f25c50107f2d5564d8">px::asio::CCdsHandler::do_alarm_discovery</a></div><div class="ttdeci">PUBLIC void do_alarm_discovery(uint64_t starting_global_count=0)</div><div class="ttdoc">Perform a static discovery of all alarm updates starting at the given sequence ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00803">cds_handler.cpp:803</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a8a5010e9de4014a5c2ee6ae37b008230"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8a5010e9de4014a5c2ee6ae37b008230">px::asio::CCdsHandler::process_response_type</a></div><div class="ttdeci">bool process_response_type(queued_req_type exp_req_type, std::shared_ptr&lt; px::cds::CRequestResponse &gt; resp)</div><div class="ttdoc">(Attempt to) Process a CDS response of the given request type. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00980">cds_handler.cpp:980</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetDevice_html_ae6beff875f8f7d70853848c58b870a43"><div class="ttname"><a href="../../dc/d8a/classpx_1_1cds_1_1CGetDevice.html#ae6beff875f8f7d70853848c58b870a43">px::cds::CGetDevice::requested_ids</a></div><div class="ttdeci">std::vector&lt; px::id_t &gt; requested_ids</div><div class="ttdoc">The device IDs to query. Default = 1 (the publisher / root device). </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dc8/get__device_8hpp_source.html#l00067">get_device.hpp:67</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsDevice_html_aad9dd7ebc8ea00d8b047239e4e0730e2"><div class="ttname"><a href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#aad9dd7ebc8ea00d8b047239e4e0730e2">px::asio::CCdsDevice::_px_device</a></div><div class="ttdeci">px::CDevice _px_device</div><div class="ttdoc">A local copy of the latest px::CDevice data. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da3/cds__device_8hpp_source.html#l00054">cds_device.hpp:54</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a96568e9452f15dcc9ef7d1b7412443ab"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a96568e9452f15dcc9ef7d1b7412443ab">px::asio::CCdsHandler::_internal_callback_handle</a></div><div class="ttdeci">px::cds::CallbackHandle _internal_callback_handle</div><div class="ttdoc">If set, this is the handle we got from the CDS when we registered our internal callback for submit() ...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00877">cds_handler.hpp:877</a></div></div>
<div class="ttc" id="subscribe_8hpp_html"><div class="ttname"><a href="../../d9/dbb/subscribe_8hpp.html">subscribe.hpp</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html">px::asio::CCdsHandler</a></div><div class="ttdoc">ABC for CDS Handler, provides a common synchronous/asynchronous interface to the CDS API...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00072">cds_handler.hpp:72</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetDevice_html"><div class="ttname"><a href="../../dc/d8a/classpx_1_1cds_1_1CGetDevice.html">px::cds::CGetDevice</a></div><div class="ttdoc">Get list of devices from the CDS. </div><div class="ttdef"><b>Definition:</b> <a href="../../dc/dc8/get__device_8hpp_source.html#l00026">get_device.hpp:26</a></div></div>
<div class="ttc" id="classpx_1_1CDevice_html_a806bd549a06559074ccae14be9afd925"><div class="ttname"><a href="../../d6/d5b/classpx_1_1CDevice.html#a806bd549a06559074ccae14be9afd925">px::CDevice::set_state</a></div><div class="ttdeci">PUBLIC void set_state(const px::CBitset&lt; px::realtime_state &gt; &amp;st)</div><div class="ttdoc">Set the device&amp;#39;s own_state. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dd4/device_8cpp_source.html#l00966">device.cpp:966</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandlerCallback_html"><div class="ttname"><a href="../../da/d72/classpx_1_1asio_1_1CCdsHandlerCallback.html">px::asio::CCdsHandlerCallback</a></div><div class="ttdoc">An even simpler callback handler, without ASIO, which will invoke the px::asio::CCdsHandler::internal...</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d86/cds__connection__callback_8hpp_source.html#l00073">cds_connection_callback.hpp:73</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a1490c8cfafb707940563675d474c1752"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1490c8cfafb707940563675d474c1752">px::asio::CCdsHandler::_submit_wait_count</a></div><div class="ttdeci">unsigned int _submit_wait_count</div><div class="ttdoc">A simple up-counter for each call to submit_wait(). </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00923">cds_handler.hpp:923</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a0b6d96ca49da4118186dc686a98622d8"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0b6d96ca49da4118186dc686a98622d8">px::asio::CCdsHandler::check_awaiting_timeouts</a></div><div class="ttdeci">bool check_awaiting_timeouts()</div><div class="ttdoc">Check the expected responses to see if we are past the time when an async response can be expected to...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l01447">cds_handler.cpp:1447</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsDevice_html_ab022cc05f8830462e4f2022d4314a682"><div class="ttname"><a href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#ab022cc05f8830462e4f2022d4314a682">px::asio::CCdsDevice::_channel_values_subscribed</a></div><div class="ttdeci">bool _channel_values_subscribed</div><div class="ttdoc">Flag to note when we have subscribed to the Channel Values for this Device. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da3/cds__device_8hpp_source.html#l00065">cds_device.hpp:65</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a5fa6628b70d41ed6fe65199fbaa2092d"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5fa6628b70d41ed6fe65199fbaa2092d">px::asio::CCdsHandler::_reqst_queue_mutex</a></div><div class="ttdeci">std::recursive_mutex _reqst_queue_mutex</div><div class="ttdoc">A mutex to protect access or updating of the deque _reqst_queue. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00860">cds_handler.hpp:860</a></div></div>
<div class="ttc" id="structpx_1_1asio_1_1CCdsHandler_1_1ch__val__s_html_ad869ebb5e167a2dc070346249dcaee34"><div class="ttname"><a href="../../dc/d33/structpx_1_1asio_1_1CCdsHandler_1_1ch__val__s.html#ad869ebb5e167a2dc070346249dcaee34">px::asio::CCdsHandler::ch_val_s::when</a></div><div class="ttdeci">px::CWallTime when</div><div class="ttdoc">The time that value was most recently updated. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00122">cds_handler.hpp:122</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a6ef9a92f4828d60f311f463828d88998"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a6ef9a92f4828d60f311f463828d88998">px::asio::CCdsHandler::get_channel_value</a></div><div class="ttdeci">PUBLIC bool get_channel_value(px::id_t channel_id, px::CValue &amp;value)</div><div class="ttdoc">Channel Related Asynchronous Member Functions. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l01577">cds_handler.cpp:1577</a></div></div>
<div class="ttc" id="namespacepx_html_a9188d298ea20cd951b49ba50d698a49b"><div class="ttname"><a href="../../de/dcb/namespacepx.html#a9188d298ea20cd951b49ba50d698a49b">px::id_t</a></div><div class="ttdeci">uint64_t id_t</div><div class="ttdoc">Unique identifier. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db3/id_8hpp_source.html#l00023">id.hpp:23</a></div></div>
<div class="ttc" id="id_8hpp_html_a461a9279b34d33ce9f3daeb054c18b7b"><div class="ttname"><a href="../../db/db3/id_8hpp.html#a461a9279b34d33ce9f3daeb054c18b7b">PX_ID_UNSET</a></div><div class="ttdeci">#define PX_ID_UNSET</div><div class="ttdoc">An ID considered &amp;quot;invalid&amp;quot; or &amp;quot;unset&amp;quot;. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db3/id_8hpp_source.html#l00028">id.hpp:28</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetAlarms_html_acb61b42d91b8165c368d0720ee0d55f0"><div class="ttname"><a href="../../d1/dc0/classpx_1_1cds_1_1CGetAlarms.html#acb61b42d91b8165c368d0720ee0d55f0">px::cds::CGetAlarms::start_global_count</a></div><div class="ttdeci">uint64_t start_global_count</div><div class="ttdoc">Return only updates whose global count is greater than or equal to this. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d45/get__alarms_8hpp_source.html#l00102">get_alarms.hpp:102</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a1c4f5f464f8ff82b16ba306404c740e0a8ccf655de8fa023eb6ce0f6e243e2089"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a8ccf655de8fa023eb6ce0f6e243e2089">px::asio::CCdsHandler::RQST_SUBSCRIBE_CHANNEL_VALUES</a></div><div class="ttdoc">Subscribe to all the Channel Values for this Device. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00086">cds_handler.hpp:86</a></div></div>
<div class="ttc" id="common_8hpp_html_a217a0bd562b98ae8c2ffce44935351e1"><div class="ttname"><a href="../../dd/d3a/common_8hpp.html#a217a0bd562b98ae8c2ffce44935351e1">likely</a></div><div class="ttdeci">#define likely(x)</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/d3a/common_8hpp_source.html#l00020">common.hpp:20</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetAlarms_html_adeb35c7c6b484781ff5d685c0a47bb2c"><div class="ttname"><a href="../../d1/dc0/classpx_1_1cds_1_1CGetAlarms.html#adeb35c7c6b484781ff5d685c0a47bb2c">px::cds::CGetAlarms::max_result_size</a></div><div class="ttdeci">uint32_t max_result_size</div><div class="ttdoc">Return at most this many updates. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d45/get__alarms_8hpp_source.html#l00117">get_alarms.hpp:117</a></div></div>
<div class="ttc" id="register__watchdog_8hpp_html"><div class="ttname"><a href="../../d8/d07/register__watchdog_8hpp.html">register_watchdog.hpp</a></div></div>
<div class="ttc" id="group__special__callback__handles_html_gafe97d8a3313acdb27c9e73c95f42cefa"><div class="ttname"><a href="../../d1/de5/group__special__callback__handles.html#gafe97d8a3313acdb27c9e73c95f42cefa">CALLBACK_NONE</a></div><div class="ttdeci">#define CALLBACK_NONE</div><div class="ttdoc">Don&amp;#39;t bother sending us a response. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d7c/request__response_8hpp_source.html#l00026">request_response.hpp:26</a></div></div>
<div class="ttc" id="create__channel_8hpp_html"><div class="ttname"><a href="../../dc/d43/create__channel_8hpp.html">create_channel.hpp</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_abed337d829238a87c3495edc8ead96f4"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abed337d829238a87c3495edc8ead96f4">px::asio::CCdsHandler::set_channel_value</a></div><div class="ttdeci">PUBLIC void set_channel_value(px::id_t channel_id, const px::CValue &amp;value)</div><div class="ttdoc">Utility function to set the current Value of a Channel into the CDS. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l01728">cds_handler.cpp:1728</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_aef4cca6cba616dc0dcce8f914f792b83"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aef4cca6cba616dc0dcce8f914f792b83">px::asio::CCdsHandler::_awaiting_resps_mutex</a></div><div class="ttdeci">std::recursive_mutex _awaiting_resps_mutex</div><div class="ttdoc">A recursive mutex to protect access or updating of the map _awaiting_resps. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00867">cds_handler.hpp:867</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_ad7e1632da24ad4edf0b0bac9d3b2de55"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad7e1632da24ad4edf0b0bac9d3b2de55">px::asio::CCdsHandler::submit_wait</a></div><div class="ttdeci">virtual PUBLIC std::shared_ptr&lt; px::cds::CRequestResponse &gt; submit_wait(px::cds::CRequestResponse &amp;req) const </div><div class="ttdoc">Submit a request for CDS processing, waiting for the response and returning it. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00194">cds_handler.cpp:194</a></div></div>
<div class="ttc" id="get__channel__settings_8hpp_html"><div class="ttname"><a href="../../d4/d6c/get__channel__settings_8hpp.html">get_channel_settings.hpp</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a2006f4f4d69f866827c8585cb3d7d09b"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a2006f4f4d69f866827c8585cb3d7d09b">px::asio::CCdsHandler::process_device_data</a></div><div class="ttdeci">bool process_device_data(const px::CDevice &amp;px_device)</div><div class="ttdoc">The recursive function to check this device&amp;#39;s data and see if we need to add or update the Device dat...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00591">cds_handler.cpp:591</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a5556ac1e9278da66bfa7f6a50c2c718f"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5556ac1e9278da66bfa7f6a50c2c718f">px::asio::CCdsHandler::do_static_discovery</a></div><div class="ttdeci">PUBLIC void do_static_discovery(px::id_t starting_dev_id=PX_ID_ROOT)</div><div class="ttdoc">Perform a static discovery of all device data starting at the given ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00399">cds_handler.cpp:399</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a8e7f7da549a3fd4bebeff1deb9646d12"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8e7f7da549a3fd4bebeff1deb9646d12">px::asio::CCdsHandler::get_device</a></div><div class="ttdeci">PUBLIC px::CDevice get_device(px::id_t dev_id)</div><div class="ttdoc">Device Related Asynchronous Member Functions. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00308">cds_handler.cpp:308</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a410ac02c6d8fb33b91deff414db7e061"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a410ac02c6d8fb33b91deff414db7e061">px::asio::CCdsHandler::init_device_map</a></div><div class="ttdeci">PUBLIC void init_device_map(const cds_device_callback_t &amp;add_device_callback, const cds_device_callback_t &amp;update_device_callback, const device_delete_callback_t &amp;delete_device_callback, const cds_device_callback_t &amp;device_state_callback, bool want_channels, const cds_ch_settings_callback_t &amp;channel_settings_callback=cds_ch_settings_callback_t())</div><div class="ttdoc">Member Functions that manage the maps of Devices and Channels, and Alarm handling. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00346">cds_handler.cpp:346</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a0e54ae24cd6e4b943ea7171e97701456"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0e54ae24cd6e4b943ea7171e97701456">px::asio::CCdsHandler::is_communicating_device</a></div><div class="ttdeci">PUBLIC bool is_communicating_device(px::id_t dev_id) const </div><div class="ttdoc">Checks if we have the requested Device instance in our map, and if its state is enabled and communica...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00775">cds_handler.cpp:775</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_aaaa16e727fba39f242dbe12de10ad926"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aaaa16e727fba39f242dbe12de10ad926">px::asio::CCdsHandler::_my_perms</a></div><div class="ttdeci">px::CBitset&lt; px::permissions &gt; _my_perms</div><div class="ttdoc">This client&amp;#39;s set of permissions. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00902">cds_handler.hpp:902</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a517c085c90f0643a22ad476324ae3e99"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a517c085c90f0643a22ad476324ae3e99">px::asio::CCdsHandler::device_delete_callback_t</a></div><div class="ttdeci">std::function&lt; void(px::id_t)&gt; device_delete_callback_t</div><div class="ttdoc">Define the function object type to handle CCdsDevice deletions from the CDS. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00103">cds_handler.hpp:103</a></div></div>
<div class="ttc" id="classpx_1_1CValue_html_a2a46ef72ad52efd0c5b9d88b4cafc21a"><div class="ttname"><a href="../../db/dd9/classpx_1_1CValue.html#a2a46ef72ad52efd0c5b9d88b4cafc21a">px::CValue::type</a></div><div class="ttdeci">PUBLIC CDataType type() const </div><div class="ttdoc">Get the data type for this value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dc0/value_8cpp_source.html#l00140">value.cpp:140</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a1c4f5f464f8ff82b16ba306404c740e0a7e5b30fcce4d8299841858a089502ed3"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0a7e5b30fcce4d8299841858a089502ed3">px::asio::CCdsHandler::RQST_GET_DEVICE</a></div><div class="ttdoc">Get the Device data. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00083">cds_handler.hpp:83</a></div></div>
<div class="ttc" id="log_8hpp_html_a521456704214b9bd0a4dd62c8095ec13"><div class="ttname"><a href="../../d4/d3d/log_8hpp.html#a521456704214b9bd0a4dd62c8095ec13">LIBPX_NOTICE</a></div><div class="ttdeci">#define LIBPX_NOTICE(__VLVL__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3d/log_8hpp_source.html#l00188">log.hpp:188</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a7adb2b1f00702d8aa9ae706962b78d3e"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7adb2b1f00702d8aa9ae706962b78d3e">px::asio::CCdsHandler::handle</a></div><div class="ttdeci">px::cds::CallbackHandle handle</div><div class="ttdoc">Callback handle for solicited responses to cds requests. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00664">cds_handler.hpp:664</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CSignalPipe_html_a10a7ac470fc31363514f20e1ae650dc1"><div class="ttname"><a href="../../d7/d2b/classpx_1_1cds_1_1CSignalPipe.html#a10a7ac470fc31363514f20e1ae650dc1">px::cds::CSignalPipe::fd</a></div><div class="ttdeci">static int fd()</div><div class="ttdoc">Return a file descriptor which is suitable for polling (via select(), epoll(), or similar) for read-r...</div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d4e/signal__pipe_8hpp_source.html#l00078">signal_pipe.hpp:78</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CCdsClientLogin_html_a00af3c2448a31ece1c0036c4a4ae9c4b"><div class="ttname"><a href="../../dc/d26/classpx_1_1cds_1_1CCdsClientLogin.html#a00af3c2448a31ece1c0036c4a4ae9c4b">px::cds::CCdsClientLogin::service</a></div><div class="ttdeci">px::string service</div><div class="ttdoc">service to login, normally the name of the calling application </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d6e/login_8hpp_source.html#l00276">login.hpp:276</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a9dbf29b0506a7fecd3970d72cc16115f"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a9dbf29b0506a7fecd3970d72cc16115f">px::asio::CCdsHandler::CCdsHandler</a></div><div class="ttdeci">PUBLIC CCdsHandler(const px::string &amp;app_name, uint32_t wait_secs=60, uint32_t request_queue_size=4194304, uint32_t response_queue_size=4194304, const bool enable_data_validation=true)</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00036">cds_handler.cpp:36</a></div></div>
<div class="ttc" id="cds__connection__callback_8hpp_html"><div class="ttname"><a href="../../dd/d86/cds__connection__callback_8hpp.html">cds_connection_callback.hpp</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CSubscribe_html_a25fa8f9d345b56c2eed0a707b37d927c"><div class="ttname"><a href="../../d9/dda/classpx_1_1cds_1_1CSubscribe.html#a25fa8f9d345b56c2eed0a707b37d927c">px::cds::CSubscribe::subscriptions</a></div><div class="ttdeci">std::vector&lt; CSubscribeSingle &gt; subscriptions</div><div class="ttdoc">List of subscriptions to add or remove. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbb/subscribe_8hpp_source.html#l00176">subscribe.hpp:176</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CClient_html_a63512b3fd6a96fb8adf392c2242d9f54"><div class="ttname"><a href="../../db/db8/classpx_1_1cds_1_1CClient.html#a63512b3fd6a96fb8adf392c2242d9f54">px::cds::CClient::register_callback</a></div><div class="ttdeci">PUBLIC CallbackHandle register_callback(std::shared_ptr&lt; CCallback &gt; callback)</div><div class="ttdoc">Register a callback function to receive (and dequeue) responses. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/client_8cpp_source.html#l00446">client.cpp:446</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CSubscriberNotify_html"><div class="ttname"><a href="../../d7/d07/classpx_1_1cds_1_1CSubscriberNotify.html">px::cds::CSubscriberNotify</a></div><div class="ttdoc">Sent, unsolicited, from CDS to clients in response to a subscribed event or change, or a login session ending. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/df9/subscriber__notify_8hpp_source.html#l00035">subscriber_notify.hpp:35</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsSyncIO_html_a360b5622da14b7bef31147de28db63a4"><div class="ttname"><a href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a360b5622da14b7bef31147de28db63a4">px::asio::CCdsSyncIO::get_channel_settings</a></div><div class="ttdeci">PUBLIC std::shared_ptr&lt; px::cds::CGetChannelSettings &gt; get_channel_settings(const px::id_t dev_id)</div><div class="ttdoc">Utility function to get all Channel Settings for a device in the CDS. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/cds__sync__io_8cpp_source.html#l00604">cds_sync_io.cpp:604</a></div></div>
<div class="ttc" id="namespacepx_html_acf6770f6d835c0c868d8be96d1771e3fafedb2d84cafe20862cb4399751a8a7e3"><div class="ttname"><a href="../../de/dcb/namespacepx.html#acf6770f6d835c0c868d8be96d1771e3fafedb2d84cafe20862cb4399751a8a7e3">px::alarm_trigger_type::invalid</a></div></div>
<div class="ttc" id="namespacepx_html_a60cb4a870ad1ada57e20d9e76de5578ca075ae3d2fc31640504f814f60e5ef713"><div class="ttname"><a href="../../de/dcb/namespacepx.html#a60cb4a870ad1ada57e20d9e76de5578ca075ae3d2fc31640504f814f60e5ef713">px::realtime_state::disabled</a></div></div>
<div class="ttc" id="get__channel_8hpp_html"><div class="ttname"><a href="../../df/d4b/get__channel_8hpp.html">get_channel.hpp</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CSubscribeSingle_html"><div class="ttname"><a href="../../dc/d4b/classpx_1_1cds_1_1CSubscribeSingle.html">px::cds::CSubscribeSingle</a></div><div class="ttdoc">Represents a single subscription (or un-subscripton): the (enumerated) type of subscription, the object it applies to, and which subscriber ID is asking (a CDS client can get more than one subscriber ID if it desires, for multiplexing). </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/dbb/subscribe_8hpp_source.html#l00021">subscribe.hpp:21</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a0a7867d1f3a2a55f28f1356ec071ff5c"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0a7867d1f3a2a55f28f1356ec071ff5c">px::asio::CCdsHandler::_session_token</a></div><div class="ttdeci">px::string _session_token</div><div class="ttdoc">Holds the session token that we are logged into the CDS with. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00899">cds_handler.hpp:899</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CClient_html_a04806b8577ecbb198bc2f7c8cf9939ff"><div class="ttname"><a href="../../db/db8/classpx_1_1cds_1_1CClient.html#a04806b8577ecbb198bc2f7c8cf9939ff">px::cds::CClient::unregister_callback</a></div><div class="ttdeci">PUBLIC void unregister_callback(CallbackHandle handle)</div><div class="ttdoc">Unregister a previously registered callback structure. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/client_8cpp_source.html#l00478">client.cpp:478</a></div></div>
<div class="ttc" id="namespacepx_1_1permission_html_a7449a16cbcc654759961b6640de7ce33"><div class="ttname"><a href="../../da/dda/namespacepx_1_1permission.html#a7449a16cbcc654759961b6640de7ce33">px::permission::perms_to_short_str</a></div><div class="ttdeci">PUBLIC px::string perms_to_short_str(const px::CBitset&lt; px::permissions &gt; &amp;perms)</div><div class="ttdoc">Short string for display, like &amp;quot;ls -l&amp;quot; file permissions Format: per_user, data r/w/admin, config r/w/file, control basic/oper/setpoints, event-ack, security read/admin, install, internal_app/troubleshoot. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db0/permission_8cpp_source.html#l00092">permission.cpp:92</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsDevice_html_a53b9ab7fb8db713c0269fb13525bd767"><div class="ttname"><a href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#a53b9ab7fb8db713c0269fb13525bd767">px::asio::CCdsDevice::_channel_values_received</a></div><div class="ttdeci">bool _channel_values_received</div><div class="ttdoc">Flag that indicates when all of channel values for this device have been added to the CdsHandler&amp;#39;s ma...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da3/cds__device_8hpp_source.html#l00060">cds_device.hpp:60</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CSignalPipe_html"><div class="ttname"><a href="../../d7/d2b/classpx_1_1cds_1_1CSignalPipe.html">px::cds::CSignalPipe</a></div><div class="ttdoc">Class for catching UNIX signals &amp;amp; delivering them to the main polling loop. </div><div class="ttdef"><b>Definition:</b> <a href="../../d0/d4e/signal__pipe_8hpp_source.html#l00017">signal_pipe.hpp:17</a></div></div>
<div class="ttc" id="log_8hpp_html_ab1ccbce6dc90278ccab5c9081dce6e17"><div class="ttname"><a href="../../d4/d3d/log_8hpp.html#ab1ccbce6dc90278ccab5c9081dce6e17">LIBPX_FERR</a></div><div class="ttdeci">#define LIBPX_FERR(__VLVL__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3d/log_8hpp_source.html#l00182">log.hpp:182</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a4184f2136532243984b5ceb61d0d76c0"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a4184f2136532243984b5ceb61d0d76c0">px::asio::CCdsHandler::check_request_queue</a></div><div class="ttdeci">bool check_request_queue()</div><div class="ttdoc">See if there is an entry available in our queue of message requests, and, if so, send the request for...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l01334">cds_handler.cpp:1334</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CSetOOBData_html"><div class="ttname"><a href="../../d4/d55/classpx_1_1cds_1_1CSetOOBData.html">px::cds::CSetOOBData</a></div><div class="ttdoc">Update OOB data items in the CDS. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5f/set__oob__data_8hpp_source.html#l00111">set_oob_data.hpp:111</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a1c4f5f464f8ff82b16ba306404c740e0ab7dddeda449a68096c6427841bffcf58"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ab7dddeda449a68096c6427841bffcf58">px::asio::CCdsHandler::RQST_GET_CHANNEL_VALUES</a></div><div class="ttdoc">Get all the Channel Values for the Device. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00084">cds_handler.hpp:84</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_abf75a5dfc2411c8d4aca956f6a5afb14"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abf75a5dfc2411c8d4aca956f6a5afb14">px::asio::CCdsHandler::_doing_initial_discovery</a></div><div class="ttdeci">bool _doing_initial_discovery</div><div class="ttdoc">A flag that indicates when we are still in the initial static discovery phase, using synchronous CDS ...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00873">cds_handler.hpp:873</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CSetOOBData_html_a86c87efc4c9a5194b13059406cdf6888"><div class="ttname"><a href="../../d4/d55/classpx_1_1cds_1_1CSetOOBData.html#a86c87efc4c9a5194b13059406cdf6888">px::cds::CSetOOBData::data</a></div><div class="ttdeci">std::vector&lt; CSetOOBDataUnit &gt; data</div><div class="ttdoc">Request: List of sets to perform. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d5f/set__oob__data_8hpp_source.html#l00150">set_oob_data.hpp:150</a></div></div>
<div class="ttc" id="permission_8hpp_html"><div class="ttname"><a href="../../db/d8b/permission_8hpp.html">permission.hpp</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetChannelValue_html"><div class="ttname"><a href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html">px::cds::CGetChannelValue</a></div><div class="ttdoc">Get channels&amp;#39; realtime values and states. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d89/get__channel__value_8hpp_source.html#l00081">get_channel_value.hpp:81</a></div></div>
<div class="ttc" id="cds__handler_8hpp_html"><div class="ttname"><a href="../../df/d9c/cds__handler_8hpp.html">cds_handler.hpp</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CUpdateChannelValue_html"><div class="ttname"><a href="../../db/df2/classpx_1_1cds_1_1CUpdateChannelValue.html">px::cds::CUpdateChannelValue</a></div><div class="ttdoc">Update a set of channels&amp;#39; realtime values. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4b/update__channel__value_8hpp_source.html#l00073">update_channel_value.hpp:73</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CUpdateChannelValue_html_aa0f5f0710d5595d207dff8c05e0ad227"><div class="ttname"><a href="../../db/df2/classpx_1_1cds_1_1CUpdateChannelValue.html#aa0f5f0710d5595d207dff8c05e0ad227">px::cds::CUpdateChannelValue::updates</a></div><div class="ttdeci">std::vector&lt; CUpdateSingleChannelValue &gt; updates</div><div class="ttdoc">List of channel IDs and values. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4b/update__channel__value_8hpp_source.html#l00119">update_channel_value.hpp:119</a></div></div>
<div class="ttc" id="namespacepx_1_1sub_html_a9f14ba2d87747d37025c1be590176841aed9c52e870141df9c25b8e97263a19d0"><div class="ttname"><a href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841aed9c52e870141df9c25b8e97263a19d0">px::sub::subscription_type::change_signature</a></div><div class="ttdoc">Update to the change signature. </div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a1c4f5f464f8ff82b16ba306404c740e0ae8a24b31c9e5c8ac99f0f14055c5308d"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0ae8a24b31c9e5c8ac99f0f14055c5308d">px::asio::CCdsHandler::RQST_GET_CHANNEL_SETTINGS</a></div><div class="ttdoc">Get all the Channel Settings for the Device. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00085">cds_handler.hpp:85</a></div></div>
<div class="ttc" id="classpx_1_1CWallTime_html_a4452bc7e8e4fbb8c976f5763269593e7"><div class="ttname"><a href="../../d9/d7d/classpx_1_1CWallTime.html#a4452bc7e8e4fbb8c976f5763269593e7">px::CWallTime::now</a></div><div class="ttdeci">static PUBLIC CWallTime now()</div><div class="ttdoc">Factory function to create a new CWallTime instance set to &amp;quot;now&amp;quot;. </div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d22/wall__time_8cpp_source.html#l00010">wall_time.cpp:10</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_aefac77b191971c7b5373489a6ae5733c"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aefac77b191971c7b5373489a6ae5733c">px::asio::CCdsHandler::subscribe_device_callbacks</a></div><div class="ttdeci">PUBLIC void subscribe_device_callbacks()</div><div class="ttdoc">Enter CDS subscriptions for Device CrUD events to maintain the device map. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00471">cds_handler.cpp:471</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CSignalPipe_html_acd94e725edcf8d7b6c2cf4b55b2d430c"><div class="ttname"><a href="../../d7/d2b/classpx_1_1cds_1_1CSignalPipe.html#acd94e725edcf8d7b6c2cf4b55b2d430c">px::cds::CSignalPipe::clear</a></div><div class="ttdeci">static void clear()</div><div class="ttdoc">Clear notification of the incoming signal so that we can continue normal operation. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d1b/signal__pipe_8cpp_source.html#l00103">signal_pipe.cpp:103</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_ad6dfa9f95d1e1152d032f5719aa6f1d0"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad6dfa9f95d1e1152d032f5719aa6f1d0">px::asio::CCdsHandler::_want_channels</a></div><div class="ttdeci">bool _want_channels</div><div class="ttdoc">Flag that tells us whether to discover and update Channel data along with device data. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00892">cds_handler.hpp:892</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a911700a9b460e8f4dd41a4eb82f7355a"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a911700a9b460e8f4dd41a4eb82f7355a">px::asio::CCdsHandler::_change_signature_sub_id</a></div><div class="ttdeci">px::id_t _change_signature_sub_id</div><div class="ttdoc">The subscription id for our CDS subscriptions for device Change Signatures. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00835">cds_handler.hpp:835</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a16553da663bf5d4e9d51882bc98fc581"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a16553da663bf5d4e9d51882bc98fc581">px::asio::CCdsHandler::_alarm_sub_id</a></div><div class="ttdeci">px::id_t _alarm_sub_id</div><div class="ttdoc">The subscription id for our CDS subscriptions for alarm updates. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00850">cds_handler.hpp:850</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetChannelSettings_html"><div class="ttname"><a href="../../de/dab/classpx_1_1cds_1_1CGetChannelSettings.html">px::cds::CGetChannelSettings</a></div><div class="ttdoc">Get the current settings for a channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d6c/get__channel__settings_8hpp_source.html#l00034">get_channel_settings.hpp:34</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a6a303fcab722a10d70bdca3133b072cd"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a6a303fcab722a10d70bdca3133b072cd">px::asio::CCdsHandler::submit</a></div><div class="ttdeci">virtual PUBLIC uint32_t submit(px::cds::CRequestResponse &amp;req, bool sleep_on_full=false)</div><div class="ttdoc">Submit a request for CDS processing. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00232">cds_handler.cpp:232</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_abf5e000e20af5dc4b1e7f49299f4c48d"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#abf5e000e20af5dc4b1e7f49299f4c48d">px::asio::CCdsHandler::get_session_token</a></div><div class="ttdeci">PUBLIC const px::string &amp; get_session_token()</div><div class="ttdoc">Getter for our session token. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l01518">cds_handler.cpp:1518</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a8c213d7dd5c7e101e8beabd4ce832248"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8c213d7dd5c7e101e8beabd4ce832248">px::asio::CCdsHandler::_add_device_callback</a></div><div class="ttdeci">cds_device_callback_t _add_device_callback</div><div class="ttdoc">The callback function to the application to let it handle the addition of a new CCdsDevice container ...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00799">cds_handler.hpp:799</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetSingleChannelValue_html_a3c8207a636f7571a426849c1b4d1d6ed"><div class="ttname"><a href="../../d6/da7/classpx_1_1cds_1_1CGetSingleChannelValue.html#a3c8207a636f7571a426849c1b4d1d6ed">px::cds::CGetSingleChannelValue::when</a></div><div class="ttdeci">CWallTime when</div><div class="ttdoc">The time that value was most recently updated. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d89/get__channel__value_8hpp_source.html#l00064">get_channel_value.hpp:64</a></div></div>
<div class="ttc" id="get__device_8hpp_html"><div class="ttname"><a href="../../dc/dc8/get__device_8hpp.html">get_device.hpp</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_aa45851ad0ebfa7541cab7a1f739b4e18"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa45851ad0ebfa7541cab7a1f739b4e18">px::asio::CCdsHandler::_dev_state_sub_id</a></div><div class="ttdeci">px::id_t _dev_state_sub_id</div><div class="ttdoc">The subscription id for our CDS subscriptions for device state changes.. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00844">cds_handler.hpp:844</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a4566a160ea6d8b1659725e11a770e5d8"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a4566a160ea6d8b1659725e11a770e5d8">px::asio::CCdsHandler::_override_pacing</a></div><div class="ttdeci">long int _override_pacing</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00896">cds_handler.hpp:896</a></div></div>
<div class="ttc" id="namespacepx_1_1sub_html_a9f14ba2d87747d37025c1be590176841a139ee1f327cb1d7e4748baced02f8e60"><div class="ttname"><a href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a139ee1f327cb1d7e4748baced02f8e60">px::sub::subscription_type::device_settings</a></div><div class="ttdoc">Update to device-level settings. </div></div>
<div class="ttc" id="login_8hpp_html"><div class="ttname"><a href="../../d3/d6e/login_8hpp.html">login.hpp</a></div></div>
<div class="ttc" id="update__channel__value_8hpp_html"><div class="ttname"><a href="../../db/d4b/update__channel__value_8hpp.html">update_channel_value.hpp</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetChannelSettings_html_a9f57e428683c3eb02eb104d36adbfa32"><div class="ttname"><a href="../../de/dab/classpx_1_1cds_1_1CGetChannelSettings.html#a9f57e428683c3eb02eb104d36adbfa32">px::cds::CGetChannelSettings::ids</a></div><div class="ttdeci">std::vector&lt; px::id_t &gt; ids</div><div class="ttdoc">List of channels to fetch. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d6c/get__channel__settings_8hpp_source.html#l00075">get_channel_settings.hpp:75</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CCdsClientLogin_html_a5b8a5bf99d23d11123ea3ae3ce7ba277"><div class="ttname"><a href="../../dc/d26/classpx_1_1cds_1_1CCdsClientLogin.html#a5b8a5bf99d23d11123ea3ae3ce7ba277">px::cds::CCdsClientLogin::hard_timeout</a></div><div class="ttdeci">uint32_t hard_timeout</div><div class="ttdoc">Hard timeout (not refreshable) for this session (default/0: no timeout) </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d6e/login_8hpp_source.html#l00282">login.hpp:282</a></div></div>
<div class="ttc" id="namespacepx_1_1sub_html_a9f14ba2d87747d37025c1be590176841ac657323e6efcc419624555fab7ee5ec3"><div class="ttname"><a href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841ac657323e6efcc419624555fab7ee5ec3">px::sub::subscription_type::value_update</a></div><div class="ttdoc">Update to a channel&amp;#39;s current/real-time value that changes the value. </div></div>
<div class="ttc" id="classpx_1_1CDevice_html_a41eb528e122765272fe2d317daf428b0"><div class="ttname"><a href="../../d6/d5b/classpx_1_1CDevice.html#a41eb528e122765272fe2d317daf428b0">px::CDevice::change_signature</a></div><div class="ttdeci">uint64_t change_signature</div><div class="ttdoc">Represents a change signature, to help avoid any unnecessary re-discovery by indicating if any signif...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d08/device_8hpp_source.html#l00396">device.hpp:396</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a23956be018c9fba64a7ff3d3d9952208"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a23956be018c9fba64a7ff3d3d9952208">px::asio::CCdsHandler::cds_login</a></div><div class="ttdeci">PUBLIC void cds_login()</div><div class="ttdoc">Do a CDS Client Login (no username or password) to get a session token and permissions. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l01474">cds_handler.cpp:1474</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a1c4f5f464f8ff82b16ba306404c740e0"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a1c4f5f464f8ff82b16ba306404c740e0">px::asio::CCdsHandler::queued_req_type</a></div><div class="ttdeci">queued_req_type</div><div class="ttdoc">A set of Enums for the types of queued requests handled internally by this class. ...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00081">cds_handler.hpp:81</a></div></div>
<div class="ttc" id="classpx_1_1CValue_html"><div class="ttname"><a href="../../db/dd9/classpx_1_1CValue.html">px::CValue</a></div><div class="ttdoc">Variadic value. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dca/type_2value_8hpp_source.html#l00034">type/value.hpp:34</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CClient_html_a907410082d34b93630b2f0b0abe44186"><div class="ttname"><a href="../../db/db8/classpx_1_1cds_1_1CClient.html#a907410082d34b93630b2f0b0abe44186">px::cds::CClient::submit</a></div><div class="ttdeci">PUBLIC uint32_t submit(CRequestResponse &amp;req, CallbackHandle callback=CALLBACK_NONE, bool sleep_on_full=false)</div><div class="ttdoc">Submit a request for CDS processing. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/client_8cpp_source.html#l00530">client.cpp:530</a></div></div>
<div class="ttc" id="log_8hpp_html_aca06af91b95ad5e55953f4488f2c95e1"><div class="ttname"><a href="../../d4/d3d/log_8hpp.html#aca06af91b95ad5e55953f4488f2c95e1">LIBPX_FINFO</a></div><div class="ttdeci">#define LIBPX_FINFO(__VLVL__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3d/log_8hpp_source.html#l00194">log.hpp:194</a></div></div>
<div class="ttc" id="classpx_1_1CWallTime_html"><div class="ttname"><a href="../../d9/d7d/classpx_1_1CWallTime.html">px::CWallTime</a></div><div class="ttdoc">Wall-clock time. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/dda/wall__time_8hpp_source.html#l00026">wall_time.hpp:26</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_ad31b9bf04739997bef426658f039d506"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad31b9bf04739997bef426658f039d506">px::asio::CCdsHandler::connect_to_cds</a></div><div class="ttdeci">PUBLIC void connect_to_cds(const px::string &amp;app_name, uint32_t wait_secs=60, uint32_t request_queue_size=4194304, uint32_t response_queue_size=4194304)</div><div class="ttdoc">Open the connection to the CDS (if not already open). </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00097">cds_handler.cpp:97</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a965b685fdc21e5892cb63d817c33fa33"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a965b685fdc21e5892cb63d817c33fa33">px::asio::CCdsHandler::init_channel_values_callback</a></div><div class="ttdeci">PUBLIC bool init_channel_values_callback(const cds_ch_values_callback_t &amp;update_channel_values_callback)</div><div class="ttdoc">Function to initialize the optional callback for channel value updates. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00517">cds_handler.cpp:517</a></div></div>
<div class="ttc" id="id_8hpp_html_a4bf9a4a8ce0afe78d52a46e514329c5a"><div class="ttname"><a href="../../db/db3/id_8hpp.html#a4bf9a4a8ce0afe78d52a46e514329c5a">PX_ID_ROOT</a></div><div class="ttdeci">#define PX_ID_ROOT</div><div class="ttdoc">Define the ID for the root device. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db3/id_8hpp_source.html#l00040">id.hpp:40</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a7572741e89c58700cb91b699865c0fa9"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7572741e89c58700cb91b699865c0fa9">px::asio::CCdsHandler::subscribe_alarm_callback</a></div><div class="ttdeci">PUBLIC void subscribe_alarm_callback()</div><div class="ttdoc">Enter CDS subscriptions for Alarm events. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00827">cds_handler.cpp:827</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_acc483b564f12d9173bf7369ef89ae42b"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#acc483b564f12d9173bf7369ef89ae42b">px::asio::CCdsHandler::_in_callback_guard</a></div><div class="ttdeci">bool _in_callback_guard</div><div class="ttdoc">Set when we enter a callback from the CDS; cleared when we exit it. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00883">cds_handler.hpp:883</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a7b760a8420b8a6ef12d60c3f9c00eaff"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7b760a8420b8a6ef12d60c3f9c00eaff">px::asio::CCdsHandler::get_map_device</a></div><div class="ttdeci">PUBLIC bool get_map_device(px::id_t dev_id, cds_device_map_citer_t &amp;map_pos) const </div><div class="ttdoc">Getter for a CCdsDevice instance in our map, looked up by its Device ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00727">cds_handler.cpp:727</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CCdsClientLogin_html_a53937ef73561f7e3fbedd780a162dc48"><div class="ttname"><a href="../../dc/d26/classpx_1_1cds_1_1CCdsClientLogin.html#a53937ef73561f7e3fbedd780a162dc48">px::cds::CCdsClientLogin::idle_timeout</a></div><div class="ttdeci">uint32_t idle_timeout</div><div class="ttdoc">Idle timeout for this session (default/0: no timeout) </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d6e/login_8hpp_source.html#l00279">login.hpp:279</a></div></div>
<div class="ttc" id="classtimespec_html"><div class="ttname"><a href="../../da/d9d/classtimespec.html">timespec</a></div></div>
<div class="ttc" id="get__alarms_8hpp_html"><div class="ttname"><a href="../../df/d45/get__alarms_8hpp.html">get_alarms.hpp</a></div></div>
<div class="ttc" id="classpx_1_1CBitset_html_abce11bc695cf4b1dd4bf9cb31e62d919"><div class="ttname"><a href="../../dd/d57/classpx_1_1CBitset.html#abce11bc695cf4b1dd4bf9cb31e62d919">px::CBitset::empty</a></div><div class="ttdeci">bool empty() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d86/bitset_8hpp_source.html#l00177">bitset.hpp:177</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a97d7549acfc26ffd2dc51dc7bcbdeb07"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a97d7549acfc26ffd2dc51dc7bcbdeb07">px::asio::CCdsHandler::_update_device_callback</a></div><div class="ttdeci">cds_device_callback_t _update_device_callback</div><div class="ttdoc">The callback function to the application to let it handle the updating of an existing CCdsDevice cont...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00805">cds_handler.hpp:805</a></div></div>
<div class="ttc" id="delete__device_8hpp_html"><div class="ttname"><a href="../../dc/db7/delete__device_8hpp.html">delete_device.hpp</a></div></div>
<div class="ttc" id="namespacepx_html_a60cb4a870ad1ada57e20d9e76de5578ca0c161174c6857de22a3653e43574df78"><div class="ttname"><a href="../../de/dcb/namespacepx.html#a60cb4a870ad1ada57e20d9e76de5578ca0c161174c6857de22a3653e43574df78">px::realtime_state::not_communicating</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a52ae66ba371f37cbcb7a33d0cdec38cc"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a52ae66ba371f37cbcb7a33d0cdec38cc">px::asio::CCdsHandler::ok_to_proceed</a></div><div class="ttdeci">virtual bool ok_to_proceed()</div><div class="ttdoc">Function for the implementation to signal to internal processing of this class&amp;#39; members that they sho...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l01775">cds_handler.cpp:1775</a></div></div>
<div class="ttc" id="classpx_1_1CDevice_html_af415b4387c92c27e7c05585954a754a7"><div class="ttname"><a href="../../d6/d5b/classpx_1_1CDevice.html#af415b4387c92c27e7c05585954a754a7">px::CDevice::set_inherited_state</a></div><div class="ttdeci">PUBLIC void set_inherited_state(const px::CBitset&lt; px::realtime_state &gt; &amp;st)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/dd4/device_8cpp_source.html#l00974">device.cpp:974</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a27bb935ae2e5a5a0dbcefdc69e9ae947"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a27bb935ae2e5a5a0dbcefdc69e9ae947">px::asio::CCdsHandler::process_subscription_update</a></div><div class="ttdeci">void process_subscription_update(std::shared_ptr&lt; px::cds::CSubscriberNotify &gt; update)</div><div class="ttdoc">Given a subscribed update event, process its contents. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l01073">cds_handler.cpp:1073</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a8f13df8167b9a9bbaf5b8f6d96490ae5"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8f13df8167b9a9bbaf5b8f6d96490ae5">px::asio::CCdsHandler::_device_map_mutex</a></div><div class="ttdeci">std::recursive_mutex _device_map_mutex</div><div class="ttdoc">A mutex to protect iterative access or updating of the map of Device and Channel data. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00793">cds_handler.hpp:793</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a55081ea603905bb29e8a1cc0a0ef1069"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a55081ea603905bb29e8a1cc0a0ef1069">px::asio::CCdsHandler::cds_device_callback_t</a></div><div class="ttdeci">std::function&lt; void(const CCdsDevice &amp;)&gt; cds_device_callback_t</div><div class="ttdoc">Define the function object type to handle CCdsDevice additions or updates from the CDS...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00099">cds_handler.hpp:99</a></div></div>
<div class="ttc" id="namespacepx_1_1cds_html_afb592c0e9297414bf72bd442764b079aa4e4104ab10b7592af99a7bbc6023d93f"><div class="ttname"><a href="../../d5/dd5/namespacepx_1_1cds.html#afb592c0e9297414bf72bd442764b079aa4e4104ab10b7592af99a7bbc6023d93f">px::cds::persistence::save_always</a></div><div class="ttdoc">Unconditionally save to persistent storage. </div></div>
<div class="ttc" id="classpx_1_1CDevice_html_a648d75d3577fd8f08a863d70ca378703"><div class="ttname"><a href="../../d6/d5b/classpx_1_1CDevice.html#a648d75d3577fd8f08a863d70ca378703">px::CDevice::channels</a></div><div class="ttdeci">chlist_t channels</div><div class="ttdoc">A list of channel id&amp;#39;s directly owned by this device. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d08/device_8hpp_source.html#l00421">device.hpp:421</a></div></div>
<div class="ttc" id="namespacepx_1_1sub_html_a9f14ba2d87747d37025c1be590176841ab6abbfb7c6c6e9ca809dea2537ee2c90"><div class="ttname"><a href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841ab6abbfb7c6c6e9ca809dea2537ee2c90">px::sub::subscription_type::device_create_recursive</a></div><div class="ttdoc">Update is sent whenever a device is created. </div></div>
<div class="ttc" id="query__trends_8hpp_html"><div class="ttname"><a href="../../d3/df0/query__trends_8hpp.html">query_trends.hpp</a></div></div>
<div class="ttc" id="structpx_1_1asio_1_1CCdsHandler_1_1ch__val__s_html_a8a3c8ae37d30a089f4c8763724e61cdb"><div class="ttname"><a href="../../dc/d33/structpx_1_1asio_1_1CCdsHandler_1_1ch__val__s.html#a8a3c8ae37d30a089f4c8763724e61cdb">px::asio::CCdsHandler::ch_val_s::value</a></div><div class="ttdeci">px::CValue value</div><div class="ttdoc">Current value of the channel. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00120">cds_handler.hpp:120</a></div></div>
<div class="ttc" id="classpx_1_1CValue_html_a746a26c3a4970db4ea4f27f30c5d4d9a"><div class="ttname"><a href="../../db/dd9/classpx_1_1CValue.html#a746a26c3a4970db4ea4f27f30c5d4d9a">px::CValue::as_string</a></div><div class="ttdeci">PUBLIC px::string as_string() const </div><div class="ttdoc">Conversion to string type. </div><div class="ttdef"><b>Definition:</b> <a href="../../d2/dc0/value_8cpp_source.html#l00307">value.cpp:307</a></div></div>
<div class="ttc" id="structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s_html_a8195950e2532284fc8b784b221ffb886"><div class="ttname"><a href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#a8195950e2532284fc8b784b221ffb886">px::asio::CCdsHandler::queued_req_s::awaiting_timeout</a></div><div class="ttdeci">px::CMonoTime awaiting_timeout</div><div class="ttdoc">When we send an async request, we set this to the time at which the response will be so late that it ...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00138">cds_handler.hpp:138</a></div></div>
<div class="ttc" id="namespacepx_1_1cds_html_afb592c0e9297414bf72bd442764b079aac8c45f79829ea04ab6d397525bf35b94"><div class="ttname"><a href="../../d5/dd5/namespacepx_1_1cds.html#afb592c0e9297414bf72bd442764b079aac8c45f79829ea04ab6d397525bf35b94">px::cds::persistence::do_not_save</a></div><div class="ttdoc">Do not persist this data, whether this tag is already persisted or not. </div></div>
<div class="ttc" id="namespacepx_1_1sub_html_a9f14ba2d87747d37025c1be590176841a68aae5477ac1dcccc5bcb6ac4e5b7e7e"><div class="ttname"><a href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a68aae5477ac1dcccc5bcb6ac4e5b7e7e">px::sub::subscription_type::device_state</a></div><div class="ttdoc">Update to a devices state value. </div></div>
<div class="ttc" id="signal__pipe_8hpp_html"><div class="ttname"><a href="../../d0/d4e/signal__pipe_8hpp.html">signal_pipe.hpp</a></div></div>
<div class="ttc" id="namespacepx_1_1cds_html_a24c4c8fb05021548bccecd5fa3f2e5fea8d4bce8bce5516e3866bd7d15cf71055"><div class="ttname"><a href="../../d5/dd5/namespacepx_1_1cds.html#a24c4c8fb05021548bccecd5fa3f2e5fea8d4bce8bce5516e3866bd7d15cf71055">px::cds::FAILED</a></div><div class="ttdoc">Finished, bad (some kind of Failure) </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d7c/request__response_8hpp_source.html#l00065">request_response.hpp:65</a></div></div>
<div class="ttc" id="structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s_html_abfa749fe99c164d725c66c94bfbe35ab"><div class="ttname"><a href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#abfa749fe99c164d725c66c94bfbe35ab">px::asio::CCdsHandler::queued_req_s::dev_id</a></div><div class="ttdeci">px::id_t dev_id</div><div class="ttdoc">The CDS ID of the Device of interest for this request. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00133">cds_handler.hpp:133</a></div></div>
<div class="ttc" id="namespacepx_1_1sub_html_a9f14ba2d87747d37025c1be590176841ac75944ab6b9f0d0b27f3765664f88bbe"><div class="ttname"><a href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841ac75944ab6b9f0d0b27f3765664f88bbe">px::sub::subscription_type::alarm_recursive</a></div><div class="ttdoc">Update to all alarms and sub alarms. </div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetAlarms_html_aa838ec7aff2a4ef94834b2d5357e2f8e"><div class="ttname"><a href="../../d1/dc0/classpx_1_1cds_1_1CGetAlarms.html#aa838ec7aff2a4ef94834b2d5357e2f8e">px::cds::CGetAlarms::populate_str_val</a></div><div class="ttdeci">bool populate_str_val</div><div class="ttdoc">If true, populate the str_val field for each of the alarms. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d45/get__alarms_8hpp_source.html#l00180">get_alarms.hpp:180</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a5b07b40fdb014e4978385d60760f831d"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a5b07b40fdb014e4978385d60760f831d">px::asio::CCdsHandler::_channel_values</a></div><div class="ttdeci">channel_value_map_t _channel_values</div><div class="ttdoc">Our internal map of all Channel Values (if desired) </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00916">cds_handler.hpp:916</a></div></div>
<div class="ttc" id="log_8hpp_html_a31b08ca1c16e897657509ea114043aba"><div class="ttname"><a href="../../d4/d3d/log_8hpp.html#a31b08ca1c16e897657509ea114043aba">LIBPX_FWARN</a></div><div class="ttdeci">#define LIBPX_FWARN(__VLVL__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3d/log_8hpp_source.html#l00186">log.hpp:186</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetSingleChannelValue_html_a9da03c004f44d0a9d614e6774e3deaeb"><div class="ttname"><a href="../../d6/da7/classpx_1_1cds_1_1CGetSingleChannelValue.html#a9da03c004f44d0a9d614e6774e3deaeb">px::cds::CGetSingleChannelValue::id</a></div><div class="ttdeci">px::id_t id</div><div class="ttdoc">The channel&amp;#39;s ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d89/get__channel__value_8hpp_source.html#l00057">get_channel_value.hpp:57</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a9982fd5461711099639ce9923c9b21e5"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a9982fd5461711099639ce9923c9b21e5">px::asio::CCdsHandler::cds_ch_values_callback_t</a></div><div class="ttdeci">std::function&lt; void(const std::map&lt; px::id_t, px::CValue &gt; &amp;, const px::CWallTime &amp;)&gt; cds_ch_values_callback_t</div><div class="ttdoc">Define the function object type to handle channel value change notifications from the CDS...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00112">cds_handler.hpp:112</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a488561bc6f2b2db3baaf66f5422aba3d"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a488561bc6f2b2db3baaf66f5422aba3d">px::asio::CCdsHandler::process_channel_value</a></div><div class="ttdeci">bool process_channel_value(px::id_t ch_id, const px::CValue &amp;value, const CWallTime &amp;timestamp)</div><div class="ttdoc">Given the Value for a Channel (from GetValue request or subscription update), save it to our map of c...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00704">cds_handler.cpp:704</a></div></div>
<div class="ttc" id="namespacepx_1_1asio_html_acd6bf8b26abffde39f6859fe50bb37af"><div class="ttname"><a href="../../d6/dbb/namespacepx_1_1asio.html#acd6bf8b26abffde39f6859fe50bb37af">px::asio::cds_device_map_iter_t</a></div><div class="ttdeci">std::map&lt; px::id_t, CCdsDevice &gt;::iterator cds_device_map_iter_t</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00047">cds_handler.hpp:47</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a4aec87f0faac56ad5be4175eb454d43a"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a4aec87f0faac56ad5be4175eb454d43a">px::asio::CCdsHandler::cds_alarm_callback_t</a></div><div class="ttdeci">std::function&lt; void(const px::CAlarmUpdate &amp;)&gt; cds_alarm_callback_t</div><div class="ttdoc">Define the function object type to handle px::CAlarmUpdate updates from the CDS. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00106">cds_handler.hpp:106</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_ae2d8ae3b3bd79f213a473f0bc3488d30"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae2d8ae3b3bd79f213a473f0bc3488d30">px::asio::CCdsHandler::ping_watchdog</a></div><div class="ttdeci">PUBLIC void ping_watchdog()</div><div class="ttdoc">Watchdog Related Asynchronous Member Functions. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00251">cds_handler.cpp:251</a></div></div>
<div class="ttc" id="structpx_1_1generic__err_html"><div class="ttname"><a href="../../d1/d2c/structpx_1_1generic__err.html">px::generic_err</a></div><div class="ttdoc">Exception class used to indicate a generic error. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d1e/exception_8hpp_source.html#l00023">exception.hpp:23</a></div></div>
<div class="ttc" id="namespacepx_1_1sub_html_a9f14ba2d87747d37025c1be590176841a6486b4e98228b83d4b13d54febe5f170"><div class="ttname"><a href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a6486b4e98228b83d4b13d54febe5f170">px::sub::subscription_type::alarm</a></div><div class="ttdoc">Update to an alarm. </div></div>
<div class="ttc" id="namespacepx_1_1sub_html_a9f14ba2d87747d37025c1be590176841a6173fabae619ef4770b698d998e2ea6f"><div class="ttname"><a href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a6173fabae619ef4770b698d998e2ea6f">px::sub::subscription_type::device_delete_recursive</a></div><div class="ttdoc">Update is sent whenever a device is deleted. </div></div>
<div class="ttc" id="channel__trends_8hpp_html"><div class="ttname"><a href="../../d7/d22/channel__trends_8hpp.html">channel_trends.hpp</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CPingWatchdog_html"><div class="ttname"><a href="../../d9/d9c/classpx_1_1cds_1_1CPingWatchdog.html">px::cds::CPingWatchdog</a></div><div class="ttdoc">Notifies the CDS that the client is still alive. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d8b/ping__watchdog_8hpp_source.html#l00018">ping_watchdog.hpp:18</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a0326c84fc1ea91666cd775c6db751382"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0326c84fc1ea91666cd775c6db751382">px::asio::CCdsHandler::_device_state_callback</a></div><div class="ttdeci">cds_device_callback_t _device_state_callback</div><div class="ttdoc">The callback function to the application to let it handle the changing Device state for an existing C...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00819">cds_handler.hpp:819</a></div></div>
<div class="ttc" id="log_8hpp_html_a001b58f6595b2ecf816ea11fbb58b201"><div class="ttname"><a href="../../d4/d3d/log_8hpp.html#a001b58f6595b2ecf816ea11fbb58b201">LIBPX_ERR</a></div><div class="ttdeci">#define LIBPX_ERR(__VLVL__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3d/log_8hpp_source.html#l00180">log.hpp:180</a></div></div>
<div class="ttc" id="structpx_1_1asio_1_1CCdsHandler_1_1ch__val__s_html"><div class="ttname"><a href="../../dc/d33/structpx_1_1asio_1_1CCdsHandler_1_1ch__val__s.html">px::asio::CCdsHandler::ch_val_s</a></div><div class="ttdoc">Define the structure to store each channel&amp;#39;s Value, timestamp, etc (Currently there is no &amp;quot;etc&amp;quot; but m...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00117">cds_handler.hpp:117</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_aa3ab982d098d8801301333226379a315"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3ab982d098d8801301333226379a315">px::asio::CCdsHandler::_internal_callback</a></div><div class="ttdeci">std::shared_ptr&lt; CCdsHandlerCallback &gt; _internal_callback</div><div class="ttdoc">A callback handler for our internal_handle_response(). </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00671">cds_handler.hpp:671</a></div></div>
<div class="ttc" id="structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s_html_a55fa5a32af82f5d7f0b4895a3e075e81"><div class="ttname"><a href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html#a55fa5a32af82f5d7f0b4895a3e075e81">px::asio::CCdsHandler::queued_req_s::req_type</a></div><div class="ttdeci">queued_req_type req_type</div><div class="ttdoc">The type of this request, from the set of queued_req_type. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00135">cds_handler.hpp:135</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetSingleChannelValue_html"><div class="ttname"><a href="../../d6/da7/classpx_1_1cds_1_1CGetSingleChannelValue.html">px::cds::CGetSingleChannelValue</a></div><div class="ttdoc">Data returned by CDS for px::Cds::CGetChannelValue. </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d89/get__channel__value_8hpp_source.html#l00020">get_channel_value.hpp:20</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_ad39ad831e5b51973c5960726b72764bb"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ad39ad831e5b51973c5960726b72764bb">px::asio::CCdsHandler::check_permission</a></div><div class="ttdeci">PUBLIC bool check_permission(px::permissions test_perm)</div><div class="ttdoc">Test to see if we have a given permission (privilege), checking against the privileges for this CDS c...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l01529">cds_handler.cpp:1529</a></div></div>
<div class="ttc" id="manage__subscriber__ids_8hpp_html"><div class="ttname"><a href="../../d5/d15/manage__subscriber__ids_8hpp.html">manage_subscriber_ids.hpp</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsDevice_html_af01372623d442be1a7edde160653cb4e"><div class="ttname"><a href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#af01372623d442be1a7edde160653cb4e">px::asio::CCdsDevice::is_valid_device</a></div><div class="ttdeci">PUBLIC bool is_valid_device() const </div><div class="ttdoc">Is the Device held by this container valid - enabled and communicating? </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d91/cds__device_8cpp_source.html#l00033">cds_device.cpp:33</a></div></div>
<div class="ttc" id="clear__watchdog_8hpp_html"><div class="ttname"><a href="../../d7/d64/clear__watchdog_8hpp.html">clear_watchdog.hpp</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a3447051088e42e33b96e066fb1381f48"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3447051088e42e33b96e066fb1381f48">px::asio::CCdsHandler::init_alarm_callback</a></div><div class="ttdeci">PUBLIC void init_alarm_callback(const cds_alarm_callback_t &amp;update_alarm_callback)</div><div class="ttdoc">Function to initialize Alarm update callbacks. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00793">cds_handler.cpp:793</a></div></div>
<div class="ttc" id="namespacepx_1_1cds_html_a24c4c8fb05021548bccecd5fa3f2e5feababe2b4a31ed96d73bd4c7d9556e583a"><div class="ttname"><a href="../../d5/dd5/namespacepx_1_1cds.html#a24c4c8fb05021548bccecd5fa3f2e5feababe2b4a31ed96d73bd4c7d9556e583a">px::cds::SUCCEEDED</a></div><div class="ttdoc">Finished, good. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d7c/request__response_8hpp_source.html#l00062">request_response.hpp:62</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_ae07ebc3f45a1d96370c13bc728330b8f"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae07ebc3f45a1d96370c13bc728330b8f">px::asio::CCdsHandler::_cds_device_map</a></div><div class="ttdeci">cds_device_map_t _cds_device_map</div><div class="ttdoc">A map of the CDS&amp;#39; Device and Channel data, in a px::asio::CCdsDevice container, keyed by each device&amp;#39;...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00789">cds_handler.hpp:789</a></div></div>
<div class="ttc" id="classpx_1_1CDevice_html"><div class="ttname"><a href="../../d6/d5b/classpx_1_1CDevice.html">px::CDevice</a></div><div class="ttdoc">Represents a device, which can be either a publisher, a device connected to the publisher, or a network connector such as INCOM port 1. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d08/device_8hpp_source.html#l00036">device.hpp:36</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsSyncIO_html"><div class="ttname"><a href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html">px::asio::CCdsSyncIO</a></div><div class="ttdoc">Provides a set of common CDS utility functions. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dc6/cds__sync__io_8hpp_source.html#l00041">cds_sync_io.hpp:41</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a7909cedb98efe9b26b6205ac3b7d48e1"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a7909cedb98efe9b26b6205ac3b7d48e1">px::asio::CCdsHandler::_channel_values_callback</a></div><div class="ttdeci">cds_ch_values_callback_t _channel_values_callback</div><div class="ttdoc">The optional callback function for the application to received changed channel values. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00830">cds_handler.hpp:830</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CClient_html_a28b00111c32ca2391045e23966fb7210"><div class="ttname"><a href="../../db/db8/classpx_1_1cds_1_1CClient.html#a28b00111c32ca2391045e23966fb7210">px::cds::CClient::unregister_unsolicited_callback</a></div><div class="ttdeci">PUBLIC void unregister_unsolicited_callback()</div><div class="ttdoc">Unregister the previously registered callback function for unsolicited messages from the CDS...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/client_8cpp_source.html#l00521">client.cpp:521</a></div></div>
<div class="ttc" id="log_8hpp_html_a242c84f819cac7a2d5e9f2e2df788b0e"><div class="ttname"><a href="../../d4/d3d/log_8hpp.html#a242c84f819cac7a2d5e9f2e2df788b0e">LIBPX_DEBUG</a></div><div class="ttdeci">#define LIBPX_DEBUG(__VLVL__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3d/log_8hpp_source.html#l00196">log.hpp:196</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_ae99a652e32b681d13ef351dbea4a2ad1"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#ae99a652e32b681d13ef351dbea4a2ad1">px::asio::CCdsHandler::~CCdsHandler</a></div><div class="ttdeci">virtual PUBLIC ~CCdsHandler()</div><div class="ttdoc">Default destructor, a virtual. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00082">cds_handler.cpp:82</a></div></div>
<div class="ttc" id="log_8hpp_html"><div class="ttname"><a href="../../d4/d3d/log_8hpp.html">log.hpp</a></div><div class="ttdoc">An internal libpx header that defines the syslogging functions. </div></div>
<div class="ttc" id="log_8hpp_html_aedf82e390ea25288cf698a9d9eb470ef"><div class="ttname"><a href="../../d4/d3d/log_8hpp.html#aedf82e390ea25288cf698a9d9eb470ef">LIBPX_INFO</a></div><div class="ttdeci">#define LIBPX_INFO(__VLVL__,...)</div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d3d/log_8hpp_source.html#l00192">log.hpp:192</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsDevice_html"><div class="ttname"><a href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html">px::asio::CCdsDevice</a></div><div class="ttdoc">This class define a container for Device data from the CDS. </div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da3/cds__device_8hpp_source.html#l00024">cds_device.hpp:24</a></div></div>
<div class="ttc" id="namespacepx_1_1sub_html_a9f14ba2d87747d37025c1be590176841a29b57489abff7736fc2f1860190a1efd"><div class="ttname"><a href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a29b57489abff7736fc2f1860190a1efd">px::sub::subscription_type::device_state_recursive</a></div><div class="ttdoc">Update to all device state changes including those of any current and future sub-devices. </div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a0e35161a3e9f1c5a204a396efff80ecb"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0e35161a3e9f1c5a204a396efff80ecb">px::asio::CCdsHandler::_delete_device_callback</a></div><div class="ttdeci">device_delete_callback_t _delete_device_callback</div><div class="ttdoc">The callback function to the application to let it handle the removal of an existing CCdsDevice conta...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00813">cds_handler.hpp:813</a></div></div>
<div class="ttc" id="classpx_1_1CMonoTime_html_a2272cac8e659fb3fb3260c776369f1e2"><div class="ttname"><a href="../../d5/d4c/classpx_1_1CMonoTime.html#a2272cac8e659fb3fb3260c776369f1e2">px::CMonoTime::now</a></div><div class="ttdeci">static PUBLIC CMonoTime now()</div><div class="ttdoc">Factory function to create a new CMonoTime instance set to &amp;quot;now&amp;quot;. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d6c/mono__time_8cpp_source.html#l00010">mono_time.cpp:10</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a0c2473fb91cf4b2786888535da71e51b"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a0c2473fb91cf4b2786888535da71e51b">px::asio::CCdsHandler::closeout_device_map</a></div><div class="ttdeci">PUBLIC void closeout_device_map()</div><div class="ttdoc">Undo the features that we enabled to populate the device map: unsubscribe callbacks, clear the map. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00529">cds_handler.cpp:529</a></div></div>
<div class="ttc" id="namespacepx_1_1sub_html_a9f14ba2d87747d37025c1be590176841a86e7be1e80840bad6d3471e250ff1c2e"><div class="ttname"><a href="../../df/d8a/namespacepx_1_1sub.html#a9f14ba2d87747d37025c1be590176841a86e7be1e80840bad6d3471e250ff1c2e">px::sub::subscription_type::max_subscription_type</a></div><div class="ttdoc">Used to validate subscription type value range. </div></div>
<div class="ttc" id="classpx_1_1cds_1_1CCdsClientLogin_html"><div class="ttname"><a href="../../dc/d26/classpx_1_1cds_1_1CCdsClientLogin.html">px::cds::CCdsClientLogin</a></div><div class="ttdoc">Login with the credentials assigned to this process by virtue of its Linux user ID (assigned by &amp;quot;uid_...</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d6e/login_8hpp_source.html#l00233">login.hpp:233</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a3d74e802843cf6efac6b7ac6cc9d7263"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a3d74e802843cf6efac6b7ac6cc9d7263">px::asio::CCdsHandler::_reqst_queue</a></div><div class="ttdeci">std::deque&lt; queued_req_t &gt; _reqst_queue</div><div class="ttdoc">A FIFO list of message types and device IDs that we want to process for discovery or maintenance...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00856">cds_handler.hpp:856</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_aa3fb9eb8b97a409c3d27c370afcdf993"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#aa3fb9eb8b97a409c3d27c370afcdf993">px::asio::CCdsHandler::_ch_values_sub_id</a></div><div class="ttdeci">px::id_t _ch_values_sub_id</div><div class="ttdoc">The subscription id for all Channel Value updates. </div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00847">cds_handler.hpp:847</a></div></div>
<div class="ttc" id="classpx_1_1CBitset_html_a990ea0e6f3eb03b789d1cd58c74b38f2"><div class="ttname"><a href="../../dd/d57/classpx_1_1CBitset.html#a990ea0e6f3eb03b789d1cd58c74b38f2">px::CBitset::get</a></div><div class="ttdeci">bool get(T flg) const </div><div class="ttdoc">Get the value of a flag. </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d86/bitset_8hpp_source.html#l00080">bitset.hpp:80</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CRequestResponse_html"><div class="ttname"><a href="../../d3/dbb/classpx_1_1cds_1_1CRequestResponse.html">px::cds::CRequestResponse</a></div><div class="ttdoc">All CDS interprocess messages are subclasses of this. </div><div class="ttdef"><b>Definition:</b> <a href="../../de/d7c/request__response_8hpp_source.html#l00096">request_response.hpp:96</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a624f000e659948bbee10971f0fc9cdee"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a624f000e659948bbee10971f0fc9cdee">px::asio::CCdsHandler::_add_dev_sub_id</a></div><div class="ttdeci">px::id_t _add_dev_sub_id</div><div class="ttdoc">The subscription id for our CDS subscriptions for &amp;quot;add device&amp;quot; and &amp;quot;delete device&amp;quot; recursively...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00841">cds_handler.hpp:841</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a52fdbf559cb4e634a650ef82657588b7"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a52fdbf559cb4e634a650ef82657588b7">px::asio::CCdsHandler::cds_ch_settings_callback_t</a></div><div class="ttdeci">std::function&lt; void(const CCdsDevice &amp;, const std::vector&lt; px::CChannelSettings &gt; &amp;)&gt; cds_ch_settings_callback_t</div><div class="ttdoc">Define the function object type to handle px::CGetChannelSettings responses from the CDS...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00109">cds_handler.hpp:109</a></div></div>
<div class="ttc" id="namespacepx_html_aeb85f37e2b5332475a0da66224536220"><div class="ttname"><a href="../../de/dcb/namespacepx.html#aeb85f37e2b5332475a0da66224536220">px::permissions</a></div><div class="ttdeci">permissions</div><div class="ttdoc">permission enumeration </div><div class="ttdef"><b>Definition:</b> <a href="../../d6/d33/permission__enums_8hpp_source.html#l00016">permission_enums.hpp:16</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a8204a8a14186da5d264cb7ea22a146af"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a8204a8a14186da5d264cb7ea22a146af">px::asio::CCdsHandler::_awaiting_resps</a></div><div class="ttdeci">std::map&lt; uint32_t, queued_req_t &gt; _awaiting_resps</div><div class="ttdoc">A map of the message types and device IDs that are awaiting a response, keyed by the their transactio...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00864">cds_handler.hpp:864</a></div></div>
<div class="ttc" id="classpx_1_1CBitset_html"><div class="ttname"><a href="../../dd/d57/classpx_1_1CBitset.html">px::CBitset&lt; px::realtime_state &gt;</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CClient_html_a5aa42d307a74fdd3117745f85a587e34"><div class="ttname"><a href="../../db/db8/classpx_1_1cds_1_1CClient.html#a5aa42d307a74fdd3117745f85a587e34">px::cds::CClient::disconnect</a></div><div class="ttdeci">PUBLIC void disconnect()</div><div class="ttdoc">Disconnect from the CDS. </div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d95/client_8cpp_source.html#l00382">client.cpp:382</a></div></div>
<div class="ttc" id="ping__watchdog_8hpp_html"><div class="ttname"><a href="../../db/d8b/ping__watchdog_8hpp.html">ping_watchdog.hpp</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CGetChannelValue_html_ad405a9803aeb3af1240344a2c4b1bd44"><div class="ttname"><a href="../../d8/d35/classpx_1_1cds_1_1CGetChannelValue.html#ad405a9803aeb3af1240344a2c4b1bd44">px::cds::CGetChannelValue::ids</a></div><div class="ttdeci">std::vector&lt; px::id_t &gt; ids</div><div class="ttdoc">List of channel IDs to query (set by client). </div><div class="ttdef"><b>Definition:</b> <a href="../../d3/d89/get__channel__value_8hpp_source.html#l00122">get_channel_value.hpp:122</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsSyncIO_html_a9476cf54a2363a1a646f3769c5fcd3dc"><div class="ttname"><a href="../../d2/df5/classpx_1_1asio_1_1CCdsSyncIO.html#a9476cf54a2363a1a646f3769c5fcd3dc">px::asio::CCdsSyncIO::get_subscriber_ids</a></div><div class="ttdeci">PUBLIC std::vector&lt; uint64_t &gt; get_subscriber_ids(size_t count, bool reflexive=false)</div><div class="ttdoc">Use CManageSubscriberIDs to request new subscriber ID(s) for our use. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d78/cds__sync__io_8cpp_source.html#l01363">cds_sync_io.cpp:1363</a></div></div>
<div class="ttc" id="classpx_1_1cds_1_1CUpdateSingleChannelValue_html"><div class="ttname"><a href="../../d2/dfb/classpx_1_1cds_1_1CUpdateSingleChannelValue.html">px::cds::CUpdateSingleChannelValue</a></div><div class="ttdoc">Structure of a single channel value update (channel ID and variadic value). </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d4b/update__channel__value_8hpp_source.html#l00019">update_channel_value.hpp:19</a></div></div>
<div class="ttc" id="namespacepx_html_a7acb13796ae56fe8e773fe781eedd790"><div class="ttname"><a href="../../de/dcb/namespacepx.html#a7acb13796ae56fe8e773fe781eedd790">px::string</a></div><div class="ttdeci">::__gnu_cxx::__vstring string</div><div class="ttdoc">We&amp;#39;re currently utilizing GCC&amp;#39;s &amp;quot;versatile string&amp;quot; class. </div><div class="ttdef"><b>Definition:</b> <a href="../../d4/d76/type_2string_8hpp_source.html#l00028">type/string.hpp:28</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a04a2b0f57c4dee19c0c178f71b7fc146"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a04a2b0f57c4dee19c0c178f71b7fc146">px::asio::CCdsHandler::_last_transaction_id</a></div><div class="ttdeci">uint32_t _last_transaction_id</div><div class="ttdoc">Notes the last TransID processed in the internal callback handler Useful so we don&amp;#39;t queue &amp;quot;waiting&amp;quot; ...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00887">cds_handler.hpp:887</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a959ebec907e436ed208793395f8e4cf6"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a959ebec907e436ed208793395f8e4cf6">px::asio::CCdsHandler::internal_handle_response</a></div><div class="ttdeci">PUBLIC void internal_handle_response(std::shared_ptr&lt; px::cds::CRequestResponse &gt; resp)</div><div class="ttdoc">Called by the CDS when one or more unsolicited, subscription update, or solicited responses are ready...</div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00853">cds_handler.cpp:853</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsHandler_html_a37228ed2d170ccea24335355b09402b0"><div class="ttname"><a href="../../d2/dcb/classpx_1_1asio_1_1CCdsHandler.html#a37228ed2d170ccea24335355b09402b0">px::asio::CCdsHandler::lookup_map_device</a></div><div class="ttdeci">bool lookup_map_device(px::id_t dev_id, cds_device_map_iter_t &amp;map_pos)</div><div class="ttdoc">Getter for a mutable CCdsDevice instance in our map, looked up by its Device ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../db/db1/cds__handler_8cpp_source.html#l00744">cds_handler.cpp:744</a></div></div>
<div class="ttc" id="structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s_html"><div class="ttname"><a href="../../dd/d8d/structpx_1_1asio_1_1CCdsHandler_1_1queued__req__s.html">px::asio::CCdsHandler::queued_req_s</a></div><div class="ttdoc">Define the structure for the queued and waiting-for-response requests Used in the _reqst_queue deque ...</div><div class="ttdef"><b>Definition:</b> <a href="../../df/d9c/cds__handler_8hpp_source.html#l00130">cds_handler.hpp:130</a></div></div>
<div class="ttc" id="classpx_1_1CDevice_html_a4ade246292d8b52df1b4395087231ad5"><div class="ttname"><a href="../../d6/d5b/classpx_1_1CDevice.html#a4ade246292d8b52df1b4395087231ad5">px::CDevice::sub_devices</a></div><div class="ttdeci">devlist_t sub_devices</div><div class="ttdoc">A list of sub device id&amp;#39;s which are grouped directly &amp;quot;under&amp;quot; this device. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d08/device_8hpp_source.html#l00416">device.hpp:416</a></div></div>
<div class="ttc" id="subscriber__notify_8hpp_html"><div class="ttname"><a href="../../d8/df9/subscriber__notify_8hpp.html">subscriber_notify.hpp</a></div></div>
<div class="ttc" id="client_8hpp_html"><div class="ttname"><a href="../../d2/dfe/client_8hpp.html">client.hpp</a></div></div>
<div class="ttc" id="create__device_8hpp_html"><div class="ttname"><a href="../../d4/db0/create__device_8hpp.html">create_device.hpp</a></div></div>
<div class="ttc" id="get__channel__value_8hpp_html"><div class="ttname"><a href="../../d3/d89/get__channel__value_8hpp.html">get_channel_value.hpp</a></div></div>
<div class="ttc" id="classpx_1_1CDevice_html_ab836878b0d7f55ad3d16b937994f3df0"><div class="ttname"><a href="../../d6/d5b/classpx_1_1CDevice.html#ab836878b0d7f55ad3d16b937994f3df0">px::CDevice::id</a></div><div class="ttdeci">px::id_t id() const </div><div class="ttdoc">Getter for device ID. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d08/device_8hpp_source.html#l00236">device.hpp:236</a></div></div>
<div class="ttc" id="classpx_1_1asio_1_1CCdsDevice_html_a074c5f9be4f7d9513374eba7054725ee"><div class="ttname"><a href="../../da/d67/classpx_1_1asio_1_1CCdsDevice.html#a074c5f9be4f7d9513374eba7054725ee">px::asio::CCdsDevice::_channel_settings_count</a></div><div class="ttdeci">size_t _channel_settings_count</div><div class="ttdoc">If the Channel Settings data is requested, then this keeps track of how many Channels were included i...</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da3/cds__device_8hpp_source.html#l00072">cds_device.hpp:72</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../dir_0e92ad6578cdb0742396e0d69fb8d85e.html">source</a></li><li class="navelem"><a class="el" href="../../dir_bc2cdec2015e9ef6f40c6b6845a4c8bc.html">asio</a></li><li class="navelem"><a class="el" href="../../dir_cdf5dabdab158199e0aab8bfa3265baf.html">cds</a></li><li class="navelem"><a class="el" href="../../db/db1/cds__handler_8cpp.html">cds_handler.cpp</a></li>
    <li class="footer">Generated on Fri May 7 2021 20:24:18 for libpx by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
