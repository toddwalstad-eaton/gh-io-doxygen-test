<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>bacnet_ip: &#39;C&#39; function interface to BACnet-stack handlers for routing.</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">bacnet_ip
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d3/d9d/group__bip__routing__interface.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">'C' function interface to BACnet-stack handlers for routing.<div class="ingroups"><a class="el" href="../../d6/d51/group__bac__stack__interface.html">'C' functions to interface to the BACnet library, bacnet-stack.</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>The handlers in the BAC-stack code (eg, h_iam.c) fortunately make all their object references through the Device object or, as here, the Routed_Device object.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for 'C' function interface to BACnet-stack handlers for routing.:</div>
<div class="dyncontent">
<center><table><tr><td><img src="../../d3/d9d/group__bip__routing__interface.png" border="0" alt="" usemap="#d3_2d9d_2group____bip____routing____interface"/>
<map name="d3_2d9d_2group____bip____routing____interface" id="d3_2d9d_2group____bip____routing____interface">
<area shape="rect" id="node2" href="../../d6/d51/group__bac__stack__interface.html" title="Consist of three areas: " alt="" coords="6,5,189,61"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gad5f8959ff2560a1a1ec5af223ad7b99b"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#gad5f8959ff2560a1a1ec5af223ad7b99b">set_global_core_pointer</a> (std::shared_ptr&lt; <a class="el" href="../../d7/d39/classCBacnetIpCore.html">CBacnetIpCore</a> &gt; bip_core)</td></tr>
<tr class="separator:gad5f8959ff2560a1a1ec5af223ad7b99b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac78c54906fa10c659b7899158a825582"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#gac78c54906fa10c659b7899158a825582">release_global_core_pointer</a> ()</td></tr>
<tr class="separator:gac78c54906fa10c659b7899158a825582"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab192b293040106b05da1e36aeb6d4a7b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#gab192b293040106b05da1e36aeb6d4a7b">set_current_device_idx</a> (size_t new_instance)</td></tr>
<tr class="memdesc:gab192b293040106b05da1e36aeb6d4a7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the global Current Device instance number (Device Map key) and corresponding Device BACnet Address.  <a href="#gab192b293040106b05da1e36aeb6d4a7b">More...</a><br/></td></tr>
<tr class="separator:gab192b293040106b05da1e36aeb6d4a7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga971e4aeaf895b910e49023caca533cf9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#ga971e4aeaf895b910e49023caca533cf9">routed_get_my_address</a> (BACNET_ADDRESS *my_address)</td></tr>
<tr class="memdesc:ga971e4aeaf895b910e49023caca533cf9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the currently active BACnet address.  <a href="#ga971e4aeaf895b910e49023caca533cf9">More...</a><br/></td></tr>
<tr class="separator:ga971e4aeaf895b910e49023caca533cf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga940845003a64e833f94471fe5b531400"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#ga940845003a64e833f94471fe5b531400">bip_get_my_address</a> (BACNET_ADDRESS *my_address)</td></tr>
<tr class="memdesc:ga940845003a64e833f94471fe5b531400"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the currently active BACnet address (which is just the main device) This is an implementation of the datalink_get_my_address() template for devices without routing (where CONFIG_BACNET_IS_GATEWAY is 'n')  <a href="#ga940845003a64e833f94471fe5b531400">More...</a><br/></td></tr>
<tr class="separator:ga940845003a64e833f94471fe5b531400"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad96261731b8474533d85924282ad8bef"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#gad96261731b8474533d85924282ad8bef">Routed_Device_GetNext</a> (BACNET_ADDRESS *dest, int *DNET_list, int *cursor)</td></tr>
<tr class="memdesc:gad96261731b8474533d85924282ad8bef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Find the next Gateway or Routed Device at the given dest-&gt;adr[] MAC address, starting the search at the "cursor" instance number.  <a href="#gad96261731b8474533d85924282ad8bef">More...</a><br/></td></tr>
<tr class="separator:gad96261731b8474533d85924282ad8bef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf081d613b434a94741a88954644aaca9"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#gaf081d613b434a94741a88954644aaca9">Routed_Device_Is_Valid_Network</a> (uint16_t dest_net, int *DNET_list)</td></tr>
<tr class="memdesc:gaf081d613b434a94741a88954644aaca9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check if the destination network is reachable - is it our virtual network, or local or else broadcast.  <a href="#gaf081d613b434a94741a88954644aaca9">More...</a><br/></td></tr>
<tr class="separator:gaf081d613b434a94741a88954644aaca9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaca13e00f88c28db7220d0b523397a87f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/dd7/classCBacnetDeviceObject.html">CBacnetDeviceObject</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#gaca13e00f88c28db7220d0b523397a87f">get_current_device_object</a> ()</td></tr>
<tr class="memdesc:gaca13e00f88c28db7220d0b523397a87f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a pointer to the current Device object (look up from the current global setting for instance number).  <a href="#gaca13e00f88c28db7220d0b523397a87f">More...</a><br/></td></tr>
<tr class="separator:gaca13e00f88c28db7220d0b523397a87f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7f5cca42b89da297673ef71d164c235c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#ga7f5cca42b89da297673ef71d164c235c">Routed_Device_Service_Approval</a> (BACNET_CONFIRMED_SERVICE service, int, uint8_t *apdu_buff, uint8_t invoke_id)</td></tr>
<tr class="memdesc:ga7f5cca42b89da297673ef71d164c235c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Check to see if the current Device supports this service.  <a href="#ga7f5cca42b89da297673ef71d164c235c">More...</a><br/></td></tr>
<tr class="separator:ga7f5cca42b89da297673ef71d164c235c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0943ce1497b79465603718616369a454"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#ga0943ce1497b79465603718616369a454">handler_etn_who_is_unicast_for_routing</a> (uint8_t *service_request, uint16_t service_len, BACNET_ADDRESS *src)</td></tr>
<tr class="memdesc:ga0943ce1497b79465603718616369a454"><td class="mdescLeft">&#160;</td><td class="mdescRight">Handler for Who-Is requests in the virtual routing setup, with a single unicast I-Am response returned to the src, from the "current" BACnet device.  <a href="#ga0943ce1497b79465603718616369a454">More...</a><br/></td></tr>
<tr class="separator:ga0943ce1497b79465603718616369a454"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:ga96076c82f2cbd247a9f254cfbad29af1"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="../../d7/d39/classCBacnetIpCore.html">CBacnetIpCore</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#ga96076c82f2cbd247a9f254cfbad29af1">global_core_ptr</a></td></tr>
<tr class="memdesc:ga96076c82f2cbd247a9f254cfbad29af1"><td class="mdescLeft">&#160;</td><td class="mdescRight">C function interface to BACnet-stack handlers, for Device-based functions.  <a href="#ga96076c82f2cbd247a9f254cfbad29af1">More...</a><br/></td></tr>
<tr class="separator:ga96076c82f2cbd247a9f254cfbad29af1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaece579c3b4b8ef21b71f6b1d28f50b46"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#gaece579c3b4b8ef21b71f6b1d28f50b46">current_device_instance</a></td></tr>
<tr class="memdesc:gaece579c3b4b8ef21b71f6b1d28f50b46"><td class="mdescLeft">&#160;</td><td class="mdescRight">For the bacnet-stack interface, need to keep the instance number of the "Current" Device.  <a href="#gaece579c3b4b8ef21b71f6b1d28f50b46">More...</a><br/></td></tr>
<tr class="separator:gaece579c3b4b8ef21b71f6b1d28f50b46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae877db4a958e18b4b190b34705335f0d"><td class="memItemLeft" align="right" valign="top">BACNET_ADDRESS&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d3/d9d/group__bip__routing__interface.html#gae877db4a958e18b4b190b34705335f0d">currentBacnetAddress</a></td></tr>
<tr class="memdesc:gae877db4a958e18b4b190b34705335f0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Local copy of BACnet Address of "Current" Device, for the stack.  <a href="#gae877db4a958e18b4b190b34705335f0d">More...</a><br/></td></tr>
<tr class="separator:gae877db4a958e18b4b190b34705335f0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The handlers in the BAC-stack code (eg, h_iam.c) fortunately make all their object references through the Device object or, as here, the Routed_Device object. </p>
<p>The following functions provide our interface to our C++ objects to satisfy the handlers when they call. The key intersection is to use the root (gateway) BacDeviceObject pointed to by our global structure to determine which Device the bacnet-stack is currently pointed to. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gad5f8959ff2560a1a1ec5af223ad7b99b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void set_global_core_pointer </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="../../d7/d39/classCBacnetIpCore.html">CBacnetIpCore</a> &gt;&#160;</td>
          <td class="paramname"><em>bip_core</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00078">78</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/d9d/group__bip__routing__interface_gad5f8959ff2560a1a1ec5af223ad7b99b_icgraph.png" border="0" usemap="#d3/d9d/group__bip__routing__interface_gad5f8959ff2560a1a1ec5af223ad7b99b_icgraph" alt=""/></div>
<map name="d3/d9d/group__bip__routing__interface_gad5f8959ff2560a1a1ec5af223ad7b99b_icgraph" id="d3/d9d/group__bip__routing__interface_gad5f8959ff2560a1a1ec5af223ad7b99b_icgraph">
<area shape="rect" id="node2" href="../../d9/dc2/classCBacnetRouting.html#a26b0ad15c2703aa28f6626acdcca7bcf" title="Constructor, which initializes our access to CDS and class data. " alt="" coords="233,5,469,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gac78c54906fa10c659b7899158a825582"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void release_global_core_pointer </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00087">87</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/d9d/group__bip__routing__interface_gac78c54906fa10c659b7899158a825582_icgraph.png" border="0" usemap="#d3/d9d/group__bip__routing__interface_gac78c54906fa10c659b7899158a825582_icgraph" alt=""/></div>
<map name="d3/d9d/group__bip__routing__interface_gac78c54906fa10c659b7899158a825582_icgraph" id="d3/d9d/group__bip__routing__interface_gac78c54906fa10c659b7899158a825582_icgraph">
<area shape="rect" id="node2" href="../../d9/dc2/classCBacnetRouting.html#ac99b5cab41e2290c0cff176808b4f8cf" title="Default destructor. " alt="" coords="206,5,405,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gab192b293040106b05da1e36aeb6d4a7b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void set_current_device_idx </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>new_instance</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the global Current Device instance number (Device Map key) and corresponding Device BACnet Address. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">new_instance</td><td>Device map key for a routed Virtual Device, or the gateway Device if the instance == 1. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00095">95</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/d9d/group__bip__routing__interface_gab192b293040106b05da1e36aeb6d4a7b_icgraph.png" border="0" usemap="#d3/d9d/group__bip__routing__interface_gab192b293040106b05da1e36aeb6d4a7b_icgraph" alt=""/></div>
<map name="d3/d9d/group__bip__routing__interface_gab192b293040106b05da1e36aeb6d4a7b_icgraph" id="d3/d9d/group__bip__routing__interface_gab192b293040106b05da1e36aeb6d4a7b_icgraph">
<area shape="rect" id="node2" href="../../d9/dd7/classCBacnetDeviceObject.html#a8fe2aa76c324462ea6ebc0b223957914" title="Broadcasts an I&#45;Am for this object. " alt="" coords="264,5,427,46"/><area shape="rect" id="node4" href="../../da/d44/group__bac__obj__interface.html#gaa50f50012701060a8832ff64ecc72ec3" title="Looks up the requested Object in the &quot;current&quot; device, and fills the Property Value list with the pre..." alt="" coords="248,71,443,97"/><area shape="rect" id="node5" href="../../d9/dc2/classCBacnetRouting.html#a26b0ad15c2703aa28f6626acdcca7bcf" title="Constructor, which initializes our access to CDS and class data. " alt="" coords="227,121,463,148"/><area shape="rect" id="node6" href="../../d3/d9d/group__bip__routing__interface.html#gad96261731b8474533d85924282ad8bef" title="Find the next Gateway or Routed Device at the given dest&#45;&gt;adr[] MAC address, starting the search at t..." alt="" coords="255,172,435,199"/><area shape="rect" id="node3" href="../../d0/d58/classCBacnetIpHandler.html#ab3acaa7dd3625f151d768ac06a71f147" title="Broadcast BACnet/IP I&#45;Ams for all devices and I&#45;Am&#45;Router&#45;to&#45;Network. " alt="" coords="512,5,691,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga971e4aeaf895b910e49023caca533cf9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void routed_get_my_address </td>
          <td>(</td>
          <td class="paramtype">BACNET_ADDRESS *&#160;</td>
          <td class="paramname"><em>my_address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the currently active BACnet address. </p>
<p>This is an implementation of the datalink_get_my_address() template for devices with routing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">my_address</td><td>Points to the currently active Device Object's BACnet address. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00141">141</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ga940845003a64e833f94471fe5b531400"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void bip_get_my_address </td>
          <td>(</td>
          <td class="paramtype">BACNET_ADDRESS *&#160;</td>
          <td class="paramname"><em>my_address</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the currently active BACnet address (which is just the main device) This is an implementation of the datalink_get_my_address() template for devices without routing (where CONFIG_BACNET_IS_GATEWAY is 'n') </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">my_address</td><td>Points to the main Device Object's BACnet address. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00151">151</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="gad96261731b8474533d85924282ad8bef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Routed_Device_GetNext </td>
          <td>(</td>
          <td class="paramtype">BACNET_ADDRESS *&#160;</td>
          <td class="paramname"><em>dest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>DNET_list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>cursor</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Find the next Gateway or Routed Device at the given dest-&gt;adr[] MAC address, starting the search at the "cursor" instance number. </p>
<p>Has the desirable side-effect of setting internal current_device_instance if a match is found, for use in the subsequent routing handling functions. Will pass over devices in our map that have gone missing / invalid.</p>
<p>This function is most useful when the dest address is a broadcast and this function is called in a loop to check each device (eg, for Who-Is). The loop will run until this function returns a cursor of -1 or returns false.</p>
<p>Higher level functions do not provide any valid contents for dest-&gt;mac_len or dest-&gt;mac[], so we ignore them here.</p>
<p>We handle the following cases (assuming valid routed device instances 2-N), though invalid routed devices would be skipped) and Routed Network Number = DNET (and "cur_dev_inst" = current_device_instance) :</p>
<table class="doxtable">
<tr>
<th>dest contents </th><th>cursor[in] </th><th>return </th><th>cursor[out] </th><th>cur_dev_inst </th><th>description  </th></tr>
<tr>
<td>(anything) </td><td>-1 </td><td>false </td><td>-1 </td><td>No change </td><td>Already done before entry </td></tr>
<tr>
<td>dest-&gt;net = 0 </td><td>0+ </td><td>true </td><td>-1 (done) </td><td>Gateway </td><td>Not routed; must be for gateway (or we wouldn't have rec'd this) </td></tr>
<tr>
<td>net = bcast </td><td>0 - 1 </td><td>true </td><td>2 (next) </td><td>Gateway </td><td>Broadcast to all; cursor = 1st routed device </td></tr>
<tr>
<td>net = bcast </td><td>2 -(N-1) </td><td>true </td><td>3 - N (next) </td><td>2 -(N-1) </td><td>Broadcast to all (addressing into routed devices) </td></tr>
<tr>
<td>net = bcast </td><td>N </td><td>true </td><td>-1 (done) </td><td>N (last) </td><td>Broadcast; no more available </td></tr>
<tr>
<td>net=DNET, MAC=0 </td><td>0 - N </td><td>true </td><td>same as bcast </td><td>same as bcast </td><td>Broadcast to DNET (MAC all 0s or its len = 0); same as net=bcast </td></tr>
<tr>
<td>net=DNET, MAC=2 </td><td>0+ </td><td>true </td><td>-1 (done) </td><td>2 </td><td>Unicast to instance 2; cursor ignored; no more </td></tr>
<tr>
<td>net=DNET, MAC=N+1 </td><td>0+ </td><td>false </td><td>-1 (done) </td><td>No change </td><td>Unicast to instance no-such device; fails </td></tr>
<tr>
<td>net=DNET, MAC=0 </td><td>N+1 </td><td>false </td><td>-1 (done) </td><td>No change </td><td>Broadcast to instance no-such device; fails </td></tr>
<tr>
<td>net=wrong </td><td>0+ </td><td>false </td><td>-1 (done) </td><td>No change </td><td>Unicast to wrong routed network; fails </td></tr>
</table>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">dest</td><td>The BACNET_ADDRESS of the message's destination. The mac_len and mac[] are invalid here; we just focus on the net, len, and adr[] to see if we are trying to reach a routed device. </td></tr>
    <tr><td class="paramdir"></td><td class="paramname">DNET_list</td><td>List of our reachable downstream BACnet Network numbers. Normally just one valid entry; terminated with a -1 value. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cursor</td><td>The concept of the cursor is that it is a starting "hint" for the search; on return, it is updated to the "next" valid device instance number to provide the cursor value to use with a subsequent GetNext call, or it equals -1 if there are no further matches. Set it to 0 on entry to access the main, gateway Device entry, or to start looping through the routed devices. Otherwise, its returned value is implementation-dependent and the calling function should not alter or interpret it. Here, the cursor will be the device instance number for the CBacnetIpConfig::_routed_device_map entry (when &gt; 1).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if the MAC addresses match (or was a broadcast, where it's an automatic match). Else False if no MAC match or no remaining devices at or after the cursor value; the cursor will be returned as -1 in these cases. </dd></dl>

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00212">212</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/d9d/group__bip__routing__interface_gad96261731b8474533d85924282ad8bef_cgraph.png" border="0" usemap="#d3/d9d/group__bip__routing__interface_gad96261731b8474533d85924282ad8bef_cgraph" alt=""/></div>
<map name="d3/d9d/group__bip__routing__interface_gad96261731b8474533d85924282ad8bef_cgraph" id="d3/d9d/group__bip__routing__interface_gad96261731b8474533d85924282ad8bef_cgraph">
<area shape="rect" id="node2" href="../../d3/d9d/group__bip__routing__interface.html#gab192b293040106b05da1e36aeb6d4a7b" title="Set the global Current Device instance number (Device Map key) and corresponding Device BACnet Addres..." alt="" coords="235,5,407,32"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gaf081d613b434a94741a88954644aaca9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool Routed_Device_Is_Valid_Network </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>dest_net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>DNET_list</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check if the destination network is reachable - is it our virtual network, or local or else broadcast. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dest_net</td><td>[in] The BACnet network number of a message's destination. Success if it is our virtual network number, or 0 (local for the gateway, or 0xFFFF for a broadcast network number. </td></tr>
    <tr><td class="paramname">DNET_list</td><td>[in] List of our reachable downstream BACnet Network numbers. Normally just one valid entry; terminated with a -1 value. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if matches our virtual network, or is for the local network Device (the gateway), or is BACNET_BROADCAST_NETWORK, which is an automatic match. Else False if not a reachable network. </dd></dl>

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00311">311</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="gaca13e00f88c28db7220d0b523397a87f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/dd7/classCBacnetDeviceObject.html">CBacnetDeviceObject</a>* get_current_device_object </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a pointer to the current Device object (look up from the current global setting for instance number). </p>
<dl class="section return"><dt>Returns</dt><dd>Pointer to class instance of current Device. Must not return NULL. </dd></dl>

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00341">341</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/d9d/group__bip__routing__interface_gaca13e00f88c28db7220d0b523397a87f_icgraph.png" border="0" usemap="#d3/d9d/group__bip__routing__interface_gaca13e00f88c28db7220d0b523397a87f_icgraph" alt=""/></div>
<map name="d3/d9d/group__bip__routing__interface_gaca13e00f88c28db7220d0b523397a87f_icgraph" id="d3/d9d/group__bip__routing__interface_gaca13e00f88c28db7220d0b523397a87f_icgraph">
<area shape="rect" id="node2" href="../../da/d44/group__bac__obj__interface.html#ga4c8fe6ec6412b93c87a96717d631d803" title="Return the Object Instance number for our (single) Device Object. " alt="" coords="219,5,397,46"/><area shape="rect" id="node5" href="../../da/d44/group__bac__obj__interface.html#ga5face75a3cab23a3387d9a2faf11d713" title="Determine if we have an object of this type and instance number. " alt="" coords="221,71,395,97"/><area shape="rect" id="node6" href="../../da/d44/group__bac__obj__interface.html#gaadb324a10206a1636760e8ebb02acacb" title="Determine if we have an object with the given object_name. " alt="" coords="207,121,409,148"/><area shape="rect" id="node7" href="../../da/d44/group__bac__obj__interface.html#gae183a714ec03abaa9116750e8f56827d" title="Triggers a device reinitialization, to a given state. " alt="" coords="235,172,381,199"/><area shape="rect" id="node8" href="../../da/d44/group__bac__obj__interface.html#gad05ce74412f922ef288487c9db91b643" title="Looks up the requested Object and Property, and encodes its Value in an APDU. " alt="" coords="224,223,392,249"/><area shape="rect" id="node10" href="../../da/d44/group__bac__obj__interface.html#ga2fb009d583358b1ef48ef4622ffa723f" title="For a given object type, returns the special property list. " alt="" coords="201,273,415,300"/><area shape="rect" id="node11" href="../../da/d44/group__bac__obj__interface.html#gaa07e7bea99141696fdc529255f38cf61" title="Attempts to write a new value to one property for this object type of a given instance. " alt="" coords="223,324,393,351"/><area shape="rect" id="node12" href="../../da/d44/group__bac__obj__interface.html#ga3be53b8b938ebcb68c6be8d393cf964d" title="Copy a child object&#39;s object_name value, given its ID. " alt="" coords="207,375,409,401"/><area shape="rect" id="node3" href="../../d3/d9d/group__bip__routing__interface.html#ga0943ce1497b79465603718616369a454" title="Handler for Who&#45;Is requests in the virtual routing setup, with a single unicast I&#45;Am response returne..." alt="" coords="471,5,625,46"/><area shape="rect" id="node4" href="../../d0/d58/classCBacnetIpHandler.html#a64101e782a5defbbb73b68e0758400db" title="Initialize the service configuration for the bacnet&#45;stack functions. " alt="" coords="680,5,848,46"/><area shape="rect" id="node9" href="../../da/d44/group__bac__obj__interface.html#ga847a8623766bd9cf2faf3dcfb80e8428" title="Looks up the requested &quot;local&quot; Device and Property, and encodes its Value in an APDU. " alt="" coords="464,215,632,257"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga7f5cca42b89da297673ef71d164c235c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int Routed_Device_Service_Approval </td>
          <td>(</td>
          <td class="paramtype">BACNET_CONFIRMED_SERVICE&#160;</td>
          <td class="paramname"><em>service</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>service_argument</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>apdu_buff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>invoke_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Check to see if the current Device supports this service. </p>
<p>Presently checks for RD, DCC, and COV, and only allows it if the current device is the gateway device.</p>
<p>This function is also invoked when building the device's PROP_PROTOCOL_SERVICES_SUPPORTED; that is an instance where the apdu_buff pointer is null, since it is only a validity check.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">service</td><td>[in] The service being requested. </td></tr>
    <tr><td class="paramname">service_argument</td><td>[in] An optional argument (eg, service type). </td></tr>
    <tr><td class="paramname">apdu_buff</td><td>[in,out] The buffer where we will encode a Reject message. May be NULL if don't want an encoded response. </td></tr>
    <tr><td class="paramname">invoke_id</td><td>[in] The invoke_id of the service request. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Length of bytes encoded in apdu_buff[] for a Reject message, just 1 if no apdu_buff was supplied and service is not supported, else 0 if service is approved for the current device. </dd></dl>

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00359">359</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="ga0943ce1497b79465603718616369a454"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handler_etn_who_is_unicast_for_routing </td>
          <td>(</td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>service_request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>service_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BACNET_ADDRESS *&#160;</td>
          <td class="paramname"><em>src</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Handler for Who-Is requests in the virtual routing setup, with a single unicast I-Am response returned to the src, from the "current" BACnet device. </p>
<p>Will check the gateway (root Device) and all virtual routed Devices against the range, if given, and respond if it matches.</p>
<p>Note: this was moved from the bacnet-stack's handler_who_is_unicast_for_routing() because the apdu_handler looped through all devices and called that function, which then also looped through all devices (if a DNET global or local broadcast) and sent many more than one I-Am per device.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">service_request</td><td>[in] The received message to be handled. </td></tr>
    <tr><td class="paramname">service_len</td><td>[in] Length of the service_request message. </td></tr>
    <tr><td class="paramname">src</td><td>[in] The BACNET_ADDRESS of the message's source that the response will be sent back to. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00434">434</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/d9d/group__bip__routing__interface_ga0943ce1497b79465603718616369a454_cgraph.png" border="0" usemap="#d3/d9d/group__bip__routing__interface_ga0943ce1497b79465603718616369a454_cgraph" alt=""/></div>
<map name="d3/d9d/group__bip__routing__interface_ga0943ce1497b79465603718616369a454_cgraph" id="d3/d9d/group__bip__routing__interface_ga0943ce1497b79465603718616369a454_cgraph">
<area shape="rect" id="node2" href="../../da/d44/group__bac__obj__interface.html#ga4c8fe6ec6412b93c87a96717d631d803" title="Return the Object Instance number for our (single) Device Object. " alt="" coords="208,38,387,79"/><area shape="rect" id="node3" href="../../d3/d9d/group__bip__routing__interface.html#gaca13e00f88c28db7220d0b523397a87f" title="Get a pointer to the current Device object (look up from the current global setting for instance numb..." alt="" coords="456,5,603,46"/><area shape="rect" id="node4" href="../../dd/d0a/classCBacnetObject.html#adc2fd19e7650da6303eabae07cdfc7a4" title="Getter for this object&#39;s Object_Instance (the ID part of ObjectID). " alt="" coords="435,70,624,111"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../d3/d9d/group__bip__routing__interface_ga0943ce1497b79465603718616369a454_icgraph.png" border="0" usemap="#d3/d9d/group__bip__routing__interface_ga0943ce1497b79465603718616369a454_icgraph" alt=""/></div>
<map name="d3/d9d/group__bip__routing__interface_ga0943ce1497b79465603718616369a454_icgraph" id="d3/d9d/group__bip__routing__interface_ga0943ce1497b79465603718616369a454_icgraph">
<area shape="rect" id="node2" href="../../d0/d58/classCBacnetIpHandler.html#a64101e782a5defbbb73b68e0758400db" title="Initialize the service configuration for the bacnet&#45;stack functions. " alt="" coords="208,5,376,46"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="ga96076c82f2cbd247a9f254cfbad29af1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="../../d7/d39/classCBacnetIpCore.html">CBacnetIpCore</a>&gt; global_core_ptr</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>C function interface to BACnet-stack handlers, for Device-based functions. </p>
<p>The handlers in the BAC-stack code (eg, h_iam.c) fortunately make all their object references through the Device object. The following functions provide our interface to our C++ objects to satisfy the handlers when they call. The key intersection is to use the (single) <a class="el" href="../../d9/dd7/classCBacnetDeviceObject.html" title="The class that provides Device data, mapped from the CDS data to BACnet. ">CBacnetDeviceObject</a> pointed to by our </p>
<h2>main core class. </h2>

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00064">64</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="gaece579c3b4b8ef21b71f6b1d28f50b46"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t current_device_instance</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For the bacnet-stack interface, need to keep the instance number of the "Current" Device. </p>
<p>That is, the gateway or virtual device we are currently accessing. We will use the device index of the current Device, which is 1 for the gateway Device. For the routed devices, this instance is their key to </p>

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00071">71</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="gae877db4a958e18b4b190b34705335f0d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BACNET_ADDRESS currentBacnetAddress</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Local copy of BACnet Address of "Current" Device, for the stack. </p>

<p>Definition at line <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html#l00074">74</a> of file <a class="el" href="../../df/d0d/bacnet__routing_8cpp_source.html">bacnet_routing.cpp</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 7 2021 20:25:56 for bacnet_ip by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
