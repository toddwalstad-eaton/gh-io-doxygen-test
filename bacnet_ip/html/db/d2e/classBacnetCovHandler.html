<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>bacnet_ip: BacnetCovHandler Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">bacnet_ip
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="../../classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="../../inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="../../functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('db/d2e/classBacnetCovHandler.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="../../d5/d23/classBacnetCovHandler-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">BacnetCovHandler Class Reference<div class="ingroups"><a class="el" href="../../d0/df9/group__BACnet__Services.html">Handlers for BACnet service invocations for bacnet_ip.</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>This class provides the services for the interface between the bacnet-stack's COV handling and the CDS-based channel data for this process.  
 <a href="../../db/d2e/classBacnetCovHandler.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for BacnetCovHandler:</div>
<div class="dyncontent">
<div class="center"><img src="../../df/dc7/classBacnetCovHandler__inherit__graph.png" border="0" usemap="#BacnetCovHandler_inherit__map" alt="Inheritance graph"/></div>
<map name="BacnetCovHandler_inherit__map" id="BacnetCovHandler_inherit__map">
<area shape="rect" id="node2" href="../../dd/d60/classpx_1_1asio_1_1CIoActor.html" title="{px::asio::CIoActor\n||}" alt="" coords="5,5,141,83"/><area shape="rect" id="node3" href="../../db/d01/classpx_1_1asio_1_1CTimedObject.html" title="{CTimedObject\n||}" alt="" coords="165,5,280,83"/></map>
</div>
<div class="dynheader">
Collaboration diagram for BacnetCovHandler:</div>
<div class="dyncontent">
<div class="center"><img src="../../dd/d1e/classBacnetCovHandler__coll__graph.png" border="0" usemap="#BacnetCovHandler_coll__map" alt="Collaboration graph"/></div>
<map name="BacnetCovHandler_coll__map" id="BacnetCovHandler_coll__map">
<area shape="rect" id="node2" href="../../dd/d60/classpx_1_1asio_1_1CIoActor.html" title="{px::asio::CIoActor\n||}" alt="" coords="5,168,141,245"/><area shape="rect" id="node3" href="../../db/d01/classpx_1_1asio_1_1CTimedObject.html" title="{CTimedObject\n||}" alt="" coords="165,168,280,245"/><area shape="rect" id="node11" title="STL class. " alt="" coords="1463,5,1597,83"/></map>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:aa0ed8e596478b0f1525f6a1f2a97a4fa"><td class="memItemLeft" align="right" valign="top">typedef std::pair<br class="typebreak"/>
&lt; px::CMonoTime, <a class="el" href="../../dd/d0a/classCBacnetObject.html">CBacnetObject</a> * &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#aa0ed8e596478b0f1525f6a1f2a97a4fa">active_cov_obj_pair_t</a></td></tr>
<tr class="memdesc:aa0ed8e596478b0f1525f6a1f2a97a4fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Typedefs for this class.  <a href="#aa0ed8e596478b0f1525f6a1f2a97a4fa">More...</a><br/></td></tr>
<tr class="separator:aa0ed8e596478b0f1525f6a1f2a97a4fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af395682ff7c2a0156fb0a80a573974ef"><td class="memItemLeft" align="right" valign="top">typedef std::map&lt; px::id_t, <br class="typebreak"/>
<a class="el" href="../../db/d2e/classBacnetCovHandler.html#aa0ed8e596478b0f1525f6a1f2a97a4fa">active_cov_obj_pair_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#af395682ff7c2a0156fb0a80a573974ef">actively_subsribed_map_t</a></td></tr>
<tr class="memdesc:af395682ff7c2a0156fb0a80a573974ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Define a type for the Actively Subscribed List (actually a map, keyed by the Channel ID).  <a href="#af395682ff7c2a0156fb0a80a573974ef">More...</a><br/></td></tr>
<tr class="separator:af395682ff7c2a0156fb0a80a573974ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a604552a0a64c1631f9dd6722e6e0f39c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a604552a0a64c1631f9dd6722e6e0f39c">BacnetCovHandler</a> (std::shared_ptr&lt; px::asio::CIoManager &gt; asio_manager, std::shared_ptr&lt; <a class="el" href="../../d7/d39/classCBacnetIpCore.html">CBacnetIpCore</a> &gt; bip_core)</td></tr>
<tr class="memdesc:a604552a0a64c1631f9dd6722e6e0f39c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructor.  <a href="#a604552a0a64c1631f9dd6722e6e0f39c">More...</a><br/></td></tr>
<tr class="separator:a604552a0a64c1631f9dd6722e6e0f39c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5483cb2f5eb0fffdf360e8defe26dc9a"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a5483cb2f5eb0fffdf360e8defe26dc9a">~BacnetCovHandler</a> ()</td></tr>
<tr class="memdesc:a5483cb2f5eb0fffdf360e8defe26dc9a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default destructor.  <a href="#a5483cb2f5eb0fffdf360e8defe26dc9a">More...</a><br/></td></tr>
<tr class="separator:a5483cb2f5eb0fffdf360e8defe26dc9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64ae347a69c1c886eaf81e9cdbdc4d96"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a64ae347a69c1c886eaf81e9cdbdc4d96">init_cov_services</a> ()</td></tr>
<tr class="memdesc:a64ae347a69c1c886eaf81e9cdbdc4d96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the COV services.  <a href="#a64ae347a69c1c886eaf81e9cdbdc4d96">More...</a><br/></td></tr>
<tr class="separator:a64ae347a69c1c886eaf81e9cdbdc4d96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4a668d5899c28a92a6cd625ccfae8b4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#aa4a668d5899c28a92a6cd625ccfae8b4">channel_values_callback</a> (const std::map&lt; px::id_t, px::CValue &gt; &amp;ch_map, const px::CWallTime &amp;update_time)</td></tr>
<tr class="memdesc:aa4a668d5899c28a92a6cd625ccfae8b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback function to handle the channel value change notifications from the CDS.  <a href="#aa4a668d5899c28a92a6cd625ccfae8b4">More...</a><br/></td></tr>
<tr class="separator:aa4a668d5899c28a92a6cd625ccfae8b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cbbda6a4f72d57db6d70eeefc3e4e78"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a1cbbda6a4f72d57db6d70eeefc3e4e78">update_active_subscription</a> (<a class="el" href="../../dd/d0a/classCBacnetObject.html">CBacnetObject</a> *obj_ptr)</td></tr>
<tr class="memdesc:a1cbbda6a4f72d57db6d70eeefc3e4e78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Add or update this object's entry in the Actively Subscribed List (_actively_subscribed_map) whenever this function is called.  <a href="#a1cbbda6a4f72d57db6d70eeefc3e4e78">More...</a><br/></td></tr>
<tr class="separator:a1cbbda6a4f72d57db6d70eeefc3e4e78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62c628388571637e9587758d9c2677db"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a62c628388571637e9587758d9c2677db">push_cov_updates</a> ()</td></tr>
<tr class="memdesc:a62c628388571637e9587758d9c2677db"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to manage sending the list of pending updates to each object.  <a href="#a62c628388571637e9587758d9c2677db">More...</a><br/></td></tr>
<tr class="separator:a62c628388571637e9587758d9c2677db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61af971324b65ffae0643327732166a4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a61af971324b65ffae0643327732166a4">close</a> ()</td></tr>
<tr class="memdesc:a61af971324b65ffae0643327732166a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close out the COV services.  <a href="#a61af971324b65ffae0643327732166a4">More...</a><br/></td></tr>
<tr class="separator:a61af971324b65ffae0643327732166a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a9dd158b6c2bb91cf229df5f99d1456f1"><td class="memItemLeft" align="right" valign="top">const unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a9dd158b6c2bb91cf229df5f99d1456f1">_COV_TIMEBASE_MSECS</a> = 100</td></tr>
<tr class="memdesc:a9dd158b6c2bb91cf229df5f99d1456f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures the value of our sub-second timebase.  <a href="#a9dd158b6c2bb91cf229df5f99d1456f1">More...</a><br/></td></tr>
<tr class="separator:a9dd158b6c2bb91cf229df5f99d1456f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:ad3f8f1a909f4dc9a25c9a1b9e5eb0041"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#ad3f8f1a909f4dc9a25c9a1b9e5eb0041">check_active_subscriptions</a> ()</td></tr>
<tr class="memdesc:ad3f8f1a909f4dc9a25c9a1b9e5eb0041"><td class="mdescLeft">&#160;</td><td class="mdescRight">Function to periodically check the list of Active Subscriptions and remove any that have aged out (haven't been renewed within _ACTIVE_SUBS_TIMEOUT_SECS).  <a href="#ad3f8f1a909f4dc9a25c9a1b9e5eb0041">More...</a><br/></td></tr>
<tr class="separator:ad3f8f1a909f4dc9a25c9a1b9e5eb0041"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a99c6ea52784d6aaf79a1d9c877d065d5"><td class="memItemLeft" align="right" valign="top">std::map&lt; px::id_t, px::CValue &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a99c6ea52784d6aaf79a1d9c877d065d5">_pending_channel_updates</a></td></tr>
<tr class="memdesc:a99c6ea52784d6aaf79a1d9c877d065d5"><td class="mdescLeft">&#160;</td><td class="mdescRight">A map of recently updated channel values, keyed by the channel IDs, holding the last updated value.  <a href="#a99c6ea52784d6aaf79a1d9c877d065d5">More...</a><br/></td></tr>
<tr class="separator:a99c6ea52784d6aaf79a1d9c877d065d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a282b421526d0fab32cec7ce3cd591c09"><td class="memItemLeft" align="right" valign="top">std::map&lt; px::id_t, px::CValue &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a282b421526d0fab32cec7ce3cd591c09">_swapped_channel_updates</a></td></tr>
<tr class="memdesc:a282b421526d0fab32cec7ce3cd591c09"><td class="mdescLeft">&#160;</td><td class="mdescRight">A second map for recently updated channel values, which will be swapped with _pending_channel_updates when we are ready to process the list of updates (to avoid conflicts with <a class="el" href="../../db/d2e/classBacnetCovHandler.html#aa4a668d5899c28a92a6cd625ccfae8b4" title="Callback function to handle the channel value change notifications from the CDS. ">channel_values_callback()</a>).  <a href="#a282b421526d0fab32cec7ce3cd591c09">More...</a><br/></td></tr>
<tr class="separator:a282b421526d0fab32cec7ce3cd591c09"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31935fbedca7c4491d260bf0c5c646ec"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#af395682ff7c2a0156fb0a80a573974ef">actively_subsribed_map_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a31935fbedca7c4491d260bf0c5c646ec">_actively_subscribed_map</a></td></tr>
<tr class="memdesc:a31935fbedca7c4491d260bf0c5c646ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">The Actively Subscribed List (actually a map, keyed by the Channel ID).  <a href="#a31935fbedca7c4491d260bf0c5c646ec">More...</a><br/></td></tr>
<tr class="separator:a31935fbedca7c4491d260bf0c5c646ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76c38d8d0ba023fb69390b849613522f"><td class="memItemLeft" align="right" valign="top">pthread_rwlock_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a76c38d8d0ba023fb69390b849613522f">_actively_subscribed_map_rwlock</a></td></tr>
<tr class="memdesc:a76c38d8d0ba023fb69390b849613522f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Read-write lock to manage access to _actively_subscribed_map from multiple threads.  <a href="#a76c38d8d0ba023fb69390b849613522f">More...</a><br/></td></tr>
<tr class="separator:a76c38d8d0ba023fb69390b849613522f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af472bd9399b180713ab9e920826e07a6"><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#af472bd9399b180713ab9e920826e07a6">_pending_channel_updates_mutex</a></td></tr>
<tr class="memdesc:af472bd9399b180713ab9e920826e07a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mutex to manage access to _pending_channel_updates from multiple threads.  <a href="#af472bd9399b180713ab9e920826e07a6">More...</a><br/></td></tr>
<tr class="separator:af472bd9399b180713ab9e920826e07a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:aafff7357514b855ea0f37e39f67c62e9"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#aafff7357514b855ea0f37e39f67c62e9">timeout</a> (const px::asio::CIoTimer &amp;timer)</td></tr>
<tr class="memdesc:aafff7357514b855ea0f37e39f67c62e9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timeout callback invoked when the ASIO timer for COV activity timing.  <a href="#aafff7357514b855ea0f37e39f67c62e9">More...</a><br/></td></tr>
<tr class="separator:aafff7357514b855ea0f37e39f67c62e9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:ad909c25e748aff8508da847a1e8c39ec"><td class="memItemLeft" align="right" valign="top">std::shared_ptr&lt; <a class="el" href="../../d7/d39/classCBacnetIpCore.html">CBacnetIpCore</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#ad909c25e748aff8508da847a1e8c39ec">_bip_core</a></td></tr>
<tr class="memdesc:ad909c25e748aff8508da847a1e8c39ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pointer back to the core class that created us.  <a href="#ad909c25e748aff8508da847a1e8c39ec">More...</a><br/></td></tr>
<tr class="separator:ad909c25e748aff8508da847a1e8c39ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae9b15b95351a93238c09784d0bf978db"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#ae9b15b95351a93238c09784d0bf978db">_subsec_counter</a></td></tr>
<tr class="memdesc:ae9b15b95351a93238c09784d0bf978db"><td class="mdescLeft">&#160;</td><td class="mdescRight">A simple up-counter for the _cov_timer; when it reaches 1000/_TIMEBASE_MSECS, then we have the one-second rollover.  <a href="#ae9b15b95351a93238c09784d0bf978db">More...</a><br/></td></tr>
<tr class="separator:ae9b15b95351a93238c09784d0bf978db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07e2ed65d90a900f7d4759c24461d894"><td class="memItemLeft" align="right" valign="top">const unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a07e2ed65d90a900f7d4759c24461d894">_CHECK_ACTIVE_SUBS_SECS</a> = 5 * 60</td></tr>
<tr class="memdesc:a07e2ed65d90a900f7d4759c24461d894"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures the timer setting for checking the Active Subscriptions.  <a href="#a07e2ed65d90a900f7d4759c24461d894">More...</a><br/></td></tr>
<tr class="separator:a07e2ed65d90a900f7d4759c24461d894"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a39782ce5e08cea2761474821d6411dfa"><td class="memItemLeft" align="right" valign="top">const unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a39782ce5e08cea2761474821d6411dfa">_ACTIVE_SUBS_TIMEOUT_SECS</a> = 2 * 60</td></tr>
<tr class="memdesc:a39782ce5e08cea2761474821d6411dfa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configures the timeout to use for checking the Active Subscriptions.  <a href="#a39782ce5e08cea2761474821d6411dfa">More...</a><br/></td></tr>
<tr class="separator:a39782ce5e08cea2761474821d6411dfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa9a67a45d5eb79513e25decec57b782"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#aaa9a67a45d5eb79513e25decec57b782">_sec_counter</a></td></tr>
<tr class="memdesc:aaa9a67a45d5eb79513e25decec57b782"><td class="mdescLeft">&#160;</td><td class="mdescRight">A simple once-per-second up-counter; when it reaches _CHECK_ACTIVE_SUBS_SECS, then it will rollover to 0.  <a href="#aaa9a67a45d5eb79513e25decec57b782">More...</a><br/></td></tr>
<tr class="separator:aaa9a67a45d5eb79513e25decec57b782"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fef20aee713114fd0eafe22a2b141ec"><td class="memItemLeft" align="right" valign="top">time_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a8fef20aee713114fd0eafe22a2b141ec">_past_miliseconds</a></td></tr>
<tr class="memdesc:a8fef20aee713114fd0eafe22a2b141ec"><td class="mdescLeft">&#160;</td><td class="mdescRight">Following variable will store the past value of timer in milliseconds.  <a href="#a8fef20aee713114fd0eafe22a2b141ec">More...</a><br/></td></tr>
<tr class="separator:a8fef20aee713114fd0eafe22a2b141ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d1c20d4362d613eafa94c3de3207e1c"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#a0d1c20d4362d613eafa94c3de3207e1c">_tsm_engine_running</a></td></tr>
<tr class="memdesc:a0d1c20d4362d613eafa94c3de3207e1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Following variable will indicate the status of tsm_engine i.e. running/stopped.  <a href="#a0d1c20d4362d613eafa94c3de3207e1c">More...</a><br/></td></tr>
<tr class="separator:a0d1c20d4362d613eafa94c3de3207e1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class provides the services for the interface between the bacnet-stack's COV handling and the CDS-based channel data for this process. </p>
<p>It has to map the channel value updates, when they are received, to the correct BACnet objects and provide those objects with the updates; it then triggers the COV notifications.</p>
<p>It also keeps the timer that paces the COV state machine in the bacnet-stack as well as the services within this class. For this, it uses the CTimedObject functionality as a sub-second timer.</p>
<p>The design is this:</p>
<ul>
<li>The activities of the COV Handler in the bacnet-stack are kept separate from the activities of this class, as much as possible (de-coupling).</li>
<li>The inputs from the CdsHandler are the changes in channel values; these have to be mapped to the BACnet objects, which each keep track of whether or not they have an update to report.</li>
<li>We want to ignore channels that are not subscribed to.</li>
<li>So to meet all these goals, we use the following design.</li>
</ul>
<p>Managing the Actively Subscribed List (_actively_subscribed_map):</p>
<ol type="1">
<li>When the bacnet-stack calls <a class="el" href="../../da/d44/group__bac__obj__interface.html#gaf1eaed940e57e8d7645da89887f22a3a" title="Looks up the requested Object type to see if the COV functionality is supported for this type...">Device_Value_List_Supported()</a>, which calls the requested object's get_supports_cov(), we take that as initiating a subscription (if we give the success return) and call <a class="el" href="../../db/d2e/classBacnetCovHandler.html#a1cbbda6a4f72d57db6d70eeefc3e4e78" title="Add or update this object&#39;s entry in the Actively Subscribed List (_actively_subscribed_map) whenever...">update_active_subscription()</a> here. This object is added to the Actively Subscribed list, and the present time is noted.</li>
<li>Whenever the bacnet-stack calls <a class="el" href="../../da/d44/group__bac__obj__interface.html#ga5b3db9c05393e4a626550d32fe9c906c" title="Checks the COV flag (for update needed) in the requested Object of the &quot;current&quot; device. ">Device_COV()</a>, which calls the requested object's get_has_cov_update(), we take that as showing that the subscription is still active. We update the present time for the object in the Actively Subscribed list.</li>
<li>Whenever the COV Timer does its 5 minute update, we check each entry in the Actively Subscribed list and remove any members which have not been updated within the last two minutes.</li>
<li>Each entry in the Actively Subscribed list consists of the channel ID (the key), the last update time (of its membership in this list), and a pointer to its corresponding BACnet object.</li>
</ol>
<p>Managing the map of Recently Updated Channel Values (_pending_channel_updates):</p>
<ol type="1">
<li>Additions are triggered by the CdsHandler calling <a class="el" href="../../db/d2e/classBacnetCovHandler.html#aa4a668d5899c28a92a6cd625ccfae8b4" title="Callback function to handle the channel value change notifications from the CDS. ">channel_values_callback()</a>; we check to see which are listed in the Actively Subscribed List and add those to _pending_channel_updates.</li>
<li>Updates occur if we find an entry already in _pending_channel_updates for a channel; in that case, we merely update its value.</li>
<li>These two operations are designed to be fast, to minimize tying up the CDS thread that calls this callback.</li>
<li>Whenever the COV Timer does its one second update, <a class="el" href="../../db/d2e/classBacnetCovHandler.html#a62c628388571637e9587758d9c2677db" title="Function to manage sending the list of pending updates to each object. ">push_cov_updates()</a> signals to each object indicated in _pending_channel_updates, via update_cov_value(), that the value is updated; the types that use COV_Increment will compare the updated value to that increment to see if they consider this a real update or not; if it is, they will set the object's _has_cov_update flag. When done processing all, the list (_pending_channel_updates) is cleared.</li>
<li>To avoid race conditions between processing and the callback, we will have two lists, and swap to go from _pending_channel_updates to the other (_swapped_channel_updates) for processing.</li>
</ol>
<p>Managing the Has COV Update flag (_has_cov_update):</p>
<ol type="1">
<li>The last thing to manage is this flag, which each BACnet object has set True when it should send a COV notification.</li>
<li>This flag is set when the object is given a value update via update_cov_value() and determines (eg, comparing to COV-Increment) that the value has changed sufficiently from the last COV published value (_last_cov_value) that it should send a COV Notification.</li>
<li>Note that each object that supports COV must keep the a copy of the last published COV value for the "is update?" comparison, even those without COV-Increment (where any change is an update). This is conveniently kept in the <a class="el" href="../../db/d33/classCBacnetPointObject.html" title="Abstract Base Class for several BACnet &quot;Point&quot; measures: These types have many common properties that...">CBacnetPointObject</a> class member _last_cov_value.</li>
<li>When the bacnet-stack calls <a class="el" href="../../da/d44/group__bac__obj__interface.html#gaa50f50012701060a8832ff64ecc72ec3" title="Looks up the requested Object in the &quot;current&quot; device, and fills the Property Value list with the pre...">Device_Encode_Value_List()</a>, which calls the object's get_cov_value_state(), the object will clear its Has COV Update flag </li>
</ol>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00135">135</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a class="anchor" id="aa0ed8e596478b0f1525f6a1f2a97a4fa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::pair&lt;px::CMonoTime, <a class="el" href="../../dd/d0a/classCBacnetObject.html">CBacnetObject</a> *&gt; <a class="el" href="../../db/d2e/classBacnetCovHandler.html#aa0ed8e596478b0f1525f6a1f2a97a4fa">BacnetCovHandler::active_cov_obj_pair_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Typedefs for this class. </p>
<p>Define a type to be the value portion of the Actively Subscribed List. The first member is the time of last COV available enquiry, and the second is a pointer to the referenced BACnet Object instance. The type of the second member here is also aliased as bacObjPtr. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00146">146</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="af395682ff7c2a0156fb0a80a573974ef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef std::map&lt;px::id_t, <a class="el" href="../../db/d2e/classBacnetCovHandler.html#aa0ed8e596478b0f1525f6a1f2a97a4fa">active_cov_obj_pair_t</a>&gt; <a class="el" href="../../db/d2e/classBacnetCovHandler.html#af395682ff7c2a0156fb0a80a573974ef">BacnetCovHandler::actively_subsribed_map_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Define a type for the Actively Subscribed List (actually a map, keyed by the Channel ID). </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00151">151</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a604552a0a64c1631f9dd6722e6e0f39c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BacnetCovHandler::BacnetCovHandler </td>
          <td>(</td>
          <td class="paramtype">std::shared_ptr&lt; px::asio::CIoManager &gt;&#160;</td>
          <td class="paramname"><em>asio_manager</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="../../d7/d39/classCBacnetIpCore.html">CBacnetIpCore</a> &gt;&#160;</td>
          <td class="paramname"><em>bip_core</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructor. </p>
<p>Internal pointer to our <a class="el" href="../../db/d2e/classBacnetCovHandler.html" title="This class provides the services for the interface between the bacnet-stack&#39;s COV handling and the CD...">BacnetCovHandler</a> instance.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">asio_manager</td><td>A reference to the ASIO Manager, needed to initialize the ASIO Actor services that this class inherits. </td></tr>
    <tr><td class="paramname">bip_core</td><td>The main loop handler for this process.</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html#l00069">69</a> of file <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html">bacnet_cov_handler.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a5483cb2f5eb0fffdf360e8defe26dc9a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">BacnetCovHandler::~BacnetCovHandler </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Default destructor. </p>

<p>Definition at line <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html#l00077">77</a> of file <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html">bacnet_cov_handler.cpp</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../db/d2e/classBacnetCovHandler_a5483cb2f5eb0fffdf360e8defe26dc9a_cgraph.png" border="0" usemap="#db/d2e/classBacnetCovHandler_a5483cb2f5eb0fffdf360e8defe26dc9a_cgraph" alt=""/></div>
<map name="db/d2e/classBacnetCovHandler_a5483cb2f5eb0fffdf360e8defe26dc9a_cgraph" id="db/d2e/classBacnetCovHandler_a5483cb2f5eb0fffdf360e8defe26dc9a_cgraph">
<area shape="rect" id="node2" href="../../db/d2e/classBacnetCovHandler.html#a61af971324b65ffae0643327732166a4" title="Close out the COV services. " alt="" coords="209,12,394,39"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a64ae347a69c1c886eaf81e9cdbdc4d96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BacnetCovHandler::init_cov_services </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the COV services. </p>

<p>Definition at line <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html#l00086">86</a> of file <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html">bacnet_cov_handler.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="aa4a668d5899c28a92a6cd625ccfae8b4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BacnetCovHandler::channel_values_callback </td>
          <td>(</td>
          <td class="paramtype">const std::map&lt; px::id_t, px::CValue &gt; &amp;&#160;</td>
          <td class="paramname"><em>ch_map</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const px::CWallTime &amp;&#160;</td>
          <td class="paramname"><em>update_time</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback function to handle the channel value change notifications from the CDS. </p>
<p>Conforms to the template for cds_ch_values_callback_t in the CdsHandler.</p>
<p>Note that this callback actually operates within the CDS Client background thread, and holds up any subsequent notifications from the CDS, so it should copy the map contents to _pending_channel_updates and return as quickly as possible.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ch_map</td><td>The map of changed values, keyed by channel ID. </td></tr>
    <tr><td class="paramname">update_time</td><td>The timestamp of these updated values. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html#l00137">137</a> of file <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html">bacnet_cov_handler.cpp</a>.</p>

</div>
</div>
<a class="anchor" id="a1cbbda6a4f72d57db6d70eeefc3e4e78"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BacnetCovHandler::update_active_subscription </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../dd/d0a/classCBacnetObject.html">CBacnetObject</a> *&#160;</td>
          <td class="paramname"><em>obj_ptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Add or update this object's entry in the Actively Subscribed List (_actively_subscribed_map) whenever this function is called. </p>
<p>Will need to get the CDS ID of the Channel. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">obj_ptr</td><td>A simple pointer to the base BACnet object class for the object. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html#l00216">216</a> of file <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html">bacnet_cov_handler.cpp</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../db/d2e/classBacnetCovHandler_a1cbbda6a4f72d57db6d70eeefc3e4e78_cgraph.png" border="0" usemap="#db/d2e/classBacnetCovHandler_a1cbbda6a4f72d57db6d70eeefc3e4e78_cgraph" alt=""/></div>
<map name="db/d2e/classBacnetCovHandler_a1cbbda6a4f72d57db6d70eeefc3e4e78_cgraph" id="db/d2e/classBacnetCovHandler_a1cbbda6a4f72d57db6d70eeefc3e4e78_cgraph">
<area shape="rect" id="node2" href="../../dd/d0a/classCBacnetObject.html#a82b1378d437074a5d0d4634911bd7ee7" title="A getter for the CDS ID of this object (eg, Channel or Device ID). " alt="" coords="295,5,441,46"/><area shape="rect" id="node3" href="../../dd/d0a/classCBacnetObject.html#a10c6a7ab5827a1de1ea3b1d97513a4f3" title="Getter for this object&#39;s Object_Name. " alt="" coords="251,71,485,97"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a62c628388571637e9587758d9c2677db"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BacnetCovHandler::push_cov_updates </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Function to manage sending the list of pending updates to each object. </p>
<p>Triggered by the one-second timer update. Clears _pending_channel_updates map when done (actually, before processing the list, via swap). </p>

<p>Definition at line <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html#l00275">275</a> of file <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html">bacnet_cov_handler.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../db/d2e/classBacnetCovHandler_a62c628388571637e9587758d9c2677db_icgraph.png" border="0" usemap="#db/d2e/classBacnetCovHandler_a62c628388571637e9587758d9c2677db_icgraph" alt=""/></div>
<map name="db/d2e/classBacnetCovHandler_a62c628388571637e9587758d9c2677db_icgraph" id="db/d2e/classBacnetCovHandler_a62c628388571637e9587758d9c2677db_icgraph">
<area shape="rect" id="node2" href="../../db/d2e/classBacnetCovHandler.html#aafff7357514b855ea0f37e39f67c62e9" title="Timeout callback invoked when the ASIO timer for COV activity timing. " alt="" coords="237,12,440,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a61af971324b65ffae0643327732166a4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void BacnetCovHandler::close </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close out the COV services. </p>
<p>We clean up any pending msgs and subscriptions. </p>

<p>Definition at line <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html#l00316">316</a> of file <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html">bacnet_cov_handler.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../db/d2e/classBacnetCovHandler_a61af971324b65ffae0643327732166a4_icgraph.png" border="0" usemap="#db/d2e/classBacnetCovHandler_a61af971324b65ffae0643327732166a4_icgraph" alt=""/></div>
<map name="db/d2e/classBacnetCovHandler_a61af971324b65ffae0643327732166a4_icgraph" id="db/d2e/classBacnetCovHandler_a61af971324b65ffae0643327732166a4_icgraph">
<area shape="rect" id="node2" href="../../db/d2e/classBacnetCovHandler.html#a5483cb2f5eb0fffdf360e8defe26dc9a" title="Default destructor. " alt="" coords="240,5,395,46"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ad3f8f1a909f4dc9a25c9a1b9e5eb0041"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void BacnetCovHandler::check_active_subscriptions </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Function to periodically check the list of Active Subscriptions and remove any that have aged out (haven't been renewed within _ACTIVE_SUBS_TIMEOUT_SECS). </p>

<p>Definition at line <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html#l00246">246</a> of file <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html">bacnet_cov_handler.cpp</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../db/d2e/classBacnetCovHandler_ad3f8f1a909f4dc9a25c9a1b9e5eb0041_icgraph.png" border="0" usemap="#db/d2e/classBacnetCovHandler_ad3f8f1a909f4dc9a25c9a1b9e5eb0041_icgraph" alt=""/></div>
<map name="db/d2e/classBacnetCovHandler_ad3f8f1a909f4dc9a25c9a1b9e5eb0041_icgraph" id="db/d2e/classBacnetCovHandler_ad3f8f1a909f4dc9a25c9a1b9e5eb0041_icgraph">
<area shape="rect" id="node2" href="../../db/d2e/classBacnetCovHandler.html#aafff7357514b855ea0f37e39f67c62e9" title="Timeout callback invoked when the ASIO timer for COV activity timing. " alt="" coords="243,12,445,39"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="aafff7357514b855ea0f37e39f67c62e9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void BacnetCovHandler::timeout </td>
          <td>(</td>
          <td class="paramtype">const px::asio::CIoTimer &amp;&#160;</td>
          <td class="paramname"><em>timer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Timeout callback invoked when the ASIO timer for COV activity timing. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timer</td><td>A reference to the handler's timer which expired. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html#l00095">95</a> of file <a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html">bacnet_cov_handler.cpp</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="../../db/d2e/classBacnetCovHandler_aafff7357514b855ea0f37e39f67c62e9_cgraph.png" border="0" usemap="#db/d2e/classBacnetCovHandler_aafff7357514b855ea0f37e39f67c62e9_cgraph" alt=""/></div>
<map name="db/d2e/classBacnetCovHandler_aafff7357514b855ea0f37e39f67c62e9_cgraph" id="db/d2e/classBacnetCovHandler_aafff7357514b855ea0f37e39f67c62e9_cgraph">
<area shape="rect" id="node2" href="../../db/d2e/classBacnetCovHandler.html#a62c628388571637e9587758d9c2677db" title="Function to manage sending the list of pending updates to each object. " alt="" coords="259,5,442,46"/><area shape="rect" id="node3" href="../../db/d2e/classBacnetCovHandler.html#ad3f8f1a909f4dc9a25c9a1b9e5eb0041" title="Function to periodically check the list of Active Subscriptions and remove any that have aged out (ha..." alt="" coords="256,70,445,111"/></map>
</div>
</p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a9dd158b6c2bb91cf229df5f99d1456f1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const unsigned int BacnetCovHandler::_COV_TIMEBASE_MSECS = 100</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Configures the value of our sub-second timebase. </p>
<p>Currently set to 100ms. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00209">209</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a99c6ea52784d6aaf79a1d9c877d065d5"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;px::id_t, px::CValue&gt; BacnetCovHandler::_pending_channel_updates</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A map of recently updated channel values, keyed by the channel IDs, holding the last updated value. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00227">227</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a282b421526d0fab32cec7ce3cd591c09"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;px::id_t, px::CValue&gt; BacnetCovHandler::_swapped_channel_updates</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A second map for recently updated channel values, which will be swapped with _pending_channel_updates when we are ready to process the list of updates (to avoid conflicts with <a class="el" href="../../db/d2e/classBacnetCovHandler.html#aa4a668d5899c28a92a6cd625ccfae8b4" title="Callback function to handle the channel value change notifications from the CDS. ">channel_values_callback()</a>). </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00233">233</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a31935fbedca7c4491d260bf0c5c646ec"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../db/d2e/classBacnetCovHandler.html#af395682ff7c2a0156fb0a80a573974ef">actively_subsribed_map_t</a> BacnetCovHandler::_actively_subscribed_map</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The Actively Subscribed List (actually a map, keyed by the Channel ID). </p>
<p>This will be managed as described above in the class overview. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00238">238</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a76c38d8d0ba023fb69390b849613522f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">pthread_rwlock_t BacnetCovHandler::_actively_subscribed_map_rwlock</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Read-write lock to manage access to _actively_subscribed_map from multiple threads. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00243">243</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="af472bd9399b180713ab9e920826e07a6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex BacnetCovHandler::_pending_channel_updates_mutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">mutable</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Mutex to manage access to _pending_channel_updates from multiple threads. </p>
<p>No need to use R/W lock, all functions are writers. When held along with _actively_subscribed_map_rwlock, always taken second. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00249">249</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ad909c25e748aff8508da847a1e8c39ec"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt;<a class="el" href="../../d7/d39/classCBacnetIpCore.html">CBacnetIpCore</a>&gt; BacnetCovHandler::_bip_core</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Pointer back to the core class that created us. </p>
<p>Gives us BACnet message map access. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00262">262</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="ae9b15b95351a93238c09784d0bf978db"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t BacnetCovHandler::_subsec_counter</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A simple up-counter for the _cov_timer; when it reaches 1000/_TIMEBASE_MSECS, then we have the one-second rollover. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00267">267</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a07e2ed65d90a900f7d4759c24461d894"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const unsigned int BacnetCovHandler::_CHECK_ACTIVE_SUBS_SECS = 5 * 60</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Configures the timer setting for checking the Active Subscriptions. </p>
<p>Currently set to 5 minutes. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00271">271</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a39782ce5e08cea2761474821d6411dfa"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const unsigned int BacnetCovHandler::_ACTIVE_SUBS_TIMEOUT_SECS = 2 * 60</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Configures the timeout to use for checking the Active Subscriptions. </p>
<p>Currently set to 2 minutes. Subscriptions which haven't been active for this amount of time are removed. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00276">276</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="aaa9a67a45d5eb79513e25decec57b782"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">size_t BacnetCovHandler::_sec_counter</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>A simple once-per-second up-counter; when it reaches _CHECK_ACTIVE_SUBS_SECS, then it will rollover to 0. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00281">281</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a8fef20aee713114fd0eafe22a2b141ec"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">time_t BacnetCovHandler::_past_miliseconds</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Following variable will store the past value of timer in milliseconds. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00283">283</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<a class="anchor" id="a0d1c20d4362d613eafa94c3de3207e1c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool BacnetCovHandler::_tsm_engine_running</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Following variable will indicate the status of tsm_engine i.e. running/stopped. </p>

<p>Definition at line <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html#l00285">285</a> of file <a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/src/product-ref1/px-toolkit/etn_source/bacnet_ip/include/bacnet/services/<a class="el" href="../../d5/d17/bacnet__cov__handler_8hpp_source.html">bacnet_cov_handler.hpp</a></li>
<li>/src/product-ref1/px-toolkit/etn_source/bacnet_ip/source/bacnet/services/<a class="el" href="../../d8/daf/bacnet__cov__handler_8cpp_source.html">bacnet_cov_handler.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../db/d2e/classBacnetCovHandler.html">BacnetCovHandler</a></li>
    <li class="footer">Generated on Fri May 7 2021 20:25:56 for bacnet_ip by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
