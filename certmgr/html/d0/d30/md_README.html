<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>px-red-certmgr: px-red-certmgr information</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">px-red-certmgr
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d0/d30/md_README.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">px-red-certmgr information </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a repository for certificate management module which helps to generate and store X509 v3 format certificates for each service in a device with asymmetric RSA keys/elliptical curve keys.</p>
<p>This repository contains the code for the certificate manager daemon and library, and also of certcmd a command line tools based on the library.</p>
<p>This is a C++ project: Files are named with cpp or hpp extension.</p>
<h2>Structure of this repository</h2>
<p>Here is the main structure of the project.</p>
<table class="doxtable">
<tr>
<th>Folder </th><th>Description  </th></tr>
<tr>
<td>├── certcmd </td><td>Command line tool which can communicate with a running certmanagd daemon via libcertmgr interface </td></tr>
<tr>
<td>├── certmgr </td><td>Certificate manager sources </td></tr>
<tr>
<td>│   ├── certmanagd </td><td>Daemon sources which are in charge of generation, storage and management of certificates </td></tr>
<tr>
<td>│   ├── common </td><td>Common sources used by the daemon and library </td></tr>
<tr>
<td>│   └── libcertmgr </td><td>Library sources providing interfacing apis to communicate with certmanagd and certcmd </td></tr>
<tr>
<td>├── docs </td><td>Doxygen documentation </td></tr>
<tr>
<td>├── COPYING </td><td>License of the certificate manager daemon </td></tr>
<tr>
<td>├── CMakeLists.txt </td><td>Top level cmake file to build the project </td></tr>
<tr>
<td>├── Reference-Files </td><td>Reference directory containing the various sample configuration files required for device certificate manager functionality </td></tr>
<tr>
<td>└── README.md </td><td>A readme file for the px-red-certmgr repository information </td></tr>
</table>
<h2>Structure of certmanagd source folder</h2>
<table class="doxtable">
<tr>
<th>Folder </th><th>Description  </th></tr>
<tr>
<td>├── CMakeLists.txt </td><td>Cmake file to build the binary </td></tr>
<tr>
<td>├── docs </td><td>Doxygen documentation </td></tr>
<tr>
<td>├── export </td><td>Header files which need to be exported for certmanagd daemon application </td></tr>
<tr>
<td>├── inc </td><td>Header files included for certmanagd daemon </td></tr>
<tr>
<td>├── scripts </td><td>Script file which needs to be installed on the target for network configuration </td></tr>
<tr>
<td>└── src </td><td>Source files included for certmanagd daemon </td></tr>
<tr>
<td>├── <a class="el" href="../../d3/db5/BinaryServiceCallbacks_8cpp.html">BinaryServiceCallbacks.cpp</a> </td><td>Representation of callbacks functions for certificate management daemon </td></tr>
<tr>
<td>├── <a class="el" href="../../d8/d1d/CertificateAuthority_8cpp.html">CertificateAuthority.cpp</a> </td><td>CA representation for certificate management daemon </td></tr>
<tr>
<td>├── <a class="el" href="../../d2/d0c/CertificateInfoStorage_8cpp.html">CertificateInfoStorage.cpp</a> </td><td>Representation of certificate information in read &amp; write format </td></tr>
<tr>
<td>├── <a class="el" href="../../d3/d3b/certmanagd_8cpp.html">certmanagd.cpp</a> </td><td>Tools for certificate management </td></tr>
<tr>
<td>├── <a class="el" href="../../d1/d3c/CnfConfiguration_8cpp.html">CnfConfiguration.cpp</a> </td><td>Representation of the conf configuration for a service for certificate management </td></tr>
<tr>
<td>├── <a class="el" href="../../d5/d6a/CnfFileConfiguration_8cpp.html">CnfFileConfiguration.cpp</a> </td><td>Representation of the cnf file configuration for a service for certificate management </td></tr>
<tr>
<td>├── <a class="el" href="../../d9/dd8/CnfHookConfiguration_8cpp.html">CnfHookConfiguration.cpp</a> </td><td>Representation of the cnfhook file configuration for a service for certificate management </td></tr>
<tr>
<td>├── <a class="el" href="../../d1/d29/Common_8cpp.html">Common.cpp</a> </td><td>This file is used to provide common APIs to be used by certmanagd files </td></tr>
<tr>
<td>├── <a class="el" href="../../de/d4d/ExternalCertificateStorage_8cpp.html">ExternalCertificateStorage.cpp</a> </td><td>Representation of storage for external certificates </td></tr>
<tr>
<td>├── <a class="el" href="../../df/d3b/LibraryWrapperServiceCallbacks_8cpp.html">LibraryWrapperServiceCallbacks.cpp</a> </td><td>Wrapper of callbacks functions for certificate management daemon coming from external library </td></tr>
<tr>
<td>├── <a class="el" href="../../d4/d88/Log_8cpp.html">Log.cpp</a> </td><td>Function to log the activity inside daemon using syslog </td></tr>
<tr>
<td>├── <a class="el" href="../../d4/d3d/NetworkConfiguration_8cpp.html">NetworkConfiguration.cpp</a> </td><td>Representation of the configuration of the network for certificate management </td></tr>
<tr>
<td>├── <a class="el" href="../../dc/dcb/NetworkInfo_8cpp.html">NetworkInfo.cpp</a> </td><td>Representation of the network information for a certificate </td></tr>
<tr>
<td>├── <a class="el" href="../../d2/d21/Openssl_8cpp.html">Openssl.cpp</a> </td><td>This contains a wrapper class that defines and maintains a BIO openssl object </td></tr>
<tr>
<td>├── <a class="el" href="../../db/dd9/Server_8cpp.html">Server.cpp</a> </td><td>Server representation for certificate management </td></tr>
<tr>
<td>├── <a class="el" href="../../d2/dc4/Service_8cpp.html">Service.cpp</a> </td><td>Representation of a service for certificate management </td></tr>
<tr>
<td>└── <a class="el" href="../../d2/d1a/TrustedCertificate_8cpp.html">TrustedCertificate.cpp</a> </td><td>Trusted client representation for certificate management daemon </td></tr>
</table>
<h2>Structure of common source folder</h2>
<table class="doxtable">
<tr>
<th>Folder </th><th>Description  </th></tr>
<tr>
<td>├── export </td><td>Common header files which need to be exported for daemon and library applications </td></tr>
<tr>
<td>├── inc </td><td>Common header files included for both daemon and library </td></tr>
<tr>
<td>└── src </td><td>Common source files included for both daemon and library </td></tr>
<tr>
<td>├── <a class="el" href="../../d6/def/certificate_8cpp.html">certificate.cpp</a> </td><td>Representation of all certificate parameters </td></tr>
<tr>
<td>├── <a class="el" href="../../d0/d4d/CertificateIdCnMap_8cpp.html">CertificateIdCnMap.cpp</a> </td><td>Representation of certificate Ids and common name base on c++ std::map </td></tr>
<tr>
<td>├── <a class="el" href="../../d9/dcb/CertificateIdList_8cpp.html">CertificateIdList.cpp</a> </td><td>Representation of certificate Ids base on c++ std::set </td></tr>
<tr>
<td>├── <a class="el" href="../../d4/d36/CertificateInfo_8cpp.html">CertificateInfo.cpp</a> </td><td>Representation of certificate information in read only </td></tr>
<tr>
<td>├── <a class="el" href="../../d5/d6b/Commands_8cpp.html">Commands.cpp</a> </td><td>Class for commands and function to parse and create commands </td></tr>
<tr>
<td>├── <a class="el" href="../../df/de2/DaemonConfiguration_8cpp.html">DaemonConfiguration.cpp</a> </td><td>Representation of the configuration for the Daemon certificate management </td></tr>
<tr>
<td>├── <a class="el" href="../../dd/d6f/ExternalCertificateAccessor_8cpp.html">ExternalCertificateAccessor.cpp</a> </td><td>External Certificate files accessor which help to get the path of an external certificate and its related files </td></tr>
<tr>
<td>├── <a class="el" href="../../df/d38/InternalCertificatesAccessor_8cpp.html">InternalCertificatesAccessor.cpp</a> </td><td>Internal Certificate files accessor which help to get the path of an internal certificate and its related files </td></tr>
<tr>
<td>├── <a class="el" href="../../d4/d3c/ServiceConfiguration_8cpp.html">ServiceConfiguration.cpp</a> </td><td>Representation of the configuration for a service for certificate management </td></tr>
<tr>
<td>└── <a class="el" href="../../dc/d48/Tools_8cpp.html">Tools.cpp</a> </td><td>Tools for certificate management </td></tr>
</table>
<h2>Structure of libcertmgr source folder</h2>
<table class="doxtable">
<tr>
<th>Folder </th><th>Description  </th></tr>
<tr>
<td>├── CMakeLists.txt </td><td>Cmake file to build the library </td></tr>
<tr>
<td>├── docs </td><td>Doxygen documentation </td></tr>
<tr>
<td>├── export </td><td>Header files which need to be exported for certificate manager library application </td></tr>
<tr>
<td>└── src </td><td>Source files included for certificate manager library </td></tr>
<tr>
<td>├── <a class="el" href="../../d3/d54/CertmanagerApi_8cpp.html">CertmanagerApi.cpp</a> </td><td>Implementation of c++ Api for certificate manager </td></tr>
<tr>
<td>├── <a class="el" href="../../de/d8e/CertmanagerApiException_8cpp.html" title="Implementation of certificate manager API exceptions. ">CertmanagerApiException.cpp</a> </td><td>Implementation of certificate manager API exceptions </td></tr>
<tr>
<td>└── <a class="el" href="../../d2/dd7/OverwrittenData_8cpp.html">OverwrittenData.cpp</a> </td><td>Accessor for data which can be overwritten by the user for each certificate </td></tr>
</table>
<h2>Build Dependencies</h2>
<p>This repository build depends on the following modules:</p>
<ul>
<li><code>px-red-utils</code> - repository to store common libraries and utility files used in various sub modules/ components of the toolkit.</li>
<li><code>Third party components</code> - cxxtoold, openssl, syslog, thread, librt</li>
</ul>
<h2>How to use this repository</h2>
<p>There are two ways to use this repository:</p>
<ul>
<li>Using the 'px-red-certmgr' standalone without the <code>px-toolkit</code> module in any application:<ul>
<li>To use independently, the user need to clone the other dependent repo <code>px-red-utils</code> and add various third party vendor modules</li>
</ul>
</li>
<li>Using the 'px-red-certmgr' as a component of <code>px-toolkit</code><ul>
<li>This repository needs to be cloned at <code><a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/certmgr/v2">https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/certmgr/v2</a></code> level.</li>
<li>If you perform <code>git submodule update --init --recursive</code> operation from px-toolkit level, then <code>px-red-certmgr</code> will get cloned.</li>
<li>To ensure that the certificate manager gets build, please make sure that you have enabled the support for PX-Red's certificate manager module in the configuration file at px-toolkit level.</li>
</ul>
</li>
</ul>
<h2>Configuring your builds</h2>
<p>The build options are provided by the following "config" files:</p>
<ul>
<li><code><a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/shared/shared_make/config">https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/shared/shared_make/config</a></code> - contains default Toolkit package choices.</li>
<li><code><a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/shared/shared_make/depend">https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/shared/shared_make/depend</a></code> - Sets some Toolkit configuration dependencies, based on the configuration choices made.</li>
</ul>
<h1>Configuring the certificate manager</h1>
<p>The certificate manager use a configuration file (by default /etc/certmanagd/config.daemon). Then for each service, the certificate manager need a service configuration file. This includes the service cnfhook files for service server certificate attibutes and configuration options.</p>
<p>You can find a example of those file and more in the Reference-Files folder.</p>
<h2>Creating init script</h2>
<p>The init script file for certmanagd is responsible for configuring and starting the daemon process and all other operations to be performed on daemon ( like start, stop, status, reload, restart ).</p>
<p>Please refer <a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/certmgr/v2/rootfs/etc/init.d/certmanagd">https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/certmgr/v2/rootfs/etc/init.d/certmanagd</a> file for reference for creating init script.</p>
<h2>Configuring daemon configuration file</h2>
<p>This is a configuration file for the certmanagd with the directory paths for IPC files, certificate storage paths and user groups specified.</p>
<p>Please refer <a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/certmgr/v2/rootfs/etc/certmanager/config.daemon">https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/certmgr/v2/rootfs/etc/certmanager/config.daemon</a> file for reference for configuring daemon configuration file.</p>
<h2>Users and groups added for device certificate</h2>
<p>User is the daemonUser specified in config.daemon file that will run the daemon. While creating a new user, we should make sure to assign groups to that user so that it can use a particular service. By default, the "admin" user is added to groups for all the services (PKI and HTTPS by default). Please check the <a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/rootfs/skeleton/etc/group">https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/rootfs/skeleton/etc/group</a> file for reference on creating groups for services and certificate manager daemon.</p>
<p>Group is the list of users who can access the services assigned to them.</p>
<h2>Creating service conf files</h2>
<p>A conf file is a sample file that helps to define configuration information about a standard service. These files hold the callback script path, conf file path, certificate generation and target configurations, openssl engine option, network interface information(s) to be added in the certificate and allowed target(s) among CA, server and trusted client.</p>
<ul>
<li>PKI (Public Key Infrastructure) service: This service can act as a master service to provide signed certificates to other services of the device. This service is by default configured to generate self-signed certificates which act as master certificate.</li>
<li>HTTPS service: In this case, by default, this service will get its server certificate signed by the pki1 service.</li>
</ul>
<p>Please refer <a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/mercury_server/rootfs/etc/certmanager/services/https.conf">https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/mercury_server/rootfs/etc/certmanager/services/https.conf</a> file for reference on creating service conf files.</p>
<h2>Creating service cnfhook files</h2>
<p>Cnfhook file is a sample file that describes the service server certificate attibutes and configuration options. These files hold the configuration key (RSA2048, SECP256K1, SECP384R1, SECP521R1, PRIME256V1), size of keys (default: 2048), algorithm to use (sha256), extensions to add to a certificate request, common name, email address for who to contact (CA), Country, State, City, Organization Names and units.</p>
<p>Please refer <a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/mercury_server/rootfs/usr/share/certmanager/cnfhook-https.hook">https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/mercury_server/rootfs/usr/share/certmanager/cnfhook-https.hook</a> file for reference on creating service cnfhook files.</p>
<h2>Creating callback scripts</h2>
<p>This is a sample file that describes how to handle different system operations, when a operation happens in service certificates. These files hold the actions to be performed on service certificates in case of any operations or events in the system.</p>
<p>Please refer <a href="https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/mercury_server/rootfs/usr/share/certmanager/callback-https.sh">https://bitbucket-prod.tcc.etn.com/projects/LNXTK/repos/px-toolkit/browse/etn_source/mercury_server/rootfs/usr/share/certmanager/callback-https.sh</a> for reference on creating service callback scripts</p>
<h2>Daemon notification about network change</h2>
<ul>
<li>In case of any change in the network, the daemon is notified and a reload operation occurs for all the services.</li>
<li>Each service checks whether the certificate needs to be renewed with updated network information.</li>
<li>E.g., if the IP address of a network interface gets changed, then https certificate will be regenerated as it depends on all N/W interfaces whereas PKI1 will not get renewed.</li>
</ul>
<h2>Daemon notification about time change</h2>
<ul>
<li>In case of time change detected, the certmanagd gets notified and the existing certificates are checked for validity.</li>
<li>At first, the daemon will go through all the PKI services (service name starts with PKI) and will check if any certificate is not valid anymore either due to start date or expiry date.</li>
<li>Then the daemon will regenerate a new certificate for that service. Same will be done for all other services.</li>
<li>In addition to that, the CA/PKI services will also raise a time reloads notification for renewing their dependent service certificates as they are renewed.</li>
<li>The device will have a ‘time-change-notifier’ which will be responsible for time change detection and intimation to the daemon.</li>
<li>By default, it detects drift bigger than 1 seconds, on an interval of 2 seconds. </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 7 2021 20:24:54 for px-red-certmgr by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
