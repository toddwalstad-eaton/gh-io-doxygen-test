<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ptpd: PTP Daemon (ptpd)</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">ptpd
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Classes</span></a></li>
      <li><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('d0/dcf/md__src_product-ref1_px-toolkit_etn_source_ptpd_docs_PTP_Config_Status_OOB_Guide.html','../../');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">PTP Daemon (ptpd) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>PX-Red uses a third party vendor source package LinuxPTP-3.1 to synchronize local PTP hardware clock or system clock with PTP master instance.</p>
<p>At startup ,</p>
<ul>
<li>It reads the PTP configuration parameter from the 'PtpConfig' OOB and update the 'ptp4l' config file located at '/etc/ptp_default.cfg'</li>
<li>Later, it starts the 'ptp4l' and 'phc2sys' service ('phc2ys won't spawned in case of Software Timestamping mode ').</li>
<li>Then it spawns 'pmc'-PTP Management client utility to poll few status parameters at configurable poll interval and update it to 'PtpStatus' OOB.</li>
</ul>
<p>It supports both hardware and software timestamping slave mode with build time configurable parameter 'CONFIG_ENABLE_HW_TIMESTAMP_PTPD'</p>
<p>The default is hardware timestamping mode.</p>
<p>Hardware timestamp mode:</p>
<ul>
<li>"ptp4l" instance is spawned with hardware timestamping flag, which sync the local PTP hardware clock with PTP master's clock.</li>
<li>"phc2sys" is also spawned with "ptp4l", which sync the local system clock with local PTP hardware clock.</li>
</ul>
<p>Software timestamp mode:</p>
<ul>
<li>"ptp4l" instance is spawned with software timestamping flag, which sync the local system clock with master's clock.</li>
<li>"phc2sys" won't be spawned in this mode, as ptp4l itself sync the local system clock time with PTP master's clock.</li>
</ul>
<h2>Configsubscriber Initialization and Action Scripts for PTP</h2>
<p>The <a href="../../../rootfs/etc/configsubscriber/configsubscriber-ptpd.json">configsubscriber-ptpd.json</a> initialization file sets up the following change event actions on Out-of-Band (OOB) object updates:</p>
<ul>
<li>If the <code>PtpConfig</code> OOB is changed, then the <a href="../../../rootfs/etc/init.d/ptpd">`ptpd`</a> scripts get called, which restrart 'ptpd' service with updated configuration parameter.</li>
</ul>
<h2>PTP Out-of-Band (OOB) Object Initialization</h2>
<p>The following JSON files intitialize the default data for the OOBs defined below.</p>
<ul>
<li><a href="../../../rootfs/etc/cds/generic/71_ptpd_defaults.json">Default initialization for the 'PtpConfig' and 'PtpStatus' OOBs</a>.</li>
<li><code>PtpStatus</code> and <code>PtpConfig</code> OOB documentation are below.</li>
</ul>
<h1>PTP Daemon Configuration and Status Out-of-Band (OOB) Objects</h1>
<p>The following PTP OOB objects support the configuration and status of the PTP daemon <code>ptpd</code>:</p>
<ul>
<li>PtpConfig - PTP configuration.</li>
<li>PtpStatus - PTP status.</li>
</ul>
<h2>PtpConfig OOB</h2>
<p>Configurable fields for "ptp4l" service</p>
<h3>Fields</h3>
<h4>enable</h4>
<p>Enable/Disable PTPD service.</p>
<p>The default is false.</p>
<h3>network_transport</h3>
<p>Select the network transport. Possible values are:</p>
<ul>
<li>"UDPv4"</li>
<li>"UDPv6"</li>
<li>"L2" - Raw Ethernet</li>
</ul>
<p>The default is L2.</p>
<h3>slave_only</h3>
<p>Switch to 'Master' or 'Slave' PTP mode. Possible values are:</p>
<ul>
<li>true - PTP slave mode.</li>
<li>false - PTP master mode.</li>
</ul>
<p>Note: Currently, PX-Red supports only slave mode. This flag is future purpose only, when master get supported in PX-Red.</p>
<p>The default is true.</p>
<h3>domain_number</h3>
<p>The domain attribute of the local clock.</p>
<p>The domain_number is the primary mechanism for end users and system integrators to isolate the operation of a PTP Instance from PTP messages used in other domains.</p>
<p>Range - 0 to 255.</p>
<p>The default is 0.</p>
<h3>priority1</h3>
<p>The attribute priority1 is used in the execution of the best master clock algorithm.</p>
<p>Lower values take precedence.</p>
<p>Range - The value of priority1 shall be configurable to any value in the range 0 to 255 unless restricted by limits established by the applicable PTP Profile.</p>
<p>The default is 128.</p>
<h3>priority2</h3>
<p>The attribute priority2 is used in the execution of the best master clock algorithm.</p>
<p>Lower values take precedence.</p>
<p>Range - The value of priority2 shall be configurable to any value in the range 0 to 255 unless restricted by limits established by the applicable PTP Profile.</p>
<p>The default is 128.</p>
<p>NOTE—In the event that the operation of the best master clock algorithm fails to order the PTP Instances based on the values of priority1, clockClass, clockAccuracy, and scaledOffsetLogVariance, the priority2 attribute allows the creation of up to 256 priorities to be evaluated before the tiebreaker. The tiebreaker is based on the clockIdentity.</p>
<h3>interface</h3>
<p>String - Network interface on which PTP instance will listen for PTP messages.</p>
<p>The default is "eth0".</p>
<h3>PTP Clock</h3>
<p>String - PTP hardware clock used for Hardware timestamping.</p>
<p>The default is "/dev/ptp0".</p>
<h3>status_poll_interval</h3>
<p>The poll rate at which PTP status get polled from local ptp4l instance.</p>
<p>Range - 5 to 50 seconds.</p>
<p>The default is 10 seconds.</p>
<h3>Example</h3>
<p>```json { "toolkitStruct": { "ptp_config": { "enable":true, "network_transport":"L2", "slave_only":true, "domain_number":0, "priority1":128, "priority2":128, "interface":"eth0", "ptp_clock":"/dev/ptp0", "status_poll_interval":5 }, "description":"PTP settings", "label":"PtpConfig" } }</p>
<p>```</p>
<h2>PtpStatus OOB</h2>
<p>Status of 'ptp4l' service</p>
<h3>Fields</h3>
<h4>port_identity.clock_identity</h4>
<p>String - MAC based identity of local PTP clock.</p>
<h4>port_idenity.port_number</h4>
<p>Uint32 -An index identifying a specific PTP Port on a local PTP Instance.</p>
<h4>state</h4>
<p>Enum - Value of the current state of the protocol engine associated with local PTP Port.</p>
<p>The possiable values are:</p>
<ul>
<li>"INITIALIZING"</li>
<li>"FAULTY"</li>
<li>"DISABLED"</li>
<li>"LISTENING"</li>
<li>"PRE_MASTER"</li>
<li>"MASTER"</li>
<li>"PASSIVE"</li>
<li>"UNCALIBRATED"</li>
<li>"SLAVE"</li>
</ul>
<h4>steps_removed</h4>
<p>This represents How many hops the local PTP instance is far from the Grand Master.</p>
<p>Suppose, If local PTP instance is directly connected to Grand master (with no Boundry Clock) than value would be '1'.</p>
<h4>parent_port_identity.clock_identity</h4>
<p>String - MAC based identity of parent PTP clock.</p>
<p>In case, if no Boundry Clock (BC) between Slave and GrandMaster, than value of grandmaster_clock_identity and parent_clock_idenity remains identical.</p>
<h4>parent_port_identity.port_number</h4>
<p>An index identifying a specific PTP Port on a parent PTP Instance.</p>
<h4>grand_master_clock_identity</h4>
<p>MAC based identity of GrandMaster PTP clock.</p>
<h4>grand_master_clock_quality.clock_class</h4>
<p>This is the configurable parameter in ptp4l GrandMaster instance.</p>
<p>This is the value from Grand Master PTP instance , not from local PTP instance.</p>
<p>An attribute defining the TAI traceability, synchronization state, and expected performance of the time or frequency distributed by a Boundary Clock or Ordinary Clock.</p>
<p>The clockClass attribute of the GM clock. It denotes the traceability of the time distributed by the grandmaster clock.</p>
<p>The default value is 248.</p>
<p>Refer Table:4 for clockClass specifications from IEEE 1588-2019 specifications.</p>
<h4>grand_master_clock_quality.clock_accuracy</h4>
<p>The clockAccuracy is one of the attribute that characterizes a PTP Instance for the purpose of the best master clock algorithm.</p>
<p>This is the value from Grand Master PTP instance , not from local PTP instance.</p>
<p>It indicates the expected accuracy of a PTP Instance when it is the Grandmaster PTP Instance.</p>
<p>The default value is 0xfe.</p>
<p>Refer Table 5—clockAccuracy enumeration from IEEE 1588-2019 specifications.</p>
<h4>grand_master_clock_quality.clock_log_variance</h4>
<p>The offsetScaledLogVariance attribute of the GrandMaster clock. It characterizes the stability of the clock.</p>
<p>This is the value from Grand Master PTP instance , not from local instance.</p>
<p>The offsetScaledLogVariance is also one of the attribute that characterizes a PTP Instance for the purpose of the best master clock algorithm.</p>
<p>The default value is 0xFFFF.</p>
<h3>Example</h3>
<p>'''json { "toolkitStruct": { "ptp_status": { "port_identity": { "clock_identity":"fc6947.fffe.1eac51", "port_number":1 }, "state":"SLAVE", "steps_removed":1, "parent_port_identity": { "clock_identity":"10e7c6.fffe.431ba7", "port_number":1 }, "grand_master_clock_identity":"10e7c6.fffe.431ba7", "grand_master_clock_quality": { "clock_class":248, "clock_accuracy":253, "clock_log_variance":65535 }, } } } ''' </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri May 7 2021 20:25:53 for ptpd by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
